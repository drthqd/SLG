window.app={AppConstants:{START_UP:"StartUp",INIT:"Init",LOAD:"Load"},GameData:{url:"data/",serverId:null,uid:23,imageSrc:"images/",cndImgSrc:"http://test.gswsapi.the9.com/gsws/client/images/",gameCanvas:null,gameDiv:null,gameStage:null,UIFormDiv:null,GameResource:null,hero:null},getServiceURL:function(){return 0<=location.href.indexOf("http://localhost")||0<=location.href.indexOf("http://127.0.0.1")?DEBUG_URL:app.GameData.url},trace:function(){if(!0==_DEBUG){var b=Array.prototype.slice.call(arguments).join(" "),
c=new Date;console.log("["+toFix(c.getMinutes(),2)+":"+toFix(c.getSeconds(),2)+"]",b)}},getStyle:function(b){return"fc7,fc7,fc12,fc4,fc1,fc9,fc3,fc2".split(",")[b]},numberToCN:function(b){return",\u4e00,\u4e8c,\u4e09,\u56db,\u4e94".split(",")[b]}};window.app.Event={CLICK:Touch.isSupported()?"touchend":"click",MOVE:Touch.isSupported()?"touchmove":"mousemove",MOUSE_UP:Touch.isSupported()?"touchend":"mouseup",MOUSE_DOWN:Touch.isSupported()?"touchstart":"mousedown",ONCLICK:Touch.isSupported()?"ontouchend":"onclick",ONMOVE:Touch.isSupported()?"ontouchmove":"onmousemove",ONMOUSE_DOWN:Touch.isSupported()?"ontouchstart":"onmousedown",ONMOUSE_UP:Touch.isSupported()?"ontouchend":"onmouseup"};if(!("indexOf"in Array))Array.prototype.indexOf=function(b){for(var c=0;c<this.length;c++)if(this[c]==b)return c;return-1};Array.DESC=1;Array.ASC=0;function sortOn(b,c,e){var f=c.split("."),e=e||Array.ASC;b.sort(function(b,c){for(var j=b[f[0]],k=c[f[0]],l=1;l<f.length;l++)j=j[f[l]],k=k[f[l]];return j<k?e==Array.ASC?-1:1:j>k?e==Array.ASC?1:-1:0})}function $(b){return document.getElementById(b)}function toFix(b,c){c||(c=1);for(var e=b.toString(),f=c-e.length;0<f;)e="0"+e,f--;return e}
function clone(b){var c={},e;for(e in b)c[e]=b[e];return c}function hasClass(b,c){return b.className.match(RegExp("(\\s|^)"+c+"(\\s|$)"))}function addClass(b,c){this.hasClass(b,c)||(b.className+=" "+c)}function removeClass(b,c){if(hasClass(b,c))b.className=b.className.replace(RegExp("(\\s|^)"+c+"(\\s|$)")," ")};puremvc.define({name:"app.GameFacade",parent:puremvc.Facade},{startup:function(){if(!this.initialized)this.initialized=!0,app.trace("GameFacade StartUp"),app.proxy.DataService.getInstance().facade=this,this.registerCommand(app.AppConstants.START_UP,app.command.StartUpCommand),this.sendNotification(app.AppConstants.START_UP)}},{getInstance:function(b){var c=puremvc.Facade.instanceMap;return(instance=c[b])?instance:c[b]=new app.GameFacade(b)},NAME:"GameFacade"});puremvc.define({name:"app.controller.TimeController",constructor:function(){this._timer=new Timer(1E3);this._timer.start()}},{addListener:function(b){this._timer.addListener(b)},removeListener:function(b){this._timer.removeListener(b)}},{_instance:null,getInstance:function(){if(null==app.controller.TimeController._instance)app.controller.TimeController._instance=new app.controller.TimeController;return app.controller.TimeController._instance}});puremvc.define({name:"app.controller.RepeatAction",constructor:function(b,c,e,f){this.handler=b;this.startTime=c||0;this.delayTime=e||0;this.repeatCount=f||0;this.count=0;this.firstRun=!0}},{startTime:0,delayTime:0,repeatCount:-1,count:0,handler:null,timeID:null,start:function(){this.stop();if(0<this.repeatCount||-1==this.repeatCount){var b=this.firstRun?this.startTime:this.delayTime;this.timeID=setTimeout(ClassUtils.delegate(this,this.timeOut),1E3*b);this.firstRun=!1}},stop:function(){this.timeID&&
clearTimeout(this.timeID);this.timeID=null},reset:function(){this.stop();this.count=0;this.firstRun=!0},timeOut:function(){0<this.repeatCount&&this.repeatCount--;this.handler&&this.handler();this.start()},depose:function(){this.stop();this.handler=null}});puremvc.define({name:"app.controller.battle.BatchStep",constructor:function(b){this.handlers=[];this.target=b;this.isComplete=!1}},{handlers:null,target:null,isComplete:!1,add:function(b,c){this.handlers.push({troop:b,hp:c})},next:function(){if(0<this.handlers.length){var b=this.handlers.shift();this.target._scene.showHp(b.troop,b.hp,ClassUtils.delegate(this,this.next,b.hp))}else this.isComplete=!0,this.target&&this.target.complete()},depose:function(){this.handlers=[];this.target=null}});puremvc.define({name:"app.controller.battle.BattleStep",constructor:function(b){this.data=b;this.index=0}},{index:0,_scene:null,data:null,macroCommand:null,next:function(){null!=this.macroCommand&&this.macroCommand.nextStep()},execute:function(){}});puremvc.define({name:"app.controller.battle.BattleDelay",parent:app.controller.battle.BattleStep},{execute:function(){var b=this;setTimeout(function(){b.next()},this.data)}});puremvc.define({name:"app.controller.battle.BattleRecord",constructor:function(b){this._scene=b;this.index=0;this._records=[]}},{index:0,_scene:null,_records:[],complete:null,addStep:function(b){this._records.push(b)},nextStep:function(){if(0<this._records.length){var b=this._records.shift();b.index=this.index++;b._scene=this._scene;b.macroCommand=this;b.execute()}else this.complete&&this.complete(),this.complete=null},stopLoop:function(){this.complete&&this.complete();this.depose()},depose:function(){if(this._records)for(var b=
0;b<this._records.length;b++)this._records[b]._scene=null,this._records[b].macroCommand=null;this._scene=null;this._records=[];this.complete=null;this.index=0}});puremvc.define({name:"app.controller.battle.BattleActStep",parent:app.controller.battle.BattleStep},{execute:function(){for(var b=this.data,c,e=!0,f=b.length,g=0;g<f;g++)null!=b[g].skill&&(e=!1,c=this._scene.troops[b[g].pos],b[g].actor?(c.attack(),b[g].isRange&&this._scene.showActText(b[g],"\u66b4\u51fb"),b[g].backFight&&this._scene.showActText(b[g],"\u53cd\u51fb"),this._scene.showSkillText(b[g]),this.next()):0<b[g].skill?this._scene.showSkill(b[g],g==b.length-1?ClassUtils.delegate(this,this.complete):
null):g==b.length-1&&this.complete());e&&this.complete()},complete:function(){this.next()}});puremvc.define({name:"app.controller.battle.BattleUpdateBuffer",parent:app.controller.battle.BattleStep},{execute:function(){for(var b=this.data,c=b.length,e=0;e<c;e++)this._scene.updateBuffer(b[e]),this._scene.updateMorale(b[e]),this._scene.isAlive(b[e]);var f=this;setTimeout(function(){f.next()},300)}});puremvc.define({name:"app.controller.battle.BattleUpdateHp",parent:app.controller.battle.BattleStep},{random:0,execute:function(){var b=this.data,c,e,f;this.batchs=[];f=!0;for(var g=b.length,h=0,j=0;j<g;j++)if(c=b[j].hp,e=this._scene.troops[b[j].pos],null!=c&&0<c.length){h=c.length;f=new app.controller.battle.BatchStep(this);for(var k=0;k<h;k++)f.add(e,c[k]);this.batchs.push(f);f.next();f=!1}f&&this.next()},complete:function(){var b=!0,c=this.batchs.length,e;for(e=0;e<c;e++)if(!this.batchs[e].isComplete){b=
!1;break}if(b){for(e=0;e<c;e++)this.batchs[e].depose();this.batchs=null;this.next()}}});puremvc.define({name:"app.controller.WarfareController",constructor:function(b,c,e,f,g){this.attacker=b;this.defender=c;this.fightMovie=e;this.winMovie=f;this.lossMovie=g}},{_speed:2,data:null,handler:null,move:function(b){var c=function(){this.attacker.arrived||(this.attacker.x+=this._speed,this.attacker.checkArrived());this.defender.arrived||(this.defender.x-=this._speed,this.defender.checkArrived());this.attacker.arrived&&this.defender.arrived&&(this.stop(),this.fight(),b&&b())};this.attacker.arrived||
this.attacker.move();this.defender.arrived||this.defender.move();this.stop();!this.attacker.arrived||!this.defender.arrived?this.timeID=setInterval(ClassUtils.delegate(this,c),60):b&&b()},stop:function(){this.timeID&&clearInterval(this.timeID);this.timeID=null},fight:function(b){this.stop();this.timeID=setTimeout(ClassUtils.delegate(this,function(){this.fightMovie&&this.fightMovie.parent&&this.fightMovie.parent.removeChild(this.fightMovie);this.showHp();b&&b()}),2E3+Math.round(1E3*Math.random()));
this.fightMovie.x=this.defender.x-10;this.fightMovie.y=this.defender.y+15;this.attacker.parent.addChild(this.fightMovie);this.fightMovie.gotoAndPlay(0)},showHp:function(){app.view.battle.NumberMovie.showMovie(30,0,this.data.attackerLoss,this.attacker,null,0.6);app.view.battle.NumberMovie.showMovie(30,0,this.data.defenserLoss,this.defender,ClassUtils.delegate(this,function(){this.showResult()}),0.6)},showResult:function(){var b,c=this.attacker.parent;1==this.data.result?(this.attacker.cheer(),this.defender.parent.removeChild(this.defender),
b=this.attacker,this.winMovie.scaleX=-1,this.lossMovie.x=this.defender.x,this.lossMovie.y=this.defender.y,this.data.effect&&this.throwGroop(this.lossMovie,c,this.defender.x+50,this.defender.y-50)):-1==this.data.result?(this.defender.cheer(),this.attacker.parent.removeChild(this.attacker),b=this.defender,this.winMovie.scaleX=1,this.lossMovie.x=this.attacker.x,this.lossMovie.y=this.attacker.y,this.lossMovie.scaleX=-1,this.data.effect&&this.throwGroop(this.lossMovie,c,this.attacker.x-50,this.attacker.y-
50)):(this.defender.parent.removeChild(this.defender),this.attacker.parent.removeChild(this.attacker));if(b)this.winMovie.x=30,this.winMovie.y=10,b.addChild(this.winMovie),this.winMovie.gotoAndPlay(0),this.timeID=setTimeout(ClassUtils.delegate(this,function(){this.timeID=null;b.removeChild(this.winMovie);b.standup();b=null;this.lossMovie.parent&&this.lossMovie.parent.removeChild(this.lossMovie);this.handler&&this.handler(this.data.bid,this.getDescript());this.handler=null}),2E3)},getDescript:function(){var b;
switch(this.data.result){case 1:b="\u80dc\u5229\u4e86";break;case -1:b="\u5931\u8d25\u4e86";break;default:b="\u4e0d\u5206\u80dc\u8d1f"}return"<span class='fc4'>"+this.attacker.data.name+"</span>\u653b\u6253<span class='fc4'>"+this.defender.data.name+"</span>"+b},throwGroop:function(b,c,e,f,g){c.addChild(b);b.gotoAndPlay(0);Tween.get(b,{loop:!1}).to({x:e,y:f,alpha:0},1E3,Ease.get(1)).call(function(){c.removeChild(b);g&&g.call(this)},null,this)},depose:function(){this.timeID&&clearTimeout(this.timeID);
this.lossMovie=this.winMovie=this.fightMovie=this.defender=this.attacker=handler=this.timeID=null}});puremvc.define({name:"app.command.CommandType"},{},{INIT:"CommandType_Init",GO_SCENE:"CommandType_GOScene",LEVEL_UP:"CommandType_LevelUp",Grain:"CommandType_Farm",CLEAR_INDICATE_TIME:"ClearIndicateTimeCommand",QUICKEN_COMMAND:"QuickenCommand",ADD_BAGSIZE:"CommandType_addBagSize",ITEM_DOWNGRADE:"CommandType_itemDowngrade",ITEM_UPGRADE:"CommandType_itemUpgrade",ITEM_GET:"CommandType_itemGet",ITEM_SELL:"CommandType_itemSell",SHOP:"CommandType_shop",LOAD_BATTLEMAP:"CommandType_loadBattleMap",SHOW_NEW_HERO:"CommandType_showNewHero",
PAY:"CommandType_pay",TOP_MENU_SHINE:"CommandType_topMenuShine",SIMPLE_BATTLE_RESULT:"CommandType_simpleResult",CLEAR_TIME_HANDLE:"Clear_time_handle",ADD_BUILDDINGSIZE:"add_buildding_size"});puremvc.define({name:"puremvc.AsyncCommand",parent:puremvc.SimpleCommand},{macroCommand:null,commandComplete:function(){null!=this.macroCommand&&this.macroCommand.nextCommand()}});puremvc.define({name:"puremvc.AsyncMacroCommand",parent:puremvc.MacroCommand,constructor:function(){puremvc.MacroCommand.call(this)}},{subCommands:null,initializeMacroCommand:function(){},addSubCommand:function(b){this.subCommands.push(b)},execute:function(b){this.note=b;this.nextCommand()},commandComplete:function(){},nextCommand:function(){if(0<this.subCommands.length){var b=new (this.subCommands.shift());b.macroCommand=this;b.initializeNotifier(this.multitonKey);b.execute(this.note)}else this.commandComplete()}});puremvc.define({name:"app.command.InitCommand",parent:puremvc.AsyncMacroCommand},{initializeMacroCommand:function(){app.trace("Execute InitCommand");this.addSubCommand(app.command.ViewPorterCommand);this.addSubCommand(app.command.LoadDataBaseCommand);this.addSubCommand(app.command.LoadInitDataCommand);this.addSubCommand(app.command.LoadCacheCommand)},commandComplete:function(){app.trace("InitCommand Complete");this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.HomeMediator);
this.facade.retrieveProxy(app.proxy.ChatProxy.NAME).received()}});puremvc.define({name:"app.command.ViewPorterCommand",parent:puremvc.AsyncCommand},{first:!0,execute:function(){app.trace("ViewPorterCommand Execute!");this.init();window.addEventListener("selectstart",function(){return!1},!1);window.addEventListener("touchmove",function(b){b.preventDefault()});window.addEventListener("resize",this);this.setGame(window.innerWidth>=window.innerHeight);this.commandComplete()},handleEvent:function(b){switch(b.type){case "resize":this.setGame(window.innerWidth>=window.innerHeight)}},
init:function(){if(!app.GameData.gameCanvas){app.GameData.gameCanvas=document.createElement("canvas");app.GameData.gameStage=new Stage(app.GameData.gameCanvas);app.GameData.gameCanvas.style.cssText="position:absolute; left:0px; top:0px";Touch.isSupported()&&Touch.enable(app.GameData.gameStage);app.GameData.gameDiv=this._createDiv("position:absolute; left:0px; top:0px");app.GameData.UIFormDiv=this._createDiv("position:absolute; left:0px; top:0px");var b=document.getElementById("viewporter");b.appendChild(app.GameData.gameCanvas);
b.appendChild(app.GameData.gameDiv);b.appendChild(app.GameData.UIFormDiv);b=document.createElement("div");b.id="oriLock";b.style.position="absolute";b.style.top=0;b.style.left=0;b.style.bottom=0;b.style.right=0;b.style["background-color"]="#000000";b.style.color="#ffffff";b.style["font-size"]="20px";b.style["padding-top"]="20px";b.style.display="none";b.innerHTML="\u4e3a\u4e86\u4f53\u9a8c\u6700\u597d\u7684\u6e38\u620f\u6548\u679c\uff0c\u8bf7\u65cb\u8f6c\u60a8\u7684\u624b\u6301\u8bbe\u5907.";document.body.appendChild(b)}},
setGame:function(b){if(b){var c=app.GameData.gameCanvas,e=Math.min(window.innerWidth,650),f=Math.ceil(268/480*e);c.width=e;c.height=f;c.style.left="0px";c.style.top="0px";app.GameData.gameStage.update();setTimeout(function(){window.scrollTo(0,0)},50);this.sendNotification(app.mediator.system.LoadMediator.ONSIZE)}document.getElementById("oriLock").style.display=b?"none":"block";b?this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!0):this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,
!1)},_createDiv:function(b){var c=document.createElement("div");c.style.cssText=b;return c}});puremvc.define({name:"app.command.LoadCacheCommand",parent:puremvc.AsyncCommand},{execute:function(){var b=[{id:"allHtml",src:"data/html.zb"},{id:"building_tip",src:app.GameData.imageSrc+"ui/lvbg.png"},{id:"levelup",src:app.GameData.imageSrc+"effect/levelup.png"},{id:"levelup_data",src:app.GameData.imageSrc+"effect/levelup.zb"},{id:"pointer",src:app.GameData.imageSrc+"effect/troop_pointer.png"},{id:"pointer_data",src:app.GameData.imageSrc+"effect/troop_pointer.zb"},{id:"uieff_05",src:app.GameData.imageSrc+
"uieff/uieff_05.png"},{id:"uieff_05_data",src:app.GameData.imageSrc+"uieff/uieff_05.zb"},{id:"uieff_03",src:app.GameData.imageSrc+"uieff/uieff_03.png"},{id:"uieff_03_data",src:app.GameData.imageSrc+"uieff/uieff_03.zb"},{id:"uieff_11",src:app.GameData.imageSrc+"uieff/uieff_11.png"},{id:"uieff_11_data",src:app.GameData.imageSrc+"uieff/uieff_11.zb"},{id:"uieff_10",src:app.GameData.imageSrc+"uieff/uieff_10.png"},{id:"uieff_10_data",src:app.GameData.imageSrc+"uieff/uieff_10.zb"},{id:"jiantou",src:app.GameData.imageSrc+
"ui/jiantou.png"}],c=this.facade.retrieveProxy(app.proxy.HomeProxy.NAME),b=b.concat(c.getData(),c.getHomeMapInfo());app.trace("LoadCacheCommand start");0<b.length?(c=ClassUtils.delegate(this,this.onComplete),this.sendNotification(app.AppConstants.LOAD,{value:b,callback:c,descript:"\u52a0\u8f7d\u56fe\u7247\u8d44\u6e90\u6587\u4ef6\uff0c\u8bf7\u8010\u5fc3\u7b49\u5019\u2026"})):onComplete(null)},onComplete:function(b){app.trace("LoadCacheCommand complete");this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource=
b;app.GameData.GameResource=b;this.facade.retrieveMediator(app.mediator.system.PopUpMsgMediator.NAME).template=b.getContent("popup_msg");this.commandComplete()}});puremvc.define({name:"app.command.LoadDataBaseCommand",parent:puremvc.AsyncCommand},{preDataList:[{id:"homeData",src:"data/Home.zb"}],execute:function(){app.trace("Execute LoadDataBaseCommand!");var b={value:this.preDataList,callback:ClassUtils.delegate(this,this.onComplete),descript:"\u52a0\u8f7d\u6e38\u620f\u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u8010\u5fc3\u7b49\u5019\u2026"};this.sendNotification(app.AppConstants.LOAD,b)},onComplete:function(b){app.trace("\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u5b8c\u6bd5!");
b=b.getContent("homeData");app.data.DataBase.getInstance().setData(b);this.commandComplete()}});puremvc.define({name:"app.command.LoadInitDataCommand",parent:puremvc.AsyncCommand},{execute:function(){app.trace("Execute LoadInitDataCommand");this.facade.retrieveProxy(app.proxy.InitProxy.NAME).getInitInfo(ClassUtils.delegate(this,this.onComplete))},onComplete:function(){app.trace("\u6e38\u620f\u6570\u636eint.json\u8bf7\u6c42\u5b8c\u6bd5");this.facade.retrieveProxy(app.proxy.HomeProxy.NAME).init();this.commandComplete()}});puremvc.define({name:"app.command.GoSceneCommand",parent:puremvc.SimpleCommand},{execute:function(b){var c=[],e=b.getBody(),f,b="\u52a0\u8f7d\u8d44\u6e90\u6587\u4ef6\u2026",g;this.typeName=null;switch(e){case app.mediator.scene.HomeMediator:this.typeName="\u4e3b\u57ce";break;case app.mediator.scene.BattleMapMediator:this.typeName="\u526f\u672c";break;case app.mediator.scene.BattleFieldMediator:g=this.facade.retrieveProxy(app.proxy.BattleProxy.NAME);c=c.concat(g.getBattleResource());f=g.data;g.clear();
b="\u52a0\u8f7d\u6218\u6597\u8d44\u6e90\u6587\u4ef6\u2026";break;case app.mediator.scene.WorldMediator:g=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME);if(!1==g.loadResourceStatus)c=c.concat(this.facade.retrieveProxy(app.proxy.WorldProxy.NAME).getWorldResource()),b="\u52a0\u8f7d\u4e16\u754c\u573a\u666f\u6587\u4ef6\u2026",g.loadResourceStatus=!0;this.typeName="\u4e16\u754c";break;case app.mediator.scene.ResourceMediator:g=this.facade.retrieveProxy(app.proxy.ResProxy.NAME);if(!1==g.loadResourceStatus)c=
c.concat([{id:"resourceBg_silver",src:app.GameData.imageSrc+"scene/resourceBg_silver.jpg"},{id:"resourceBg_farm",src:app.GameData.imageSrc+"scene/resourceBg_farm.jpg"},{id:"resource_silver1",src:app.GameData.imageSrc+"resource/resource_silver1.png"},{id:"resource_silver2",src:app.GameData.imageSrc+"resource/resource_silver2.png"},{id:"resource_silver3",src:app.GameData.imageSrc+"resource/resource_silver3.png"},{id:"resource_farm1",src:app.GameData.imageSrc+"resource/resource_farm1.png"},{id:"resource_farm2",
src:app.GameData.imageSrc+"resource/resource_farm2.png"},{id:"resource_farm3",src:app.GameData.imageSrc+"resource/resource_farm3.png"},{id:"preBtn",src:app.GameData.imageSrc+"ui/left.png"},{id:"nextBtn",src:app.GameData.imageSrc+"ui/right.png"},{id:"pageBg",src:app.GameData.imageSrc+"ui/popubg_19.png"},{id:"silverBtn",src:app.GameData.imageSrc+"resource/silverBtn.png"},{id:"areaBtn",src:app.GameData.imageSrc+"ui/diqu.png"},{id:"resPointerSprite",src:app.GameData.imageSrc+"effect/res_pointer.png"},
{id:"resDoubleSprite",src:app.GameData.imageSrc+"effect/res_double.png"},{id:"resSteal",src:app.GameData.imageSrc+"effect/resSteal.png"},{id:"flag",src:app.GameData.imageSrc+"resource/qizhi.png"},{id:"map_ico1",src:app.GameData.imageSrc+"ui/ico_01.gif"}]),b="\u52a0\u8f7d\u8d44\u6e90\u573a\u666f\u6587\u4ef6\u2026",g.loadResourceStatus=!0;this.typeName="\u8d44\u6e90";break;case app.mediator.scene.AreaMediator:g=this.facade.retrieveProxy(app.proxy.AreaProxy.NAME);if(!1==g.loadResourceStatus)c=c.concat([{id:"areaBg1",
src:app.GameData.imageSrc+"scene/area_1.jpg"},{id:"areaBg2",src:app.GameData.imageSrc+"scene/area_2.jpg"},{id:"areaBg3",src:app.GameData.imageSrc+"scene/area_3.jpg"},{id:"town1",src:app.GameData.imageSrc+"area/city_1.png"},{id:"town2",src:app.GameData.imageSrc+"area/city_2.png"},{id:"town3",src:app.GameData.imageSrc+"area/city_3.png"},{id:"town4",src:app.GameData.imageSrc+"area/city_4.png"},{id:"preBtn",src:app.GameData.imageSrc+"ui/left.png"},{id:"nextBtn",src:app.GameData.imageSrc+"ui/right.png"},
{id:"pageBg",src:app.GameData.imageSrc+"ui/popubg_19.png"},{id:"resBtn",src:app.GameData.imageSrc+"ui/ziyuanqu.png"},{id:"areaPointerSprite",src:app.GameData.imageSrc+"effect/res_pointer.png"},{id:"flag",src:app.GameData.imageSrc+"resource/qizhi.png"},{id:"dunpai",src:app.GameData.imageSrc+"area/dunpai.png"},{id:"map_ico1",src:app.GameData.imageSrc+"ui/ico_01.gif"}]),b="\u52a0\u8f7d\u5730\u533a\u573a\u666f\u6587\u4ef6\u2026",g.loadResourceStatus=!0;this.typeName="\u5730\u533a";break;case app.mediator.scene.SmallGameMediator:g=
this.facade.retrieveProxy(app.proxy.SmallGameProxy.NAME);g.picId=app.data.DataBase.getInstance().getHeroInfo(g.data.heroId).pic;if(!1==g.loadResourceStatus)c=c.concat([{id:"gameBg",src:app.GameData.imageSrc+"smallGame/gamebg.jpg"},{id:"startBtn",src:app.GameData.imageSrc+"ui/popupbg_13.gif"},{id:"enemy_1",src:app.GameData.imageSrc+"smallGame/enemy_1.png"},{id:"enemy_2",src:app.GameData.imageSrc+"smallGame/enemy_2.png"},{id:"enemy_3",src:app.GameData.imageSrc+"smallGame/enemy_3.png"},{id:"enemy_4",
src:app.GameData.imageSrc+"smallGame/enemy_4.png"},{id:"enemy_5",src:app.GameData.imageSrc+"smallGame/enemy_5.png"},{id:"enemy_6",src:app.GameData.imageSrc+"smallGame/enemy_6.png"},{id:"hit",src:app.GameData.imageSrc+"smallGame/hit.png"},{id:"closeBtn",src:app.GameData.imageSrc+"ui/btnbg_03.png"},{id:"heroBg",src:app.GameData.imageSrc+"smallGame/popubg_21.png"},{id:"chuizi",src:app.GameData.imageSrc+"smallGame/chuizi.png"},{id:"menuBg",src:app.GameData.imageSrc+"ui/popubg_15.png"}]),b="\u52a0\u8f7d\u653b\u57ce\u573a\u666f\u6587\u4ef6\u2026",
g.loadResourceStatus=!0;c=c.concat([{id:"heroImg"+g.picId,src:app.GameData.imageSrc+"heros/hero_"+g.picId+".gif"}]);break;case app.mediator.scene.WarfareMediator:g=this.facade.retrieveProxy(app.proxy.WarfareProxy.NAME);if(!1==g.loadResourceStatus)c=c.concat([{id:"title",src:app.GameData.imageSrc+"effect/title.png"},{id:"numberBmp",src:app.GameData.imageSrc+"skill/number.png"},{id:"war_bg",src:app.GameData.imageSrc+"warfare/war_bg.jpg"},{id:"army_a",src:app.GameData.imageSrc+"map/army3.png"},{id:"army_d",
src:app.GameData.imageSrc+"map/army2.png"},{id:"soldier1",src:app.GameData.imageSrc+"warfare/soldier1.png"},{id:"soldier1_data",src:app.GameData.imageSrc+"warfare/soldier1.zb"},{id:"soldier3",src:app.GameData.imageSrc+"warfare/soldier3.png"},{id:"soldier3_data",src:app.GameData.imageSrc+"warfare/soldier3.zb"},{id:"soldier4",src:app.GameData.imageSrc+"warfare/soldier4.png"},{id:"soldier4_data",src:app.GameData.imageSrc+"warfare/soldier4.zb"},{id:"soldier5",src:app.GameData.imageSrc+"warfare/soldier5.png"},
{id:"soldier5_data",src:app.GameData.imageSrc+"warfare/soldier5.zb"},{id:"fight",src:app.GameData.imageSrc+"warfare/fight.png"},{id:"fight_data",src:app.GameData.imageSrc+"warfare/fight.zb"},{id:"winner",src:app.GameData.imageSrc+"warfare/winner.png"},{id:"winner_data",src:app.GameData.imageSrc+"warfare/winner.zb"},{id:"throw",src:app.GameData.imageSrc+"warfare/throw.png"},{id:"throw_data",src:app.GameData.imageSrc+"warfare/throw.zb"}]),b="\u52a0\u8f7d\u519b\u56e2\u6218\u8d44\u6e90\u6587\u4ef6\u2026",
g.loadResourceStatus=!0;g=this.facade.retrieveProxy(app.proxy.WarfareProxy.NAME);f=g.data;g.clear()}if(0<c.length)f=ClassUtils.delegate(this,this.onComplete,e,f),this.sendNotification(app.AppConstants.LOAD,{value:c,callback:f,descript:b});else this.onComplete(null,e,f)},onComplete:function(b,c,e){var f=this.facade.retrieveProxy(app.proxy.GameInfoProxy.NAME).sceneMediator;if(null!=f)this.sendNotification(f.CLOSE),this.facade.retrieveProxy(app.proxy.GameInfoProxy.NAME).prevMediator=f;this.facade.retrieveProxy(app.proxy.GameInfoProxy.NAME).sceneMediator=
c;this.sendNotification(app.mediator.system.IndicateMediator.CLOSE);this.sendNotification(app.mediator.system.MainMenuMediator.CLOSE);this.sendNotification(app.mediator.system.ChatMediator.GOSCENE,c);this.sendNotification(app.mediator.system.MainMenuMediator.CHANGE_RIGHT_MENU,this.typeName);this.typeName=null;b&&app.GameData.GameResource.appendResource(b);this.sendNotification(c.SHOW,e)}});puremvc.define({name:"app.command.LoadCommand",parent:puremvc.SimpleCommand},{execute:function(b){var c=this,e=b.getBody(),f=new Loader,g={};f.addEventListener("loaded",function(b){if(b.data.desc)g.text=b.data.desc;g.loaded=f.getLoaded();g.total=f.getTotalSize();e.hide||c.sendNotification(app.mediator.system.LoadMediator.SHOW,g)});f.addEventListener("complete",function(){g=f.getLoadedSize()+"/"+f.getTotalSize();e.hide||c.sendNotification(app.mediator.system.LoadMediator.CLOSE);"function"==typeof e.callback?
e.callback(f):"string"==typeof e.callback&&c.sendNotification(e.callback,f)});for(b=0;b<e.value.length;b++)f.addSource(e.value[b]);g.text=e.descript;g.loaded=f.getLoadedSize();g.total=f.getTotalSize();this.sendNotification(app.mediator.system.LoadMediator.SHOW,g);f.load()}});puremvc.define({name:"app.command.PrepControllerCommand",parent:puremvc.SimpleCommand},{execute:function(){app.trace("PrepControllerCommand");this.facade.registerCommand(app.AppConstants.LOAD,app.command.LoadCommand);this.facade.registerCommand(app.command.CommandType.GO_SCENE,app.command.GoSceneCommand);this.facade.registerCommand(app.AppConstants.INIT,app.command.InitCommand);this.facade.registerCommand(app.command.CommandType.LEVEL_UP,app.command.LevelUpCommand);this.facade.registerCommand(app.command.CommandType.Grain,
app.command.FarmCommand);this.facade.registerCommand(app.command.CommandType.CLEAR_INDICATE_TIME,app.command.ClearIndicateTimeCommand);this.facade.registerCommand(app.command.CommandType.QUICKEN_COMMAND,app.command.QuickenCommand);this.facade.registerCommand(app.command.CommandType.ADD_BAGSIZE,app.command.AddBagCommand);this.facade.registerCommand(app.command.CommandType.ITEM_DOWNGRADE,app.command.ItemDowngradeCommand);this.facade.registerCommand(app.command.CommandType.ITEM_UPGRADE,app.command.ItemUpgradeCommand);
this.facade.registerCommand(app.command.CommandType.ITEM_GET,app.command.ItemGetCommand);this.facade.registerCommand(app.command.CommandType.ITEM_SELL,app.command.ItemSellCommand);this.facade.registerCommand(app.command.CommandType.SHOP,app.command.ShopCommand);this.facade.registerCommand(app.command.CommandType.LOAD_BATTLEMAP,app.command.LoadBattleMapCommand);this.facade.registerCommand(app.command.CommandType.SHOW_NEW_HERO,app.command.ShowNewHeroCommand);this.facade.registerCommand(app.command.CommandType.TOP_MENU_SHINE,
app.command.TopMenuShineCommand);this.facade.registerCommand(app.command.CommandType.PAY,app.command.PayCommand);this.facade.registerCommand(app.command.CommandType.SIMPLE_BATTLE_RESULT,app.command.SimpleBattleCommand);this.facade.registerCommand(app.command.CommandType.CLEAR_TIME_HANDLE,app.command.ClearCDCommand);this.facade.registerCommand(app.command.CommandType.ADD_BUILDDINGSIZE,app.command.AddBuilddingSizeCommand)}});puremvc.define({name:"app.command.PrepModelCommand",parent:puremvc.SimpleCommand},{execute:function(){this.facade.registerProxy(new app.proxy.ResourceProxy);this.facade.registerProxy(new app.proxy.InitProxy);this.facade.registerProxy(new app.proxy.HomeProxy);this.facade.registerProxy(new app.proxy.LevelUpProxy);this.facade.registerProxy(new app.proxy.UserInfoProxy);this.facade.registerProxy(new app.proxy.StrategyProxy);this.facade.registerProxy(new app.proxy.GameInfoProxy);this.facade.registerProxy(new app.proxy.IndicateProxy);
this.facade.registerProxy(new app.proxy.HerosProxy);this.facade.registerProxy(new app.proxy.HeroProxy);this.facade.registerProxy(new app.proxy.FarmProxy);this.facade.registerProxy(new app.proxy.LevyProxy);this.facade.registerProxy(new app.proxy.OfficialProxy);this.facade.registerProxy(new app.proxy.BagProxy);this.facade.registerProxy(new app.proxy.ShopProxy);this.facade.registerProxy(new app.proxy.MarketProxy);this.facade.registerProxy(new app.proxy.BattleProxy);this.facade.registerProxy(new app.proxy.TalksProxy);
this.facade.registerProxy(new app.proxy.LiegemanProxy);this.facade.registerProxy(new app.proxy.FolkHouseProxy);this.facade.registerProxy(new app.proxy.FormationProxy);this.facade.registerProxy(new app.proxy.BarracksProxy);this.facade.registerProxy(new app.proxy.WorkShopProxy);this.facade.registerProxy(new app.proxy.AppointProxy);this.facade.registerProxy(new app.proxy.EquipProxy);this.facade.registerProxy(new app.proxy.WorldProxy);this.facade.registerProxy(new app.proxy.BattleMapProxy);this.facade.registerProxy(new app.proxy.BattleMapArmyProxy);
this.facade.registerProxy(new app.proxy.ResProxy);this.facade.registerProxy(new app.proxy.AreaProxy);this.facade.registerProxy(new app.proxy.ChatProxy);this.facade.registerProxy(new app.proxy.NpcEventProxy);this.facade.registerProxy(new app.proxy.CampaignProxy);this.facade.registerProxy(new app.proxy.RankProxy);this.facade.registerProxy(new app.proxy.SignInProxy);this.facade.registerProxy(new app.proxy.TaskMainProxy);this.facade.registerProxy(new app.proxy.TaskDayProxy);this.facade.registerProxy(new app.proxy.MailProxy);
this.facade.registerProxy(new app.proxy.AchievementProxy);this.facade.registerProxy(new app.proxy.PlayerinfoProxy);this.facade.registerProxy(new app.proxy.RefreshProxy);this.facade.registerProxy(new app.proxy.ArmyGroupProxy);this.facade.registerProxy(new app.proxy.ArmyGroupAskProxy);this.facade.registerProxy(new app.proxy.ArmyGroupListProxy);this.facade.registerProxy(new app.proxy.ArmyGroupTeamProxy);this.facade.registerProxy(new app.proxy.ArmyGroupResearchProxy);this.facade.registerProxy(new app.proxy.GiftProxy);
this.facade.registerProxy(new app.proxy.GroupWarProxy);this.facade.registerProxy(new app.proxy.ChallengeProxy);this.facade.registerProxy(new app.proxy.SmallGameProxy);this.facade.registerProxy(new app.proxy.NewPlayerGuideProxy);this.facade.registerProxy(new app.proxy.WarfareProxy);this.facade.registerProxy(new app.proxy.PayProxy);this.facade.registerProxy(new app.proxy.SimpleBattleProxy);this.facade.registerProxy(new app.proxy.TaskStatusProxy)}});puremvc.define({name:"app.command.PrepViewCommand",parent:puremvc.SimpleCommand},{execute:function(){this.facade.registerMediator(new app.mediator.scene.HomeMediator);this.facade.registerMediator(new app.mediator.scene.BattleMapMediator);this.facade.registerMediator(new app.mediator.scene.BattleFieldMediator);this.facade.registerMediator(new app.mediator.scene.WorldMediator);this.facade.registerMediator(new app.mediator.scene.WorldDialogMediator);this.facade.registerMediator(new app.mediator.scene.DevelopMediator);
this.facade.registerMediator(new app.mediator.scene.ResourceMediator);this.facade.registerMediator(new app.mediator.scene.AreaMediator);this.facade.registerMediator(new app.mediator.scene.SmallGameMediator);this.facade.registerMediator(new app.mediator.system.LoadMediator);this.facade.registerMediator(new app.mediator.system.PopUpMsgMediator);this.facade.registerMediator(new app.mediator.system.ActivityMediator);this.facade.registerMediator(new app.mediator.system.ChatMediator);this.facade.registerMediator(new app.mediator.system.IndicateMediator);
this.facade.registerMediator(new app.mediator.system.MailMediator);this.facade.registerMediator(new app.mediator.system.AutoPopUpMsgMediator);this.facade.registerMediator(new app.mediator.system.MainMenuMediator);this.facade.registerMediator(new app.mediator.system.ResControlMediator);this.facade.registerMediator(new app.mediator.system.AreaControlMediator);this.facade.registerMediator(new app.mediator.system.TradeControlMediator);this.facade.registerMediator(new app.mediator.system.NoteControlMediator);
this.facade.registerMediator(new app.mediator.system.TownLogoControlMediator);this.facade.registerMediator(new app.mediator.system.NpcEventMediator);this.facade.registerMediator(new app.mediator.system.RankMediator);this.facade.registerMediator(new app.mediator.system.ActiveMediator);this.facade.registerMediator(new app.mediator.system.CountryMediator);this.facade.registerMediator(new app.mediator.system.MailDetailMediator);this.facade.registerMediator(new app.mediator.system.PlayerInfoMediator);
this.facade.registerMediator(new app.mediator.system.NewPlayerGuideMediator);this.facade.registerMediator(new app.mediator.building.LevelUpMediator);this.facade.registerMediator(new app.mediator.building.BankMediator);this.facade.registerMediator(new app.mediator.building.DrillGroundMediator);this.facade.registerMediator(new app.mediator.building.FarmLandMediator);this.facade.registerMediator(new app.mediator.building.FolkHouseMediator);this.facade.registerMediator(new app.mediator.building.HallMediator);
this.facade.registerMediator(new app.mediator.building.StoreRoomMediator);this.facade.registerMediator(new app.mediator.building.StoresMediator);this.facade.registerMediator(new app.mediator.building.StrategyCenterMediator);this.facade.registerMediator(new app.mediator.building.TaskMediator);this.facade.registerMediator(new app.mediator.system.ArmyGroupMediator);this.facade.registerMediator(new app.mediator.system.GiftMediator);this.facade.registerMediator(new app.mediator.scene.JoinGroupWarMediator);
this.facade.registerMediator(new app.mediator.system.ChallengeMediator);this.facade.registerMediator(new app.mediator.building.AchievementMediator);this.facade.registerMediator(new app.mediator.scene.WarfareMediator);this.facade.registerMediator(new app.mediator.system.PayMediator);this.facade.registerMediator(new app.mediator.system.HeroMediator);this.facade.registerMediator(new app.mediator.building.HubuMediator);this.facade.registerMediator(new app.mediator.system.HelpMediator)}});puremvc.define({name:"app.command.StartUpCommand",parent:puremvc.MacroCommand},{initializeMacroCommand:function(){this.addSubCommand(app.command.PrepControllerCommand);this.addSubCommand(app.command.PrepModelCommand);this.addSubCommand(app.command.PrepViewCommand);this.addSubCommand(app.command.InitCommand)}});puremvc.define({name:"app.command.LevelUpCommand",parent:puremvc.SimpleCommand},{execute:function(b){var c=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME),e=c.getBuildInfo(b.getBody()),f=this,b=function(){f.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).levelUp(e.id)};if(this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.silverCoin<e.needMoney)app.view.Tooltip.getInstance().show(app.data.CONST.MSG_NOT_ENOUGH_MONEY);else{if(e.id!=app.data.HomeBuildingData.HALL&&(c=c.getBuildInfo(app.data.HomeBuildingData.HALL),
e.level>=c.level)){app.view.Tooltip.getInstance().show("<span class='fc9'>\u5efa\u7b51\u7b49\u7ea7\u4e0d\u80fd\u8d85\u8fc7\u4e3b\u57ce\u7b49\u7ea7</span>");return}this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).buildingFull()?(this.indicateVo=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).buildingIndsmall,this.sendNotification(app.command.CommandType.CLEAR_TIME_HANDLE,{timer:this.indicateVo,handle:ClassUtils.delegate(this,b)})):b()}}});puremvc.define({name:"app.command.ClearIndicateTimeCommand",parent:puremvc.SimpleCommand},{execute:function(b){var c=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME),e=b.getBody(),b=app.data.DataBase.getInstance().computeCost(e.type,Math.floor(e.time.getTime()/1E3));b>this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.goldCoin?this.sendNotification(app.command.CommandType.PAY):app.view.Alert.getInstance().show("\u5c06\u7b49\u5f85\u65f6\u95f4\u6e05\u96f6\u9700\u8981\u82b1\u8d39<span class='fc1'>"+
b+"\u91d1\u5e01</span>\u3002<br />\u662f\u5426\u786e\u5b9a\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==b&&c.clearCoolTime(e.id)})}});puremvc.define({name:"app.command.ItemDowngradeCommand",parent:puremvc.SimpleCommand},{execute:function(b){var c=b.getBody().id;b.getBody();var b=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME),e=this.facade.retrieveProxy(app.proxy.BagProxy.NAME),f=e.getItemData(c);1>=f.level||(b.data.maxSilverCoin-b.data.silverCoin<f.downMoney?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9"> \u964d\u7ea7\u540e\u94f6\u5e01\u603b\u91cf\u8d85\u8fc7\u4e0a\u9650\uff01\u65e0\u6cd5\u964d\u7ea7\u3002</lbael>'):
e.degradeEquipAll(c))}});puremvc.define({name:"app.command.ItemGetCommand",parent:puremvc.SimpleCommand},{execute:function(b){var b=b.getBody(),c=this.facade.retrieveProxy(app.proxy.BagProxy.NAME);0>=c.bagEmpty?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">\u80cc\u5305\u6ca1\u6709\u7a7a\u4f4d\u4e86\uff01</lbael>'):c.obtainEquip(b)}});puremvc.define({name:"app.command.ItemSellCommand",parent:puremvc.SimpleCommand},{execute:function(b){var b=b.getBody(),c=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME),e=this.facade.retrieveProxy(app.proxy.BagProxy.NAME),f=e.getItemData(b);0<f.heroId?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">\u8bf7\u5148\u5378\u4e0b\u88c5\u5907\u518d\u5356\u51fa\uff01</lbael>'):c.data.maxSilverCoin-c.data.silverCoin<f.getSellPrice()?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,
'<label class="fc9">\u5356\u51fa\u540e\u94f6\u5e01\u603b\u91cf\u8d85\u8fc7\u4e0a\u9650\uff01</lbael>'):1<f.level?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">\u8bf7\u5148\u964d\u7ea7\u518d\u5356\uff01</lbael>'):e.sellEquip(b)}});puremvc.define({name:"app.command.ItemUpgradeCommand",parent:puremvc.SimpleCommand},{execute:function(b){var c=b.getBody().id,e=b.getBody().force,b=b.getBody().gold,f=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME),g=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME),h=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_8),j=this.facade.retrieveProxy(app.proxy.BagProxy.NAME),k=function(){j.upgradeEquip(c,e)},l=j.getItemData(c);-1==
l.canObtain&&(f.data.silverCoin<l.upMoney?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">'+app.data.CONST.MSG_NOT_ENOUGH_MONEY+"</lbael>"):l.level>=g.getBuildInfo(app.data.HomeBuildingData.HALL).level?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">\u88c5\u5907\u7684\u7b49\u7ea7\u4e0d\u80fd\u8d85\u8fc7\u4e3b\u57ce\u7684\u7b49\u7ea7\uff01</lbael>'):1==e&&b>f.data.goldCoin?this.sendNotification(app.command.CommandType.PAY):
h.full?this.sendNotification(app.command.CommandType.CLEAR_TIME_HANDLE,{timer:h,handle:ClassUtils.delegate(this,k)}):k())}});puremvc.define({name:"app.command.AddBagCommand",parent:puremvc.SimpleCommand},{execute:function(){var b=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME),c=this.facade.retrieveProxy(app.proxy.BagProxy.NAME);b.data.goldCoin<c.bagPrice?this.sendNotification(app.command.CommandType.PAY):c.addBagSize()}});puremvc.define({name:"app.command.ShopCommand",parent:puremvc.SimpleCommand},{execute:function(b){var b=b.getBody(),c=this.facade.retrieveProxy(app.proxy.BagProxy.NAME),e=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME),f=this.facade.retrieveProxy(app.proxy.ShopProxy.NAME),g=f.getShopData(b);1==g.type&&e.data.silverCoin<g.price?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">'+app.data.CONST.MSG_NOT_ENOUGH_MONEY+"</lbael>"):2==g.type&&e.data.goldCoin<
g.price?this.sendNotification(app.command.CommandType.PAY):0>=c.bagEmpty?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">\u60a8\u7684\u80cc\u5305\u5df2\u6ee1\uff01</lbael>'):f.buyItem(b)}});puremvc.define({name:"app.command.QuickenCommand",parent:puremvc.SimpleCommand},{execute:function(b){var c=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.DRILL_GROUND),e=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.HALL),f=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).getData(),g=this,h=function(){g.facade.retrieveProxy(app.proxy.HerosProxy.NAME).accelerate(j)},j=b.getBody();null==j.train?app.view.Tooltip.getInstance().show("\u6b66\u5c06\u6ca1\u6709\u5728\u8bad\u7ec3\u4e2d"):
100*c.level>f.feat?app.view.Tooltip.getInstance().show("\u60a8\u7684\u6218\u529f\u4e0d\u8db3"):j.level>=e.level?app.view.Tooltip.getInstance().show("<span class='fc9'>\u6b66\u5c06\u7b49\u7ea7\u65e0\u6cd5\u8d85\u8fc7\u4e3b\u57ce\u7b49\u7ea7</span>"):(b=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_4),!0==b.full?this.sendNotification(app.command.CommandType.CLEAR_TIME_HANDLE,{timer:b,handle:ClassUtils.delegate(this,h)}):h())}});puremvc.define({name:"app.command.LoadBattleMapCommand",parent:puremvc.SimpleCommand},{execute:function(b){var b=b.getBody(),c,e=this.facade.retrieveProxy(app.proxy.BattleMapProxy.NAME);null!=e.resource&&(b="MAP_BG");"INIT"==b?c=[{id:"map_qi1",src:app.GameData.imageSrc+"map/qi1.png"},{id:"map_qi1_r",src:app.GameData.imageSrc+"map/qi1_r.png"},{id:"map_qi2",src:app.GameData.imageSrc+"map/qi2.png"},{id:"map_qi2_r",src:app.GameData.imageSrc+"map/qi2_r.png"},{id:"map_qi3",src:app.GameData.imageSrc+"map/qi3.png"},
{id:"map_qi3_r",src:app.GameData.imageSrc+"map/qi3_r.png"},{id:"map_qi4",src:app.GameData.imageSrc+"map/qi4.png"},{id:"map_qi4_r",src:app.GameData.imageSrc+"map/qi4_r.png"},{id:"map_selecter",src:app.GameData.imageSrc+"effect/troop_selecter.png"},{id:"map_selecterJson",src:app.GameData.imageSrc+"effect/troop_selecter.zb"},{id:"preBtn",src:app.GameData.imageSrc+"ui/left.png"},{id:"nextBtn",src:app.GameData.imageSrc+"ui/right.png"},{id:"pageBg",src:app.GameData.imageSrc+"ui/popubg_19.png"},{id:"map_img2",
src:app.GameData.imageSrc+"ui/fblb.png"},{id:"map_png9",src:app.GameData.imageSrc+"uieff/uieff_09.png"},{id:"map_json9",src:app.GameData.imageSrc+"uieff/uieff_09.zb"},{id:"map_ico1",src:app.GameData.imageSrc+"ui/ico_01.gif"},{id:"map_story_1",src:app.GameData.imageSrc+"map/story_1.jpg"},{id:"mapRiht",src:app.GameData.imageSrc+"effect/mapRiht.png"},{id:"mapRihtJson",src:app.GameData.imageSrc+"effect/mapRiht.json"}]:"MAP_BG"==b&&(c=e.getMapBg());b=ClassUtils.delegate(this,this.onComplete,b);this.sendNotification(app.AppConstants.LOAD,
{value:c,callback:b,descript:"\u52a0\u8f7d\u526f\u672c\u5730\u56fe\u6587\u4ef6\u2026\u2026"})},onComplete:function(b,c){b&&("INIT"==c?(app.GameData.GameResource.appendResource(b),this.sendNotification(app.command.CommandType.LOAD_BATTLEMAP,"MAP_BG")):"MAP_BG"==c&&(app.GameData.GameResource.appendResource(b),this.sendNotification(app.mediator.scene.BattleMapMediator.SHOW_MAP)))}});puremvc.define({name:"app.command.ShowNewHeroCommand",parent:puremvc.SimpleCommand},{execute:function(b){var c=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource,b=new app.view.building.DrillGroundTalkPop(c.getContent("dg_talks_pop"),b.getBody()),c={prevType:1};c.prevConf={name:app.GameData.hero.name,pic:app.GameData.hero.pic};b.setData(c);app.GameData.hero=null}});puremvc.define({name:"app.command.PayCommand",parent:puremvc.SimpleCommand},{execute:function(b){b.getBody();var c=this.facade.retrieveProxy(app.proxy.PayProxy.NAME);app.view.Alert.show("\u91d1\u5e01\u4e0d\u8db3\uff01\u662f\u5426\u8fdb\u884c\u5145\u503c\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==b&&c.goPay()})}});puremvc.define({name:"app.command.TopMenuShineCommand",parent:puremvc.SimpleCommand},{execute:function(b){this.sendNotification(app.mediator.system.MainMenuMediator.BTNSHINE,b.getBody())}});puremvc.define({name:"app.command.SimpleBattleCommand",parent:puremvc.SimpleCommand},{execute:function(b){this.resultView=new app.view.system.BattleResultView(app.GameData.GameResource.getContent("battle_result"),!0);var c=b.getBody();this.resultView.setData(c);this.resultView.replayBtn.value="\u6218\u6597\u8be6\u60c5";var e=this,f=this.facade.retrieveProxy(app.proxy.BattleMapProxy.NAME),g=this.facade.retrieveProxy(app.proxy.SimpleBattleProxy.NAME);this.resultView.replayBtn[app.Event.ONCLICK]=function(){e.resultView.depose();
f.loadData(app.proxy.BattleMapProxy.LOAD_STRATEGY_SHOW,{bid:c.id})};this.resultView.exitBtn[app.Event.ONCLICK]=function(){e.resultView.depose();g.isLose=!1}}});puremvc.define({name:"app.command.ClearCDCommand",parent:puremvc.SimpleCommand},{execute:function(b){var c=b.getBody().handle,e=b.getBody().timer,f=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME),g=app.data.DataBase.getInstance().computeCost(e.type,Math.floor(e.time.getTime()/1E3)),b=",\u59d4\u6d3e,\u751f\u4ea7,\u6218\u6597,\u8bad\u7ec3,\u79d1\u6280\u5347\u7ea7,\u5f81\u6536,\u5efa\u7b51\u5347\u7ea7,\u5f3a\u5316,\u519c\u7530\u6536\u83b7,\u63a0\u593a,\u5f00\u53d1,\u4e49\u5175\u5f81\u6536,\u8fc1\u79fb".split(",")[e.type]+
"\u51b7\u5374\u4e2d\uff0c\u5c06\u7b49\u5f85\u65f6\u95f4\u6e05\u96f6\u9700\u8981\u82b1\u8d39<span class='fc1'>"+g+"\u91d1\u5e01</span>\u3002<br />\u662f\u5426\u7ee7\u7eed\uff1f",h=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.goldCoin,j=this;app.view.Alert.getInstance().show(b,["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==b&&(g>h?j.sendNotification(app.command.CommandType.PAY):f.clearCoolTime(e.id,c))})}});puremvc.define({name:"app.command.AddBuilddingSizeCommand",parent:puremvc.SimpleCommand},{execute:function(){var b=[0,4,4,5,5,6,6,7,7,8,8],c=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data,e=null==c.vip?0:c.vip,f=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME),g=f.getIndicateDataByType(app.proxy.IndicateProxy.TYPE_7).length;if(g>=b[b.length-1])app.view.Alert.getInstance().show("\u5efa\u7b51\u4f4d\u5df2\u6ee1\uff01");else if(10>e&&g>=b[e]){for(var e=null,h=0;h<b.length;h++)if(b[h]>
g){e=h;break}app.view.Alert.getInstance().show("\u4e0d\u80fd\u589e\u52a0\uff0c\u5145\u503c\u6210\u4e3a\u4f1a\u5458"+e+"\u7ea7\u53ef\u589e\u52a0\u5efa\u7b51\u4f4d\u5230"+b[e]+"\u4e2a\uff01")}else if(g<b[e]){var j=50*(g-2);app.view.Alert.getInstance().show("\u589e\u52a0\u4e00\u4e2a\u5efa\u7b51\u4f4d\u9700\u8981\u82b1\u8d39"+j+"\u4e2a\u91d1\u5e01\uff0c\u786e\u5b9a\u8981\u8d2d\u4e70\u5417\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==b&&(c.goldCoin<j?this.sendNotification(app.command.CommandType.PAY):
f.addBuildingQueue())})}}});puremvc.define({name:"app.mediator.scene.BattleMapMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){return[app.mediator.scene.BattleMapMediator.SHOW,app.mediator.scene.BattleMapMediator.CLOSE,app.mediator.scene.BattleMapMediator.SHOW_MAP,app.mediator.scene.BattleMapMediator.GUIDE_SELECT_ARMYGROUP,app.mediator.scene.BattleMapMediator.BATTLEMAPVIEWPOP_CLOSE,app.proxy.BattleMapProxy.LOAD_MAP_COMPLETE,app.proxy.BattleMapProxy.LOAD_STRATEGYLIST_COMPLETE,app.proxy.BattleMapProxy.COMPLETE,
app.proxy.BattleMapArmyProxy.CHANGE,app.mediator.scene.BattleMapMediator.STOP_RENDER,app.mediator.scene.BattleMapMediator.RESUME_RENDER,app.proxy.WarfareProxy.UPDATE]},handleNotification:function(b){switch(b.getName()){case app.mediator.scene.BattleMapMediator.SHOW:this._init();break;case app.mediator.scene.BattleMapMediator.CLOSE:this.battleMapProxy=null;this.viewComponent.depose();this.setViewComponent(null);break;case app.proxy.BattleMapProxy.COMPLETE:this.sendNotification(app.command.CommandType.LOAD_BATTLEMAP,
"INIT");break;case app.proxy.BattleMapProxy.LOAD_MAP_COMPLETE:this.sendNotification(app.command.CommandType.LOAD_BATTLEMAP,"MAP_BG");break;case app.mediator.scene.BattleMapMediator.SHOW_MAP:null!=this.viewComponent&&(this.viewComponent.depose(),this.setViewComponent(null));if(void 0==this.showTip)this.showTip=!0;b=this.battleMapProxy.getData();!0==b.map.isFirst&&null!=b.map.conf.des?(this.sendNotification(app.mediator.system.MainMenuMediator.CLOSE),this.sendNotification(app.mediator.system.IndicateMediator.CLOSE),
this.sendNotification(app.mediator.system.ChatMediator.CLOSE,"map"),this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!1)):(this.sendNotification(app.mediator.system.MainMenuMediator.SHOW,"map"),this.sendNotification(app.mediator.system.IndicateMediator.SHOW,"map"),this.sendNotification(app.mediator.system.ChatMediator.SHOW_LINE,"map"),this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!0));this.setViewComponent(new app.view.scene.BattleMapView(b,app.GameData.GameResource,
this.showTip,this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).isBuildingShow(29)));this.showTip=!0;this.indicateVo=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_3);this.viewComponent.setData(this.gameInfoProxy.getData(),this.indicateVo);this.viewComponent.addEventListener(app.view.scene.BattleMapView.SELECT_ARMYGROUP,this);this.viewComponent.addEventListener(app.view.scene.BattleMapView.CHANGE_MAP,this);this.viewComponent.addEventListener(app.view.scene.BattleMapView.NEXT_MAP,
this);this.viewComponent.addEventListener(app.view.scene.BattleMapView.CLEAR_CD,this);this.viewComponent.addEventListener(app.view.scene.BattleMapView.REFRESH_DATA,this);this.viewComponent.addEventListener(app.view.scene.BattleMapView.SHOW_ACH,this);this.viewComponent.addEventListener(app.view.scene.BattleMapView.SHOW_MENU_BAR,this);var c,e,b=this.facade.retrieveProxy(app.proxy.NewPlayerGuideProxy.NAME);if(b.data&&999!=b.data.id&&!0==b.battleDataUpdate)e=b.battleData;if(e){if(1==e[0]&&2==e[1]&&null!=
this.facade.retrieveProxy(app.proxy.BagProxy.NAME).getItemByHero(b.data.heroId,1))break;c=app.data.DataBase.getInstance().getGuideByEnemyId(e)}if(c)b.battleDataUpdate=!1,b.data.battleId=c.id,b.data.type=2,b.goNextPhase(b.data.battleId,2),this.sendNotification(app.mediator.system.NewPlayerGuideMediator.SHOW);if(null!=app.GameData.hero){this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!1);if(c)var f=this,g=function(){f.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,
!0)};this.sendNotification(app.command.CommandType.SHOW_NEW_HERO,g)}break;case app.proxy.BattleMapProxy.LOAD_STRATEGYLIST_COMPLETE:this.creatStrategyPop(b.getBody());break;case app.proxy.BattleMapArmyProxy.CHANGE:null!=this.battleMapPop&&this.battleMapPop.showLayout();break;case app.mediator.scene.BattleMapMediator.STOP_RENDER:null!=this.viewComponent&&this.viewComponent.setTicker(!1);break;case app.mediator.scene.BattleMapMediator.RESUME_RENDER:null!=this.viewComponent&&this.viewComponent.setTicker(!0);
break;case app.mediator.scene.BattleMapMediator.GUIDE_SELECT_ARMYGROUP:this.handleEvent({type:app.view.scene.BattleMapView.SELECT_ARMYGROUP,data:b.getBody()});break;case app.mediator.scene.BattleMapMediator.BATTLEMAPVIEWPOP_CLOSE:case app.proxy.WarfareProxy.UPDATE:this.showTip=!1,this.handleEvent({type:app.view.scene.BattleMapViewPop.CLOSE})}},_init:function(){this.battleMapProxy=this.facade.retrieveProxy(app.proxy.BattleMapProxy.NAME);this.gameInfoProxy=this.facade.retrieveProxy(app.proxy.GameInfoProxy.NAME);
null!=this.battleMapProxy.getData()?this.sendNotification(app.command.CommandType.LOAD_BATTLEMAP,"INIT"):this.battleMapProxy.loadData(app.proxy.BattleMapProxy.LOAD_INIT)},handleEvent:function(b){switch(b.type){case app.view.scene.BattleMapView.SELECT_ARMYGROUP:this.sendNotification(app.mediator.scene.BattleMapMediator.STOP_RENDER);this.battleMapPop=new app.view.scene.BattleMapViewPop(app.GameData.GameResource.getContent("battleMap_01"));this.battleMapPop.addEventListener(app.view.scene.BattleMapViewPop.CLOSE,
this);this.battleMapPop.addEventListener(app.view.scene.BattleMapViewPop.SHOW_STRATEGY,this);this.battleMapPop.addEventListener(app.view.scene.BattleMapViewPop.START_FIGHT,this);this.battleMapPop.addEventListener(app.view.scene.BattleMapViewPop.SHOW_STORM,this);this.battleMapPop.setData(b.data,this.battleMapProxy.getData().map.gId);break;case app.view.scene.BattleMapView.REFRESH_DATA:this.battleMapProxy.loadData(app.proxy.BattleMapProxy.RELOAD);break;case app.view.scene.BattleMapViewPop.START_FIGHT:this.goFight("free",
b.data);break;case app.view.scene.BattleMapViewPop.CLOSE:if(null!=this.battleMapPop)this.battleMapPop.depose(),this.battleMapPop=null;this.sendNotification(app.mediator.scene.BattleMapMediator.RESUME_RENDER);break;case app.view.scene.BattleMapViewPop.SHOW_STRATEGY:b=b.data;null!=b.strategyList?this.creatStrategyPop(b):this.battleMapProxy.loadData(app.proxy.BattleMapProxy.LOAD_STRATEGYLIST,b);break;case app.view.scene.BattleMapViewStrategy.CLOSE:this.battleMapStrategy.depose();this.battleMapStrategy=
null;break;case app.view.scene.BattleMapViewPop.SHOW_STORM:this.goFight("storm",b.data);break;case app.view.scene.BattleMapViewStrategy.GO_SEE_STRATEGY:this.battleMapStrategy.depose();this.battleMapStrategy=null;this.battleMapPop.depose();this.battleMapPop=null;this.battleMapProxy.loadData(app.proxy.BattleMapProxy.LOAD_STRATEGY_SHOW,{bid:b.data});break;case app.view.scene.BattleMapView.CHANGE_MAP:this.sendNotification(app.mediator.scene.BattleMapMediator.STOP_RENDER);this.battleMapMenu=new app.view.scene.BattleMapChange(app.GameData.GameResource.getContent("battleMap_02"));
this.battleMapMenu.addEventListener(app.view.scene.BattleMapChange.CLOSE,this);this.battleMapMenu.addEventListener(app.view.scene.BattleMapChange.SELECT_MAP,this);this.battleMapMenu.setData(this.battleMapProxy.getData());break;case app.view.scene.BattleMapView.NEXT_MAP:this.battleMapProxy.loadData(app.proxy.BattleMapProxy.LOAD_MAP,b.data);break;case app.view.scene.BattleMapView.CLEAR_CD:this.sendNotification(app.command.CommandType.CLEAR_INDICATE_TIME,this.indicateVo);break;case app.view.scene.BattleMapChange.CLOSE:this.battleMapMenu.depose();
this.battleMapMenu=null;this.sendNotification(app.mediator.scene.BattleMapMediator.RESUME_RENDER);break;case app.view.scene.BattleMapChange.SELECT_MAP:this.battleMapMenu.depose();this.battleMapMenu=null;this.showTip=!0;this.battleMapProxy.loadData(app.proxy.BattleMapProxy.LOAD_MAP,b.data);break;case app.view.scene.BattleMapView.SHOW_ACH:this.sendNotification(app.mediator.building.AchievementMediator.SHOWSINGLE,b.id);break;case app.view.scene.BattleMapView.SHOW_MENU_BAR:this.sendNotification(app.mediator.system.MainMenuMediator.SHOW,
"map"),this.sendNotification(app.mediator.system.IndicateMediator.SHOW,"map"),this.sendNotification(app.mediator.system.ChatMediator.SHOW_LINE,"map"),this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!0)}},creatStrategyPop:function(b){this.battleMapStrategy=new app.view.scene.BattleMapViewStrategy(app.GameData.GameResource.getContent("battleMap_03"),b);this.battleMapStrategy.addEventListener(app.view.scene.BattleMapViewStrategy.CLOSE,this);this.battleMapStrategy.addEventListener(app.view.scene.BattleMapViewStrategy.GO_SEE_STRATEGY,
this)},goFight:function(b,c,e){if(2==c.conf.barrierType)this.sendNotification(app.mediator.scene.JoinGroupWarMediator.SHOW,c);else{var f=this;if(null==this.userVo)this.userVo=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;if(null==e||!1==e)if(e=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).isBuildingShow(11),0>=this.userVo.troop&&e){app.view.Alert.show("\u5175\u529b\u4e0d\u8db3\uff0c\u662f\u5426\u9700\u8981\u7ee7\u7eed\u6218\u6597\uff1f",["\u7ee7\u7eed\u6218\u6597","\u8865\u5145\u5175\u529b"],
function(e){0==e?f.goFight(b,c,!0):f.sendNotification(app.mediator.building.DrillGroundMediator.SHOW,2)});return}e=function(){0<f.userVo.warToken?"free"==b?f.startFight(c):"storm"==b&&app.view.Alert.show("\u5f3a\u653b\u9700\u8981\u82b1\u8d39 <span class='fc2'>"+f.userVo.forceGolden+"</span> \u91d1\u5e01\uff0c\u60a8\u786e\u5b9a\u8981\u5f3a\u653b\u5417\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(e){0==e&&(f.userVo.goldCoin>=f.userVo.forceGolden?f.startFight(c,b):f.sendNotification(app.command.CommandType.PAY))}):
app.view.Alert.show("\u60a8\u7684\u519b\u4ee4\u4e0d\u8db3\uff0c\u786e\u5b9a\u9700\u8981\u8d2d\u4e70\u519b\u4ee4\u5417\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==b&&f.sendNotification(app.mediator.system.MainMenuMediator.SHOW_TOKEN)})};0<this.indicateVo.time.getTime()?this.sendNotification(app.command.CommandType.CLEAR_TIME_HANDLE,{timer:this.indicateVo,handle:ClassUtils.delegate(this,e)}):e()}},startFight:function(b,c){this.showTip=!1;this.battleMapPop.depose();this.battleMapPop=null;this.sendNotification(app.mediator.scene.BattleMapMediator.RESUME_RENDER);
"storm"==c?this.battleMapProxy.loadData(app.proxy.BattleMapProxy.STORM_FIGHT,b):this.battleMapProxy.loadData(app.proxy.BattleMapProxy.START_FIGHT,b)}},{NAME:"BattleMapMediator",SHOW:"BattleMapMediator_show",CLOSE:"BattleMapMediator_close",SHOW_MAP:"BattleMapMediator_showMap",STOP_RENDER:"BattleMapMediator_stop_render",RESUME_RENDER:"BattleMapMediator_resume_render",GUIDE_SELECT_ARMYGROUP:"BattleMapMediator_guide_selectArmyGroup",BATTLEMAPVIEWPOP_CLOSE:"BattleMapViewPop_close"});puremvc.define({name:"app.mediator.scene.BattleFieldMediator",parent:puremvc.Mediator},{battleData:null,noEffect:!1,listNotificationInterests:function(){return[app.mediator.scene.BattleFieldMediator.SHOW,app.mediator.scene.BattleFieldMediator.CLOSE,app.mediator.scene.BattleFieldMediator.SHOW_LOSE_GUIDE,app.mediator.scene.BattleFieldMediator.CLOSE_LOSE_GUIDE]},handleNotification:function(b){var c=app.view.scene.BattleFieldSceneView;switch(b.getName()){case app.mediator.scene.BattleFieldMediator.SHOW:this.noEffect=
!1;this.loader=app.GameData.GameResource;this.statusForm=new app.view.system.BattleStatusView(this.loader.getContent("battle_status"),!1);this.statusForm.container.style.display="none";app.view.battle.NumberMovie.setBitmapSource(this.loader.getContent("numberBmp"));var e=this.facade.retrieveProxy(app.proxy.BattleProxy.NAME).battleBg;this.battleData=b.getBody();this.setViewComponent(new app.view.scene.BattleFieldSceneView(this.loader,this.battleData.header,e));this.viewComponent.setFormation(this.battleData.fighters);
this.setRecords(this.battleData);this.viewComponent.addEventListener(c.SELECT_TROOP,this);this.viewComponent.addEventListener(c.DESELECT_TROOP,this);this.showButtons();break;case app.mediator.scene.BattleFieldMediator.CLOSE:this.closeResult();if(this.resultBtn)app.GameData.UIFormDiv.removeChild(this.resultBtn),this.resultBtn=null;if(this.effectBtn)app.GameData.UIFormDiv.removeChild(this.effectBtn),this.effectBtn=null;this.statusForm&&this.statusForm.depose();this.viewComponent.depose();this.viewComponent.removeEventListener(c.SELECT_TROOP,
this);this.viewComponent.removeEventListener(c.DESELECT_TROOP,this);this.setViewComponent(null);!1==this.simpleBattleProxy.isLose&&!1==this.battleMapProxy.isBattleReport&&this.loseGuide();this.simpleBattleProxy.isLose=!1;this.battleData=null;break;case app.mediator.scene.BattleFieldMediator.SHOW_LOSE_GUIDE:if(this.battleLoseGuide=new app.view.system.BattleLoseGuideView(this.loader.getContent("battleLoseGuide"),b.getBody()))this.battleLoseGuide.addEventListener(app.view.system.BattleLoseGuideView.HANDLE,
this),this.battleLoseGuide.addEventListener(app.view.system.BattleLoseGuideView.CLOSE,this);break;case app.mediator.scene.BattleFieldMediator.CLOSE_LOSE_GUIDE:this.battleLoseGuide.removeEventListener(app.view.system.BattleLoseGuideView.HANDLE,this),this.battleLoseGuide.removeEventListener(app.view.system.BattleLoseGuideView.CLOSE,this),this.battleLoseGuide.depose(),this.battleLoseGuide=null}},setRecords:function(b){var c=b.records,e=app.controller.battle;this.battle&&this.battle.depose();this.battle=
new e.BattleRecord(this.viewComponent);this.battle.complete=ClassUtils.delegate(this,this.showResult,b);app.view.battle.SkillMovie.setEffectVisible(this.noEffect);this.battle.addStep(new e.BattleDelay(500));for(var b=c.length,f=0;f<b;f++)this.battle.addStep(new e.BattleActStep(c[f])),this.battle.addStep(new e.BattleUpdateHp(c[f])),this.battle.addStep(new e.BattleUpdateBuffer(c[f]));this.battle.addStep(new e.BattleDelay(500));this.battle.nextStep()},showTroopInfo:function(b){clearTimeout(this.time);
this.closeTroopInfo();this.time=setTimeout(ClassUtils.delegate(this,this.closeTroopInfo),1500);this.statusForm.setData(b.target);this.statusForm.setVisible(!0);this.statusForm.setPosition(b.x-75,b.y-100)},setTripSize:function(b,c){b.style["background-size"]=100*(1<c?1:c)+"% 100%"},closeTroopInfo:function(){this.statusForm.setVisible(!1)},showResult:function(b){var c=app.view.system.BattleResultView;this.resultView=new c(this.loader.getContent("battle_result"),!1);this.resultView.setData(b);this.resultView.addEventListener(c.REPLAY,
this);this.resultView.addEventListener(c.EXIT,this);this.resultBtn.style.visibility="hidden";this.effectBtn.style.visibility="hidden"},closeResult:function(){if(this.resultView){var b=app.view.system.BattleResultView;this.resultView.removeEventListener(b.REPLAY,this);this.resultView.removeEventListener(b.EXIT,this);this.resultView.depose();this.resultView=null}},replay:function(){this.viewComponent.clear();this.viewComponent.setFormation(this.battleData.fighters);this.setRecords(this.battleData);
this.resultBtn.style.visibility="visible";this.effectBtn.style.visibility="visible"},showButtons:function(){var b=app.GameData.gameCanvas.width,c=app.GameData.gameCanvas.height;this.resultBtn=this.createButton("\u7ed3\u679c",b-140,c-30);this.effectBtn=this.createButton("",b-70,c-30);this.updateBtnLabel();var e=this;this.resultBtn[app.Event.ONCLICK]=function(){e.battle.stopLoop()};this.effectBtn[app.Event.ONCLICK]=function(){e.noEffect=!e.noEffect;app.view.battle.SkillMovie.setEffectVisible(e.noEffect);
e.updateBtnLabel()}},updateBtnLabel:function(){this.effectBtn.value=this.noEffect?"\u5f00\u542f\u7279\u6548":"\u5173\u95ed\u7279\u6548"},createButton:function(b,c,e){var f=document.createElement("input");f.type="button";f.value=b;f.className="btn_red";app.GameData.UIFormDiv.appendChild(f);f.style.position="absolute";f.style.left=(c||0)+"px";f.style.top=(e||0)+"px";return f},handleEvent:function(b){var c=app.view.scene.BattleFieldSceneView,e=app.view.system.BattleResultView;switch(b.type){case c.SELECT_TROOP:this.showTroopInfo(b.data);
break;case c.DESELECT_TROOP:this.closeTroopInfo();break;case e.REPLAY:this.closeResult();this.replay();break;case e.EXIT:b=this.facade.retrieveProxy(app.proxy.GameInfoProxy.NAME).prevMediator;this.sendNotification(app.command.CommandType.GO_SCENE,b);break;case app.view.system.BattleLoseGuideView.HANDLE:0==b.data?this.sendNotification(app.mediator.system.HeroMediator.SHOW,3):1==b.data?this.sendNotification(app.mediator.building.StrategyCenterMediator.SHOW,0):this.sendNotification(app.mediator.system.HeroMediator.SHOW,
2);this.sendNotification(app.mediator.scene.BattleFieldMediator.CLOSE_LOSE_GUIDE);break;case app.view.system.BattleLoseGuideView.CLOSE:this.sendNotification(app.mediator.scene.BattleFieldMediator.CLOSE_LOSE_GUIDE)}},loseGuide:function(){var b=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.HALL).level;this.battleData.header.attackerName==this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.name&&9==this.battleData.result.rank&&(60>b&&20<=b?this.loseGuideShow(Math.round(2*
Math.random())):20>b&&8<=b?this.loseGuideShow(Math.round(Math.random())):this.loseGuideShow(0));this.battleMapProxy.isBattleReport=!1},loseGuideShow:function(b){this.sendNotification(app.mediator.scene.BattleFieldMediator.SHOW_LOSE_GUIDE,b)},onRegister:function(){this.simpleBattleProxy=this.facade.retrieveProxy(app.proxy.SimpleBattleProxy.NAME);this.battleMapProxy=this.facade.retrieveProxy(app.proxy.BattleMapProxy.NAME)}},{NAME:"BattleFieldMediator",SHOW:"BattleFieldMediator_Show",CLOSE:"BattleFieldMediator_Close",
SHOW_LOSE_GUIDE:"BattleFieldMediator_ShowLoseGuide",CLOSE_LOSE_GUIDE:"BattleFieldMediator_CloseLoseGuide"});puremvc.define({name:"app.mediator.scene.HomeMediator",parent:puremvc.Mediator},{firstRun:Boolean,listNotificationInterests:function(){var b=app.mediator.scene.HomeMediator;return[b.SHOW,b.CLOSE,b.ADD_BUILDING,b.STOP_RENDER,b.RESUME_RENDER,b.ADD_NPC,b.MOVE,app.proxy.UserInfoProxy.CHANGED,app.proxy.LevelUpProxy.CHANGED,app.proxy.LevelUpProxy.COMPLETE,app.mediator.system.LoadMediator.ONSIZE]},handleNotification:function(b){var c=app.mediator.scene.HomeMediator;switch(b.getName()){case c.SHOW:this.sendNotification(app.mediator.system.LoadMediator.CLOSE,
"big");this.sendNotification(app.mediator.system.LoadMediator.USE,"sma");this.sendNotification(app.mediator.system.IndicateMediator.SHOW,"hall");this.sendNotification(app.mediator.system.MainMenuMediator.SHOW,"hall");this.facade.retrieveProxy(app.proxy.TaskStatusProxy.NAME).getData()?this.sendNotification(app.proxy.TaskStatusProxy.ICON_STATUS,1):this.sendNotification(app.proxy.TaskStatusProxy.ICON_STATUS,0);this.facade.retrieveProxy(app.proxy.GiftProxy.NAME).freshData();this.sendNotification(app.mediator.system.ChatMediator.SHOW_LINE);
this._init(this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource);this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!0);if(this.firstRun){this.firstRun=!1;var e;e=!1;b=this.facade.retrieveProxy(app.proxy.NewPlayerGuideProxy.NAME);if(b.data&&999!=b.data.id&&(c=app.data.DataBase.getInstance().getGuideById(b.data.id))&&1==c.condition)e=!0,b.data.type=1,this.sendNotification(app.mediator.system.NewPlayerGuideMediator.SHOW);!1==e&&(b=this.facade.retrieveProxy(app.proxy.GameInfoProxy.NAME).getSeasonDesc(),
this.sendNotification(app.mediator.system.PopUpMsgMediator.SHOW,b))}break;case c.CLOSE:this.viewComponent.removeEventListener(this.viewComponent.SELECT_CONSTRUCT,this);this.viewComponent.depose();this.setViewComponent(null);break;case c.ADD_BUILDING:this.addBuilding(b.getBody());break;case c.STOP_RENDER:Ticker.setPaused(!0);break;case c.RESUME_RENDER:Ticker.setPaused(!1);break;case app.proxy.LevelUpProxy.CHANGED:case app.proxy.LevelUpProxy.COMPLETE:this.updateBuildingInfo();break;case c.MOVE:this.viewComponent&&
(b=b.getBody(),this.viewComponent.moveTo(b.x,b.y));break;case app.mediator.system.LoadMediator.ONSIZE:this.viewComponent&&this.viewComponent.changeView()}},addBuilding:function(b){this.viewComponent.update(b)},onRegister:function(){this.firstRun=!0},onRemove:function(){},_init:function(b){var c=app.view.scene.HomeSceneView,e=this.facade.retrieveProxy(app.proxy.HomeProxy.NAME).getData();this.setViewComponent(new c(b,e));this.updateBuildingInfo();this.viewComponent.addEventListener(c.SELECT_CONSTRUCT,
this)},updateBuildingInfo:function(){if(this.viewComponent)for(var b=this.facade.retrieveProxy(app.proxy.HomeProxy.NAME).getData(),c=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME),e=0;e<b.length;e++){var f=c.getBuildingLevel(b[e]);null!=f&&this.viewComponent.updateLevel(b[e].id,f)}},handleEvent:function(b){switch(b.type){case app.view.scene.HomeSceneView.SELECT_CONSTRUCT:switch(b.data){case app.data.HomeBuildingData.HALL:case app.data.HomeBuildingData.DRILL_GROUND:case app.data.HomeBuildingData.STRATEGY:case app.data.HomeBuildingData.MARKET:this.sendNotification(app.mediator.building.LevelUpMediator.SHOW,
b.data);break;case app.data.HomeBuildingData.HuBu:this.sendNotification(app.mediator.building.FarmLandMediator.SHOW,b.data);break;case app.data.HomeBuildingData.ARMYGROUP:this.sendNotification(app.mediator.system.ArmyGroupMediator.SHOW,b.data);break;case app.data.HomeBuildingData.FOLK_HOUSE:this.sendNotification(app.mediator.building.FolkHouseMediator.SHOW,b.data);break;case app.data.HomeBuildingData.SMALL_GAME:this.sendNotification(app.mediator.scene.SmallGameMediator.LOADDATA);break;default:app.view.Alert.getInstance().show(b.data+
"\u7a0d\u5019\u5f00\u653e\uff0c\u656c\u8bf7\u671f\u5f85\uff01",["\u786e\u5b9a","\u53d6\u6d88"],function(){})}}}},{NAME:"HomeMediator",SHOW:"Home_Show",CLOSE:"Home_Close",ADD_BUILDING:"Home_Add_Building",ADD_NPC:"Home_Add_Npc",STOP_RENDER:"Home_Stop_Render",RESUME_RENDER:"Home_Resume_Render",MOVE:"Home_Move"});puremvc.define({name:"app.mediator.scene.ResourceMediator",parent:puremvc.Mediator},{refreshInt:null,type:null,page:null,listNotificationInterests:function(){var b=app.mediator.scene.ResourceMediator;return[b.SHOW,b.LOAD_COMPLETE,b.CLOSE,b.SHOW_STEAL_SPRITE]},handleNotification:function(b){var c=app.mediator.scene.ResourceMediator;switch(b.getName()){case c.SHOW:this.userData=this.userInfoProxy.data;this.resProxy.loadResData();break;case c.LOAD_COMPLETE:this.indicateVo=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_3);
this.userData.stealIndicate=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_10);if(this.viewComponent)this.viewComponent.resourceData=b.getBody(),0==this.viewComponent.stage.children.length?this.viewComponent.init():this.viewComponent.show();else{var c=app.view.scene.ResourceSceneView,e=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;this.sendNotification(app.mediator.system.MainMenuMediator.SHOW,"map");this.sendNotification(app.mediator.system.IndicateMediator.SHOW,
"map");this.setViewComponent(new c(e));this.viewComponent.setData(b.getBody(),this.userData,this.indicateVo);this.viewComponent.addEventListener(c.SELECT_RESOURCE,this);this.viewComponent.addEventListener(c.RES_UPDATE,this);this.viewComponent.addEventListener(c.GO_AREA,this);this.viewComponent.addEventListener(c.CLEAR_CD,this)}this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!0);if(null==this.refreshInt){var f=this;this.refreshInt=setInterval(function(){f.resProxy.loadResData()},
3E3)}break;case c.CLOSE:if(this.refreshInt)clearInterval(this.refreshInt),this.refreshInt=null;this.viewComponent.removeEventListener(this.viewComponent.SELECT_RESOURCE,this);this.viewComponent.removeEventListener(this.viewComponent.RES_UPDATE,this);this.viewComponent.removeEventListener(this.viewComponent.GO_AREA,this);this.viewComponent.removeEventListener(this.viewComponent.CLEAR_CD,this);this.viewComponent.depose();this.setViewComponent(null);break;case c.SHOW_STEAL_SPRITE:this.viewComponent.drawSteal()}},
onRegister:function(){this.resProxy=this.facade.retrieveProxy(app.proxy.ResProxy.NAME);this.userInfoProxy=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME)},onRemove:function(){},handleEvent:function(b){switch(b.type){case app.view.scene.ResourceSceneView.SELECT_RESOURCE:this.sendNotification(app.mediator.system.ResControlMediator.SHOW,b.data);break;case app.view.scene.ResourceSceneView.RES_UPDATE:this.page=b.data;this.resProxy.loadResData(this.page);break;case app.view.scene.ResourceSceneView.GO_AREA:var c=
this.facade.retrieveProxy(app.proxy.AreaProxy.NAME);c.countryId=b.data;c.page=1;this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.AreaMediator);break;case app.view.scene.ResourceSceneView.CLEAR_CD:this.sendNotification(app.command.CommandType.CLEAR_INDICATE_TIME,this.indicateVo)}}},{NAME:"ResourceMediator",SHOW:"Resource_Show",CLOSE:"Resource_Close",LOAD_COMPLETE:"Resource_loadComplete",SHOW_STEAL_SPRITE:"Resource_showStealSprite"});puremvc.define({name:"app.mediator.scene.AreaMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.scene.AreaMediator;return[b.SHOW,b.LOAD_COMPLETE,b.CLOSE]},handleNotification:function(b){var c=app.mediator.scene.AreaMediator;switch(b.getName()){case c.SHOW:this.areaProxy.loadData();break;case c.LOAD_COMPLETE:this.indicateVo=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_3);if(this.viewComponent)this.viewComponent.areaData=
b.getBody(),this.viewComponent.show(this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource);else{var c=app.view.scene.AreaSceneView,e=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource,f=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;this.sendNotification(app.mediator.system.MainMenuMediator.SHOW,"map");this.sendNotification(app.mediator.system.IndicateMediator.SHOW,"map");var g=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME),h=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.HALL).level;
this.setViewComponent(new c(e,b.getBody(),g,f,this.indicateVo,h));this.viewComponent.addEventListener(c.SELECT_TOWN,this);this.viewComponent.addEventListener(c.LOAD_AREA_DATA,this);this.viewComponent.addEventListener(c.GO_RES_SCENE,this);this.viewComponent.addEventListener(c.CLEAR_CD,this);this.viewComponent.addEventListener(c.GO_WORLD_SCENE,this)}this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!0);if(null==this.refreshInt){var j=this;this.refreshInt=setInterval(function(){j.areaProxy.loadData()},
3E4)}break;case c.CLOSE:if(this.refreshInt)clearInterval(this.refreshInt),this.refreshInt=null;this.viewComponent.removeEventListener(this.viewComponent.SELECT_TOWN,this);this.viewComponent.removeEventListener(this.viewComponent.LOAD_AREA_DATA,this);this.viewComponent.removeEventListener(this.viewComponent.GO_RES_SCENE,this);this.viewComponent.removeEventListener(this.viewComponent.CLEAR_CD,this);this.viewComponent.removeEventListener(this.viewComponent.GO_WORLD_SCENE,this);this.viewComponent.depose();
this.setViewComponent(null)}},onRegister:function(){this.areaProxy=this.facade.retrieveProxy(app.proxy.AreaProxy.NAME)},onRemove:function(){},handleEvent:function(b){switch(b.type){case app.view.scene.AreaSceneView.SELECT_TOWN:this.sendNotification(app.mediator.system.AreaControlMediator.SHOW,b.data);break;case app.view.scene.AreaSceneView.LOAD_AREA_DATA:this.areaProxy.page=b.data;this.areaProxy.loadData(b.data);break;case app.view.scene.AreaSceneView.GO_RES_SCENE:var c=this.facade.retrieveProxy(app.proxy.ResProxy.NAME);
c.countryId=b.data;c.page=1;c.type=1;this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.ResourceMediator);break;case app.view.scene.AreaSceneView.CLEAR_CD:this.sendNotification(app.command.CommandType.CLEAR_INDICATE_TIME,this.indicateVo);break;case app.view.scene.AreaSceneView.GO_WORLD_SCENE:this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.WorldMediator)}}},{NAME:"AreaMediator",SHOW:"Area_Show",CLOSE:"Area_Close",LOAD_COMPLETE:"Area_loadComplete"});puremvc.define({name:"app.mediator.scene.WorldMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){return[app.mediator.scene.WorldMediator.SHOW,app.mediator.scene.WorldMediator.CLOSE,app.proxy.WorldProxy.COMPLETE,app.mediator.scene.WorldMediator.STOP_RENDER,app.mediator.scene.WorldMediator.RESUME_RENDER,app.proxy.UserInfoProxy.CHANGED,app.mediator.scene.WorldMediator.MOVE]},handleNotification:function(b){switch(b.getName()){case app.mediator.scene.WorldMediator.SHOW:this.setViewComponent(new app.view.scene.WorldMapView(app.GameData.GameResource));
this.sendNotification(app.mediator.system.MainMenuMediator.SHOW);this.sendNotification(app.mediator.system.IndicateMediator.SHOW);this.viewComponent.addEventListener(app.view.scene.WorldMapView.SELECT_CONSTRUCT,this);null!=this.WorldProxy.data?(this.viewComponent.setData(this.getDrawCitiesData(),this.getMainCityData(),this.getBattleCityData(),this.IndicateProxy),this.viewComponent.draw()):this.WorldProxy.getInitData();this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!0);break;
case app.mediator.scene.WorldMediator.CLOSE:this.viewComponent.removeEventListener(app.view.scene.WorldMapView.SELECT_CONSTRUCT);this.viewComponent.depose();this.setViewComponent(null);break;case app.proxy.WorldProxy.COMPLETE:this.viewComponent.setData(this.getCitiesData(1),this.getCitiesData(2),this.getMainCityData(),this.getBattleCityData(),this.IndicateProxy);this.viewComponent.draw();break;case app.mediator.scene.WorldMediator.STOP_RENDER:null!=this.viewComponent&&this.viewComponent.setTicker(!1);
break;case app.mediator.scene.WorldMediator.RESUME_RENDER:null!=this.viewComponent&&this.viewComponent.setTicker(!0);break;case app.mediator.scene.WorldMediator.MOVE:this.viewComponent&&(b=b.getBody(),this.viewComponent.moveTo(b.x,b.y))}},getMainCityData:function(){var b=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.cityId,b=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME).getCityDataByID(b),c=[];c.push(b.x,b.y);return c},getBattleCityData:function(){for(var b=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.cityId,
b=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME).getCityDataByID(b),c=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME).CityData.citis,e=[],f=0;f<c.length;f++){var g=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME).getCityDataByID(c[f]);if(g.levelmax==b.levelmax&&g.color!=b.color){var h={};h.x=g.x;h.y=g.y;e.push(h)}}return e},getCitiesData:function(b){var c=[],e=[];if(1==b)c=this.WorldProxy.CityData.citis;else if(2==b)c=this.WorldProxy.CityData.moveCitis;if(!c)return e;for(b=0;b<c.length;b++){var f=
this.WorldProxy.getCityDataByID(c[b]);e.push(f)}return e},onRegister:function(){this.WorldProxy=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME);this.UserInfoProxy=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME);this.IndicateProxy=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME)},onRemove:function(){this.viewComponent.depose();this.setViewComponent(null)},handleEvent:function(b){switch(b.type){case app.view.scene.WorldMapView.SELECT_CONSTRUCT:this.sendNotification(app.mediator.scene.WorldDialogMediator.SHOW,
b.data)}}},{NAME:"WorldMediator",SHOW:"WorldMediator_Show",CLOSE:"WorldMediator_Close",STOP_RENDER:"WorldMediator_Stop_render",RESUME_RENDER:"WorldMediator_Resume_render",MOVE:"WorldMediator_Move"});puremvc.define({name:"app.mediator.scene.DevelopMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.scene.DevelopMediator;return[b.SHOW,b.CLOSE]},handleNotification:function(b){switch(b.getName()){case app.mediator.scene.DevelopMediator.SHOW:this.selectedCityID=b.getBody();this.showPanel();break;case app.mediator.scene.DevelopMediator.CLOSE:this.closePanel()}},showPanel:function(){this.dialog&&this.dialog.depose();var b=app.GameData.GameResource,c=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME).getCityDataByID(this.selectedCityID),
e=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME).postData;this.dialog=new app.view.scene.DevelopDialog(b.getContent("develop"),c,e);this.dialog.addEventListener(app.view.scene.DevelopDialog.CLOSE,this);this.dialog.addEventListener(app.view.scene.DevelopDialog.CANCEL,this);this.dialog.addEventListener(app.view.scene.DevelopDialog.QUEREN,this)},closePanel:function(){if(this.dialog)this.dialog.removeEventListener(app.view.scene.DevelopDialog.CLOSE,this),this.dialog.removeEventListener(app.view.scene.DevelopDialog.CANCEL,
this),this.dialog.removeEventListener(app.view.scene.DevelopDialog.QUEREN,this),this.dialog.depose(),this.dialog=null},countDevelopCoin:function(b,c){var e=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME).getCityDataByID(this.selectedCityID),f=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME).postData;switch(b){case 1:e=f.business/e.business;break;case 2:e=f.trade/e.trade;break;case 3:e=f.mining/e.mineral;break;case 4:e=f.agriculture/f.agriculture;break;case 5:e=f.military/e.military;break;
default:e=f.trade/e.trade}return Math.round(100*e)/10*c},boolenDevelop:function(b){var c=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME).getCityDataByID(this.selectedCityID),e=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME).postData;switch(b){case 1:b=e.business>=c.businessmax?!1:!0;break;case 2:b=e.trade>=c.trademax?!1:!0;break;case 3:b=e.mining>=c.mineralmax?!1:!0;break;case 4:b=e.agriculture>=c.agriculturemax?!1:!0;break;case 5:b=e.military>=c.militarymax?!1:!0;break;default:b=e.trade>=
c.trademax?!1:!0}return b},handleEvent:function(b){switch(b.type){case app.view.scene.DevelopDialog.CLOSE:case app.view.scene.DevelopDialog.CANCEL:this.closePanel();break;case app.view.scene.DevelopDialog.QUEREN:var b=b.data,c=this.countDevelopCoin(b.type,b.lidu),e=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.silverCoin;if(this.boolenDevelop(b.type))if(e>=c){b.id=this.selectedCityID;var f=this;this.facade.retrieveProxy(app.proxy.WorldProxy.NAME).getDevelopData(b,function(){null!=app.GameData.hero&&
f.sendNotification(app.command.CommandType.SHOW_NEW_HERO)})}else app.view.Tooltip.getInstance().show(app.data.CONST.MSG_NOT_ENOUGH_MONEY);else app.view.Tooltip.getInstance().show("\u8d85\u51fa\u6700\u5927\u5f00\u53d1\u4e0a\u9650\uff01")}}},{NAME:"DevelopMediator",SHOW:"DevelopMediator_SHOW",CLOSE:"DevelopMediator_CLOSE"});puremvc.define({name:"app.mediator.scene.WorldDialogMediator",parent:puremvc.Mediator},{developColdownTimeId:11,imgInColddownTimeId:13,listNotificationInterests:function(){var b=app.mediator.scene.WorldDialogMediator;return[b.SHOW,b.CLOSE,app.proxy.WorldProxy.getImgInComplete,app.proxy.WorldProxy.getDevelopComplete,app.proxy.UserInfoProxy.CHANGED,app.mediator.system.CountryMediator.SELECT_COUNTRY_COMPLETE]},handleNotification:function(b){var c=app.mediator.scene.WorldDialogMediator;switch(b.getName()){case c.SHOW:this.userData=
this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;this.worldProxy=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME);this.prestige=this.userData.prestige;this.showPanel(b.getBody());break;case c.CLOSE:this.closePanel();break;case app.proxy.UserInfoProxy.CHANGED:if(!this.dialog)break;b=this.facade.retrieveProxy(app.proxy.AreaProxy.NAME);if(this.selectedCityId&&this.mainCityId&&this.selectedCityId!=this.mainCityId&&this.dialog)b.countryId=this.selectedCityId,b.page=null,this.closePanel(),
this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.AreaMediator);if(this.selectedCityId&&this.mainCityId&&this.selectedCityId==this.mainCityId&&this.dialog)this.sendNotification(app.mediator.scene.DevelopMediator.CLOSE),this.updatePanel(),b="\u672c\u6b21\u5f00\u53d1\u83b7\u5f97\u5a01\u671b\uff1a"+(this.userData.prestige-this.prestige),app.view.Tooltip.getInstance().show(b),this.prestige=this.userData.prestige;break;case app.mediator.system.CountryMediator.SELECT_COUNTRY_COMPLETE:this.completeSelctCountry()}},
showPanel:function(b){this.selectedCityId=b;this.dialog&&this.dialog.depose();var c=this;this.worldProxy.getPostCityData(b,function(){c.mainCityId=c.userData.cityId;var e=c.worldProxy.getCityDataByID(c.mainCityId).levelmax,f=c.worldProxy.getCityDataByID(b),g=c.worldProxy.postData,h=c.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource,j=c.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(c.developColdownTimeId).time,k=c.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(c.imgInColddownTimeId).time,
j=null!=j?j.getTime():0,k=null!=k?k.getTime():0;c.dialog=new app.view.scene.WorldDialogView(h.getContent("worldDialog"),b);c.dialog.addEventListener(app.view.scene.WorldDialogView.CLOSE,c);c.dialog.addEventListener(app.view.scene.WorldDialogView.getIn,c);c.dialog.addEventListener(app.view.scene.WorldDialogView.imgIn,c);c.dialog.addEventListener(app.view.scene.WorldDialogView.develop,c);c.dialog.setDialogView(f,g,e,j,k)})},closePanel:function(){if(this.dialog)this.dialog.removeEventListener(app.view.scene.WorldDialogView.CLOSE,
this),this.dialog.removeEventListener(app.view.scene.WorldDialogView.getIn,this),this.dialog.removeEventListener(app.view.scene.WorldDialogView.imgIn,this),this.dialog.removeEventListener(app.view.scene.WorldDialogView.develop,this),this.dialog.depose(),this.dialog=null},updatePanel:function(){var b=this;this.worldProxy.getPostCityData(this.selectedCityId,function(){var c=b.worldProxy.getCityDataByID(b.selectedCityId),e=b.worldProxy.postData,f=b.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(b.developColdownTimeId).time,
g=b.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(b.imgInColddownTimeId).time,f=null!=f?f.getTime():0,g=null!=g?g.getTime():0;b.dialog.updateDialogView(c,e,f,g)})},handleEvent:function(b){switch(b.type){case app.view.scene.WorldDialogView.CLOSE:this.sendNotification(app.mediator.scene.WorldMediator.RESUME_RENDER);this.closePanel();break;case app.view.scene.WorldDialogView.getIn:var c=this.facade.retrieveProxy(app.proxy.AreaProxy.NAME);c.countryId=b.data;c.page=1;this.closePanel();
this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.AreaMediator);break;case app.view.scene.WorldDialogView.imgIn:this.selectCountryData={};this.selectCountryData.id=b.data;this.showCountry();break;case app.view.scene.WorldDialogView.develop:this.sendNotification(app.mediator.scene.DevelopMediator.SHOW,b.data)}},completeSelctCountry:function(){this.worldProxy.getImgInData(this.selectCountryData)},showCountry:function(){-1==this.userData.country?this.sendNotification(app.mediator.system.CountryMediator.SHOW):
this.completeSelctCountry()}},{NAME:"WorldDialogMediator",SHOW:"WorldDialog_Show",CLOSE:"WorldDialog_Close"});puremvc.define({name:"app.mediator.scene.SmallGameMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.scene.SmallGameMediator;return[b.SHOW,b.UPDATE,b.LOADDATA]},handleNotification:function(b){var c=app.mediator.scene.SmallGameMediator;switch(b.getName()){case c.SHOW:var b=app.view.scene.SmallGameSceneView,c=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource,e=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.DRILL_GROUND).level;
this.hallLev=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.HALL).level;this.setViewComponent(new b(c,this.smallGameProxy.data,e,this.hallLev,this.smallGameProxy.picId));this.viewComponent.addEventListener(app.view.scene.SmallGameSceneView.START,this);this.viewComponent.addEventListener(app.view.scene.SmallGameSceneView.OVER,this);this.viewComponent.addEventListener(app.view.scene.SmallGameSceneView.CLOSE,this);this.viewComponent.addEventListener(app.view.scene.SmallGameSceneView.SHOW_HELP,
this);break;case c.LOADDATA:this.smallGameProxy.loadData();break;case c.UPDATE:this.viewComponent.data=this.smallGameProxy.data,this.viewComponent.countTxt.text="\u4eca\u5929\u5269\u4f59\u6b21\u6570"+this.smallGameProxy.data.count}},onRegister:function(){this.smallGameProxy=this.facade.retrieveProxy(app.proxy.SmallGameProxy.NAME)},onRemove:function(){},handleEvent:function(b){switch(b.type){case app.view.scene.SmallGameSceneView.START:this.smallGameProxy.gameStart();break;case app.view.scene.SmallGameSceneView.OVER:this.smallGameProxy.gameOver(b.data);
break;case app.view.scene.SmallGameSceneView.CLOSE:this.viewComponent.removeEventListener(app.view.scene.SmallGameSceneView.START,this);this.viewComponent.removeEventListener(app.view.scene.SmallGameSceneView.OVER,this);this.viewComponent.removeEventListener(app.view.scene.SmallGameSceneView.CLOSE,this);this.viewComponent.removeEventListener(app.view.scene.SmallGameSceneView.SHOW_HELP,this);this.viewComponent.depose();this.setViewComponent(null);this.sendNotification(app.command.CommandType.GO_SCENE,
app.mediator.scene.HomeMediator);break;case app.view.scene.SmallGameSceneView.SHOW_HELP:b=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;this.helpComponent=new app.view.system.SmallGameHelpView(b.getContent("dg_smallGameHelp_pop"));this.helpComponent.addEventListener(app.view.system.SmallGameHelpView.CLOSE,this);break;case app.view.system.SmallGameHelpView.CLOSE:this.helpComponent.depose(),this.helpComponent=null}}},{NAME:"SmallGameMediator",SHOW:"SmallGame_Show",UPDATE:"SmallGame_Update",
LOADDATA:"SmallGame_LoadData"});puremvc.define({name:"app.mediator.system.LoadMediator",parent:puremvc.Mediator},{_loadBarType:"big",listNotificationInterests:function(){return[app.mediator.system.LoadMediator.USE,app.mediator.system.LoadMediator.SHOW,app.mediator.system.LoadMediator.CLOSE,app.mediator.system.LoadMediator.ONSIZE]},handleNotification:function(b){switch(b.getName()){case app.mediator.system.LoadMediator.USE:this._loadBarType=b.getBody();break;case app.mediator.system.LoadMediator.SHOW:"big"==this._loadBarType?this._showBigLoadBar(b.getBody()):
this._showSmallLoadBar(b.getBody());break;case app.mediator.system.LoadMediator.CLOSE:"big"==this._loadBarType?"big"==b.getBody()&&this._hideBigLoadBar():this._hideSmallLoadBar();break;case app.mediator.system.LoadMediator.ONSIZE:if(this._bigLoadForm){var b=this._bigLoadForm.view,c=b.clientWidth,e=b.clientHeight,f=app.GameData.gameCanvas.width,g=app.GameData.gameCanvas.height,h=f/480;268*h>g?(h=g/268,c=480>c?0.5*(480*h-c*h):0,e=0.5*(g-e*h)):(c=0.5*(f-c*h),e=268>e?0.5*(268*h-e*h):0);b.style["-webkit-transform-origin"]=
"0 0";b.style["-webkit-transform"]="scale("+h+")";b.style.left=c+"px";b.style.top=e+"px"}}},_showSmallLoadBar:function(b){if(!this._loadForm)this._hideBigLoadBar(),this._loadForm=new app.view.base.BaseUIForm(app.GameData.GameResource.getContent("sLoading"),!0,0),this._sLoadBar=this._loadForm.view.querySelector("#sloadbar"),this._sLoadText=this._loadForm.view.querySelector("#sloadtext");this._sLoadBar.style.width=this.showPercent(b,480)+"px";this._sLoadText.innerHTML=this.showText(b)},_hideSmallLoadBar:function(){if(this._sLoadBar)this._loadForm.depose(),
this._sLoadText=this._sLoadBar=this._loadForm=null},showText:function(b){return"string"==typeof b?b:b.text},showPercent:function(b,c){return"string"==typeof b?c:Math.ceil(b.loaded/b.total*c)},_showBigLoadBar:function(b){if(!this._bigLoadForm)this._hideSmallLoadBar(),this._bigLoadForm=new app.view.base.BaseUIForm(this.getBigLoadBarHtml(),!0),this._bigLoadBar=this._bigLoadForm.view.querySelector("#loadbar"),this._loadText=this._bigLoadForm.view.querySelector("#loadtext");this._bigLoadBar&&(this._bigLoadBar.style.width=
this.showPercent(b,252)+"px");if(this._loadText)this._loadText.innerHTML=this.showText(b)},_hideSmallLoadBar:function(){if(this._sLoadBar)this._loadForm.depose(),this._sLoadText=this._sLoadBar=this._loadForm=null},_hideBigLoadBar:function(){if(this._bigLoadForm)this._bigLoadForm.depose(),this._loadText=this._bigLoadBar=this._bigLoadForm=null},getBigLoadBarHtml:function(){var b;return"<div id='loading' style='position:absolute;background:url(images/ui/loadingbg.jpg) left top no-repeat; width:480px; height:268px;'><div style='width:252px; height:4px; overflow: hidden; margin:0 auto; padding-top:204px;'><div id='loadbar' style='width:1px; height:4px;background:url(images/ui/loadingbar.png) left top repeat-x;'></div></div><div id='loadtext' style='width:480px; height: 27px; line-height: 27px; font-size: 10px; text-align:center;position:absolute;top:206px;' class='fc1'>100%</div></div>"}},
{NAME:"LoadMediator",SHOW:"LoadMediator_Show",CLOSE:"LoadMediator_Close",USE:"LoadMediator_Use",ONSIZE:"LoadMediator_OnSize"});puremvc.define({name:"app.mediator.system.ActivityMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){return[]},handleNotification:function(b){b.getName()},onRegister:function(){},onRemove:function(){},handleEvent:function(){}},{NAME:"ActivityMediator"});puremvc.define({name:"app.mediator.system.ChatMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.system.ChatMediator;return[b.SHOW_LINE,b.SHOW,b.CLOSE,b.RECEIVED,b.GOSCENE,app.mediator.system.LoadMediator.ONSIZE]},systemNoticeDiv:null,nowSystemNotice:null,isDisplaySNotice:!0,handleNotification:function(b){var c=app.mediator.system.ChatMediator,e=app.view.system.ChatView;switch(b.getName()){case c.SHOW_LINE:this.showChatLine();this.chatLine.style.display="block";
break;case c.SHOW:this.showChatView();this.chatLine.style.display="none";break;case c.CLOSE:"map"==b.getBody()&&(this.chatLine.style.display="none");this.viewComponent&&this.handleEvent({type:e.CLOSE});break;case c.RECEIVED:b=this.convertAll(b.getBody());if(this.viewComponent)for(c=0;c<b.length;c++)this.viewComponent.appendMsg(b[c]);if(0<b.length&&this.chatLine){this.chatLine.querySelector("#chat_line").innerHTML=b[b.length-1].value;4==b[b.length-1].group&&(this.animate.show(!0),this.animate.play());
for(c=b.length;c--;)if(5==b[c].group){this.addSystemNotice(b[c].value);break}}break;case app.mediator.system.ChatMediator.GOSCENE:this.isDisplaySNotice=b.getBody().NAME==app.mediator.scene.HomeMediator.NAME?!0:!1;this.showSystemNotice();break;case app.mediator.system.LoadMediator.ONSIZE:this.setChatLineTop()}},showChatLine:function(){var b=app.GameData.GameResource,c;if(!this.chatLine){c=document.createElement("div");c.innerHTML=b.getContent("chatLine");this.chatLine=c.children[0];app.GameData.gameDiv.appendChild(this.chatLine);
this.chatLine.style.left="2px";this.setChatLineTop();this.chatBtn=this.chatLine.querySelector("#chat_btn");var e=this;this.chatBtn[app.Event.ONCLICK]=function(){e.showChatView();e.chatLine.style.display="none";e.closeInterval()};this.systemNoticeDiv=this.chatLine.querySelector("#systemNotice");this.animate=app.view.AnimateCanvas.createIcon(b,"uieff_05",-6,-6);this.chatBtn.appendChild(this.animate.canvas);this.animate.show(!1);this.animate.stop()}},setChatLineTop:function(){this.chatLine&&(this.chatLine.style.top=
app.GameData.gameCanvas.height-46+"px")},showChatView:function(){if(!this.viewComponent){var b=app.view.system.ChatView;this.setViewComponent(new app.view.system.ChatView(app.GameData.GameResource.getContent("chat")));this.viewComponent.onPageSelect=ClassUtils.delegate(this,this.onPageSelect);this.viewComponent.setNotice(this.facade.retrieveProxy(app.proxy.GameInfoProxy.NAME).data.notice);this.viewComponent.addEventListener(b.CLOSE,this);this.viewComponent.addEventListener(b.SEND,this);this.viewComponent.addEventListener(b.SHOW_ROLE,
this);this.viewComponent.addEventListener(b.SET_ROLE,this);this.onPageSelect(0)}},showRole:function(){var b=this,c=this.facade.retrieveProxy(app.proxy.ChatProxy.NAME),e;app.view.Alert.getInstance().show("<p align='center'>\u8f93\u5165\u73a9\u5bb6\u7684\u540d\u79f0</p><input id='role_input' value='' type='text' style='background-color:black; border:#454233 1px solid; width:158px; height:27px;'>",["\u786e\u5b9a","\u53d6\u6d88"],function(e){b.viewComponent.selectTarget(0);0==e&&(e=document.querySelector("#role_input").value.trim(),
0<e.length?c.queryTarget(e,function(c){if(null!=c){var e=b.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.roleId;c.id!=e?b.viewComponent.setPrivateRole(c):app.view.Tooltip.getInstance().show("\u60a8\u4e0d\u80fd\u548c\u81ea\u5df1\u804a\u5929")}}):app.view.Tooltip.getInstance().show("\u73a9\u5bb6\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"))});e=document.getElementById("role_input");e[app.Event.ONCLICK]=function(){this.focus()};e.focus()},sendMsg:function(b){this.facade.retrieveProxy(app.proxy.ChatProxy.NAME).sendMsg(b,
function(){this.viewComponent&&this.viewComponent.clearInput()})},onPageSelect:function(b){this.viewComponent&&this.viewComponent.replaceAllMsg(this.convertAll(this.facade.retrieveProxy(app.proxy.ChatProxy.NAME).getDataByGroup(b)))},handleEvent:function(b){var c=app.view.system.ChatView;switch(b.type){case c.CLOSE:this.viewComponent.depose();this.setViewComponent(null);this.chatLine.style.display="block";this.animate.show(!1);this.animate.stop();break;case c.SEND:this.sendMsg(b.data);break;case c.SHOW_ROLE:this.showRole();
break;case c.SET_ROLE:this.viewComponent.selectTarget(4,!0),this.viewComponent.setPrivateRole(b.data)}},convertAll:function(b){for(var b=b||[],c=[],e=0;e<b.length;e++)c.push(this.convertData(b[e]));return c},convertData:function(b){var c={};c.group=b.group;c.value="";var e;switch(b.group){case 5:e="\u3010\u7cfb\u7edf\u3011";break;case 4:e=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;b.rid!=e.roleId?(e="\u3010"+b.name+"\u3011",e=this.getLink(e,b.rid,b.name)+"\u5bf9\u4f60\u8bf4"):(e=
"\u3010"+b.targetName+"\u3011",e="\u4f60\u5bf9"+this.getLink(e,b.targetId,b.targetName)+"\u8bf4");break;default:b.rid!=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.roleId?(e="\u3010"+b.name+"\u3011",e=this.getLink(e,b.rid,b.name)):e="\u3010"+b.name+"\u3011"}c.value=e+"\uff1a"+this.getMessage(b)+"&nbsp;&nbsp;"+this.getTime(b.sendTime);return c},getLink:function(b,c,e){return'<a id="'+c+'" name="'+e+'">'+(b+"</a>")},onLabelClick:function(){},getTime:function(b){return"["+b+"]"},getMessage:function(b){var c=
"";switch(b.type){case 0:c=b.msg;break;case 1:c="\u5f97\u5230"+b.msg;break;case 2:c="\u64c2\u53f0\u8d5b\u5f00\u59cb";break;case 3:c="\u64c2\u53f0\u8d5b\u5956\u52b1"+b.msg;break;case 4:c="\u5c55\u793a\u7269\u54c1"+b.msg}return c},addSystemNotice:function(b){this.nowSystemNotice=b;this.showSystemNotice()},showSystemNotice:function(){if(null!=this.systemNoticeDiv)if(this.isDisplaySNotice){if(this.systemNoticeDiv.style.visibility="visible",null==this._intervalID&&this.nowSystemNotice)this.systemNoticeDiv.innerHTML=
"<marquee loop=1 scrollamount=2>"+this.nowSystemNotice+"</marquee>",this.setInterval(650*this.nowSystemNotice.length),this.nowSystemNotice=null}else this.systemNoticeDiv.style.visibility="hidden"},setInterval:function(b){this._intervalID=null;this._intervalID=setTimeout(ClassUtils.delegate(this,this.closeInterval),b)},closeInterval:function(){clearTimeout(this._intervalID);this._intervalID=null;if(this.systemNoticeDiv)this.systemNoticeDiv.innerHTML="";this.showSystemNotice()}},{NAME:"ChatMediator",
SHOW:"ChatMediator_Show",CLOSE:"ChatMediator_Close",RECEIVED:"ChatMediator_Received",SHOW_LINE:"ChatMediator_ShowLine",GOSCENE:"ChatMediator_goScene"});puremvc.define({name:"app.mediator.system.IndicateMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.system.IndicateMediator;return[b.SHOW,b.CLOSE,b.ADD_INDICATE,app.proxy.UserInfoProxy.CHANGED,app.proxy.IndicateProxy.ADD,app.mediator.system.LoadMediator.ONSIZE]},handleNotification:function(b){var c=app.mediator.system.IndicateMediator;switch(b.getName()){case c.SHOW:this.show(b.getBody());app.controller.TimeController.getInstance().addListener(this);break;
case c.CLOSE:if(this.viewComponent)app.controller.TimeController.getInstance().removeListener(this),this.viewComponent.view.style.display="none";break;case app.proxy.UserInfoProxy.CHANGED:b=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_3);c=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;b.num=c.warToken;b.maxNum=c.maxWarToken;break;case app.mediator.system.LoadMediator.ONSIZE:this.viewComponent&&this.viewComponent.changeView();
break;case app.proxy.IndicateProxy.ADD:this.viewComponent&&this.addItem()}},step:function(){this.viewComponent.update()},show:function(){if(null==this.viewComponent){var b=app.view.system.IndicateView,c=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;this.setViewComponent(new b(c.getContent("indicate")));this.viewComponent.addEventListener(b.ITEM_SELECT,this);this.viewComponent.addEventListener(b.CLEAR_TIME,this);this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME);this.addItem()}this.viewComponent.view.style.display=
"block"},addItem:function(){this.viewComponent.reSetScroll();for(var b=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).data,c,e=0;e<b.length;e++)c=this.createItem(b[e]),null!=c&&this.viewComponent.addItem(c);this.viewComponent.addItem(this.createItem({type:100}));this.viewComponent.gotoPage()},createItem:function(b){var c=app.proxy.IndicateProxy,e,f,g,h,j=!0;switch(b.type){case c.TYPE_3:e="<span class='fc4'>\u6218\u6597\u51b7\u5374&nbsp;\u53ef\u6218\u6597</span>";f="<span>\u6218\u6597\u51b7\u5374&nbsp;#0</span>";
g="<span>\u6218\u6597\u51b7\u5374&nbsp;\u5df2\u65e0\u519b\u4ee4</span>";h=["time"];break;case c.TYPE_4:e="<span class='fc4'>\u8bad\u7ec3&nbsp;#0/#1&nbsp\u53ef\u7a81\u98de</span>";f="<span>\u8bad\u7ec3&nbsp;#0/#1&nbsp;#2</span>";g="<span class='fc4'>\u8bad\u7ec3&nbsp;#0/#1&nbsp\u53ef\u7a81\u98de</span>";h=["num","maxNum","time"];break;case c.TYPE_5:e="<span class='fc4'>\u53ef\u5347\u7ea7\u79d1\u6280</span>";f="<span>\u5347\u7ea7\u79d1\u6280&nbsp;#0</span>";h=["time"];break;case c.TYPE_6:e="<span class='fc4'>\u5f81\u6536\u51b7\u5374&nbsp;\u53ef\u5f81\u6536</span>";
f="<span>\u5f81\u6536\u51b7\u5374&nbsp;#0</span>";g="<span class='fc7'>\u5f81\u6536\u51b7\u5374&nbsp;\u4eca\u5929\u65e0\u5f81\u6536</span>";h=["time"];break;case c.TYPE_7:e="<span class='fc4'>\u5efa\u7b51\u961f\u4f0d&nbsp;\u7a7a\u95f2</span>";f="<span>\u5efa\u7b51\u961f\u4f0d&nbsp;#0</span>";h=["time"];break;case c.TYPE_9:e="<span class='fc4'>\u7cae\u98df&nbsp;#0/#1&nbsp;\u53ef\u6536\u83b7</span>";f="<span>\u7cae\u98df&nbsp;#0/#1&nbsp;#2</span>";g="<span class='fc7'>\u7cae\u98df&nbsp;#0/#1&nbsp;\u6536\u83b7\u7ed3\u675f</span>";
h=["num","maxNum","time"];j=!1;break;case 100:e="<span>\u589e\u52a0\u5efa\u7b51\u961f\u4f0d</span>",h=[],j=!0}var k;null!=e&&(k=new app.view.system.IndicateItem(e,f,g,b,h,j));return k},statusColor:function(b){return b.full?"fc6":"fc4"},onRegister:function(){},onRemove:function(){},handleEvent:function(b){var c=app.proxy.IndicateProxy,e=app.view.system.IndicateView;if(b.type==e.ITEM_SELECT)switch(b.data.type){case c.TYPE_6:0<b.data.num&&this.sendNotification(app.mediator.building.HubuMediator.SHOW,
0);break;case c.TYPE_4:this.sendNotification(app.mediator.building.DrillGroundMediator.SHOW,0);break;case c.TYPE_9:0<b.data.num&&this.sendNotification(app.mediator.building.FarmLandMediator.SHOW,app.data.HomeBuildingData.HuBu);break;case c.TYPE_3:this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.BattleMapMediator);break;case c.TYPE_5:this.sendNotification(app.mediator.building.StrategyCenterMediator.SHOW,0);break;case 100:this.sendNotification(app.command.CommandType.ADD_BUILDDINGSIZE)}else b.type==
e.CLEAR_TIME&&this.sendNotification(app.command.CommandType.CLEAR_INDICATE_TIME,b.data)}},{NAME:"IndicateMediator",ADD_INDICATE:"Indicate_AddIndicate",SHOW:"Indicate_Show",CLOSE:"Indicate_Close",ADD_BUILD_TIME:"Indicate_AddBuildTime",REDUCE_BUILD_TIME:"Indicate_ReduceBuildTime"});puremvc.define({name:"app.mediator.system.MailMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.system.MailMediator;return[b.SHOW,b.LOAD_COMPLETE,b.ADD_COMPLETE]},handleNotification:function(b){var c=app.mediator.system.MailMediator;switch(b.getName()){case c.SHOW:b=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;null==this.viewComponent&&(this.setViewComponent(new app.view.system.MailView(b)),null==this.mailProxy.mailData?this.mailProxy.loadMailData():
this.sendNotification(c.LOAD_COMPLETE,this.mailProxy.mailData),this.viewComponent.addEventListener(app.view.system.MailView.CLOSE,this),this.viewComponent.addEventListener(app.view.system.MailView.READ,this),this.viewComponent.addEventListener(app.view.system.MailView.DEL,this),this.viewComponent.addEventListener(app.view.system.MailView.DEL_ALL,this),this.viewComponent.addEventListener(app.view.system.MailView.NEW_MAIL,this),this.viewComponent.addEventListener(app.view.system.MailView.LOAD_NEXT_MAIL_LIST,
this));break;case c.LOAD_COMPLETE:this.sendNotification(app.proxy.MailProxy.ICON_STATUS,0);this.viewComponent.setData(b.getBody());break;case c.ADD_COMPLETE:this.viewComponent.addData(b.getBody())}},onRegister:function(){this.mailProxy=this.facade.retrieveProxy(app.proxy.MailProxy.NAME)},onClose:function(){this.viewComponent.removeEventListener(app.view.system.MailView.CLOSE,this);this.viewComponent.removeEventListener(app.view.system.MailView.READ,this);this.viewComponent.removeEventListener(app.view.system.MailView.DEL,
this);this.viewComponent.removeEventListener(app.view.system.MailView.DEL_ALL,this);this.viewComponent.removeEventListener(app.view.system.MailView.NEW_MAIL,this);this.viewComponent.removeEventListener(app.view.system.MailView.LOAD_NEXT_MAIL_LIST,this);this.viewComponent=null},handleEvent:function(b){switch(b.type){case app.view.system.MailView.CLOSE:this.onClose();break;case app.view.system.MailView.READ:this.mailProxy.readMail(b.data);break;case app.view.system.MailView.DEL:this.mailProxy.delMail(b.data);
break;case app.view.system.MailView.DEL_ALL:this.mailProxy.delAllMail(b.data);break;case app.view.system.MailView.NEW_MAIL:this.sendNotification(app.mediator.system.MailDetailMediator.SHOW_INPUT,b.data);break;case app.view.system.MailView.LOAD_NEXT_MAIL_LIST:this.mailProxy.loadMailData(b.data)}}},{NAME:"MailMediator",SHOW:"Mail_Show",CLOSE:"Mail_Close",LOAD_COMPLETE:"Mail_LoadComplete",ADD_COMPLETE:"Mail_AddComplete"});puremvc.define({name:"app.mediator.system.PopUpMsgMediator",parent:puremvc.Mediator},{template:null,listNotificationInterests:function(){return[app.mediator.system.PopUpMsgMediator.SHOW,app.mediator.system.LoadMediator.ONSIZE]},handleNotification:function(b){switch(b.getName()){case app.mediator.system.PopUpMsgMediator.SHOW:this.show(b.getBody());break;case app.mediator.system.LoadMediator.ONSIZE:this.viewComponent&&this.viewComponent.changeView()}},show:function(b){var c=new app.view.base.BaseUIForm(this.template,
!0);c.container.addEventListener(app.Event.CLICK,this);c.view.querySelector("#pmsg").innerHTML=b;var e=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.heroId,e=app.data.DataBase.getInstance().getHeroInfo(e).pic;c.view.querySelector("#npc").style.background="url(images/heros/hero_"+e+".gif) left center no-repeat";this.msg=b;this.setViewComponent(c)},close:function(){this.viewComponent.container.removeEventListener(app.Event.CLICK,this);this.viewComponent.depose();this.setViewComponent(null)},
handleEvent:function(){this.close()}},{NAME:"PopUpMsgMediator",SHOW:"PopUpMsgMediator_Show"});puremvc.define({name:"app.mediator.system.AutoPopUpMsgMediator",parent:puremvc.Mediator},{msgContainer:null,listNotificationInterests:function(){var b=app.mediator.system.AutoPopUpMsgMediator;return[b.SHOW_REWARDS,b.SHOW_MSG]},handleNotification:function(b){var c=app.mediator.system.AutoPopUpMsgMediator;switch(b.getName()){case c.SHOW_REWARDS:var c="",e,b=b.getBody(),f="none",g;try{for(var h=0;h<b.length;h++)10==b[h].tid?(g=app.data.DataBase.getInstance().getRewardInfo(b[h]),e=g.name,f=g.itemClass):
e=app.data.DataBase.getInstance().getRewardName(b[h].tid),c+="\u5956\u52b1 <label class="+f+">"+e+"</label>\u00d7"+b[h].value+"<br />";this.show(c)}catch(j){app.trace(j.message)}break;case c.SHOW_MSG:this.show(b.getBody())}},show:function(b){this.close();var c=document.createElement("div");c.style.width="480px";c.style["text-align"]="center";c.className="fc4";c.innerHTML=b;c.style.background="url(images/ui/popubg_04.png) center top repeat-y";c.style.lineHeight="24px";this.msgContainer=new app.view.base.BaseUIForm(c,
!1);var e=this;this.timeID=setTimeout(function(){e.close()},2E3)},close:function(){this.timeID&&clearTimeout(this.timeID);this.timeID=null;null!=this.msgContainer&&this.msgContainer.depose();this.msgContainer=null}},{NAME:"PopUpRewardMediator",SHOW_REWARDS:"AutoPopUpMsgMediator_ShowReward",SHOW_MSG:"AutoPopUpMsgMediator_ShowMsg"});puremvc.define({name:"app.mediator.system.MainMenuMediator",parent:puremvc.Mediator},{state:null,listNotificationInterests:function(){var b=app.mediator.system.MainMenuMediator;return[b.SHOW,b.CLOSE,b.SHOW_TOKEN,b.SHOW_MENU,b.HIDE_MENU,b.BTNSHINE,b.CHANGE_RIGHT_MENU,app.proxy.UserInfoProxy.CHANGED,app.proxy.LevelUpProxy.COMPLETE,app.proxy.GiftProxy.ICON_STATUS,app.proxy.MailProxy.ICON_STATUS,app.proxy.TaskStatusProxy.ICON_STATUS,app.mediator.system.LoadMediator.ONSIZE]},bigMenuStatus:[],smallMenuStatus:[],
handleNotification:function(b){var c=app.mediator.system.MainMenuMediator;switch(b.getName()){case c.SHOW:if(null==this.levelUpProxy)this.levelUpProxy=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME),this.hallVo=this.levelUpProxy.getBuildInfo(app.data.HomeBuildingData.HALL),this.userVo=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;this.show(b.getBody());this.update();break;case c.CLOSE:this.topMenu&&(this.topMenu.style.display="none");break;case app.proxy.UserInfoProxy.CHANGED:this.topMenu&&
(this.update(),(this.userVo.hasWorld||this.userVo.hasChallenge)&&this.showZSBtn());break;case c.SHOW_TOKEN:this.showToken();break;case c.SHOW_MENU:this.initMenu(null,b.getBody(),!0);break;case c.HIDE_MENU:this.hideMenu();break;case c.BTNSHINE:this.btnShineSet(b.getBody());break;case app.proxy.LevelUpProxy.COMPLETE:b=b.getBody();if(1==b.id)this.topMenu&&(this.update(),this.rightMenuBtn("\u4e3b\u57ce")),this.topMenu.querySelector("#menu_level").innerHTML=b.level;break;case app.proxy.GiftProxy.ICON_STATUS:this.updateGiftState(b.getBody());
break;case app.proxy.MailProxy.ICON_STATUS:this.updateMailState(b.getBody());break;case app.proxy.TaskStatusProxy.ICON_STATUS:this.updateTaskState(b.getBody());break;case app.mediator.system.LoadMediator.ONSIZE:this.scaleToScreen();break;case c.CHANGE_RIGHT_MENU:this.rightMenuBtn(b.getBody())}},show:function(){var b,c=this;if(!this.topMenu)b=document.createElement("div"),b.innerHTML=app.GameData.GameResource.getContent("topMenu"),this.topMenu=b.children[0],app.GameData.gameDiv.appendChild(this.topMenu),
this.scaleToScreen(),this.funBtnDiv=this.topMenu.querySelector("#fun_btns"),this.funBtns=this.topMenu.querySelectorAll("#fun_btns>div"),this.funBtns[0][app.Event.ONCLICK]=ClassUtils.delegate(this,this.initMenu,0,!0),this.funBtns[1][app.Event.ONCLICK]=function(){c.sendNotification(app.mediator.building.TaskMediator.SHOW)},this.funBtns[2][app.Event.ONCLICK]=function(){c.sendNotification(app.mediator.system.HeroMediator.SHOW,0)},this.funBtns[3][app.Event.ONCLICK]=ClassUtils.delegate(this,this.initMenu,
3,!0),this.topBtns=this.topMenu.querySelector("#top_btns").querySelectorAll("div"),this.topBtns[0][app.Event.ONCLICK]=function(){c.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.HomeMediator)},this.topBtns[1][app.Event.ONCLICK]=function(){c.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.BattleMapMediator)},this.topMenu.querySelector("#jl_icon")[app.Event.ONCLICK]=function(){c.showToken()},b=this.topMenu.querySelectorAll("#menu_icon>li"),this.mailIcon=b[0],
this.mailIcon[app.Event.ONCLICK]=function(){c.sendNotification(app.mediator.system.MailMediator.SHOW)},b[1][app.Event.ONCLICK]=function(){c.sendNotification(app.mediator.system.PayMediator.SHOW)},this.giftIcon=b[2],this.giftIcon[app.Event.ONCLICK]=function(){c.sendNotification(app.mediator.system.GiftMediator.SHOW)},this.topMenu.querySelector("#menu_season")[app.Event.ONCLICK]=function(){c.showCityInfo()},this.rightMenuBtn("\u4e3b\u57ce");this.topMenu.style.display="block"},scaleToScreen:function(){this.topMenu&&
(this.topMenu.style.width=app.GameData.gameCanvas.width+"px");this.topMenu&&(this.topMenu.style.height=app.GameData.gameCanvas.height+"px")},onRegister:function(){var b=this;this.clearMenu=function(){b.hideMenu()};this.stage=document.getElementById("viewporter");this.stage.addEventListener(app.Event.CLICK,this.clearMenu)},onRemove:function(){if(this.clearMenu)this.stage.removeEventListener(app.Event.CLICK,this.clearMenu),this.clearMenu=null},initMenu:function(b,c){var e,f;if(c===this.currentIndex)this.hideMenu();
else{this.hideMenu();this.currentIndex=c;var g=this.smallMenuStatus,h=function(b,c){for(var e=[],f=0;f<b.length;f++)e.push(null!=c[b[f]]?c[b[f]].status:0);return e};switch(c){case 0:e=this.menuGL;f=h([5,6,7,8,9],g);break;case 3:e=this.menuZS,f=h([0,1,2,3,4],g)}}if(e){var j=this;this.currentMenu=new app.view.system.Menu(e,f,app.GameData.GameResource,function(b){0==c?j.functionality(b):3==c&&j.military(b);j.hideMenu()});for(f=e=0;f<this.funBtns.length;f++)"block"==this.funBtns[f].style.display&&e++;
f=this.currentMenu.container;f.style.right=this.funBtns[c].clientWidth*((3==e?2:3)-c)+"px";f.style.top=this.funBtns[c].clientHeight+2+"px";this.funBtnDiv.appendChild(f)}b&&b.stopPropagation()},hideMenu:function(){this.currentMenu&&this.currentMenu.depose();this.currentMenu=this.currentIndex=null},rightMenuBtn:function(b){this.state=b;if(this.topMenu)"\u526f\u672c"==b?(this.topBtns[0].style.display="block",this.topBtns[1].style.display="none"):(this.topBtns[0].style.display="\u8d44\u6e90"==b||"\u5730\u533a"==
b?"block":"\u4e3b\u57ce"==b?"none":"block",this.topBtns[1].style.display="block"),50<=this.hallVo.level?(this.menuGL=["\u6210\u5c31","\u6392\u884c","\u5e2e\u52a9"],this.menuZS=["\u4e16\u754c","\u5730\u533a","\u8d44\u6e90","\u6311\u6218"]):(this.levelUpProxy.isBuildingShow(22)?20>=this.hallVo.level?this.menuCtrl(1,1):this.menuCtrl(1,0):this.topBtns[1].style.display="none",this.showZSBtn(),this.funBtns[2].style.display=this.levelUpProxy.isBuildingShow(23)?"block":"none",this.levelUpProxy.isBuildingShow(31)?
(this.funBtns[0].style.display="block",this.menuGL=[],this.levelUpProxy.isBuildingShow(29)&&this.menuGL.push("\u6210\u5c31"),this.levelUpProxy.isBuildingShow(30)&&this.menuGL.push("\u6392\u884c"),this.levelUpProxy.isBuildingShow(31)&&this.menuGL.push("\u5e2e\u52a9")):this.funBtns[0].style.display="none",this.levelUpProxy.isBuildingShow(17)?(this.topMenu.querySelectorAll("#menu_icon>li")[2].style.display="block",this.funBtns[1].style.display="block"):(this.topMenu.querySelectorAll("#menu_icon>li")[2].style.display=
"none",this.funBtns[1].style.display="none"))},showZSBtn:function(){!this.userVo.hasWorld&&!this.userVo.hasChallenge&&!this.levelUpProxy.isBuildingShow(27)?this.funBtns[3].style.display="none":(this.funBtns[3].style.display="block",this.menuZS=[],this.userVo.hasWorld&&this.menuZS.push("\u4e16\u754c"),this.levelUpProxy.isBuildingShow(27)&&this.menuZS.push("\u5730\u533a"),this.levelUpProxy.isBuildingShow(28)&&this.menuZS.push("\u8d44\u6e90"),this.userVo.hasChallenge&&this.menuZS.push("\u6311\u6218"))},
military:function(b){switch(b){case "\u5730\u533a":var b=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data,c=this.facade.retrieveProxy(app.proxy.AreaProxy.NAME);c.countryId=b.cityId;c.page=null;this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.AreaMediator);break;case "\u4e16\u754c":this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.WorldMediator);break;case "\u8d44\u6e90":b=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;c=this.facade.retrieveProxy(app.proxy.ResProxy.NAME);
c.countryId=b.cityId;c.page=1;c.type=1;this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.ResourceMediator);break;case "\u6311\u6218":this.sendNotification(app.mediator.system.ChallengeMediator.SHOW)}},functionality:function(b){switch(b){case "\u5e2e\u52a9":this.sendNotification(app.mediator.system.HelpMediator.SHOW);break;case "\u6210\u5c31":this.sendNotification(app.mediator.building.AchievementMediator.SHOW);break;case "\u6392\u884c":this.sendNotification(app.mediator.system.RankMediator.SHOW)}},
updateGiftState:function(b){this.giftState&&this.giftState.depose();this.giftState=null;var c;if(0==b)c="hidden";else if(1==b||2==b)c="visible";this.giftIcon.style.visibility=c;if(2==b)this.giftState&&this.giftState.depose(),this.giftState=null,this.giftState=app.view.AnimateCanvas.createIcon(app.GameData.GameResource,"uieff_11",126,28),this.giftState.canvas.width=72,this.giftState.canvas.height=72,this.giftIcon.appendChild(this.giftState.canvas),this.giftState.play()},btnShineSet:function(b){var c=
b.id,e=b.key,f=null,g=0==b.type?this.bigMenuStatus:this.smallMenuStatus;if(null==g[c])g[c]={},g[c].status=0,g[c].key=[];else a:{for(var f=g[c].key,h=0;h<f.length;h++)if(f[h]==e){f=h;break a}f=null}null==f?(g[c].status=1==b.status?g[c].status+1:g[c].status-1,g[c].key.push(e)):0==b.status&&(g[c].status-=1,g[c].key.splice(f,1));if(0>g[c].status)g[c].status=0;0==b.type&&this.menuCtrl(c,this.bigMenuStatus[c].status)},menuCtrl:function(b,c){0==c?this["bigShow"+b]&&(this["bigShow"+b].depose(),this["bigShow"+
b]=null):0<c&&this.bigMenuShow(b)},updateTaskState:function(b){if(0==b){if(this.taskShow)this.taskShow.depose(),this.taskShow=null}else if(1==b)this.taskShow&&this.taskShow.depose(),this.taskShow=null,this.taskShow=app.view.AnimateCanvas.createIcon(app.GameData.GameResource,"uieff_10",39,-5),this.funBtns[1].appendChild(this.taskShow.canvas),this.taskShow.play()},bigMenuShow:function(b){this["bigShow"+b]&&this["bigShow"+b].depose();this["bigShow"+b]=null;var c;c=2>b?this.topMenu.querySelector("#top_btns").querySelectorAll("div")[b]:
this.topMenu.querySelector("#top_btns").querySelectorAll("div")[b-2];this["bigShow"+b]=app.view.AnimateCanvas.createIcon(app.GameData.GameResource,"uieff_05",c.offsetLeft-5,"\u4e3b\u57ce"==this.state?c.offsetTop-12:c.offsetTop+46*b-12);c.appendChild(this["bigShow"+b].canvas);this["bigShow"+b].play()},updateMailState:function(b){this.mailState&&this.mailState.depose();this.mailState=null;if(1==b)this.mailState=app.view.AnimateCanvas.createIcon(app.GameData.GameResource,"uieff_03",67,40),this.mailState.canvas.width=
36,this.mailState.canvas.height=36,this.mailIcon.appendChild(this.mailState.canvas),this.mailState.play()},update:function(){var b=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data,c=this.facade.retrieveProxy(app.proxy.GameInfoProxy.NAME).data,e=this.topMenu.querySelector("#menu_season");e.style["background-position"]="0px "+-37*(c.season-1)+"px";e=e.querySelectorAll("p");e[0].innerHTML=c.year;e[1].innerHTML=["\u6625","\u590f","\u79cb","\u51ac"][c.season-1];c=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.HALL);
this.topMenu.querySelector("#menu_level").innerHTML=c.level;for(var c=this.topMenu.querySelectorAll("#menu_coin>div"),e=["\u7cae","\u5175","\u94f6"],f=[b.grain,b.troop,b.silverCoin],g=0;g<c.length;g++)c[g].innerHTML='<label style="color:white">'+e[g]+":"+f[g]+"</label>";c=this.topMenu.querySelectorAll("#menu_coin2>div");c[0].innerHTML='<label style="color:white">\u6218:'+b.feat+"</label>";c[1].innerHTML='<label style="color:white">\u5a01:'+b.prestige+"</label>";c[2].innerHTML='<label class="fc1">\u91d1:'+
b.goldCoin+"</label>";this.topMenu.querySelector("#jl_icon").querySelector("p").innerHTML=b.warToken+"/"+b.maxWarToken;this.tokenView&&this.tokenView.setData(this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data)},showCityInfo:function(){var b=app.view.system.CityInfoView,c=new b(app.GameData.GameResource.getContent("cityInfo"));c.addEventListener(b.CLOSE,this);var b=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data,e=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.HALL).level,
f=this.facade.retrieveProxy(app.proxy.GameInfoProxy.NAME).data.season;c.update(b,e,f)},showToken:function(){var b=this;if(!0==this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.canBuyWarToken){var c=function(){app.view.Tooltip.getInstance().show("\u519b\u4ee4\u8d2d\u4e70\u6210\u529f\uff01")},e="\u8d2d\u4e70\u519b\u4ee4\u9700\u8981\u82b1\u8d39<span class='fc1'>"+this.facade.retrieveProxy(app.proxy.GameInfoProxy.NAME).data.warTokenCost+"\u91d1\u5e01</span>.";app.view.Alert.getInstance().show(e+
"<br />\u662f\u5426\u786e\u5b9a\u8d2d\u4e70?",["\u786e\u5b9a","\u53d6\u6d88"],function(e){0==e&&b.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).buyWarToken(c)})}else app.view.Tooltip.getInstance().show("\u4eca\u5929\u7684\u8d2d\u4e70\u6b21\u6570\u5df2\u7ecf\u7528\u5b8c\u4e86")},handleEvent:function(b){switch(b.type){case app.view.system.CityInfoView.CLOSE:b.target.depose()}}},{NAME:"MainMenuMediator",SHOW:"MainMenuMediator_Show",CLOSE:"MainMenuMediator_Close",SHOW_TOKEN:"MainMenuMediator_ShowToken",
SHOW_MENU:"MainMenuMediator_ShowMenu",HIDE_MENU:"MainMenuMediator_HideMenu",BTNSHINE:"MainMenuMediator_BtnShine",CHANGE_RIGHT_MENU:"MainMenuMediator_changeRightMenu"});puremvc.define({name:"app.mediator.system.ResControlMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.system.ResControlMediator;return[b.SHOW,b.CLOSE]},handleNotification:function(b){var c=app.mediator.system.ResControlMediator;switch(b.getName()){case c.SHOW:var c=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource,e=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME);this.userData=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;
this.myCity=e.getCityDataByID(this.userData.cityId);e=e.getCityDataByID(this.resProxy.countryId);this.viewComponent?this.viewComponent.setData(b.getBody(),this.userData,this.myCity,e,this.indicateVo):(this.setViewComponent(new app.view.system.ResourceControlView(c)),this.viewComponent.setData(b.getBody(),this.userData,this.myCity,e),this.viewComponent.addEventListener(app.view.system.ResourceControlView.CLOSE,this),this.viewComponent.addEventListener(app.view.system.ResourceControlView.CAPTURE,this),
this.viewComponent.addEventListener(app.view.system.ResourceControlView.GIVE_UP,this),this.viewComponent.addEventListener(app.view.system.ResourceControlView.STEAL,this),this.viewComponent.addEventListener(app.view.system.ResourceControlView.DOUBLE_CONTROL,this),this.viewComponent.addEventListener(app.view.system.ResourceControlView.PATROL_CONTROL,this),this.viewComponent.addEventListener(app.view.system.ResourceControlView.SHOW_PLAYERINFO,this));break;case c.CLOSE:this.viewComponent.removeEventListener(app.view.system.ResourceControlView.CLOSE,
this),this.viewComponent.removeEventListener(app.view.system.ResourceControlView.CAPTURE,this),this.viewComponent.removeEventListener(app.view.system.ResourceControlView.GIVE_UP,this),this.viewComponent.removeEventListener(app.view.system.ResourceControlView.STEAL,this),this.viewComponent.removeEventListener(app.view.system.ResourceControlView.DOUBLE_CONTROL,this),this.viewComponent.removeEventListener(app.view.system.ResourceControlView.PATROL_CONTROL,this),this.viewComponent.removeEventListener(app.view.system.ResourceControlView.SHOW_PLAYERINFO,
this),this.viewComponent.depose(),this.setViewComponent(null)}},onRegister:function(){this.resProxy=this.facade.retrieveProxy(app.proxy.ResProxy.NAME)},onRemove:function(){},handleEvent:function(b){var c=this,e;switch(b.type){case app.view.system.ResourceControlView.CLOSE:this.sendNotification(app.mediator.system.ResControlMediator.CLOSE);break;case app.view.system.ResourceControlView.CAPTURE:e=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_3);
var c=this,f=function(){0<c.userData.warToken?(c.b=c.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).isBuildingShow(11),0>=c.userData.troop&&c.b?app.view.Alert.getInstance().show("\u5175\u529b\u4e0d\u8db3\uff0c\u662f\u5426\u9700\u8981\u7ee7\u7eed\u5f81\u670d\uff1f",["\u7ee7\u7eed\u5f81\u670d","\u8865\u5145\u5175\u529b"],function(e){0==e?c.resProxy.captureHandle(b.data):c.sendNotification(app.mediator.building.DrillGroundMediator.SHOW,2)}):c.resProxy.captureHandle(b.data)):app.view.Alert.show("\u60a8\u7684\u519b\u4ee4\u4e0d\u8db3\uff0c\u786e\u5b9a\u9700\u8981\u8d2d\u4e70\u519b\u4ee4\u5417\uff1f",
["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==b&&c.sendNotification(app.mediator.system.MainMenuMediator.SHOW_TOKEN)})};e&&0<e.time.getTime()?this.sendNotification(app.command.CommandType.CLEAR_TIME_HANDLE,{timer:e,handle:ClassUtils.delegate(this,f)}):f();break;case app.view.system.ResourceControlView.GIVE_UP:this.resProxy.giveupHandle(b.data);break;case app.view.system.ResourceControlView.STEAL:(e=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_10))&&
0<e.time.getTime()?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">\u63a0\u593a\u65f6\u95f4\u51b7\u5374\u4e2d</label>'):this.resProxy.stealHandle(b.data);break;case app.view.system.ResourceControlView.DOUBLE_CONTROL:var g=250*this.myCity.levelmax;app.view.Alert.getInstance().show("\u5929\u9053\u916c\u52e4\u53ef\u83b7\u5f972\u500d\u4ea7\u91cf\uff0c\u4f46\u540c\u65f6\u4e5f\u5141\u8bb8\u88ab\u654c\u56fd\u63a0\u593a\uff0c\u662f\u5426\u82b1\u8d39"+g+"\u94f6\u5e01\u5f00\u542f\u5929\u9053\u916c\u52e4\uff1f",
["\u786e\u5b9a","\u53d6\u6d88"],function(e){0==e&&(c.userData.silverCoin>=g?c.resProxy.doubleHandle(b.data):c.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">'+app.data.CONST.MSG_NOT_ENOUGH_MONEY+"</label>"))});break;case app.view.system.ResourceControlView.PATROL_CONTROL:app.view.Alert.getInstance().show("\u52a0\u5f3a\u5de1\u903b\u540e\uff0c\u88ab\u63a0\u593a\u65f6100%\u6982\u7387\u89e6\u53d1\u6218\u6597\uff0c\u662f\u5426\u82b1\u8d3910\u91d1\u5e01\u52a0\u5f3a\u5de1\u903b\uff1f",
["\u786e\u5b9a","\u53d6\u6d88"],function(e){0==e&&(c.userData.goldCoin>=app.view.system.ResourceControlView.PATROL_CONTROL_GOLD?c.resProxy.patrolHandle(b.data):c.sendNotification(app.command.CommandType.PAY))});break;case app.view.system.ResourceControlView.SHOW_PLAYERINFO:this.sendNotification(app.mediator.system.PlayerInfoMediator.SHOW,b.data)}}},{NAME:"ResControlMediator",SHOW:"ResControl_Show",CLOSE:"ResControl_Close"});puremvc.define({name:"app.mediator.system.AreaControlMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.system.AreaControlMediator;return[b.SHOW,b.CLOSE]},handleNotification:function(b){var c=app.mediator.system.AreaControlMediator;switch(b.getName()){case c.SHOW:this.indicateVo=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_3);c=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;
this.userData=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;var e=this.facade.retrieveProxy(app.proxy.WorldProxy.NAME),f=e.getCityDataByID(this.userData.cityId),e=e.getCityDataByID(this.areaProxy.countryId),g=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.HALL).level;this.viewComponent?this.viewComponent.setData(b.getBody(),this.userData,f,e,this.areaProxy.countryId,g):(this.setViewComponent(new app.view.system.AreaControlView(c)),this.viewComponent.setData(b.getBody(),
this.userData,f,e,this.areaProxy.countryId,g),this.viewComponent.addEventListener(app.view.system.AreaControlView.CLOSE,this),this.viewComponent.addEventListener(app.view.system.AreaControlView.ATTACK,this),this.viewComponent.addEventListener(app.view.system.AreaControlView.CONQUER,this),this.viewComponent.addEventListener(app.view.system.AreaControlView.TRADE,this),this.viewComponent.addEventListener(app.view.system.AreaControlView.MAIL,this),this.viewComponent.addEventListener(app.view.system.AreaControlView.ENTER,
this),this.viewComponent.addEventListener(app.view.system.AreaControlView.SLAYER,this),this.viewComponent.addEventListener(app.view.system.AreaControlView.MODIFY_NOTE,this),this.viewComponent.addEventListener(app.view.system.AreaControlView.MODIFY_TOWNLOGO,this),this.viewComponent.addEventListener(app.view.system.AreaControlView.SHOW_PLAYERINFO,this));break;case c.CLOSE:this.viewComponent.removeEventListener(app.view.system.AreaControlView.CLOSE,this),this.viewComponent.removeEventListener(app.view.system.AreaControlView.ATTACK,
this),this.viewComponent.removeEventListener(app.view.system.AreaControlView.CONQUER,this),this.viewComponent.removeEventListener(app.view.system.AreaControlView.TRADE,this),this.viewComponent.removeEventListener(app.view.system.AreaControlView.MAIL,this),this.viewComponent.removeEventListener(app.view.system.AreaControlView.ENTER,this),this.viewComponent.removeEventListener(app.view.system.AreaControlView.SLAYER,this),this.viewComponent.removeEventListener(app.view.system.AreaControlView.MODIFY_NOTE,
this),this.viewComponent.removeEventListener(app.view.system.AreaControlView.MODIFY_TOWNLOGO,this),this.viewComponent.removeEventListener(app.view.system.AreaControlView.SHOW_PLAYERINFO,this),this.viewComponent.depose(),this.setViewComponent(null)}},onRegister:function(){this.areaProxy=this.facade.retrieveProxy(app.proxy.AreaProxy.NAME)},onRemove:function(){},handleEvent:function(b){var c=this;switch(b.type){case app.view.system.AreaControlView.CLOSE:this.sendNotification(app.mediator.system.AreaControlMediator.CLOSE);
break;case app.view.system.AreaControlView.ATTACK:var e=function(){if(0<c.userData.warToken)if(c.b=c.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).isBuildingShow(11),0>=c.userData.troop&&c.b){var e;app.view.Alert.getInstance().show("\u5175\u529b\u4e0d\u8db3\uff0c\u662f\u5426\u9700\u8981\u7ee7\u7eed\u653b\u6253\uff1f",["\u7ee7\u7eed\u653b\u6253","\u8865\u5145\u5175\u529b"],function(e){0==e?c.areaProxy.attackHandle(b.data):c.sendNotification(app.mediator.building.DrillGroundMediator.SHOW,2)})}else c.areaProxy.attackHandle(b.data);
else app.view.Alert.show("\u60a8\u7684\u519b\u4ee4\u4e0d\u8db3\uff0c\u786e\u5b9a\u9700\u8981\u8d2d\u4e70\u519b\u4ee4\u5417\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==b&&c.sendNotification(app.mediator.system.MainMenuMediator.SHOW_TOKEN)})};this.indicateVo&&0<this.indicateVo.time.getTime()?this.sendNotification(app.command.CommandType.CLEAR_TIME_HANDLE,{timer:this.indicateVo,handle:ClassUtils.delegate(this,e)}):e();break;case app.view.system.AreaControlView.CONQUER:e=function(){0<c.userData.warToken?
(c.b=c.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).isBuildingShow(11),0>=c.userData.troop&&c.b?app.view.Alert.getInstance().show("\u5175\u529b\u4e0d\u8db3\uff0c\u662f\u5426\u9700\u8981\u7ee7\u7eed\u653b\u6253\uff1f",["\u7ee7\u7eed\u653b\u6253","\u8865\u5145\u5175\u529b"],function(e){0==e?c.areaProxy.conquerHandle(b.data):c.sendNotification(app.mediator.building.DrillGroundMediator.SHOW,2)}):c.areaProxy.conquerHandle(b.data)):app.view.Alert.show("\u60a8\u7684\u519b\u4ee4\u4e0d\u8db3\uff0c\u786e\u5b9a\u9700\u8981\u8d2d\u4e70\u519b\u4ee4\u5417\uff1f",
["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==b&&c.sendNotification(app.mediator.system.MainMenuMediator.SHOW_TOKEN)})};this.indicateVo&&0<this.indicateVo.time.getTime()?this.sendNotification(app.command.CommandType.CLEAR_TIME_HANDLE,{timer:this.indicateVo,handle:ClassUtils.delegate(this,e)}):e();break;case app.view.system.AreaControlView.TRADE:this.areaProxy.tradeHandle(b.data);break;case app.view.system.AreaControlView.MAIL:this.sendNotification(app.mediator.system.MailDetailMediator.SHOW_INPUT,
b.data);break;case app.view.system.AreaControlView.ENTER:this.sendNotification(app.mediator.system.AreaControlMediator.CLOSE);this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.HomeMediator);break;case app.view.system.AreaControlView.SLAYER:this.sendNotification(app.mediator.building.HallMediator.SHOW,1);break;case app.view.system.AreaControlView.MODIFY_NOTE:this.sendNotification(app.mediator.system.NoteControlMediator.SHOW,b.data);break;case app.view.system.AreaControlView.MODIFY_TOWNLOGO:this.sendNotification(app.mediator.system.TownLogoControlMediator.SHOW,
b.data);break;case app.view.system.AreaControlView.SHOW_PLAYERINFO:this.sendNotification(app.mediator.system.PlayerInfoMediator.SHOW,b.data)}}},{NAME:"AreaControlMediator",SHOW:"AreaControl_Show",CLOSE:"AreaControl_Close"});puremvc.define({name:"app.mediator.system.TradeControlMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.system.TradeControlMediator;return[b.SHOW,b.CLOSE,b.UPDATE]},handleNotification:function(b){var c=app.mediator.system.TradeControlMediator;switch(b.getName()){case c.SHOW:c=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;this.setViewComponent(new app.view.system.TradeControlView(c));this.viewComponent.setData(b.getBody());this.viewComponent.addEventListener(app.view.system.TradeControlView.CLOSE,
this);this.viewComponent.addEventListener(app.view.system.TradeControlView.SELL,this);break;case c.CLOSE:this.viewComponent.removeEventListener(app.view.system.TradeControlView.CLOSE,this);this.viewComponent.removeEventListener(app.view.system.TradeControlView.SELL,this);this.viewComponent.depose();this.setViewComponent(null);break;case c.UPDATE:this.viewComponent.updateData(b.getBody())}},onRegister:function(){this.areaProxy=this.facade.retrieveProxy(app.proxy.AreaProxy.NAME)},onRemove:function(){},
handleEvent:function(b){switch(b.type){case app.view.system.TradeControlView.CLOSE:this.sendNotification(app.mediator.system.TradeControlMediator.CLOSE);break;case app.view.system.TradeControlView.SELL:this.areaProxy.sellHandle(b.data)}}},{NAME:"TradeControlMediator",SHOW:"TradeControl_Show",CLOSE:"TradeControl_Close",UPDATE:"TradeControl_Update"});puremvc.define({name:"app.mediator.system.NoteControlMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.system.NoteControlMediator;return[b.SHOW,b.CLOSE]},handleNotification:function(b){var c=app.mediator.system.NoteControlMediator;switch(b.getName()){case c.SHOW:c=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;this.setViewComponent(new app.view.system.NoteControlView(c));this.viewComponent.setData(b.getBody());this.viewComponent.addEventListener(app.view.system.NoteControlView.CLOSE,
this);this.viewComponent.addEventListener(app.view.system.NoteControlView.MODIFY,this);break;case c.CLOSE:this.viewComponent.removeEventListener(app.view.system.NoteControlView.CLOSE,this),this.viewComponent.removeEventListener(app.view.system.NoteControlView.MODIFY,this),this.viewComponent.depose(),this.setViewComponent(null)}},onRegister:function(){this.areaProxy=this.facade.retrieveProxy(app.proxy.AreaProxy.NAME)},onRemove:function(){},handleEvent:function(b){switch(b.type){case app.view.system.NoteControlView.CLOSE:this.sendNotification(app.mediator.system.NoteControlMediator.CLOSE);
break;case app.view.system.NoteControlView.MODIFY:this.areaProxy.modifyNoteHandle(b.data)}}},{NAME:"NoteControlMediator",SHOW:"NoteControl_Show",CLOSE:"NoteControl_Close"});puremvc.define({name:"app.mediator.system.TownLogoControlMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.system.TownLogoControlMediator;return[b.SHOW,b.CLOSE]},handleNotification:function(b){var c=app.mediator.system.TownLogoControlMediator;switch(b.getName()){case c.SHOW:c=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;this.setViewComponent(new app.view.system.TownLogoControlView(c));this.viewComponent.setData(b.getBody());this.viewComponent.addEventListener(app.view.system.TownLogoControlView.CLOSE,
this);this.viewComponent.addEventListener(app.view.system.TownLogoControlView.MODIFY,this);break;case c.CLOSE:this.viewComponent.removeEventListener(app.view.system.TownLogoControlView.CLOSE,this),this.viewComponent.removeEventListener(app.view.system.TownLogoControlView.MODIFY,this),this.viewComponent.depose(),this.setViewComponent(null)}},onRegister:function(){this.areaProxy=this.facade.retrieveProxy(app.proxy.AreaProxy.NAME)},onRemove:function(){},handleEvent:function(b){switch(b.type){case app.view.system.TownLogoControlView.CLOSE:this.sendNotification(app.mediator.system.TownLogoControlMediator.CLOSE);
break;case app.view.system.TownLogoControlView.MODIFY:this.areaProxy.modifyTownLogoHandle(b.data)}}},{NAME:"TownLogoControlMediator",SHOW:"TownLogoControl_Show",CLOSE:"TownLogoControl_Close"});puremvc.define({name:"app.mediator.system.NpcEventMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.system.NpcEventMediator;return[b.SHOW,b.CLOSE]},handleNotification:function(b){var c=app.mediator.system.NpcEventMediator;switch(b.getName()){case c.SHOW:c=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;this.setViewComponent(new app.view.system.NpcEventView(c));this.viewComponent.setData(b.getBody());this.viewComponent.addEventListener(app.view.system.NpcEventView.CLOSE,
this);this.viewComponent.removeEventListener(app.view.system.NpcEventView.SELECT,this);break;case c.CLOSE:this.viewComponent.removeEventListener(app.view.system.NpcEventView.CLOSE,this),this.viewComponent.removeEventListener(app.view.system.NpcEventView.SELECT,this),this.viewComponent.depose(),this.setViewComponent(null)}},onRegister:function(){this.npcEventProxy=this.facade.retrieveProxy(app.proxy.NpcEventProxy.NAME)},onRemove:function(){},handleEvent:function(b){switch(b.type){case app.view.system.NpcEventView.SELECT:this.npcEventProxy.npcEventHandle(b.data);
break;case app.view.system.NpcEventView.CLOSE:this.sendNotification(app.mediator.system.NpcEventMediator.CLOSE)}}},{NAME:"NpcEventMediator",SHOW:"NpcEvent_Show",CLOSE:"NpcEvent_Close"});puremvc.define({name:"app.mediator.system.ActiveMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){return[app.mediator.system.ActiveMediator.SHOW]},handleNotification:function(b){var c=app.mediator.system.ActiveMediator;switch(b.getName()){case c.SHOW:c=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource,null==this.viewComponent&&this.setViewComponent(new app.view.system.ActiveView(c)),this.viewComponent.setData(b.getBody()),this.viewComponent.addEventListener(app.view.system.ActiveView.CLOSE,
this)}},onRegister:function(){},handleEvent:function(b){switch(b.type){case app.view.system.ActiveView.CLOSE:this.viewComponent.removeEventListener(app.view.system.ActiveView.CLOSE,this),this.viewComponent.depose(),this.setViewComponent(null)}}},{NAME:"ActiveMediator",SHOW:"Active_Show"});puremvc.define({name:"app.mediator.system.CountryMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){return[app.mediator.system.CountryMediator.SHOW]},handleNotification:function(b){switch(b.getName()){case app.mediator.system.CountryMediator.SHOW:this.show()}},show:function(){var b=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;this.setViewComponent(new app.view.system.CountryView(b.getContent("country")));this.viewComponent.setFlag(b.getContent("pointer"),
b.getContent("pointer_data"));this.viewComponent.addEventListener(app.view.system.CountryView.SELECT,this)},handleEvent:function(b){if(b.type==app.view.system.CountryView.SELECT)if(!0==this.viewComponent.isOK)this.viewComponent.depose(),this.setViewComponent(null),this.sendNotification(app.mediator.system.CountryMediator.SELECT_COUNTRY_COMPLETE);else{!1==this.viewComponent.isRandom&&(this.viewComponent.depose(),this.setViewComponent(null),this.sendNotification(app.mediator.system.CountryMediator.SELECT_COUNTRY_COMPLETE));
var c=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME),e=this;c.selectCountry(b.data,function(){null!=e.viewComponent&&e.viewComponent.showCompleteMsg(c.getData().country)})}}},{NAME:"CountryMediator",SHOW:"CountryMediator_Show",SELECT_COUNTRY_COMPLETE:"select_country_complete"});puremvc.define({name:"app.mediator.system.MailDetailMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.system.MailDetailMediator;return[b.SHOW,b.SHOW_INPUT,b.SEND_COMPLETE]},handleNotification:function(b){var c=app.mediator.system.MailDetailMediator;switch(b.getName()){case c.SHOW:c=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;null==this.viewComponent&&(this.setViewComponent(new app.view.system.MailDetailView(c)),this.viewComponent.addEventListener(app.view.system.MailDetailView.CLOSE,
this),this.viewComponent.addEventListener(app.view.system.MailDetailView.RETURN_MAIL,this),this.viewComponent.addEventListener(app.view.system.MailDetailView.NEXT_MAIL,this),this.viewComponent.addEventListener(app.view.system.MailDetailView.PRE_MAIL,this),this.viewComponent.addEventListener(app.view.system.MailDetailView.PLAY_BATTLE,this),this.viewComponent.addEventListener(app.view.system.MailDetailView.PLAYER_INFO,this));this.viewComponent.setData(b.getBody(),this.mailProxy.mailData.length);break;
case c.SHOW_INPUT:c=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;this.viewComponent&&this.closeMailDetailView();this.setViewComponent(new app.view.system.MailInputView(c));this.viewComponent.setData(b.getBody());this.viewComponent.addEventListener(app.view.system.MailInputView.CLOSE,this);this.viewComponent.addEventListener(app.view.system.MailInputView.SEND_MAIL,this);break;case c.SEND_COMPLETE:this.viewComponent&&this.handleEvent({type:app.view.system.MailInputView.CLOSE}),
app.view.Alert.getInstance().show("\u53d1\u9001\u90ae\u4ef6\u6210\u529f!")}},onRegister:function(){this.mailProxy=this.facade.retrieveProxy(app.proxy.MailProxy.NAME)},closeMailDetailView:function(){this.viewComponent.removeEventListener(app.view.system.MailDetailView.CLOSE,this);this.viewComponent.removeEventListener(app.view.system.MailDetailView.RETURN_MAIL,this);this.viewComponent.removeEventListener(app.view.system.MailDetailView.NEXT_MAIL,this);this.viewComponent.removeEventListener(app.view.system.MailDetailView.PRE_MAIL,
this);this.viewComponent.removeEventListener(app.view.system.MailDetailView.PLAY_BATTLE,this);this.viewComponent.removeEventListener(app.view.system.MailDetailView.PLAYER_INFO,this);this.viewComponent.depose();this.setViewComponent(null)},closeMailInputView:function(){this.viewComponent.removeEventListener(app.view.system.MailInputView.CLOSE,this);this.viewComponent.removeEventListener(app.view.system.MailInputView.SEND_MAIL,this);this.viewComponent.depose();this.setViewComponent(null)},handleEvent:function(b){switch(b.type){case app.view.system.MailDetailView.CLOSE:this.closeMailDetailView();
break;case app.view.system.MailDetailView.READ:this.mailProxy.readMail(b.data);break;case app.view.system.MailDetailView.DEL:this.mailProxy.delMail(b.data);break;case app.view.system.MailDetailView.DEL_ALL:this.mailProxy.delAllMail();break;case app.view.system.MailDetailView.RETURN_MAIL:this.sendNotification(app.mediator.system.MailDetailMediator.SHOW_INPUT,b.data);break;case app.view.system.MailInputView.CLOSE:this.closeMailInputView();break;case app.view.system.MailInputView.SEND_MAIL:this.mailProxy.sendMail(b.data);
break;case app.view.system.MailDetailView.NEXT_MAIL:this.mailProxy.readMail([this.mailProxy.mailData[b.data+1],b.data+1]);break;case app.view.system.MailDetailView.PRE_MAIL:this.mailProxy.readMail([this.mailProxy.mailData[b.data-1],b.data-1]);break;case app.view.system.MailDetailView.PLAY_BATTLE:var c,e;c=b.data[1];b=b.data[0];if(null!=b&&null!=c)this.closeMailInputView(),e=this.facade.retrieveMediator(app.mediator.system.MailMediator.NAME).viewComponent,e.depose(),e=this.facade.retrieveProxy(app.proxy.BattleMapProxy.NAME),
e.isBattleReport=!0,1==c?e.loadData(app.proxy.BattleMapProxy.LOAD_STRATEGY_SHOW,{bid:b}):e.loadData(app.proxy.BattleMapProxy.LOAD_STRATEGY_SHOW,{cid:b});break;case app.view.system.MailDetailView.PLAYER_INFO:this.sendNotification(app.mediator.system.PlayerInfoMediator.SHOW,b.data)}}},{NAME:"MailDetailMediator",SHOW:"MailDetail_Show",SHOW_INPUT:"MailInput_Show",SEND_COMPLETE:"Mail_Send_Complete"});puremvc.define({name:"app.mediator.system.PlayerInfoMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.system.PlayerInfoMediator;return[b.SHOW,b.CLOSE,b.LOAD_COMPLETE]},handleNotification:function(b){var c=app.mediator.system.PlayerInfoMediator;switch(b.getName()){case c.SHOW:this.playerinfoProxy.loadData(b.getBody());break;case c.LOAD_COMPLETE:b=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;this.setViewComponent(new app.view.system.PlayerInfoView(b));
this.viewComponent.setData(this.playerinfoProxy.data);this.viewComponent.addEventListener(app.view.system.PlayerInfoView.CLOSE,this);break;case c.CLOSE:this.viewComponent.removeEventListener(app.view.system.PlayerInfoView.CLOSE,this),this.viewComponent.depose(),this.setViewComponent(null)}},onRegister:function(){this.playerinfoProxy=this.facade.retrieveProxy(app.proxy.PlayerinfoProxy.NAME)},onRemove:function(){},handleEvent:function(b){switch(b.type){case app.view.system.PlayerInfoView.CLOSE:this.sendNotification(app.mediator.system.PlayerInfoMediator.CLOSE)}}},
{NAME:"PlayerInfoMediator",SHOW:"PlayerInfo_Show",LOAD_COMPLETE:"PlayerInfo_LoadComplete",CLOSE:"PlayerInfo_Close"});puremvc.define({name:"app.mediator.system.NewPlayerGuideMediator",parent:puremvc.Mediator},{firstRun:!1,listNotificationInterests:function(){var b=app.mediator.system.NewPlayerGuideMediator;return[b.SHOW,b.CLOSE,b.VISIBLE,app.mediator.system.LoadMediator.ONSIZE]},handleNotification:function(b){var c=app.mediator.system.NewPlayerGuideMediator;switch(b.getName()){case c.SHOW:(b=this.facade.retrieveMediator(app.mediator.system.IndicateMediator.NAME).viewComponent)&&b.close(!0);this.facade.retrieveMediator(app.mediator.system.ChatMediator.NAME).viewComponent&&
this.sendNotification(app.mediator.system.ChatMediator.CLOSE);app.view.Alert.getInstance().close();if(1==this.newPlayerGuideProxy.data.type&&!1==this.firstRun)this.firstRun=!0;2==this.newPlayerGuideProxy.data.type&&1==this.newPlayerGuideProxy.data.battleId&&16>this.newPlayerGuideProxy.data.id&&this.newPlayerGuideProxy.goNextPhase(17,1);if(2==this.newPlayerGuideProxy.data.type){var e=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;50==this.newPlayerGuideProxy.data.battleId?this.sendNotification(app.mediator.scene.WorldMediator.MOVE,
{x:160,y:162}):56==this.newPlayerGuideProxy.data.battleId?2==e.country?this.sendNotification(app.mediator.scene.WorldMediator.MOVE,{x:250,y:0}):3==e.country?this.sendNotification(app.mediator.scene.WorldMediator.MOVE,{x:89,y:364}):4==e.country&&this.sendNotification(app.mediator.scene.WorldMediator.MOVE,{x:480,y:189}):61==this.newPlayerGuideProxy.data.battleId?2==e.country?this.sendNotification(app.mediator.scene.WorldMediator.MOVE,{x:315,y:0}):3==e.country?this.sendNotification(app.mediator.scene.WorldMediator.MOVE,
{x:0,y:111}):4==e.country&&this.sendNotification(app.mediator.scene.WorldMediator.MOVE,{x:358,y:176}):66==this.newPlayerGuideProxy.data.battleId?2==e.country?this.sendNotification(app.mediator.scene.WorldMediator.MOVE,{x:480,y:0}):3==e.country?this.sendNotification(app.mediator.scene.WorldMediator.MOVE,{x:108,y:56}):4==e.country&&this.sendNotification(app.mediator.scene.WorldMediator.MOVE,{x:425,y:244}):71==this.newPlayerGuideProxy.data.battleId&&(2==e.country?this.sendNotification(app.mediator.scene.WorldMediator.MOVE,
{x:245,y:141}):3==e.country?this.sendNotification(app.mediator.scene.WorldMediator.MOVE,{x:94,y:223}):4==e.country&&this.sendNotification(app.mediator.scene.WorldMediator.MOVE,{x:311,y:171}))}if(null==this.viewComponent)b=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource,this.setViewComponent(new app.view.system.NewPlayerGuideView(b)),this.viewComponent.addEventListener(app.view.system.NewPlayerGuideView.NEXT,this),this.viewComponent.addEventListener(app.view.system.NewPlayerGuideView.CLOSE,
this);4==this.newPlayerGuideProxy.data.id||41==this.newPlayerGuideProxy.data.levelUpId?this.sendNotification(app.mediator.scene.HomeMediator.MOVE,{x:268,y:0}):2==this.newPlayerGuideProxy.data.levelUpId||57==this.newPlayerGuideProxy.data.levelUpId?this.sendNotification(app.mediator.scene.HomeMediator.MOVE,{x:0,y:0}):11==this.newPlayerGuideProxy.data.levelUpId||31==this.newPlayerGuideProxy.data.levelUpId||56==this.newPlayerGuideProxy.data.levelUpId?this.sendNotification(app.mediator.scene.HomeMediator.MOVE,
{x:199,y:150}):14==this.newPlayerGuideProxy.data.levelUpId||59==this.newPlayerGuideProxy.data.levelUpId?this.sendNotification(app.mediator.scene.HomeMediator.MOVE,{x:268,y:150}):60==this.newPlayerGuideProxy.data.levelUpId?this.sendNotification(app.mediator.scene.HomeMediator.MOVE,{x:42,y:0}):30==this.newPlayerGuideProxy.data.levelUpId?this.sendNotification(app.mediator.scene.HomeMediator.MOVE,{x:268,y:40}):32==this.newPlayerGuideProxy.data.levelUpId||51==this.newPlayerGuideProxy.data.levelUpId?this.sendNotification(app.mediator.scene.HomeMediator.MOVE,
{x:109,y:83}):46==this.newPlayerGuideProxy.data.levelUpId&&this.sendNotification(app.mediator.scene.HomeMediator.MOVE,{x:0,y:150});b=this.facade.retrieveMediator(app.mediator.scene.HomeMediator.NAME).viewComponent;c=this.facade.retrieveMediator(app.mediator.scene.WorldMediator.NAME).viewComponent;this.viewComponent.setData(this.newPlayerGuideProxy.data,b,c,e);break;case c.CLOSE:this.viewComponent.removeEventListener(app.view.system.NewPlayerGuideView.NEXT,this);this.viewComponent.removeEventListener(app.view.system.NewPlayerGuideView.CLOSE,
this);this.viewComponent.depose();this.setViewComponent(null);break;case c.VISIBLE:this.viewComponent&&this.viewComponent.viewVisble(b.getBody());break;case app.mediator.system.LoadMediator.ONSIZE:this.viewComponent&&this.viewComponent.layout()}},onRegister:function(){this.newPlayerGuideProxy=this.facade.retrieveProxy(app.proxy.NewPlayerGuideProxy.NAME)},onRemove:function(){},handleEvent:function(b){switch(b.type){case app.view.system.NewPlayerGuideView.NEXT:this.newPlayerGuideProxy.nextStep(b.data);
break;case app.view.system.NewPlayerGuideView.CLOSE:this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!1);var c=this;app.view.Alert.getInstance().show("\u662f\u5426\u8981\u8df3\u8fc7\u5168\u90e8\u7684\u65b0\u624b\u5f15\u5bfc\uff1f\u8df3\u8fc7\u540e\u65e0\u6cd5\u518d\u6b21\u67e5\u770b\u3002",["\u786e\u8ba4\u8df3\u8fc7","\u53d6\u6d88"],function(b){0==b?(c.newPlayerGuideProxy.goNextPhase(999,1),c.sendNotification(app.mediator.system.NewPlayerGuideMediator.CLOSE)):c.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,
!0)})}}},{NAME:"NewPlayerGuideMediator",SHOW:"NewPlayerGuide_Show",CLOSE:"NewPlayerGuide_Close",VISIBLE:"NewPlayerGuide_Visible"});puremvc.define({name:"app.mediator.system.RankMediator",parent:puremvc.Mediator},{tabId:0,listNotificationInterests:function(){var b=app.mediator.system.RankMediator;return[b.SHOW,b.LOAD_COMPLETE]},handleNotification:function(b){var c=app.mediator.system.RankMediator;switch(b.getName()){case c.SHOW:b=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;null==this.viewComponent&&(this.setViewComponent(new app.view.system.RankView(b)),this.viewComponent.addEventListener(app.view.system.RankView.CLOSE,
this),this.viewComponent.addEventListener(app.view.system.RankView.SHOW_PLAYERINFO,this));this.rankProxy.loadRankData();break;case c.LOAD_COMPLETE:this.viewComponent.setData(b.getBody()),this.viewComponent.show(0)}},onRegister:function(){this.rankProxy=this.facade.retrieveProxy(app.proxy.RankProxy.NAME)},onClose:function(){this.viewComponent.removeEventListener(app.view.system.RankView.CLOSE,this);this.viewComponent.removeEventListener(app.view.system.RankView.SHOW_PLAYERINFO,this);this.setViewComponent(null)},
handleEvent:function(b){switch(b.type){case app.view.system.RankView.CLOSE:this.onClose();break;case app.view.system.RankView.SHOW_PLAYERINFO:this.sendNotification(app.mediator.system.PlayerInfoMediator.SHOW,b.data)}}},{NAME:"RankMediator",SHOW:"Rank_Show",LOAD_COMPLETE:"Rank_LoadComplete",CLOSE:"Rank_Close"});puremvc.define({name:"app.mediator.system.HelpMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){return[app.mediator.system.HelpMediator.SHOW,app.mediator.system.HelpMediator.CLOSE]},handleNotification:function(b){switch(b.getName()){case app.mediator.system.HelpMediator.SHOW:this.viewComponent||(this.setViewComponent(new app.view.system.HelpView),this.viewComponent.addEventListener(app.view.system.HelpView.CLOSE,this));break;case app.mediator.system.HelpMediator.CLOSE:this.viewComponent.depose(),
this.viewComponent=null}},handleEvent:function(b){switch(b.type){case app.view.system.HelpView.CLOSE:this.viewComponent.depose(),this.viewComponent=null}}},{NAME:"HelpMediator",SHOW:"HelpMediator_Show",CLOSE:"HelpMediator_Close"});puremvc.define({name:"app.mediator.building.LevelUpMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.building.LevelUpMediator;return[b.SHOW,b.CLOSE,app.proxy.LevelUpProxy.COMPLETE]},handleNotification:function(b){var c=app.mediator.building.LevelUpMediator;switch(b.getName()){case c.SHOW:this.showBuildDialog(b.getBody());this.updateBuildInfo();this.testStroes(b.getBody());break;case c.CLOSE:this.closeBuildDialog();break;case app.proxy.LevelUpProxy.COMPLETE:if(null!=
this.dialog&&(this.updateBuildInfo(),this.dialog.showLevelUP()),b.getBody().id==app.data.HomeBuildingData.HALL&&(b=this.facade.retrieveProxy(app.proxy.NewPlayerGuideProxy.NAME),b.data&&999!=b.data.id&&(this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!0),c=this.levelUpProxy.getBuildInfo(app.data.HomeBuildingData.HALL).level,c=app.data.DataBase.getInstance().getGuideByLevel(c))))b.data.levelUpId=c.id,b.data.type=3,b.goNextPhase(b.data.levelUpId,3),this.sendNotification(app.mediator.building.LevelUpMediator.CLOSE,
app.data.HomeBuildingData.HALL),this.sendNotification(app.mediator.system.NewPlayerGuideMediator.SHOW)}},testStroes:function(b){if(10==b&&(b=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME),b=b.getIndicateDataByType(app.proxy.IndicateProxy.TYPE_1),null==b||0>=b.length))b=this.dialog.container.querySelector("#levelup_btns").getElementsByTagName("input"),b[b.length-1].style.visibility="hidden"},showBuildDialog:function(b){this.dialog&&this.dialog.depose();this.selectBuilding=b;this.buildVo=this.levelUpProxy.getBuildInfo(this.selectBuilding);
this.dialog=new app.view.building.CommonBuildDialog(app.GameData.GameResource.getContent("home_dlg"));this.objInfo=this.facade.retrieveProxy(app.proxy.HomeProxy.NAME).getBuildingInfo(b);this.btns=this.getButtons(this.objInfo);this.dialog.setData(this.objInfo);this.dialog.addEventListener(app.view.building.CommonBuildDialog.LEVEL_UP,this);this.dialog.addEventListener(app.view.building.CommonBuildDialog.CLOSE,this);this.dialog.addEventListener(app.view.building.CommonBuildDialog.OPERATE,this);this.dialog.setFlag(app.GameData.GameResource)},
getButtons:function(b){var c=[],c=c.concat(b.buttons);b.id==app.data.HomeBuildingData.HALL?(this.levelUpProxy.isBuildingShow(1)||c.splice(1,1),this.levelUpProxy.isBuildingShow(0)||c.splice(0,1)):b.id==app.data.HomeBuildingData.DRILL_GROUND?this.levelUpProxy.isBuildingShow(11)||c.splice(2,1):b.id==app.data.HomeBuildingData.MARKET?(this.levelUpProxy.isBuildingShow(5)||c.splice(2,1),this.levelUpProxy.isBuildingShow(4)||c.splice(1,1)):b.id==app.data.HomeBuildingData.STRATEGY&&(this.levelUpProxy.isBuildingShow(8)||
c.splice(2,1));return c},closeBuildDialog:function(){if(this.dialog)this.dialog.removeEventListener(app.view.building.CommonBuildDialog.LEVEL_UP,this),this.dialog.removeEventListener(app.view.building.CommonBuildDialog.CLOSE,this),this.dialog.depose(),this.dialog=null},updateBuildInfo:function(){if(this.dialog){if(this.selectBuilding==app.data.HomeBuildingData.HALL||this.selectBuilding==app.data.HomeBuildingData.STRATEGY)this.btns=this.getButtons(this.objInfo);this.dialog.updateBuildInfo(this.buildVo,
this.btns)}},onRegister:function(){this.levelUpProxy=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME)},handleEvent:function(b){switch(b.type){case app.view.building.CommonBuildDialog.LEVEL_UP:this.sendNotification(app.command.CommandType.LEVEL_UP,this.selectBuilding);break;case app.view.building.CommonBuildDialog.CLOSE:this.closeBuildDialog();break;case app.view.building.CommonBuildDialog.OPERATE:switch(this.selectBuilding){case app.data.HomeBuildingData.HALL:this.sendNotification(app.mediator.building.HallMediator.SHOW,
b.data);break;case app.data.HomeBuildingData.STRATEGY:this.sendNotification(app.mediator.building.StrategyCenterMediator.SHOW,b.data);break;case app.data.HomeBuildingData.DRILL_GROUND:this.sendNotification(app.mediator.building.DrillGroundMediator.SHOW,b.data);break;case app.data.HomeBuildingData.MARKET:this.sendNotification(app.mediator.building.StoresMediator.SHOW,b.data)}this.closeBuildDialog()}}},{NAME:"LevelUpMediator",SHOW:"LevelUpMediator_Show",CLOSE:"LevelUpMediator_Close"});puremvc.define({name:"app.mediator.building.BankMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){return[app.mediator.building.BankMediator.SHOW,app.proxy.LevelUpProxy.COMPLETE]},handleNotification:function(b){var c=app.mediator.building.BankMediator;switch(b.getName()){case c.SHOW:this.selectBuilding=b.getBody();b=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;this.setViewComponent(new app.view.building.BankView(b));this.loadBankData();this.viewComponent.addEventListener(app.view.building.BankView.CLOSE,
this);this.viewComponent.addEventListener(app.view.building.BankView.LEVEL_UP,this);this.viewComponent.setFlag(b);break;case app.proxy.LevelUpProxy.COMPLETE:b=b.getBody(),this.viewComponent&&b.id==app.data.HomeBuildingData.COUNTING_HOUSE&&(this.viewComponent.updateInfo(this.buildData),this.viewComponent.showLevelUP())}},loadBankData:function(){var b;this.buildData=this.levelUpProxy.getBuildInfo(app.data.HomeBuildingData.COUNTING_HOUSE);b=this.homeProxy.getBuildingInfo(this.selectBuilding);this.userData=
this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;this.viewComponent.setData(b,this.buildData,this.userData)},updateBuildInfo:function(b){this.viewComponent&&this.viewComponent.updateBuildInfo(b)},onRegister:function(){this.homeProxy=this.facade.retrieveProxy(app.proxy.HomeProxy.NAME);this.levelUpProxy=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME)},onRemove:function(){this.viewComponent.depose();this.setViewComponent(null)},handleEvent:function(b){switch(b.type){case app.view.building.BankView.CLOSE:this.closeBuildDialog();
break;case app.view.building.BankView.LEVEL_UP:b=b.data,this.userData.silverCoin>=b.needMoney?this.sendNotification(app.command.CommandType.LEVEL_UP,b.id):this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,app.data.CONST.MSG_NOT_ENOUGH_MONEY)}},closeBuildDialog:function(){this.viewComponent.removeEventListener(app.view.building.BankView.CLOSE,this);this.viewComponent.removeEventListener(app.view.building.BankView.LEVEL_UP,this);this.viewComponent.depose()}},{NAME:"BankMediator",
SHOW:"Bank_Show",CLOSE:"Bank_Close"});puremvc.define({name:"app.mediator.building.HallMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){return[app.mediator.building.HallMediator.SHOW,app.mediator.building.HallMediator.CLOSE,app.proxy.UserInfoProxy.CHANGED,app.proxy.IndicateProxy.CHANGED,app.proxy.OfficialProxy.CHANGED,app.proxy.LiegemanProxy.CHANGED]},handleNotification:function(b){var c=app.mediator.building.HallMediator,e=this.viewComponent;switch(b.getName()){case c.SHOW:var f=[!1,!1],c=function(c){f[c]=!0;f[0]&&
f[1]&&this.show(b.getBody())};this.facade.retrieveProxy(app.proxy.OfficialProxy.NAME).getOfficialInfo(ClassUtils.delegate(this,c,0));this.facade.retrieveProxy(app.proxy.LiegemanProxy.NAME).getLiegemanInfo(ClassUtils.delegate(this,c,1));break;case c.CLOSE:e.depose();break;case app.proxy.UserInfoProxy.CHANGED:e&&this.updateCommonData();break;case app.proxy.OfficialProxy.CHANGED:null!=e&&this.updateOfficialData();break;case app.proxy.LiegemanProxy.CHANGED:null!=e&&this.updateLiegemanData()}},show:function(b){var c=
this,e=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.HALL).level,f=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME),g=f.isBuildingShow(1),f=f.isBuildingShow(0);this.setViewComponent(new app.view.building.HallContentView(app.GameData.GameResource,e,g,f));this.viewComponent.addEventListener(app.view.building.HallContentView.CLOSE,function(){c.viewComponent=null});e=this.viewComponent;g=app.view.building.HallContentView;this.facade.retrieveProxy(app.proxy.LevyProxy.NAME);
var h=function(b){b instanceof String?c.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,b):c.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_REWARDS,b)},j=this.facade.retrieveProxy(app.proxy.OfficialProxy.NAME);e.addEventListener(g.GET_PAY,function(){j.getPay(h)});var k=function(b){null!=app.GameData.hero&&c.sendNotification(app.command.CommandType.SHOW_NEW_HERO);h(b)};e.addEventListener(g.EXCHANGE_PRESTIGE,function(){var b=c.facade.retrieveProxy(app.proxy.OfficialProxy.NAME).data;
c.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.feat>=b.needFeat?j.exchangePrestige(k):c.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,"\u6218\u529f\u4e0d\u591f\uff01")});var l=this.facade.retrieveProxy(app.proxy.LiegemanProxy.NAME);e.addEventListener(g.KICK_LIEGEMAN,function(b){l.kickLiegeman(b.data)});var m=function(){c.updateLiegemanData()};e.addEventListener(g.REFRESH_LIEGEMAN,function(){l.data=null;l.getLiegemanInfo(ClassUtils.delegate(this,m,2))});this.updateCommonData();
this.updateOfficialData();this.updateLiegemanData();this.viewComponent.show(b)},updateCommonData:function(){this.viewComponent.setData(this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data)},updateOfficialData:function(){var b=this.facade.retrieveProxy(app.proxy.OfficialProxy.NAME).data,c=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.prestige;this.viewComponent.setOfficialData(b,c)},updateLiegemanData:function(){var b=this.facade.retrieveProxy(app.proxy.LiegemanProxy.NAME).data,
c=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.prestige,c=app.data.DataBase.getInstance().getOfficialByPrestige(c);this.viewComponent.setLiegemanData(b,c)},onRemove:function(){this.viewComponent.depose();this.setViewComponent(null)},handleEvent:function(){}},{NAME:"HallMediator",SHOW:"Hall_Show",CLOSE:"Hall_Close"});puremvc.define({name:"app.mediator.building.DrillGroundMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.building.DrillGroundMediator;return[b.SHOW,b.CLOSE,b.START_RECRUIT,app.proxy.HerosProxy.COMPLETE,app.proxy.HerosProxy.CHANGED,app.proxy.HerosProxy.HEROS_LIST_CHANGED,app.proxy.HerosProxy.HERO_INFO_CHANGED,app.proxy.TalksProxy.CHANGED,app.proxy.TalksProxy.COMPLETE,app.proxy.FormationProxy.CHANGED,app.proxy.BarracksProxy.CHANGED,app.proxy.IndicateProxy.CHANGED,
app.proxy.UserInfoProxy.CHANGED]},tabId:0,handleNotification:function(b){var c=app.mediator.building.DrillGroundMediator;switch(b.getName()){case c.SHOW:this.dgBuildVO=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.DRILL_GROUND);this.hallBuildVo=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.HALL);this.talksProxy=this.facade.retrieveProxy(app.proxy.TalksProxy.NAME);this.barracksProxy=this.facade.retrieveProxy(app.proxy.BarracksProxy.NAME);
this.indicateProxy=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME);this.tabId=b.getBody();c=app.GameData.GameResource;this.freeSoldiersTimer=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_12);b=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).isBuildingShow(11);this.setViewComponent(new app.view.building.DrillGroundView(c,b));this.viewComponent.addEventListener(app.view.building.DrillGroundRecruit.RECRUIT_HEROINFO,this);this.viewComponent.addEventListener(app.view.building.DrillGroundRecruit.START_SEEK,
this);this.viewComponent.addEventListener(app.view.building.DrillGroundRecruit.START_TALKS,this);this.viewComponent.addEventListener(app.view.building.DrillGroundTrain.ADD_LOCATION,this);this.viewComponent.addEventListener(app.view.building.DrillGroundTrain.START_TRAIN,this);this.viewComponent.addEventListener(app.view.building.DrillGroundTrain.AUTO_OVER_TRAIN,this);this.viewComponent.addEventListener(app.view.building.DrillGroundView.CLOSE,this);this.viewComponent.addEventListener(app.view.building.BarracksView.GET,
this);this.viewComponent.addEventListener(app.view.building.BarracksView.GETFREE,this);this.viewComponent.addEventListener(app.view.building.BarracksView.SHOWMSG,this);this.formationProxy=this.facade.retrieveProxy(app.proxy.FormationProxy.NAME);this.facade.sendNotification(app.mediator.scene.HomeMediator.STOP_RENDER);this.facade.sendNotification(app.mediator.scene.BattleMapMediator.STOP_RENDER);if(null!=this.herosProxy.data&&0<this.barracksProxy.foodExpense)this.setData();else{var e=[!1,!1],f=this,
c=function(b){e[b]=!0;e[0]&&e[1]&&f.setData()};null==this.herosProxy.data?this.herosProxy.loadData(ClassUtils.delegate(this,c,0)):c(0);b?this.barracksProxy.getBarracksInfo(ClassUtils.delegate(this,c,1)):c(1)}break;case c.CLOSE:this.onRemove();break;case app.proxy.HerosProxy.COMPLETE:null!=this.viewComponent&&this.setData();break;case app.proxy.HerosProxy.CHANGED:null!=this.viewComponent&&this.viewComponent.update();break;case app.proxy.HerosProxy.HEROS_LIST_CHANGED:null!=this.viewComponent&&this.viewComponent.heroListUpdate();
break;case app.proxy.UserInfoProxy.CHANGED:null!=this.viewComponent&&(this.upUserInfo(),this.viewComponent.updateBarrack());break;case app.proxy.HerosProxy.HERO_INFO_CHANGED:null!=this.reBuildView&&null!=b.getBody()&&this.reBuildView.setData(b.getBody(),this.herosProxy.data.needMoney);null!=this.viewComponent&&this.viewComponent.updateInfo();null!=this.trainPop&&this.trainPop.refresh();break;case app.proxy.TalksProxy.CHANGED:null!=this.viewComponent&&this.viewComponent.talksChange(b.getBody());break;
case app.proxy.TalksProxy.COMPLETE:(new app.view.building.DrillGroundTalkPop(this.loader.getContent("dg_talks_pop"))).setData(b.getBody());null!=this.viewComponent&&this.viewComponent.talksChange(b.getBody());break;case app.proxy.FormationProxy.CHANGED:null!=this.viewComponent&&this.viewComponent.formationChange();break;case c.START_RECRUIT:this.handleEvent({type:app.view.building.DrillGroundRecruitPop.START_RECRUIT,data:b.getBody()})}},setData:function(){this.viewComponent.setData(this.herosProxy.data,
this.dgBuildVO.level,this.talksProxy.data,this.formationProxy.data,this.barracksProxy,this.freeSoldiersTimer,this.hallBuildVo);this.upUserInfo();this.viewComponent.show(this.tabId)},upUserInfo:function(){this.viewComponent.showUserInfo(this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data)},onRegister:function(){this.herosProxy=this.facade.retrieveProxy(app.proxy.HerosProxy.NAME)},onRemove:function(){this.facade.sendNotification(app.mediator.scene.HomeMediator.RESUME_RENDER);this.facade.sendNotification(app.mediator.scene.BattleMapMediator.RESUME_RENDER);
this.onClose()},onClose:function(){this.setViewComponent(null);this.indicateProxy=this.talksProxy=this.hallBuildVo=this.dgBuildVO=this.newBirthView=this.reBuildView=null},handleEvent:function(b){var c;if(null==this.loader)this.loader=app.GameData.GameResource;if(null==this.userProxy)this.userProxy=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME);if(null==this.talksProxy)this.talksProxy=this.facade.retrieveProxy(app.proxy.TalksProxy.NAME);var e=this;switch(b.type){case app.view.building.DrillGroundView.CLOSE:this.onRemove();
break;case app.view.building.DrillGroundTrainPop.QUICKEN_TRAIN:c=b.data;this.sendNotification(app.command.CommandType.QUICKEN_COMMAND,c);break;case app.view.building.DrillGroundTrainPop.CLEAR_TRAIN_CD:this.sendNotification(app.command.CommandType.CLEAR_INDICATE_TIME,b.data);break;case app.view.building.DrillGroundTrainPop.OVER_TRAIN:c=b.data;app.view.Alert.getInstance().show("\u786e\u5b9a\u8981\u7ed3\u675f\u5f53\u524d\u6b66\u5c06\u7684\u8bad\u7ec3\u5417\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(b){if(0==
b)e.herosProxy.overTrain(c),e.trainPop.depose(),e.trainPop=null});break;case app.view.building.DrillGroundTrainPop.AUTO_OVER_TRAIN:this.trainPop.depose(),this.trainPop=null;case app.view.building.DrillGroundTrain.AUTO_OVER_TRAIN:c=b.data;this.herosProxy.overTrain(c,!0);break;case app.view.building.DrillGroundTrain.START_TRAIN:c=b.data;this.trainPop=new app.view.building.DrillGroundTrainPop(this.loader.getContent("dg_train_pop"));this.trainPop.setData(c,this.herosProxy.data,this.userProxy.data);this.trainPop.addEventListener(app.view.building.DrillGroundTrainPop.CLOSE,
this);null==c?this.trainPop.addEventListener(app.view.building.DrillGroundTrainPop.START_TRAIN,this):(this.trainPop.addEventListener(app.view.building.DrillGroundTrainPop.AUTO_OVER_TRAIN,this),this.trainPop.addEventListener(app.view.building.DrillGroundTrainPop.OVER_TRAIN,this),this.trainPop.addEventListener(app.view.building.DrillGroundTrainPop.QUICKEN_TRAIN,this),this.trainPop.addEventListener(app.view.building.DrillGroundTrainPop.CLEAR_TRAIN_CD,this),this.trainPop.setInfo(this.dgBuildVO.level,
this.indicateProxy.getIndicateDataByType(app.proxy.IndicateProxy.TYPE_4),this.userProxy.data));break;case app.view.building.DrillGroundTrainPop.CLOSE:this.trainPop.depose();this.trainPop=null;break;case app.view.building.DrillGroundTrainPop.START_TRAIN:c=b.data.hvo;c.level<this.hallBuildVo.level?b.data.gold>this.userProxy.data.goldCoin?this.sendNotification(app.command.CommandType.PAY):this.herosProxy.startTrain(b.data):this.facade.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,
"\u4e3b\u57ce\u7b49\u7ea7\u4e0d\u591f\uff0c\u65e0\u6cd5\u5f00\u59cb\u8bad\u7ec3\u3002");break;case app.view.building.DrillGroundTrain.ADD_LOCATION:if(20<=this.herosProxy.data.trainQueue){this.facade.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,"\u5df2\u8fbe\u5230\u8bad\u7ec3\u4f4d\u6700\u5927\u503c\uff0c\u4e0d\u80fd\u5f00\u542f\u3002");break}if(this.herosProxy.data.trainQueue+1>this.herosProxy.data.trainMax){this.facade.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,
"\u60a8\u7684\u8bad\u7ec3\u4f4d\u5df2\u7ecf\u8fbe\u5230\u6700\u5927\uff0c\u53ef\u901a\u8fc7\u63d0\u9ad8\u60a8\u7684\u4f1a\u5458\u7b49\u7ea7\u6765\u589e\u52a0\u65b0\u7684\u8bad\u7ec3\u4f4d\u3002");break}if(3<this.herosProxy.data.trainQueue+1){var f=50*(this.herosProxy.data.trainQueue-2);app.view.Alert.getInstance().show("\u589e\u52a0\u8bad\u7ec3\u4f4d\u7f6e\uff0c\u5c06\u82b1\u8d39 <span class='fc2'>"+f+"\u91d1\u5e01</span>\u3002<br />\u786e\u5b9a\u9700\u8981\u589e\u52a0\u5417\uff1f",["\u786e\u5b9a",
"\u53d6\u6d88"],function(b){0==b&&(e.userProxy.data.goldCoin>=f?e.herosProxy.addLocation():e.sendNotification(app.command.CommandType.PAY))})}else app.view.Alert.getInstance().show("\u8be5\u8bad\u7ec3\u4f4d\u7f6e\u514d\u8d39\u5f00\u542f\uff0c\u662f\u5426\u786e\u5b9a\u8981\u589e\u52a0\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==b&&e.herosProxy.addLocation()});break;case app.view.building.DrillGroundRecruit.RECRUIT_HEROINFO:c=b.data;this.recruitHero=new app.view.building.DrillGroundRecruitPop(this.loader.getContent("dg_recruit_pop"));
this.recruitHero.addEventListener(app.view.building.DrillGroundRecruitPop.START_RECRUIT,this);this.recruitHero.setData(c);break;case app.view.building.DrillGroundRecruitPop.START_RECRUIT:c=b.data;var b=this.herosProxy.herosMaxCount(this.userProxy.data.prestige),g=this.herosProxy.data.onJobList.length;b>g?this.userProxy.data.silverCoin>=c.conf.recruitMoney?this.herosProxy.recruitHero(c):this.facade.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,"\u60a8\u7684\u94f6\u5e01\u4e0d\u8db3\uff0c\u767b\u7528\u8be5\u6b66\u5c06\u9700\u8981 "+
c.conf.recruitMoney+"\u94f6\u5e01\u3002"):10>g?(g=app.data.DataBase.getInstance().queryOfficialInfoByCount(b+1,1),app.view.Alert.getInstance().show("\u62db\u52df\u7b2c<span class='fc2'>"+(b+1)+"</span>\u6b66\u5c06\u9700\u8981\u5b98\u804c<span class='fc2'>"+g.name+"</span>(\u5a01\u671b<span class='fc2'>"+g.value+"</span>)\u3002")):app.view.Tooltip.getInstance().show("\u60a8\u7684\u6b66\u5c06\u6570\u91cf\u5df2\u8fbe\u5230"+g+"\u4f4d\uff0c\u4e0d\u80fd\u518d\u767b\u7528\u4e86\u3002");break;case app.view.building.DrillGroundRecruit.START_SEEK:this.userProxy.data.goldCoin>=
this.talksProxy.data.goldCoin?this.talksProxy.seekOther():this.sendNotification(app.command.CommandType.PAY);break;case app.view.building.DrillGroundRecruit.START_TALKS:0<this.talksProxy.data.count?this.talksProxy.startTalks():this.facade.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,"\u4eca\u65e5\u76846\u6b21\u4f1a\u8c08\u6b21\u6570\u5df2\u7528\u5b8c\uff0c\u8bf7\u660e\u65e5\u518d\u6765\u3002");break;case app.view.building.BarracksView.GET:this.barracksProxy.getSoldiers(b.data.n);
break;case app.view.building.BarracksView.GETFREE:this.barracksProxy.getFreeSoldiers();break;case app.view.building.BarracksView.SHOWMSG:this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,b.data)}}},{NAME:"DrillGroundMediator",SHOW:"DrillGround_Show",CLOSE:"DrillGround_Close",START_RECRUIT:"DrillGround_Start_recruit"});puremvc.define({name:"app.mediator.building.FarmLandMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.building.FarmLandMediator;return[b.SHOW,b.CLOSE,app.proxy.LevelUpProxy.COMPLETE,app.proxy.FarmProxy.COMPLETE,app.proxy.FarmProxy.ShCOMPLETE]},handleNotification:function(b){switch(b.getName()){case app.mediator.building.FarmLandMediator.SHOW:this.selectBuilding=b.getBody();null!=this.facade.retrieveProxy(app.proxy.FarmProxy.NAME).data?this.showPanel():this.facade.retrieveProxy(app.proxy.FarmProxy.NAME).getPreGrainInfo();
break;case app.mediator.building.FarmLandMediator.CLOSE:this.dialog.depose();this.dialog=null;this.closeBuildDialog();break;case app.proxy.LevelUpProxy.COMPLETE:b.getBody().id==this.selectBuilding&&(this.updateBuildInfo(),this.dialog.showLevelUP());break;case app.proxy.FarmProxy.COMPLETE:this.preGrain=this.facade.retrieveProxy(app.proxy.FarmProxy.NAME).data.nextNumber;this.showPanel();break;case app.proxy.FarmProxy.ShCOMPLETE:b="\u672c\u6b21\u6536\u83b7\u83b7\u5f97"+this.preGrain+"\u7cae\u98df",this.preGrain=
this.facade.retrieveProxy(app.proxy.FarmProxy.NAME).data.nextNumber,this.updateGrainInfo(),app.view.Tooltip.getInstance().show(b)}},showBuildDialog:function(b){this.dialog&&this.dialog.depose();this.selectBuilding=b;var c=app.GameData.GameResource,e=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_9);this.dialog=new app.view.building.FarmView(c.getContent("farm"),e);b=this.facade.retrieveProxy(app.proxy.HomeProxy.NAME).getBuildingInfo(b);e=
[];e.push(this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).isBuildingShow(14));e.push(this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).isBuildingShow(15));e.push(this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).isBuildingShow(16));this.dialog.setData(b,e);this.dialog.addEventListener(app.view.building.FarmView.LEVEL_UP,this);this.dialog.addEventListener(app.view.building.FarmView.CLOSE,this);this.dialog.addEventListener(app.view.building.FarmView.OPERATE,this);this.dialog.setFlag(c)},
closeBuildDialog:function(){if(this.dialog)this.dialog.removeEventListener(app.view.building.FarmView.LEVEL_UP,this),this.dialog.removeEventListener(app.view.building.FarmView.CLOSE,this),this.dialog.removeEventListener(app.view.building.FarmView.OPERATE,this),this.dialog.depose(),this.dialog=null},updateBuildInfo:function(){this.dialog.updateFarmInfo(this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(this.selectBuilding))},updateGrainInfo:function(){this.dialog.updateGrainInfo(this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_9))},
showPanel:function(){this.showBuildDialog(this.selectBuilding);this.updateBuildInfo();this.updateGrainInfo()},handleEvent:function(b){switch(b.type){case app.view.building.FarmView.LEVEL_UP:this.sendNotification(app.command.CommandType.LEVEL_UP,this.selectBuilding);break;case app.view.building.FarmView.CLOSE:this.closeBuildDialog();break;case app.view.building.FarmView.OPERATE:if(1==b.data){var b=this.facade.retrieveProxy(app.proxy.FarmProxy.NAME).data.nextNumber,c=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(9),
e=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;if(0==c.num){app.view.Tooltip.getInstance().show("\u6536\u83b7\u6b21\u6570\u5df2\u7528\u5b8c\uff01");break}0!=c.time.getTime()?app.view.Tooltip.getInstance().show("\u6536\u83b7\u51b7\u5374\u4e2d\uff01"):b+e.grain>e.maxGrain?app.view.Tooltip.getInstance().show("\u8d85\u51fa\u5f53\u524d\u7cae\u4ed3\u4e0a\u9650\uff01"):this.facade.retrieveProxy(app.proxy.FarmProxy.NAME).getShInfo()}else this.closeBuildDialog(),this.sendNotification(app.mediator.building.HubuMediator.SHOW,
0==b.data?0:1)}}},{NAME:"FarmLandMediator",SHOW:"FarmLand_Show",CLOSE:"FarmLand_Close"});puremvc.define({name:"app.mediator.building.FolkHouseMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.building.FolkHouseMediator;return[b.SHOW,b.CLOSE,b.SHOW_PATROL,app.proxy.FolkHouseProxy.PATROL_UPDATE,app.proxy.FolkHouseProxy.PATROL_REFRESH,app.proxy.UserInfoProxy.CHANGED,app.proxy.LevelUpProxy.COMPLETE]},tabId:0,handleNotification:function(b){var c=app.mediator.building.FolkHouseMediator;switch(b.getName()){case c.SHOW:this.selectBuilding=b.getBody();
b=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;this.setViewComponent(new app.view.building.FolkHouseView(b));this.loadFolkHouseData();this.viewComponent.addEventListener(app.view.building.FolkHouseView.CLOSE,this);this.viewComponent.addEventListener(app.view.building.FolkHouseView.LEVEL_UP,this);this.viewComponent.addEventListener(app.view.building.FolkHouseView.SHOW_PATROL,this);this.viewComponent.setFlag(b);break;case c.CLOSE:this.closeBuildDialog();break;case c.SHOW_PATROL:this.viewComponent&&
this.closeBuildDialog();b=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;this.setViewComponent(new app.view.building.PatrolView(b));this.viewComponent.addEventListener(app.view.building.PatrolView.CLOSE,this);this.viewComponent.addEventListener(app.view.building.PatrolView.PATROL,this);this.viewComponent.addEventListener(app.view.building.PatrolView.REFRESH,this);null!=this.folkHouseProxy.patrolData?(this.viewComponent.setData(this.folkHouseProxy.patrolData),this.viewComponent.show(this.tabId),
this.upUserInfo(),this.sendNotification(app.mediator.scene.HomeMediator.STOP_RENDER)):this.folkHouseProxy.loadPatrolData();break;case app.proxy.FolkHouseProxy.PATROL_UPDATE:this.viewComponent.setData(b.getBody()[0]);this.viewComponent.show(this.tabId);this.viewComponent.refreshUI(b.getBody()[1]);this.upUserInfo();break;case app.proxy.FolkHouseProxy.PATROL_REFRESH:this.viewComponent.setData(b.getBody()[0]);this.viewComponent.refreshUI(b.getBody()[1]);break;case app.proxy.UserInfoProxy.CHANGED:null!=
this.viewComponent&&this.upUserInfo();break;case app.proxy.LevelUpProxy.COMPLETE:b=b.getBody(),b.id==app.data.HomeBuildingData.FOLK_HOUSE&&(this.updateBuildInfo(b),this.viewComponent.showLevelUP(b.id))}},updateBuildInfo:function(b){this.viewComponent&&this.viewComponent.updateInfo(b)},loadFolkHouseData:function(){var b,c;c=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME);b=c.getBuildInfo(app.data.HomeBuildingData.FOLK_HOUSE);this.hallLev=c.getBuildInfo(app.data.HomeBuildingData.HALL).level;
this.userData=this.userInfoProxy.data;c=this.homeProxy.getBuildingInfo(this.selectBuilding);this.viewComponent.setData(b,this.hallLev,this.userData,c)},onRegister:function(){this.folkHouseProxy=this.facade.retrieveProxy(app.proxy.FolkHouseProxy.NAME);this.homeProxy=this.facade.retrieveProxy(app.proxy.HomeProxy.NAME);this.userInfoProxy=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME)},onRemove:function(){this.viewComponent.depose();this.setViewComponent(null)},handleEvent:function(b){switch(b.type){case app.view.building.FolkHouseView.CLOSE:this.closeBuildDialog();
break;case app.view.building.FolkHouseView.LEVEL_UP:var c=b.data;c.level<this.hallLev?this.userData.silverCoin>=c.needMoney?this.sendNotification(app.command.CommandType.LEVEL_UP,c.id):this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,app.data.CONST.MSG_NOT_ENOUGH_MONEY):this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,"\u6c11\u5c45\u7684\u7b49\u7ea7\u65e0\u6cd5\u8d85\u8fc7\u4e3b\u57ce\u7b49\u7ea7\uff0c\u8bf7\u5148\u5347\u7ea7\u4e3b\u57ce");break;case app.view.building.FolkHouseView.SHOW_PATROL:this.sendNotification(app.mediator.building.FolkHouseMediator.SHOW_PATROL);
break;case app.view.building.PatrolView.REFRESH:if(!1==this.viewComponent.refreshStatus){var e=this;this.userData.silverCoin>=app.view.building.PatrolView.REFRESH_MONEY?app.view.Alert.getInstance().show("\u5237\u65b0\u9700\u8981\u82b1\u8d395000\u94f6\u5e01\u3002\u662f\u5426\u786e\u5b9a\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(c){0==c&&(5E3<=e.userData.silverCoin?e.folkHouseProxy.patrolRefresh(b.data):e.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,app.data.CONST.MSG_NOT_ENOUGH_MONEY))}):
this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,app.data.CONST.MSG_NOT_ENOUGH_MONEY)}else this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,"\u5237\u65b0\u4e2d\uff0c\u8bf7\u7a0d\u7b49");break;case app.view.building.PatrolView.PATROL:0<this.folkHouseProxy.patrolData.count?this.folkHouseProxy.patrolGo():this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">\u5de1\u67e5\u6b21\u6570\u5df2\u7528\u5b8c\uff0c\u8bf7\u7b49\u5f85\u5237\u65b0</label>');
break;case app.view.building.PatrolView.CLOSE:this.closePatrolDialog()}},closeBuildDialog:function(){this.viewComponent.removeEventListener(app.view.building.FolkHouseView.SHOW_PATROL,this);this.viewComponent.removeEventListener(app.view.building.FolkHouseView.CLOSE,this);this.viewComponent.removeEventListener(app.view.building.FolkHouseView.LEVEL_UP,this);this.viewComponent.depose()},closePatrolDialog:function(){this.viewComponent.removeEventListener(app.view.building.PatrolView.CLOSE,this);this.viewComponent.removeEventListener(app.view.building.PatrolView.PATROL,
this);this.viewComponent.removeEventListener(app.view.building.PatrolView.REFRESH,this);this.sendNotification(app.mediator.scene.HomeMediator.RESUME_RENDER)},upUserInfo:function(){this.viewComponent.showUserInfo&&this.viewComponent.showUserInfo(this.userData)}},{NAME:"FolkHouseMediator",SHOW:"FolkHouse_Show",CLOSE:"FolkHouse_Close",SHOW_PATROL:"Show_Patrol"});puremvc.define({name:"app.mediator.building.StoreRoomMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.building.StoreRoomMediator;return[b.SHOW,b.SHOW_MARKET,app.proxy.LevelUpProxy.COMPLETE]},handleNotification:function(b){var c=app.mediator.building.StoreRoomMediator;switch(b.getName()){case c.SHOW:this.selectBuilding=b.getBody();this.loader=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;this.setViewComponent(new app.view.building.StoreRoomView(this.loader));
this.loadStoreRoomData();this.viewComponent.addEventListener(app.view.building.StoreRoomView.CLOSE,this);this.viewComponent.addEventListener(app.view.building.StoreRoomView.LEVEL_UP,this);this.viewComponent.addEventListener(app.view.building.StoreRoomView.SHOW_MARKET,this);this.viewComponent.setFlag(this.loader);break;case app.proxy.LevelUpProxy.COMPLETE:b=b.getBody();this.viewComponent&&b.id==app.data.HomeBuildingData.TREASURY&&(this.viewComponent.updateInfo(this.buildData),this.viewComponent.showLevelUP());
break;case c.SHOW_MARKET:this.viewComponent&&this.closeBuildDialog();this.tabId=b.getBody();this.marketView=new app.view.building.MarketContentView(this.loader);this.marketView.addEventListener(app.view.building.MarketContentView.Trade,this);this.marketView.addEventListener(app.view.building.MarketContentView.CLOSE,this);null!=this.marketProxy.data&&null!=this.marketProxy.data.rate&&null!=this.marketProxy.data.maxTrade?(this.marketView.show(this.tabId),this.updatePanel()):this.facade.retrieveProxy(app.proxy.MarketProxy.NAME).getMarketInfo();
break;case app.proxy.MarketProxy.COMPLETE:this.marketView.show(this.tabId);this.updatePanel();break;case app.proxy.MarketProxy.CHANGED:null!=this.marketView&&this.updatePanel()}},loadStoreRoomData:function(){var b;this.buildData=this.levelUpProxy.getBuildInfo(app.data.HomeBuildingData.TREASURY);b=this.homeProxy.getBuildingInfo(this.selectBuilding);this.userData=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;this.viewComponent.setData(b,this.buildData,this.userData)},updateBuildInfo:function(b){this.viewComponent&&
this.viewComponent.updateBuildInfo(b)},updatePanel:function(){this.marketView.setData(this.marketProxy.data,this.levelUpProxy.getBuildInfo(app.data.HomeBuildingData.TREASURY).level,this.userInfoProxy.data);this.marketView.updateView();this.upUserInfo()},upUserInfo:function(){this.marketView.showUserInfo(this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data)},onRegister:function(){this.homeProxy=this.facade.retrieveProxy(app.proxy.HomeProxy.NAME);this.levelUpProxy=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME);
this.marketProxy=this.facade.retrieveProxy(app.proxy.MarketProxy.NAME);this.userInfoProxy=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME)},onRemove:function(){this.viewComponent.depose();this.setViewComponent(null)},handleEvent:function(b){switch(b.type){case app.view.building.StoreRoomView.CLOSE:this.closeBuildDialog();break;case app.view.building.StoreRoomView.LEVEL_UP:b=b.data;this.userData.silverCoin>=b.needMoney?this.sendNotification(app.command.CommandType.LEVEL_UP,b.id):this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,
app.data.CONST.MSG_NOT_ENOUGH_MONEY);break;case app.view.building.StoreRoomView.SHOW_MARKET:this.sendNotification(app.mediator.building.StoreRoomMediator.SHOW_MARKET,b.data);break;case app.view.building.MarketContentView.Trade:if(0==b.data.foodCount)break;var c,e=this.facade.retrieveProxy(app.proxy.MarketProxy.NAME).data,f=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.silverCoin;0==b.data.tradeType&&(c=Math.round(e.rate/100*b.data.foodCount),0<=f-c?this.facade.retrieveProxy(app.proxy.MarketProxy.NAME).getMarketInfo(b.data):
app.view.Tooltip.getInstance().show(app.data.CONST.MSG_NOT_ENOUGH_MONEY));1==b.data.tradeType&&(0>this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.grain-b.data.foodCount?app.view.Tooltip.getInstance().show("\u7cae\u98df\u4e0d\u8db3\uff01"):this.facade.retrieveProxy(app.proxy.MarketProxy.NAME).getMarketInfo(b.data));2==b.data.tradeType&&(c=Math.round(2*e.rate*b.data.foodCount/100),0<=f-c?this.facade.retrieveProxy(app.proxy.MarketProxy.NAME).getMarketInfo(b.data):app.view.Tooltip.getInstance().show(app.data.CONST.MSG_NOT_ENOUGH_MONEY));
break;case app.view.building.MarketContentView.CLOSE:this.marketView=null}},closeBuildDialog:function(){this.viewComponent.removeEventListener(app.view.building.StoreRoomView.CLOSE,this);this.viewComponent.removeEventListener(app.view.building.StoreRoomView.LEVEL_UP,this);this.viewComponent.removeEventListener(app.view.building.StoreRoomView.SHOW_MARKET,this);this.viewComponent.depose()}},{NAME:"StoreRoomMediator",SHOW:"StoreRoom_Show",CLOSE:"StoreRoom_Close",SHOW_MARKET:"StoreRoom_ShowMarket"});puremvc.define({name:"app.mediator.building.StoresMediator",parent:puremvc.Mediator},{shopProxy:null,appointTimer:null,listNotificationInterests:function(){return[app.mediator.building.StoresMediator.SHOW,app.mediator.building.StoresMediator.CLOSE,app.proxy.AppointProxy.CHANGE,app.proxy.ShopProxy.SHOWMSG,app.proxy.ShopProxy.CHANGED,app.proxy.BagProxy.ITEM_CHANGED,app.proxy.UserInfoProxy.CHANGED,app.proxy.MarketProxy.CHANGED,app.proxy.BagProxy.ITEM_SELL]},handleNotification:function(b){switch(b.getName()){case app.mediator.building.StoresMediator.SHOW:this.sendNotification(app.mediator.scene.HomeMediator.STOP_RENDER);
this.shopProxy=this.facade.retrieveProxy(app.proxy.ShopProxy.NAME);this.bagProxy=this.facade.retrieveProxy(app.proxy.BagProxy.NAME);this.appointProxy=this.facade.retrieveProxy(app.proxy.AppointProxy.NAME);this.marketProxy=this.facade.retrieveProxy(app.proxy.MarketProxy.NAME);this.loader=app.GameData.GameResource;this.userInfo=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;this.indicateProxy=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME);this.appointTimer=this.indicateProxy.getIndicateDataByType(app.proxy.IndicateProxy.TYPE_1);
this.tabId=b.getBody();var b=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).isBuildingShow(4),c=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).isBuildingShow(5);this.setViewComponent(new app.view.building.StoreFrameView(this.loader,b,c));this.viewComponent.addEventListener(app.view.building.ShopView.BUY_EQUIP,this);this.viewComponent.addEventListener(app.view.building.AppointView.SELL_EQUIP,this);this.viewComponent.addEventListener(app.view.building.AppointView.APPOINT,this);this.viewComponent.addEventListener(app.view.building.AppointView.SHOW_APPOINTACC,
this);this.viewComponent.addEventListener(app.view.building.AppointView.CLEAR_APPOINTTIMER,this);this.viewComponent.addEventListener(app.view.building.StoreFrameView.CLOSE,this);this.viewComponent.addEventListener(app.view.building.MarketContentView.HEISHI,this);this.viewComponent.addEventListener(app.view.building.MarketContentView.Trade,this);var e=null!=this.marketProxy.data&&null!=this.marketProxy.data.rate&&null!=this.marketProxy.data.maxTrade?!0:!1;if(this.shopProxy.shopList&&(!c||this.appointProxy.weapon)&&
e)this.sendData(),this.viewComponent.show(this.tabId);else{var f=[!1,!1,!1],e=function(b){f[b]=!0;f[0]&&f[1]&&f[2]&&(this.sendData(),this.viewComponent.show(this.tabId))};this.shopProxy.getShopInfo(ClassUtils.delegate(this,e,0));c?this.appointProxy.getAppointInfo(ClassUtils.delegate(this,e,1)):e(1);b?this.marketProxy.getMarketInfo(ClassUtils.delegate(this,e,2)):e(2)}break;case app.proxy.BagProxy.ITEM_CHANGED:if(void 0==this.viewComponent)break;this.viewComponent.updateBagData(null!=b.getBody()?this.bagProxy.getItemData(b.getBody().list[0].id):
null);break;case app.proxy.UserInfoProxy.CHANGED:this.viewComponent&&this.viewComponent.showUserInfo(this.userInfo);break;case app.proxy.AppointProxy.CHANGE:this.appointAccView?this.appointAccView.setData(this.appointProxy.acc):this.viewComponent&&this.viewComponent.updateAppointData(this.appointProxy);break;case app.proxy.MarketProxy.CHANGED:this.viewComponent&&this.viewComponent.refreshMarket();break;case app.proxy.ShopProxy.SHOWMSG:this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,
b.getBody());break;case app.mediator.building.StoresMediator.CLOSE:this.viewComponent&&this.viewComponent.depose()}},handleEvent:function(b){switch(b.type){case app.view.building.ShopView.BUY_EQUIP:this.sendNotification(app.command.CommandType.SHOP,b.data.conId);break;case app.view.building.AppointView.SELL_EQUIP:this.sendNotification(app.command.CommandType.ITEM_SELL,b.data.id);break;case app.view.building.AppointView.APPOINT:var c=this,e=function(){c.appointProxy.appointGet(b.data)};this.userInfo.silverCoin<
b.data.money?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">'+app.data.CONST.MSG_NOT_ENOUGH_MONEY+"</label>"):this.appointTimer.full?this.sendNotification(app.command.CommandType.CLEAR_TIME_HANDLE,{timer:this.appointTimer,handle:ClassUtils.delegate(this,e)}):e();break;case app.view.building.AppointView.SHOW_APPOINTACC:e=this.loader.getContent("appointAcc");this.appointAccView=new app.view.building.AppointAccView(e);this.appointAccView.setData(this.appointProxy.acc);
this.appointAccView.addEventListener(app.view.building.AppointAccView.GET,this);this.appointAccView.addEventListener(app.view.building.AppointAccView.CLOSE,this);break;case app.view.building.AppointView.CLEAR_APPOINTTIMER:this.sendNotification(app.command.CommandType.CLEAR_INDICATE_TIME,this.appointTimer);break;case app.view.building.AppointAccView.GET:this.appointProxy.appointAccGet(b.data.conId);break;case app.view.building.AppointAccView.CLOSE:this.appointAccView.depose();this.appointAccView=null;
break;case app.view.building.MarketContentView.Trade:if(0==b.data.foodCount)break;var f=this.facade.retrieveProxy(app.proxy.MarketProxy.NAME).data,g=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.silverCoin,h=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.maxSilverCoin;0==b.data.tradeType&&(e=Math.round(f.rate/100*b.data.foodCount),0<=g-e?this.facade.retrieveProxy(app.proxy.MarketProxy.NAME).getTradeInfo(b.data):app.view.Tooltip.getInstance().show(app.data.CONST.MSG_NOT_ENOUGH_MONEY));
1==b.data.tradeType&&(e=Math.round(f.rate*b.data.foodCount/100),0>this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.grain-b.data.foodCount?app.view.Tooltip.getInstance().show("\u7cae\u98df\u4e0d\u8db3\uff01"):e+g>h?app.view.Tooltip.getInstance().show("\u8d85\u51fa\u94f6\u5e01\u4e0a\u9650\uff01"):this.facade.retrieveProxy(app.proxy.MarketProxy.NAME).getTradeInfo(b.data));2==b.data.tradeType&&(e=Math.round(2*f.rate*b.data.foodCount/100),0<=g-e?this.facade.retrieveProxy(app.proxy.MarketProxy.NAME).getTradeInfo(b.data):
app.view.Tooltip.getInstance().show(app.data.CONST.MSG_NOT_ENOUGH_MONEY));break;case app.view.building.StoreFrameView.CLOSE:this.sendNotification(app.mediator.scene.HomeMediator.RESUME_RENDER),this.viewComponent=null}},sendData:function(){var b=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.MARKET);null!=b&&(this.viewComponent.setData(b.level,this.shopProxy.shopList,this.appointProxy,this.appointTimer,this.marketProxy.data,this.userInfo),this.viewComponent.showUserInfo(this.userInfo))}},
{NAME:"StoresMediator",SHOW:"Stores_Show",CLOSE:"Stores_Close"});puremvc.define({name:"app.mediator.building.StrategyCenterMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){return[app.mediator.building.StrategyCenterMediator.SHOW,app.proxy.StrategyProxy.COMPLETE,app.proxy.StrategyProxy.LEVEL_UP,app.proxy.UserInfoProxy.CHANGED]},tabId:0,handleNotification:function(b){switch(b.getName()){case app.mediator.building.StrategyCenterMediator.SHOW:this.tabId=b.getBody();this.dgLv=this.levelUpProxy.getBuildInfo(app.data.HomeBuildingData.STRATEGY).level;
this.setViewComponent(new app.view.building.StrategyView(app.GameData.GameResource,this.levelUpProxy.isBuildingShow(8)));this.viewComponent.addEventListener(app.view.building.StrategyView.CLOSE,this);this.viewComponent.addEventListener(app.view.building.StrategyView.LEVEL_UP,this);this.viewComponent.addEventListener(app.view.building.StrategyView.CLEAR_CD,this);this.indicate=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_5);this.userData=
this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;null!=this.strategyProxy.data?(this.strategyProxy.data.cdTime=this.indicate,this.viewComponent.setData(this.strategyProxy.data,this.dgLv,this.tabId),this.viewComponent.show(this.tabId),this.upUserInfo(),this.sendNotification(app.mediator.scene.HomeMediator.STOP_RENDER)):this.strategyProxy.loadData();break;case app.proxy.StrategyProxy.COMPLETE:this.viewComponent.setData(b.getBody(),this.dgLv,this.tabId);this.viewComponent.show(this.tabId);
this.sendNotification(app.mediator.scene.HomeMediator.STOP_RENDER);this.upUserInfo();break;case app.proxy.StrategyProxy.LEVEL_UP:this.viewComponent.strategyData=this.strategyProxy.data;this.viewComponent.updateStraInfo();break;case app.proxy.UserInfoProxy.CHANGED:null!=this.viewComponent&&this.upUserInfo()}},upUserInfo:function(){this.viewComponent.showUserInfo(this.userData)},onRegister:function(){this.strategyProxy=this.facade.retrieveProxy(app.proxy.StrategyProxy.NAME);this.levelUpProxy=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME)},
onRemove:function(){this.viewComponent.depose();this.setViewComponent(null)},handleEvent:function(b){var c;switch(b.type){case app.view.building.StrategyView.LEVEL_UP:c=b.data;var e=this,b=function(){e.strategyProxy.levelUp(c)};this.indicate=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_5);this.viewComponent.reqContribution>this.userData.feat?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">\u60a8\u7684\u6218\u529f\u4e0d\u8db3\uff0c\u65e0\u6cd5\u8fdb\u884c\u7814\u7a76</label>'):
this.viewComponent.buildLv<this.viewComponent.reqLevel?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">\u7b56\u7565\u5e9c\u7b49\u7ea7\u4e0d\u8db3\uff0c\u65e0\u6cd5\u8fdb\u884c\u7814\u7a76</label>'):this.indicate&&!0==this.indicate.full?this.sendNotification(app.command.CommandType.CLEAR_TIME_HANDLE,{timer:this.indicate,handle:ClassUtils.delegate(this,b)}):b();break;case app.view.building.StrategyView.CLEAR_CD:b=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_5);
this.sendNotification(app.command.CommandType.CLEAR_INDICATE_TIME,b);break;case app.view.building.StrategyView.CLOSE:this.sendNotification(app.mediator.scene.HomeMediator.RESUME_RENDER),this.viewComponent.removeEventListener(app.view.building.StrategyView.CLOSE,this),this.viewComponent.removeEventListener(app.view.building.StrategyView.LEVEL_UP,this),this.viewComponent.removeEventListener(app.view.building.StrategyView.CLEAR_CD,this),this.setViewComponent(null)}}},{NAME:"StrategyCenterMediator",SHOW:"StrategyCenter_Show",
CLOSE:"StrategyCenter_Close"});puremvc.define({name:"app.mediator.building.TaskMediator",parent:puremvc.Mediator},{taskMainProxy:null,taskDayProxy:null,gameInfoProxy:null,lotteryReward:[],lotteryNo:null,listNotificationInterests:function(){return[app.mediator.building.TaskMediator.SHOW,app.mediator.building.TaskMediator.CLOSE,app.proxy.TaskMainProxy.TASKMAIN_CHANGED,app.proxy.TaskMainProxy.SHOWMSG,app.proxy.TaskDayProxy.TASKDAY_CHANGED,app.proxy.TaskDayProxy.TASKDAY_LOTTERYRESULT,app.proxy.SignInProxy.GET_ACTIVE_REWARD_COMPLETE,
app.proxy.CampaignProxy.GET_CAMPAIGN_REWARD_COMPLETE,app.proxy.CampaignProxy.LOAD_COMPLETE,app.proxy.SignInProxy.SIGN_IN,app.view.building.TaskFrameView.LOADSIGNDATA,app.proxy.SignInProxy.LOAD_COMPLETE]},handleNotification:function(b){switch(b.getName()){case app.mediator.building.TaskMediator.SHOW:this.sendNotification(app.mediator.scene.HomeMediator.STOP_RENDER);this.taskMainProxy=this.facade.retrieveProxy(app.proxy.TaskMainProxy.NAME);this.taskDayProxy=this.facade.retrieveProxy(app.proxy.TaskDayProxy.NAME);
this.userInfo=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME);this.signInProxy=this.facade.retrieveProxy(app.proxy.SignInProxy.NAME);this.campaignProxy=this.facade.retrieveProxy(app.proxy.CampaignProxy.NAME);this.loader=app.GameData.GameResource;for(var b=b.getBody(),c=[18,19,20,21],e=[],f=0;f<c.length;f++)e.push(this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).isBuildingShow(c[f]));this.setViewComponent(new app.view.building.TaskFrameView(this.loader,e));this.viewComponent.addEventListener(app.view.building.TaskDayView.TASKDAY_FINISH,
this);this.viewComponent.addEventListener(app.view.building.TaskDayView.TASKDAY_FRESH,this);this.viewComponent.addEventListener(app.view.building.TaskDayView.TASKDAY_LOTTERY,this);this.viewComponent.addEventListener(app.view.building.TaskMainView.TASKMAIN_GET,this);this.viewComponent.addEventListener(app.view.system.SignInView.GET_ACTIVE_REWARD,this);this.viewComponent.addEventListener(app.view.system.SignInView.SHOW_ACTIVE_DIALOG,this);this.viewComponent.addEventListener(app.view.system.SignInView.SIGN_IN,
this);this.viewComponent.addEventListener(app.view.system.CampaignView.GET_REWARD,this);this.viewComponent.addEventListener(app.view.building.TaskFrameView.CLOSE,this);this.viewComponent.addEventListener(app.view.building.TaskFrameView.LOADSIGNDATA,this);this.getData(e,b);break;case app.mediator.building.TaskMediator.CLOSE:this.viewComponent.removeEventListener(app.view.building.TaskDayView.TASKDAY_FINISH,this);this.viewComponent.removeEventListener(app.view.building.TaskDayView.TASKDAY_FRESH,this);
this.viewComponent.removeEventListener(app.view.building.TaskDayView.TASKDAY_LOTTERY,this);this.viewComponent.removeEventListener(app.view.building.TaskMainView.TASKMAIN_GET,this);this.viewComponent.removeEventListener(app.view.system.SignInView.GET_ACTIVE_REWARD,this);this.viewComponent.removeEventListener(app.view.system.SignInView.SHOW_ACTIVE_DIALOG,this);this.viewComponent.removeEventListener(app.view.system.SignInView.SIGN_IN,this);this.viewComponent.removeEventListener(app.view.system.CampaignView.GET_REWARD,
this);this.viewComponent.removeEventListener(app.view.building.TaskFrameView.CLOSE,this);this.viewComponent.removeEventListener(app.view.building.TaskFrameView.LOADSIGNDATA,this);this.viewComponent=this.loader=null;break;case app.proxy.TaskMainProxy.TASKMAIN_CHANGED:this.viewComponent&&this.viewComponent.tabChange(0);break;case app.proxy.TaskDayProxy.TASKDAY_CHANGED:this.viewComponent&&this.viewComponent.tabChange(2);break;case app.proxy.TaskDayProxy.TASKDAY_LOTTERYRESULT:if(null==this.viewComponent)break;
if(void 0==this.taskLotteryView)c=this.loader.getContent("taskLottery"),this.taskLotteryView=new app.view.building.TaskLotteryView(c,!0);this.lotteryReward[this.lotteryNo]=b.getBody();this.taskLotteryView.setData(b.getBody(),this.taskDayProxy.taskDay,this.lotteryReward);this.taskLotteryView.addEventListener(app.view.building.TaskLotteryView.CLOSE,this);this.taskLotteryView.addEventListener(app.view.building.TaskLotteryView.MORELOTTERY,this);break;case app.proxy.SignInProxy.GET_ACTIVE_REWARD_COMPLETE:if(null==
this.viewComponent)break;c=b.getBody()[1];this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_REWARDS,c);this.viewComponent.setSignInData(b.getBody()[0]);this.viewComponent.activeLayout();break;case app.proxy.SignInProxy.LOAD_COMPLETE:if(null==this.viewComponent)break;this.viewComponent.setSignInData(b.getBody());break;case app.proxy.SignInProxy.SIGN_IN:if(null==this.viewComponent)break;this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_REWARDS,b.getBody()[1]);this.viewComponent.setSignInData(b.getBody()[0]);
this.viewComponent.signLayout();break;case app.proxy.CampaignProxy.LOAD_COMPLETE:if(null==this.viewComponent)break;this.viewComponent.setComData(b.getBody());break;case app.proxy.CampaignProxy.GET_CAMPAIGN_REWARD_COMPLETE:if(null==this.viewComponent)break;this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_REWARDS,b.getBody());this.viewComponent.completeReward()}},getData:function(b,c){var e=[!1,!1,!1,!1],f=function(b){e[b]=!0;e[0]&&e[1]&&e[2]&&e[3]&&this.gotoFrame(c)};b[0]?this.taskMainProxy.getTaskMInfo(ClassUtils.delegate(this,
f,0)):f(0);b[1]?this.signInProxy.loadSignInData(ClassUtils.delegate(this,f,1)):f(1);b[2]?this.taskDayProxy.getTaskDInfo(ClassUtils.delegate(this,f,2)):f(2);b[3]?this.campaignProxy.loadCampaignData(ClassUtils.delegate(this,f,3)):f(3)},gotoFrame:function(b){null==b&&(b=0);this.viewComponent.setData(this.taskMainProxy,this.taskDayProxy,this.signInProxy.signInData,this.campaignProxy.campaignData);this.viewComponent.show(b)},handleEvent:function(b){switch(b.type){case app.view.building.TaskDayView.TASKDAY_FINISH:this.userInfo.data.goldCoin<
this.taskDayProxy.taskDay.finishPrice?this.sendNotification(app.command.CommandType.PAY):this.taskDayProxy.finishTask();break;case app.view.building.TaskDayView.TASKDAY_FRESH:if(0<this.taskDayProxy.taskDay.freshTotal-this.taskDayProxy.taskDay.freshNum)this.taskDayProxy.freshTask();else{var c=this;app.view.Alert.show("\u5237\u65b0\u4efb\u52a1\u9700\u8981"+this.taskDayProxy.taskDay.freshPrice+"\u91d1\u5e01\uff0c\u786e\u5b9a\u8981\u5237\u65b0\u5417\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==
b&&(c.userInfo.data.goldCoin<c.taskDayProxy.taskDay.freshPrice?c.sendNotification(app.command.CommandType.PAY):c.taskDayProxy.freshTask())})}break;case app.view.building.TaskDayView.TASKDAY_LOTTERY:this.taskDayProxy.taskDay.lotteryNumCon=6;this.lotteryReward=[];this.lotteryCommand(b.data);break;case app.view.building.TaskMainView.TASKMAIN_GET:this.taskMainProxy.mainGet(b.data.taskId);break;case app.view.building.TaskLotteryView.MORELOTTERY:this.lotteryCommand(b.data);break;case app.view.building.TaskLotteryView.CLOSE:this.taskLotteryView.depose();
this.taskLotteryView=null;this.taskDayProxy.getNewTaskD();break;case app.view.system.SignInView.GET_ACTIVE_REWARD:this.signInProxy.getActiveReward(b.data);break;case app.view.system.SignInView.SHOW_ACTIVE_DIALOG:this.signInProxy.loadActiveData();break;case app.view.system.SignInView.SIGN_IN:this.signInProxy.signIn();break;case app.view.system.CampaignView.GET_REWARD:this.campaignProxy.campaignData.canGetReward&&this.campaignProxy.getCampaignReward();break;case app.view.building.TaskFrameView.CLOSE:this.sendNotification(app.mediator.scene.HomeMediator.RESUME_RENDER);
this.sendNotification(app.mediator.building.TaskMediator.CLOSE);break;case app.view.building.TaskFrameView.LOADSIGNDATA:this.signInProxy.loadSignInData()}},lotteryCommand:function(b){this.lotteryNo=b;if(6==this.taskDayProxy.taskDay.lotteryNumCon)this.taskDayProxy.lotteryGet();else{var c=this;app.view.Alert.getInstance().show("\u7ee7\u7eed\u62bd\u5956\u9700\u8981"+this.taskDayProxy.taskDay.lotteryPrice+"\u91d1\u5e01\uff0c\u786e\u5b9a\u8981\u7ee7\u7eed\u5417\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==
b&&(c.userInfo.data.goldCoin<c.taskDayProxy.taskDay.lotteryPrice?c.sendNotification(app.command.CommandType.PAY):c.taskDayProxy.lotteryGet())})}this.taskDayProxy.taskDay.lotteryNumCon--}},{NAME:"TaskMediator",SHOW:"Task_Show",CLOSE:"Task_Close"});puremvc.define({name:"app.mediator.building.AchievementMediator",parent:puremvc.Mediator},{achievementProxy:null,gameInfoProxy:null,listNotificationInterests:function(){return[app.mediator.building.AchievementMediator.SHOW,app.mediator.building.AchievementMediator.CLOSE,app.proxy.AchievementProxy.COPY_COMPLETE,app.proxy.AchievementProxy.SHOWMSG,app.proxy.AchievementProxy.ACHIEVEMENT_COMPLETE,app.mediator.building.AchievementMediator.SHOWSINGLE]},handleNotification:function(b){this.achievementProxy=
this.facade.retrieveProxy(app.proxy.AchievementProxy.NAME);this.loader=app.GameData.GameResource;switch(b.getName()){case app.mediator.building.AchievementMediator.SHOW:this.sendNotification(app.mediator.scene.HomeMediator.STOP_RENDER);this.userInfo=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME);this.setViewComponent(new app.view.building.AchievementView(this.loader));this.viewComponent.addEventListener(app.view.building.AchievementView.Achievement_Info,this);this.viewComponent.addEventListener(app.view.building.AchievementView.Achievement_RewardInfo,
this);this.viewComponent.addEventListener(app.view.building.AchievementView.Achievement_get,this);this.viewComponent.addEventListener(app.view.building.AchievementView.CLOSE,this);this.achievementProxy.getCopyInfo(ClassUtils.delegate(this,function(){this.gotoFrame()}));break;case app.mediator.building.AchievementMediator.CLOSE:this.closeAchievement();break;case app.proxy.AchievementProxy.ACHIEVEMENT_COMPLETE:this.viewComponent&&this.viewComponent.showInfo(b.body);this.achievementSingleView&&this.achievementSingleView.setData(b.body);
break;case app.proxy.AchievementProxy.SHOWMSG:this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,b.getBody());break;case app.mediator.building.AchievementMediator.SHOWSINGLE:this.achievementProxy.getAchievementInfo(null,b.getBody()),this.achievementSingleView&&this.achievementSingleView.depose(),b=this.loader.getContent("achievementSingle"),this.achievementSingleView=new app.view.building.AchievementSingleView(b,!0),this.achievementSingleView.addEventListener(app.view.building.AchievementSingleView.GET,
this),this.achievementSingleView.addEventListener(app.view.building.AchievementSingleView.CLOSE,this)}},gotoFrame:function(){this.viewComponent&&this.viewComponent.setData(this.achievementProxy.copyList)},handleEvent:function(b){switch(b.type){case app.view.building.AchievementView.Achievement_RewardInfo:var c=this.achievementProxy.getAInfo(b.data);c&&c.mapId?this.viewComponent.showInfo(c):this.achievementProxy.getAchievementInfo(null,b.data);break;case app.view.building.AchievementView.Achievement_Info:this.achievementInfoView&&
this.achievementInfoView.depose();c=this.loader.getContent("achievementInfo");this.achievementInfoView=new app.view.building.AchievementInfoView(c,!0);this.achievementInfoView.setData(this.achievementProxy.getAInfo(b.data.mapId));this.achievementInfoView.addEventListener(app.view.building.AchievementInfoView.CLOSE,this);break;case app.view.building.AchievementInfoView.CLOSE:this.achievementInfoView.depose();this.achievementInfoView=null;break;case app.view.building.AchievementSingleView.CLOSE:this.achievementSingleView.depose();
this.achievementSingleView=null;break;case app.view.building.AchievementSingleView.GET:case app.view.building.AchievementView.Achievement_get:this.achievementProxy.getAchievement(b.data.mapId,b.data.param);break;case app.view.building.AchievementView.CLOSE:this.closeAchievement()}},closeAchievement:function(){this.sendNotification(app.mediator.scene.HomeMediator.RESUME_RENDER);this.viewComponent.depose();this.viewComponent=null}},{NAME:"AchievementMediator",SHOW:"AchievementMediator_Show",SHOWSINGLE:"AchievementMediator_ShowSingle",
CLOSE:"AchievementMediator_Close"});puremvc.define({name:"app.mediator.system.ArmyGroupMediator",parent:puremvc.Mediator},{armyGroupProxy:null,userInfo:null,gId:null,gameInfoProxy:null,armyGroupAskProxy:null,armyGroupListProxy:null,armyGroupTeamProxy:null,armyGroupResearchProxy:null,listNotificationInterests:function(){return[app.mediator.system.ArmyGroupMediator.SHOW,app.mediator.system.ArmyGroupMediator.CLOSE,app.proxy.ArmyGroupProxy.INFO_CHANGED,app.proxy.ArmyGroupAskProxy.LIST_CHANGED,app.proxy.ArmyGroupAskProxy.INFO_CHANGED,app.proxy.ArmyGroupResearchProxy.LIST_CHANGED,
app.proxy.ArmyGroupResearchProxy.INFO_CHANGED,app.proxy.ArmyGroupTeamProxy.LIST_CHANGED,app.proxy.ArmyGroupListProxy.LIST_CHANGED,app.proxy.ArmyGroupListProxy.GROUPINFO_CHANGED,app.proxy.ArmyGroupProxy.REENTER,app.proxy.ArmyGroupListProxy.REENTER]},handleNotification:function(b){this.armyGroupProxy=this.facade.retrieveProxy(app.proxy.ArmyGroupProxy.NAME);this.armyGroupAskProxy=this.facade.retrieveProxy(app.proxy.ArmyGroupAskProxy.NAME);this.armyGroupListProxy=this.facade.retrieveProxy(app.proxy.ArmyGroupListProxy.NAME);
this.armyGroupTeamProxy=this.facade.retrieveProxy(app.proxy.ArmyGroupTeamProxy.NAME);this.armyGroupResearchProxy=this.facade.retrieveProxy(app.proxy.ArmyGroupResearchProxy.NAME);this.userInfo=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME);switch(b.getName()){case app.mediator.system.ArmyGroupMediator.SHOW:this.sendNotification(app.mediator.scene.HomeMediator.STOP_RENDER);this.reenter();break;case app.proxy.ArmyGroupProxy.INFO_CHANGED:this.viewComponent&&this.viewComponent.refreshInfo(1);
break;case app.proxy.ArmyGroupAskProxy.LIST_CHANGED:this.viewComponent&&this.viewComponent.refreshList(3);break;case app.proxy.ArmyGroupResearchProxy.LIST_CHANGED:this.viewComponent&&this.viewComponent.refreshList(2);break;case app.proxy.ArmyGroupResearchProxy.INFO_CHANGED:this.viewComponent&&this.viewComponent.setDefaultResearch();break;case app.proxy.ArmyGroupTeamProxy.LIST_CHANGED:this.viewComponent&&this.viewComponent.refreshList(1);break;case app.proxy.ArmyGroupListProxy.LIST_CHANGED:this.viewComponent&&
this.viewComponent.refreshList(0);break;case app.proxy.ArmyGroupListProxy.GROUPINFO_CHANGED:this.viewComponent&&(this.viewComponent.refreshList(0),this.viewComponent.refreshInfo(1));break;case app.proxy.ArmyGroupAskProxy.INFO_CHANGED:this.viewComponent&&this.viewComponent.refreshInfo(3);break;case app.proxy.ArmyGroupProxy.REENTER:case app.proxy.ArmyGroupListProxy.REENTER:this.reenter()}},reenter:function(){this.armyGroupProxy.getInfo(this.armyGroupListProxy.pageNum,this.armyGroupTeamProxy.pageNum,
this.armyGroupAskProxy.pageNum,ClassUtils.delegate(this,this.gotoFrame))},gotoFrame:function(){this.viewComponent&&this.viewComponent.depose();this.viewComponent=null;if(this.loader)this.loader=null;this.loader=app.GameData.GameResource;this.setViewComponent(new app.view.system.ArmyGroupFrameView(this.loader,this.armyGroupProxy.status));this.viewComponent.addEventListener(app.view.system.ArmyGroupResearchView.GROUP_RESEARCH,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupResearchView.GROUP_RESEARCHSET,
this);this.viewComponent.addEventListener(app.view.system.ArmyGroupAskListView.GROUP_ASKAGREE,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupAskListView.GROUP_ASKDISAGREE,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupAskListView.GROUP_ASKLIST,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupOurView.GROUP_PROMOTION,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupOurView.GROUP_EXITGROUP,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupOurView.GROUP_TEAMINFO,
this);this.viewComponent.addEventListener(app.view.system.ArmyGroupOurView.GROUP_TEAMLIST,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupOurView.GROUP_TEAMNOTES,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupListView.GROUP_JOIN,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupListView.GROUP_SEARCH,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupListView.GROUP_CANCLESEARCH,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupListView.GROUP_CREATE,
this);this.viewComponent.addEventListener(app.view.system.ArmyGroupListView.GROUP_CANCLEJOIN,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupListView.GROUP_MANIFESTO,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupListView.GROUP_LIST,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupListView.REENTER,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupListView.CANCEL_DISMISS,this);this.viewComponent.addEventListener(app.view.system.ArmyGroupFrameView.CLOSE,
this);this.gId=1==this.armyGroupProxy.status||4==this.armyGroupProxy.status?this.armyGroupListProxy.ourGroupInfo.id:-1;this.viewComponent.setData(this.armyGroupProxy,this.armyGroupAskProxy,this.armyGroupListProxy,this.armyGroupResearchProxy,this.armyGroupTeamProxy);this.viewComponent.show(0)},handleEvent:function(b){switch(b.type){case app.view.system.ArmyGroupResearchView.GROUP_RESEARCHSET:b.data&&0<b.data.id&&this.armyGroupResearchProxy.setDefault(this.gId,b.data.id);break;case app.view.system.ArmyGroupResearchView.GROUP_RESEARCH:var c=
this.armyGroupResearchProxy.dNum,e=200*this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.HALL).level,f=this.userInfo.data.silverCoin;if(0>=c)app.view.Alert.show("\u4eca\u5929\u6350\u732e\u6570\u91cf\u5df2\u8fbe\u4e0a\u9650!");else if(0>=f)app.view.Alert.show("\u94f6\u5e01\u4e0d\u8db3\uff0c\u65e0\u6cd5\u8fdb\u884c\u6350\u732e\u3002");else{var g=this.loader.getContent("groupDonation");this.groupDonationView=new app.view.system.GroupDonationView(g);this.groupDonationView.setData(f,
c,e,b.data.id);this.groupDonationView.addEventListener(app.view.system.GroupDonationView.OK,ClassUtils.delegate(this,this.donation));this.groupDonationView.addEventListener(app.view.system.GroupDonationView.CANCLE,ClassUtils.delegate(this,this.closeDonation));this.groupDonationView.addEventListener(app.view.system.GroupDonationView.SHOWMSG,ClassUtils.delegate(this,this.showTip))}break;case app.view.system.ArmyGroupAskListView.GROUP_ASKAGREE:b.data&&b.data.id&&0<b.data.id&&this.armyGroupAskProxy.approveMember(this.gId,
b.data.id);break;case app.view.system.ArmyGroupAskListView.GROUP_ASKDISAGREE:b.data&&b.data.id&&0<b.data.id&&this.armyGroupAskProxy.refuseMember(this.gId,b.data.id);break;case app.view.system.ArmyGroupAskListView.GROUP_ASKLIST:this.armyGroupAskProxy.getList(this.gId,b.data);break;case app.view.system.ArmyGroupOurView.GROUP_PROMOTION:8>this.armyGroupProxy.pos&&this.armyGroupProxy.advancement(this.gId);break;case app.view.system.ArmyGroupOurView.GROUP_EXITGROUP:var h=this,b=function(b){0==b&&h.armyGroupProxy.exit(h.gId)};
8==this.armyGroupProxy.pos?30<=this.armyGroupListProxy.ourGroupInfo.level?app.view.Alert.show("30\u7ea7\u4ee5\u4e0a\u7684\u519b\u56e2\u65e0\u6cd5\u89e3\u6563!"):5<=this.armyGroupListProxy.ourGroupInfo.level?app.view.Alert.show("\u519b\u957f\u9000\u51fa\u4f1a\u89e3\u6563\u8be5\u519b\u56e2\uff0c\u8be5\u519b\u56e2\u89e3\u6563\u540e3\u5929\u5185\u8fd8\u53ef\u4ee5\u53d6\u6d88\u89e3\u6563\uff0c\u786e\u5b9a\u8981\u89e3\u6563\u5417\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],b):2<=this.armyGroupListProxy.ourGroupInfo.level?
app.view.Alert.show("\u519b\u957f\u9000\u51fa\u4f1a\u89e3\u6563\u8be5\u519b\u56e2\uff0c\u8be5\u519b\u56e2\u89e3\u6563\u540e\u9700\u89813\u5c0f\u65f6\u5185\u8fd8\u53ef\u4ee5\u53d6\u6d88\u89e3\u6563\uff0c\u786e\u5b9a\u8981\u89e3\u6563\u5417\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],b):app.view.Alert.show("\u519b\u957f\u9000\u51fa\u4f1a\u89e3\u6563\u8be5\u519b\u56e2\uff0c\u786e\u5b9a\u8981\u89e3\u6563\u5417\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],b):app.view.Alert.show("\u9000\u51fa\u540e\u4e09\u5c0f\u65f6\u5185\u4e0d\u80fd\u518d\u52a0\u5165\u6216\u6210\u7acb\u519b\u56e2\uff0c\u786e\u5b9a\u8981\u9000\u51fa\u8be5\u519b\u56e2\u5417\uff1f",
["\u786e\u5b9a","\u53d6\u6d88"],b);break;case app.view.system.ArmyGroupOurView.GROUP_TEAMINFO:g=this.loader.getContent("groupTeamInfo");e=b.data.pos;c=this.armyGroupProxy.pos;this.groupTeamInfoView=new app.view.system.GroupTeamInfoView(g);g=this.armyGroupProxy.getPower(1,c)&&c>e;c=this.armyGroupProxy.getPower(3,c);this.userInfo.data.roleId==b.data.id&&(g=c=!1);this.groupTeamInfoView.setData(b.data,g,c);this.groupTeamInfoView.addEventListener(app.view.system.GroupTeamInfoView.FIRE,ClassUtils.delegate(this,
this.fire));this.groupTeamInfoView.addEventListener(app.view.system.GroupTeamInfoView.ASSIGN,ClassUtils.delegate(this,this.assign));this.groupTeamInfoView.addEventListener(app.view.system.GroupTeamInfoView.CLOSE,ClassUtils.delegate(this,this.closeTeamInfo));break;case app.view.system.ArmyGroupOurView.GROUP_TEAMLIST:this.armyGroupTeamProxy.getList(this.gId,b.data);break;case app.view.system.ArmyGroupOurView.GROUP_TEAMNOTES:c=this.armyGroupProxy.pos;b=this.armyGroupListProxy.ourGroupInfo.announcement;
this.armyGroupProxy.getPower(2,c)?(g=this.loader.getContent("groupInput"),this.groupInputView=new app.view.system.GroupInputView(g),this.groupInputView.setData("\u519b\u56e2\u516c\u544a",30,b),this.groupInputView.addEventListener(app.view.system.GroupInputView.OK,ClassUtils.delegate(this,this.newPub)),this.groupInputView.addEventListener(app.view.system.GroupInputView.CANCLE,ClassUtils.delegate(this,this.closeGroupInput)),this.groupInputView.addEventListener(app.view.system.GroupInputView.SHOWMSG,
ClassUtils.delegate(this,this.showTip))):app.view.Alert.show("\u526f\u519b\u56e2\u957f\u4ee5\u4e0a\u624d\u6709\u8be5\u6743\u9650!");break;case app.view.system.ArmyGroupListView.GROUP_JOIN:if(!b.data||null==b.data.id)break;b.data.country!=this.userInfo.data.country?app.view.Alert.show("\u65e0\u6cd5\u52a0\u5165\u5176\u4ed6\u56fd\u5bb6\u7684\u519b\u56e2!"):b.data.id&&0<b.data.id&&this.armyGroupListProxy.join(b.data.id);break;case app.view.system.ArmyGroupListView.GROUP_SEARCH:b.data&&0<b.data.length?
this.armyGroupListProxy.sendSearchList(b.data,0):this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,"\u641c\u7d22\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\uff01");break;case app.view.system.ArmyGroupListView.GROUP_CANCLESEARCH:if(1==this.armyGroupListProxy.nowList)this.armyGroupListProxy.nowList=0,this.viewComponent&&this.viewComponent.refreshList(0);break;case app.view.system.ArmyGroupListView.GROUP_CREATE:b="\u521b\u5efa\u519b\u56e2\u9700\u89812000\u94f6\u5e01\uff0c";h=this;g=function(b){0==
b&&h.showCreat()};2E3<this.userInfo.data.silverCoin?app.view.Alert.show(b+"\u786e\u5b9a\u8981\u521b\u5efa\u5417\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],g):app.view.Alert.show("\u60a8\u7684\u94f6\u5e01\u4e0d\u8db3!");break;case app.view.system.ArmyGroupListView.GROUP_CANCLEJOIN:this.armyGroupListProxy.cancleJoin(this.gId,b.data);break;case app.view.system.ArmyGroupListView.GROUP_MANIFESTO:g=this.loader.getContent("groupInput");b=this.armyGroupListProxy.ourGroupInfo.declaration;this.groupInputView=new app.view.system.GroupInputView(g);
this.groupInputView.setData("\u519b\u56e2\u5ba3\u8a00",40,b);this.groupInputView.addEventListener(app.view.system.GroupInputView.OK,ClassUtils.delegate(this,this.newExplain));this.groupInputView.addEventListener(app.view.system.GroupInputView.CANCLE,ClassUtils.delegate(this,this.closeGroupInput));this.groupInputView.addEventListener(app.view.system.GroupInputView.SHOWMSG,ClassUtils.delegate(this,this.showTip));break;case app.view.system.ArmyGroupListView.GROUP_LIST:0==b.data.l?this.armyGroupListProxy.getList(this.gId,
b.data.type):this.armyGroupListProxy.getList(b.data.type,b.data.l);break;case app.view.system.GroupTeamInfoView.CLOSE:this.groupTeamInfoView.depose();this.groupTeamInfoView=null;break;case app.view.system.ArmyGroupListView.REENTER:this.reenter();break;case app.view.system.ArmyGroupListView.CANCEL_DISMISS:this.armyGroupProxy.cancelDismiss();break;case app.view.system.ArmyGroupFrameView.CLOSE:this.armyGroupListProxy.nowList=0,this.sendNotification(app.mediator.scene.HomeMediator.RESUME_RENDER),this.viewComponent=
this.loader=null}},showCreat:function(){var b=this.loader.getContent("groupInput");this.groupInputView=new app.view.system.GroupInputView(b);this.groupInputView.setData("\u519b\u56e2\u540d\u79f0",8);this.groupInputView.addEventListener(app.view.system.GroupInputView.OK,ClassUtils.delegate(this,this.newGroup));this.groupInputView.addEventListener(app.view.system.GroupInputView.CANCLE,ClassUtils.delegate(this,this.closeGroupInput));this.groupInputView.addEventListener(app.view.system.GroupInputView.SHOWMSG,
ClassUtils.delegate(this,this.showTip))},closeGroupInput:function(){this.groupInputView.depose();this.groupInputView=null},newPub:function(b){this.closeGroupInput();this.armyGroupListProxy.newPub(this.gId,b.data.con)},newExplain:function(b){this.closeGroupInput();this.armyGroupListProxy.newExplain(this.gId,b.data.con)},newGroup:function(b){b=b.data.con;null==b||0>=b.length?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,"\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a!"):(this.closeGroupInput(),
this.armyGroupListProxy.creat(this.gId,b))},closeTeamInfo:function(){this.groupTeamInfoView.depose();this.groupTeamInfoView=null},fire:function(b){this.closeTeamInfo();this.armyGroupTeamProxy.fire(this.gId,b.data)},assign:function(b){this.closeTeamInfo();this.armyGroupTeamProxy.assign(this.gId,b.data)},closeDonation:function(){this.groupDonationView.depose();this.groupDonationView=null},donation:function(b){this.closeDonation();this.armyGroupResearchProxy.researchTeck(this.gId,b.data.id,b.data.num)},
showTip:function(b){this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,b.data)}},{NAME:"ArmyGroupMediator",SHOW:"show",CLOSE:"close"});puremvc.define({name:"app.mediator.system.GiftMediator",parent:puremvc.Mediator},{giftProxy:null,listNotificationInterests:function(){return[app.mediator.system.GiftMediator.SHOW,app.mediator.system.GiftMediator.CLOSE,app.proxy.GiftProxy.SHOWMSG,app.proxy.GiftProxy.SHOWGIFT,app.proxy.GiftProxy.LIST_CHANGED]},handleNotification:function(b){var c=app.GameData.GameResource;switch(b.getName()){case app.mediator.system.GiftMediator.SHOW:this.giftProxy=this.facade.retrieveProxy(app.proxy.GiftProxy.NAME);
this.userInfo=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;this.sendNotification(app.mediator.scene.HomeMediator.STOP_RENDER);this.setViewComponent(new app.view.system.GiftView(c));this.viewComponent.addEventListener(app.view.system.GiftView.GET,this);this.viewComponent.addEventListener(app.view.system.GiftView.GETBYKEY,this);this.viewComponent.addEventListener(app.view.system.GiftView.CLOSE,this);this.viewComponent.addEventListener(app.view.system.GiftView.GIFT_TIMEOUT,this);this.viewComponent.addEventListener(app.view.system.GiftView.GETACT,
this);this.sendData();break;case app.proxy.GiftProxy.LIST_CHANGED:this.viewComponent&&this.sendData();break;case app.proxy.GiftProxy.SHOWMSG:this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,b.getBody());break;case app.proxy.GiftProxy.SHOWGIFT:if(void 0==this.showGiftView)c=c.getContent("showGift"),this.showGiftView=new app.view.system.ShowGiftView(c,!0);this.showGiftView.setData(b.getBody());this.showGiftView.addEventListener(app.view.system.ShowGiftView.CLOSE,this)}},sendData:function(){this.viewComponent.setData(this.giftProxy.listS,
this.giftProxy.listN,this.giftProxy.keyGift,this.giftProxy.active)},getTab:function(){var b=0;2!=this.giftProxy.listS.status&&2==this.giftProxy.listN.status&&(b=1);return b},handleEvent:function(b){switch(b.type){case app.view.system.GiftView.GET:this.giftProxy.getGift(b.data);break;case app.view.system.GiftView.CLOSE:this.giftProxy.freshData();this.sendNotification(app.mediator.scene.HomeMediator.RESUME_RENDER);this.viewComponent.depose();this.viewComponent=null;break;case app.view.system.GiftView.GETBYKEY:b.data&&
0<b.data.length&&this.giftProxy.getByKey(b.data);break;case app.view.system.GiftView.GETACT:10<this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.HALL).level?this.giftProxy.getAct():app.view.Alert.getInstance().show("\u8fbe\u523011\u7ea7\u624d\u53ef\u9886\u53d6\uff01");break;case app.view.system.ShowGiftView.CLOSE:this.showGiftView&&this.showGiftView.depose(),this.showGiftView=null}}},{NAME:"giftMediator",SHOW:"gift_Show",CLOSE:"gift_Close"});puremvc.define({name:"app.mediator.scene.JoinGroupWarMediator",parent:puremvc.Mediator},{groupWarProxy:null,action:null,listNotificationInterests:function(){return[app.mediator.scene.JoinGroupWarMediator.SHOW,app.mediator.scene.JoinGroupWarMediator.CLOSE,app.proxy.WarfareProxy.UPDATE,app.proxy.GroupWarProxy.LIST_CHANGED]},handleNotification:function(b){switch(b.getName()){case app.mediator.scene.JoinGroupWarMediator.SHOW:this.groupWarProxy=this.facade.retrieveProxy(app.proxy.GroupWarProxy.NAME);this.loader=
app.GameData.GameResource;this.userInfo=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;this.sendNotification(app.mediator.scene.HomeMediator.STOP_RENDER);this.setViewComponent(new app.view.battle.JoinGroupWarView(this.loader));this.viewComponent.addEventListener(app.view.battle.JoinGroupWarView.CLOSE,this);this.viewComponent.addEventListener(app.view.battle.JoinGroupWarView.JOINGROUP,this);this.viewComponent.addEventListener(app.view.battle.JoinGroupWarView.CREATGROUP,this);this.viewComponent.addEventListener(app.view.battle.JoinGroupWarView.REMOVETEAM,
this);this.viewComponent.addEventListener(app.view.battle.JoinGroupWarView.REMOVEGROUP,this);this.viewComponent.addEventListener(app.view.battle.JoinGroupWarView.EXITGROUP,this);this.groupWarProxy.setInfo(b.body);var c=this;this.groupWarProxy.getInfo(b.body.conf.mapId,b.body.conf.barrierId,!1,function(){c.viewComponent.setGroupInfo(c.groupWarProxy.groupInfo,c.groupWarProxy.teamCon);c.sendData()});break;case app.proxy.GroupWarProxy.LIST_CHANGED:this.viewComponent&&this.sendData();break;case app.proxy.WarfareProxy.UPDATE:case app.mediator.scene.JoinGroupWarMediator.CLOSE:this.viewComponent&&
this.closeViewComponent()}},sendData:function(){this.viewComponent.showUI(this.groupWarProxy.state);this.viewComponent.setGroupList(this.groupWarProxy.list,this.action);this.joinTeamView&&this.joinTeamView.setData(this.groupWarProxy.tList);if(1==this.action)this.action=0},handleEvent:function(b){var c=this;switch(b.type){case app.view.battle.JoinGroupWarView.JOINGROUP:var e=function(){c.action=1;c.groupWarProxy.join(b.data.group.id)},f=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_3);
0<f.time.getTime()?this.sendNotification(app.command.CommandType.CLEAR_TIME_HANDLE,{timer:f,handle:ClassUtils.delegate(this,e)}):e();break;case app.view.battle.JoinGroupWarView.CREATGROUP:e=function(){c.showOptions()};f=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_3);0<f.time.getTime()?this.sendNotification(app.command.CommandType.CLEAR_TIME_HANDLE,{timer:f,handle:ClassUtils.delegate(this,e)}):e();break;case app.view.battle.JoinGroupWarView.REMOVETEAM:this.showTeam();
break;case app.view.battle.JoinGroupWarView.REMOVEGROUP:if(0>=this.groupWarProxy.state)break;this.groupWarProxy.quit();break;case app.view.battle.JoinGroupWarView.EXITGROUP:if(0>=this.groupWarProxy.state)break;this.groupWarProxy.quit();break;case app.view.battle.JoinGroupWarView.CLOSE:this.closeViewComponent()}},closeViewComponent:function(){this.groupWarProxy.closeInterval();this.groupWarProxy.clearData();this.sendNotification(app.mediator.scene.HomeMediator.RESUME_RENDER);this.viewComponent.depose();
this.viewComponent=null},showTeam:function(){this.closeView();var b=this.loader.getContent("joinGroupTeam");this.joinTeamView=new app.view.battle.CreatGroupTeamView(b);this.joinTeamView.setData(this.groupWarProxy.tList);this.joinTeamView.addEventListener(app.view.battle.CreatGroupTeamView.OK,ClassUtils.delegate(this,this.removeTeamer));this.joinTeamView.addEventListener(app.view.battle.CreatGroupTeamView.CANCLE,ClassUtils.delegate(this,this.closeTeamView))},showOptions:function(){this.closeView();
var b=this.loader.getContent("joinGroupOption");this.joinItemView=new app.view.battle.CreatGroupOptionsView(b);this.joinItemView.setData(this.groupWarProxy.levelCon,this.groupWarProxy.teamCon,this.groupWarProxy.numCon);this.joinItemView.addEventListener(app.view.battle.CreatGroupOptionsView.OK,ClassUtils.delegate(this,this.selOptions));this.joinItemView.addEventListener(app.view.battle.CreatGroupOptionsView.CANCLE,ClassUtils.delegate(this,this.closeView))},closeView:function(){this.joinItemView&&
this.joinItemView.depose();this.joinItemView=null},selOptions:function(b){this.closeView();this.action=1;this.groupWarProxy.creat(b.options)},closeTeamView:function(){this.joinTeamView&&this.joinTeamView.depose();this.joinTeamView=null},removeTeamer:function(b){if(null!=b.options)b=b.options.rid,b==this.userInfo.roleId?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">\u4e0d\u80fd\u5bf9\u81ea\u5df1\u8fdb\u884c\u64cd\u4f5c\uff01</label>'):(this.action=1,this.groupWarProxy.fire(b))}},
{NAME:"JoinGroupWarMediator",SHOW:"JoinGroupWar_Show",CLOSE:"JoinGroupWar_Close"});puremvc.define({name:"app.mediator.scene.WarfareMediator",parent:puremvc.Mediator},{msgBox:null,listNotificationInterests:function(){return[app.mediator.scene.WarfareMediator.SHOW,app.mediator.scene.WarfareMediator.CLOSE]},handleNotification:function(b){switch(b.getName()){case app.mediator.scene.WarfareMediator.SHOW:this.initMsg();this.loader=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;app.view.battle.NumberMovie.setBitmapSource(this.loader.getContent("numberBmp"));this.setViewComponent(new app.view.warfare.WarfareView(this.loader,
b.getBody()));this.viewComponent.onResult=ClassUtils.delegate(this,this.showResult);this.viewComponent.onComplete=ClassUtils.delegate(this,this.warComplete);break;case app.mediator.scene.WarfareMediator.CLOSE:this.close()}},initMsg:function(){this.msgBox=document.createElement("div");this.msgBox.style["margin-top"]="50px";this.msgBox.style.color="white";this.msgBox.style["text-shadow"]="1px 1px 1px #000";app.GameData.gameDiv.appendChild(this.msgBox)},showResult:function(b,c){var e=document.createElement("div");
e.innerHTML=c;e[app.Event.ONCLICK]=function(){app.trace("***"+b)};this.msgBox.appendChild(e);e=this.msgBox.querySelectorAll("div");3<e.length&&(e[0][app.Event.ONCLICK]=null,delete e[0][app.Event.ONCLICK],this.msgBox.removeChild(e[0]))},close:function(){if(this.msgBox)this.clearBox(),this.msgBox.parentNode.removeChild(this.msgBox),this.msgBox=null;this.viewComponent&&(this.viewComponent.depose(),this.setViewComponent(null))},clearBox:function(){for(var b=this.msgBox.querySelectorAll("div"),c=0;c<b.length;c++)b[c][app.Event.ONCLICK]=
null,delete b[c][app.Event.ONCLICK],this.msgBox.removeChild(b[c])},warComplete:function(b){var c=app.view.system.WarfareResultView;this.resultView=new c(this.loader.getContent("warfare_result"));this.resultView.selfID=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data.roleId;this.resultView.setData(b);this.resultView.addEventListener(c.REPLAY,this);this.resultView.addEventListener(c.EXIT,this)},handleEvent:function(b){this.closeResult();var c=app.view.system.WarfareResultView;switch(b.type){case c.REPLAY:this.clearBox();
this.viewComponent.replay();break;case c.EXIT:b=this.facade.retrieveProxy(app.proxy.GameInfoProxy.NAME).prevMediator,this.sendNotification(app.command.CommandType.GO_SCENE,b)}},closeResult:function(){if(this.resultView){var b=app.view.system.WarfareResultView;this.resultView.removeEventListener(b.REPLAY,this);this.resultView.removeEventListener(b.EXIT,this);this.resultView.depose();this.resultView=null}}},{NAME:"WarfareMediator",SHOW:"WarfareMediator_SHOW",CLOSE:"WarfareMediator_CLOSE"});puremvc.define({name:"app.mediator.system.ChallengeMediator",parent:puremvc.Mediator},{challengeProxy:null,listNotificationInterests:function(){return[app.mediator.system.ChallengeMediator.SHOW,app.mediator.system.ChallengeMediator.CLOSE,app.proxy.WarfareProxy.UPDATE,app.proxy.ChallengeProxy.INFO_CHANGED,app.proxy.ChallengeProxy.LIST_CHANGED]},handleNotification:function(b){this.challengeProxy=this.facade.retrieveProxy(app.proxy.ChallengeProxy.NAME);var c=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;
this.userInfo=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;switch(b.getName()){case app.mediator.system.ChallengeMediator.SHOW:this.sendNotification(app.mediator.scene.HomeMediator.STOP_RENDER);this.setViewComponent(new app.view.system.ChallengeView(c));this.viewComponent.addEventListener(app.view.system.ChallengeView.SELECT_MAP,this);this.viewComponent.addEventListener(app.view.system.ChallengeView.SHOWMSG,this);this.viewComponent.addEventListener(app.view.system.ChallengeView.CLOSE,
this);this.challengeProxy.getInfo();break;case app.proxy.ChallengeProxy.LIST_CHANGED:this.viewComponent&&this.sendData();break;case app.proxy.WarfareProxy.UPDATE:case app.mediator.system.ChallengeMediator.CLOSE:if(this.sendNotification(app.mediator.scene.HomeMediator.RESUME_RENDER),this.viewComponent)this.viewComponent.depose(),this.viewComponent=null}},sendData:function(){this.viewComponent.setData(this.challengeProxy.list,this.challengeProxy.nowJoin)},handleEvent:function(b){switch(b.type){case app.view.system.ChallengeView.SELECT_MAP:b.data.attack&&
this.sendNotification(app.mediator.scene.JoinGroupWarMediator.SHOW,b.data);break;case app.view.system.ChallengeView.SHOWMSG:this.showTip(b);break;case app.view.system.ChallengeView.CLOSE:this.sendNotification(app.mediator.scene.HomeMediator.RESUME_RENDER),this.viewComponent.depose(),this.viewComponent=null}},showTip:function(b){this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,b.data)}},{NAME:"ChallengeMediator",SHOW:"ChallengeMediator_Show",CLOSE:"ChallengeMediator_Close"});puremvc.define({name:"app.mediator.system.PayMediator",parent:puremvc.Mediator},{payProxy:null,listNotificationInterests:function(){return[app.mediator.system.PayMediator.SHOW,app.mediator.system.PayMediator.CLOSE,app.proxy.PayProxy.SHOWMSG,app.proxy.PayProxy.INFO_CHANGED]},handleNotification:function(b){var c=this.facade.retrieveProxy(app.proxy.ResourceProxy.NAME).preLoadResource;switch(b.getName()){case app.mediator.system.PayMediator.SHOW:this.payProxy=this.facade.retrieveProxy(app.proxy.PayProxy.NAME);
this.userInfo=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;this.sendNotification(app.mediator.scene.HomeMediator.STOP_RENDER);this.setViewComponent(new app.view.system.PayView(c));this.viewComponent.addEventListener(app.view.system.PayView.CLOSE,this);this.viewComponent.addEventListener(app.view.system.PayView.PAY,this);this.payProxy.getInfo();break;case app.proxy.PayProxy.SHOWMSG:this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,b.getBody());app.view.Alert.show(b.getBody());
break;case app.proxy.PayProxy.INFO_CHANGED:this.sendData()}},sendData:function(){this.viewComponent.setData(this.payProxy)},handleEvent:function(b){switch(b.type){case app.view.system.PayView.PAY:this.payProxy.goPay();break;case app.view.system.PayView.CLOSE:this.sendNotification(app.mediator.scene.HomeMediator.RESUME_RENDER),this.viewComponent.depose(),this.viewComponent=null}}},{NAME:"PayMediator",SHOW:"PayMediator_Show",CLOSE:"PayMediator_Close"});puremvc.define({name:"app.mediator.system.HeroMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){var b=app.mediator.system.HeroMediator;return[b.SHOW,b.CLOSE,b.START_RECRUIT,app.proxy.HerosProxy.COMPLETE,app.proxy.HerosProxy.CHANGED,app.proxy.HerosProxy.HEROS_LIST_CHANGED,app.proxy.HerosProxy.HERO_INFO_CHANGED,app.proxy.FormationProxy.CHANGED,app.proxy.BagProxy.SHOWMSG,app.proxy.BagProxy.STRONGINFO_CHANGED,app.proxy.BagProxy.ITEMINFO_CHANGED,app.proxy.BagProxy.BAGINFO_CHANGED,
app.proxy.BagProxy.ITEM_CHANGED,app.proxy.BagProxy.ITEM_SELL,app.proxy.EquipProxy.exchangeHeroComplete,app.proxy.EquipProxy.equipOnComplete,app.proxy.EquipProxy.equipUnComplete,app.proxy.EquipProxy.equipUnAllComplete,app.proxy.UserInfoProxy.CHANGED]},tabId:0,handleNotification:function(b){var c=app.mediator.system.HeroMediator;switch(b.getName()){case c.SHOW:this.indicateProxy=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME);this.tabId=b.getBody();this.setViewComponent(new app.view.system.HeroFrameView(app.GameData.GameResource));
this.viewComponent.addEventListener(app.view.building.DrillGroundHeros.NOJOB,this);this.viewComponent.addEventListener(app.view.building.DrillGroundHeros.TRANSFER,this);this.viewComponent.addEventListener(app.view.building.DrillGroundHeros.SETDEFAULT,this);this.viewComponent.addEventListener(app.view.building.DrillGroundHeros.REBUILD,this);this.viewComponent.addEventListener(app.view.building.DrillGroundHeros.CHANGE_MASTER,this);this.viewComponent.addEventListener(app.view.building.DrillGroundHeros.NEWBIRTH,
this);this.viewComponent.addEventListener(app.view.building.DrillGroundFormation.UP,this);this.viewComponent.addEventListener(app.view.building.DrillGroundFormation.DOWN,this);this.viewComponent.addEventListener(app.view.building.DrillGroundFormation.SAVE,this);this.viewComponent.addEventListener(app.view.building.DrillGroundFormation.SETDEFAULT,this);this.viewComponent.addEventListener(app.view.system.HeroFrameView.CLOSE,this);this.viewComponent.addEventListener(app.view.system.ItemUpgradeView.UPGRADE_EQUIP,
this);this.viewComponent.addEventListener(app.view.system.ItemUpgradeView.DEGRADE_EQUIP,this);this.viewComponent.addEventListener(app.view.system.ItemUpgradeView.CLEAR_STRONGTIMER,this);this.viewComponent.addEventListener(app.view.system.ItemUpgradeView.DEGRA_OBTAIN,this);this.viewComponent.addEventListener(app.view.system.ItemUpgradeView.SELL_EQUIP,this);this.viewComponent.addEventListener(app.view.system.ItemUpgradeView.ADD_BAGSIZE,this);this.viewComponent.addEventListener(app.view.system.ItemUpgradeView.ITEM_TIMEOUT,
this);this.viewComponent.addEventListener(app.view.building.EquipView.SelectEquip,this);this.viewComponent.addEventListener(app.view.building.EquipView.ExhcangeHero,this);this.viewComponent.addEventListener(app.view.building.EquipView.UnAllEquip,this);this.formationProxy=this.facade.retrieveProxy(app.proxy.FormationProxy.NAME);this.bagProxy=this.facade.retrieveProxy(app.proxy.BagProxy.NAME);this.indicateProxy=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME);this.strongTimer=this.indicateProxy.getIndicateDataByType(app.proxy.IndicateProxy.TYPE_8);
this.facade.sendNotification(app.mediator.scene.BattleMapMediator.STOP_RENDER);null!=this.herosProxy.data?this.setData():this.herosProxy.loadData();break;case c.CLOSE:this.onRemove();break;case app.proxy.HerosProxy.COMPLETE:null!=this.viewComponent&&this.setData();break;case app.proxy.HerosProxy.CHANGED:null!=this.viewComponent&&this.viewComponent.update();break;case app.proxy.HerosProxy.HEROS_LIST_CHANGED:null!=this.viewComponent&&this.viewComponent.heroListUpdate();break;case app.proxy.UserInfoProxy.CHANGED:null!=
this.viewComponent&&this.upUserInfo();break;case app.proxy.HerosProxy.HERO_INFO_CHANGED:null!=this.reBuildView&&this.reBuildView.setData(b.getBody(),this.herosProxy.data.needMoney);null!=this.viewComponent&&this.viewComponent.updateInfo();null!=this.trainPop&&this.trainPop.refresh();break;case app.proxy.FormationProxy.CHANGED:null!=this.viewComponent&&(this.viewComponent.formationChange(),this.viewComponent.refreshEquipFormation(this.formationProxy.getHeros()));break;case app.proxy.BagProxy.BAGINFO_CHANGED:case app.proxy.BagProxy.ITEM_CHANGED:case app.proxy.BagProxy.ITEM_SELL:this.viewComponent&&
this.viewComponent.updateBag();break;case app.proxy.BagProxy.SHOWMSG:this.viewComponent&&this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,b.getBody());break;case app.proxy.BagProxy.STRONGINFO_CHANGED:this.viewComponent&&this.viewComponent.refreshStrongInfo(this.bagProxy);break;case app.proxy.BagProxy.ITEMINFO_CHANGED:this.viewComponent&&this.viewComponent.updateNowView();break;case app.proxy.EquipProxy.exchangeHeroComplete:if(null==this.viewComponent)break;null!=this.ExchangeHeroView&&
this.ExchangeHeroView.depose();this.viewComponent.setBagData(this.bagProxy);this.viewComponent.equipFresh();c="";switch(b.getBody()){case 1:c="\u4e92\u6362\u88c5\u5907\u6210\u529f\uff01";break;case 2:c="\u6b66\u5c06\u7b49\u7ea7\u4e0d\u591f\uff0c\u90e8\u5206\u88c5\u5907\u65e0\u6cd5\u4e92\u6362\uff01";break;case 3:c="\u6b66\u5c06\u7b49\u7ea7\u4e0d\u591f\uff0c\u88c5\u5907\u4ea4\u6362\u5931\u8d25\uff01";break;default:c="\u4e92\u6362\u88c5\u5907\u6210\u529f\uff01"}app.view.Tooltip.getInstance().show(c);
break;case app.proxy.EquipProxy.equipOnComplete:if(null==this.viewComponent)break;this.viewComponent.setBagData(this.bagProxy);this.viewComponent.equipFresh();this.SelectEquipView.setData(this.bagProxy,this.herosProxy,this.SelectEquipViewStorData);this.SelectEquipView.equipLayOut();app.view.Tooltip.getInstance().show("\u7a7f\u4e0a\u88c5\u5907\u6210\u529f!");break;case app.proxy.EquipProxy.equipUnComplete:if(null==this.viewComponent)break;this.viewComponent.setBagData(this.bagProxy);this.viewComponent.equipFresh();
this.SelectEquipView.setData(this.bagProxy,this.herosProxy,this.SelectEquipViewStorData);this.SelectEquipView.equipLayOut();app.view.Tooltip.getInstance().show("\u5378\u4e0b\u88c5\u5907\u6210\u529f!");break;case app.proxy.EquipProxy.equipUnAllComplete:if(null==this.viewComponent)break;this.viewComponent.setBagData(this.bagProxy);this.viewComponent.equipFresh();app.view.Tooltip.getInstance().show("\u5168\u90e8\u5378\u8f7d\u6210\u529f!")}},setData:function(){this.bagProxy.refreshData();this.viewComponent.setData(this.herosProxy.data,
this.formationProxy.data,this.bagProxy,this.strongTimer,this.formationProxy.getHeros());this.upUserInfo();this.viewComponent.show(this.tabId)},upUserInfo:function(){this.viewComponent.showUserInfo(this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data)},onRegister:function(){this.herosProxy=this.facade.retrieveProxy(app.proxy.HerosProxy.NAME)},onRemove:function(){this.facade.sendNotification(app.mediator.scene.HomeMediator.RESUME_RENDER);this.facade.sendNotification(app.mediator.scene.BattleMapMediator.RESUME_RENDER);
this.onClose()},onClose:function(){this.setViewComponent(null);this.indicateProxy=this.newBirthView=this.reBuildView=null},handleEvent:function(b){var c;if(null==this.userProxy)this.userProxy=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME);var e=this;switch(b.type){case app.view.system.HeroFrameView.CLOSE:this.onRemove();break;case app.view.building.DrillGroundHeros.NOJOB:c=b.data;var f=this.facade.retrieveProxy(app.proxy.BagProxy.NAME),g=this.herosProxy;app.view.Alert.getInstance().show("\u662f\u5426\u8981\u89e3\u8058 <span class='fc2'>["+
c.conf.name+"]</span> \u5417\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==b&&(f.isDownHero(c.id)?g.noJob(c):(b="<span class='fc9'>\u65e0\u6cd5\u89e3\u8058\u6b66\u5c06 <span class='fc2'>["+c.conf.name+"]</span><br />\u8bf7\u5148\u5378\u4e0b\u6b66\u5c06\u7684\u88c5\u5907\uff0c\u89e3\u8058\u5931\u8d25\u3002</span>",app.view.Tooltip.getInstance().show(b,void 0,void 0,7)))});break;case app.view.building.DrillGroundHeros.TRANSFER:c=b.data;b="";1==c.soldier[0].conf.level?20>c.level&&(b="\u6b66\u5c06\u7b49\u7ea7\u4e0d\u8db320\u7ea7\uff0c\u65e0\u6cd5\u8f6c\u804c\u3002"):
2==c.soldier[0].conf.level?40>c.level&&(b="\u6b66\u5c06\u7b49\u7ea7\u4e0d\u8db340\u7ea7\uff0c\u65e0\u6cd5\u8f6c\u804c\u3002"):3==c.soldier[0].conf.level&&(b="\u56db\u7ea7\u5175\u79cd\u8f6c\u804c\u7cfb\u7edf\u5c1a\u672a\u5f00\u53d1\uff0c\u656c\u8bf7\u671f\u5f85\u3002");""!=b?app.view.Alert.getInstance().show(b):this.herosProxy.heroTransfer(c);break;case app.view.building.DrillGroundHeros.SETDEFAULT:this.herosProxy.setDefalut(b.data);break;case app.view.building.DrillGroundHeros.CHANGE_MASTER:c=b.data;
this.herosProxy.changeMaster(c);break;case app.view.building.DrillGroundHeros.REBUILD:c=b.data;this.reBuildView=new app.view.building.DrillGroundHeroRebuild(app.GameData.GameResource.getContent("dg_heros_rebuild"));this.reBuildView.setData(c,this.herosProxy.data.needMoney);this.reBuildView.addEventListener(app.view.building.DrillGroundHeroRebuild.CHANGESOLDIER,this);this.reBuildView.addEventListener(app.view.building.DrillGroundHeroRebuild.REBUILDSOLDIER,this);this.reBuildView.addEventListener(app.view.building.DrillGroundHeroRebuild.CLOSE,
this);break;case app.view.building.DrillGroundHeroRebuild.CLOSE:this.reBuildView.depose();this.reBuildView=null;break;case app.view.building.DrillGroundHeroRebuild.CHANGESOLDIER:c=b.data;null!=c.reSoldier&&this.herosProxy.changeSoldier(c);break;case app.view.building.DrillGroundHeroRebuild.REBUILDSOLDIER:c=b.data;if(null==c||null==c.soldier)break;1<c.soldier[0].conf.level?this.reBuildSoldier(c):app.view.Alert.getInstance().show("\u5f53\u524d\u662f1\u7ea7\u5175\u79cd\u4e0d\u5efa\u8bae\u91cd\u4fee\uff0c\u8bf7\u5148\u5bf9\u6b66\u5c06\u8f6c\u804c\u3002<br />\u786e\u5b9a\u9700\u8981\u91cd\u4fee\u5417\uff1f",
["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==b&&e.reBuildSoldier(c)});break;case app.view.building.DrillGroundHeros.NEWBIRTH:c=b.data;this.newBirthView=new app.view.building.DrillGroundHeroNewBirth(app.GameData.GameResource.getContent("dg_heros_newbirth"));this.newBirthView.addEventListener(app.view.building.DrillGroundHeroNewBirth.NEWBIRTH,this);this.newBirthView.setData(c);break;case app.view.building.DrillGroundHeroNewBirth.NEWBIRTH:c=b.data;this.herosProxy.newBirthHero(c);break;case app.view.building.DrillGroundRecruit.RECRUIT_HEROINFO:c=
b.data;this.recruitHero=new app.view.building.DrillGroundRecruitPop(app.GameData.GameResource.getContent("dg_recruit_pop"));this.recruitHero.addEventListener(app.view.building.DrillGroundRecruitPop.START_RECRUIT,this);this.recruitHero.setData(c);break;case app.view.building.DrillGroundRecruitPop.START_RECRUIT:c=b.data;var b=this.herosProxy.herosMaxCount(this.userProxy.data.prestige),h=this.herosProxy.data.onJobList.length;b>h?this.userProxy.data.silverCoin>=c.conf.recruitMoney?this.herosProxy.recruitHero(c):
this.facade.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,"\u60a8\u7684\u94f6\u5e01\u4e0d\u8db3\uff0c\u767b\u7528\u8be5\u6b66\u5c06\u9700\u8981 "+c.conf.recruitMoney+"\u94f6\u5e01\u3002"):10>h?(h=app.data.DataBase.getInstance().queryOfficialInfoByCount(b+1,1),app.view.Alert.getInstance().show("\u62db\u52df\u7b2c<span class='fc2'>"+(b+1)+"</span>\u6b66\u5c06\u9700\u8981\u5b98\u804c<span class='fc2'>"+h.name+"</span>(\u5a01\u671b<span class='fc2'>"+h.value+"</span>)\u3002")):app.view.Tooltip.getInstance().show("\u60a8\u7684\u6b66\u5c06\u6570\u91cf\u5df2\u8fbe\u5230"+
h+"\u4f4d\uff0c\u4e0d\u80fd\u518d\u767b\u7528\u4e86\u3002");break;case app.view.building.DrillGroundFormation.UP:this.formationProxy.upHero(b.data);break;case app.view.building.DrillGroundFormation.DOWN:this.formationProxy.downHero(b.data);break;case app.view.building.DrillGroundFormation.SAVE:this.formationProxy.save(b.data);break;case app.view.building.DrillGroundFormation.SETDEFAULT:this.formationProxy.deFormation(b.data);break;case app.view.system.ItemUpgradeView.UPGRADE_EQUIP:this.sendNotification(app.command.CommandType.ITEM_UPGRADE,
{id:b.data.sel.id,force:b.data.force,gold:b.data.gold});break;case app.view.system.ItemUpgradeView.DEGRADE_EQUIP:1<b.data.level&&this.sendNotification(app.command.CommandType.ITEM_DOWNGRADE,{id:b.data.id,type:1});break;case app.view.system.ItemUpgradeView.CLEAR_STRONGTIMER:this.sendNotification(app.command.CommandType.CLEAR_INDICATE_TIME,this.strongTimer);break;case app.view.system.ItemUpgradeView.DEGRA_OBTAIN:-1==b.data.canObtain?this.sendNotification(app.command.CommandType.ITEM_DOWNGRADE,{id:b.data.id,
type:2}):this.sendNotification(app.command.CommandType.ITEM_GET,b.data.id);break;case app.view.system.ItemUpgradeView.SELL_EQUIP:this.sendNotification(app.command.CommandType.ITEM_SELL,b.data.id);break;case app.view.system.ItemUpgradeView.ADD_BAGSIZE:app.view.Alert.getInstance().show("\u8d2d\u4e70\u4e00\u4e2a\u80cc\u5305\u4f4d\u9700\u8981\u82b1\u8d39"+this.bagProxy.bagPrice+"\u4e2a\u91d1\u5e01\uff0c\u786e\u5b9a\u8981\u8d2d\u4e70\u5417\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==b&&e.sendNotification(app.command.CommandType.ADD_BAGSIZE)});
break;case app.view.system.ItemUpgradeView.ITEM_TIMEOUT:this.bagProxy.refreshData();break;case app.view.building.EquipView.SelectEquip:this.SelectEquipView=new app.view.building.SelectEquipView(app.GameData.GameResource.getContent("selectEquip"));this.SelectEquipView.setData(this.bagProxy,this.herosProxy,b.data);this.SelectEquipViewStorData=b.data;this.SelectEquipView.equipLayOut();this.SelectEquipView.addEventListener(app.view.building.SelectEquipView.CLOSE,this);this.SelectEquipView.addEventListener(app.view.building.SelectEquipView.onEquip,
this);this.SelectEquipView.addEventListener(app.view.building.SelectEquipView.unEquip,this);break;case app.view.building.SelectEquipView.CLOSE:this.SelectEquipView.depose();this.SelectEquipView=null;break;case app.view.building.SelectEquipView.onEquip:h=this.herosProxy.getHeroVO(b.data.heroId).level;this.bagProxy.getItemData(b.data.equipmentId).conf.useLevel<=h?this.facade.retrieveProxy(app.proxy.EquipProxy.NAME).equipOn(b.data):app.view.Tooltip.getInstance().show("\u6b66\u5c06\u7b49\u7ea7\u4e0d\u591f\uff01");
break;case app.view.building.SelectEquipView.unEquip:h=this.bagProxy.bagEmpty;0<h?this.facade.retrieveProxy(app.proxy.EquipProxy.NAME).equipUn(b.data):app.view.Tooltip.getInstance().show("\u80cc\u5305\u4e0d\u8db3\uff01");break;case app.view.building.EquipView.ExhcangeHero:if(1>=this.herosProxy.data.onJobList.length){app.view.Tooltip.getInstance().show("\u6ca1\u6709\u53ef\u4e92\u6362\u88c5\u5907\u7684\u6b66\u5c06\uff01");break}this.ExchangeHeroView=new app.view.building.SelectHeroView(app.GameData.GameResource.getContent("selectHero"));
this.ExchangeHeroView.setData(this.herosProxy,b.data);this.ExchangeHeroView.heroLayOut();this.ExchangeHeroView.addEventListener(app.view.building.SelectHeroView.CLOSE,this);this.ExchangeHeroView.addEventListener(app.view.building.SelectHeroView.ExchangeHeroEquip,this);break;case app.view.building.SelectHeroView.CLOSE:this.ExchangeHeroView.depose();this.ExchangeHeroView=null;break;case app.view.building.SelectHeroView.ExchangeHeroEquip:this.facade.retrieveProxy(app.proxy.EquipProxy.NAME).exchangeHeroEquip(b.data);
break;case app.view.building.EquipView.UnAllEquip:var h=this.bagProxy.bagEmpty,j=this.bagProxy.getHeroItem(b.data).length;if(0==j){app.view.Tooltip.getInstance().show("\u8be5\u6b66\u5c06\u6ca1\u6709\u88c5\u5907 !");break}j>h?app.view.Tooltip.getInstance().show("\u80cc\u5305\u4e0d\u8db3\uff01"):(h={},h.heroId=b.data,this.facade.retrieveProxy(app.proxy.EquipProxy.NAME).unAllEquip(h))}},reBuildSoldier:function(b){var c=this.herosProxy.data.needMoney,e=this,f=function(c){0==c&&e.herosProxy.rebuildSoldier(b)};
0<c?app.view.Alert.show("\u91cd\u4fee\u5175\u79cd\u9700\u8981\u82b1\u8d39<span class='fc2'>"+c+"\u91d1\u5e01</span><br />\u662f\u5426\u786e\u5b9a\u8981\u91cd\u4fee\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],f):app.view.Alert.show("\u672c\u6b21\u91cd\u4fee\u4e3a\u514d\u8d39\u91cd\u4fee<br />\u662f\u5426\u786e\u5b9a\u8981\u91cd\u4fee\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],f)}},{NAME:"HeroMediator",SHOW:"HeroMediator_Show",CLOSE:"HeroMediator_Close",START_RECRUIT:"HeroMediator_Start_recruit"});puremvc.define({name:"app.mediator.building.HubuMediator",parent:puremvc.Mediator},{listNotificationInterests:function(){return[app.mediator.building.HubuMediator.SHOW,app.mediator.building.HubuMediator.SHOWLEVELUP,app.proxy.WorkShopProxy.PRODUCT,app.proxy.WorkShopProxy.SELL,app.proxy.WorkShopProxy.FORCE_PRODUCT,app.proxy.WorkShopProxy.FORCE_CD,app.proxy.LevyProxy.CHANGED,app.proxy.IndicateProxy.CHANGED,app.proxy.LevyProxy.SHOWREWARDS]},handleNotification:function(b){switch(b.getName()){case app.mediator.building.HubuMediator.SHOW:this.sendNotification(app.mediator.scene.HomeMediator.STOP_RENDER);
this.userInfo=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data;this.levyProxy=this.facade.retrieveProxy(app.proxy.LevyProxy.NAME);this.workShopProxy=this.facade.retrieveProxy(app.proxy.WorkShopProxy.NAME);this.indicateProxy=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME);this.lTimer=this.indicateProxy.getIndicateDataByType(app.proxy.IndicateProxy.TYPE_6);this.wTimer=this.indicateProxy.getIndicateDataByType(app.proxy.IndicateProxy.TYPE_2);var c=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).isBuildingShow(16);
this.setViewComponent(new app.view.building.HubuFrameView(app.GameData.GameResource,c));var e=[!1,!1],f=function(c){e[c]=!0;e[0]&&e[1]&&this.show(b.getBody())};this.levyProxy.getLevyInfo(ClassUtils.delegate(this,f,0));c?this.workShopProxy.loadData(ClassUtils.delegate(this,f,1)):f(1);break;case app.proxy.LevyProxy.SHOWREWARDS:if(null==this.viewComponent)break;c=b.getBody();c instanceof String?this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,c):this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_REWARDS,
c);break;case app.proxy.IndicateProxy.CHANGED:case app.proxy.LevyProxy.CHANGED:null!=this.viewComponent&&this.viewComponent.updateLevyData();break;case app.proxy.WorkShopProxy.PRODUCT:null!=this.viewComponent&&this.viewComponent.updateGoodInfo(b.getBody());break;case app.proxy.WorkShopProxy.SELL:null!=this.viewComponent&&this.viewComponent.updateGoodInfo(b.getBody());break;case app.proxy.WorkShopProxy.FORCE_PRODUCT:null!=this.viewComponent&&this.viewComponent.updateGoodInfo(b.getBody())}},handleEvent:function(b){var c=
this;switch(b.type){case app.view.building.LevyView.FORCED_LEVY:this.userInfo.goldCoin<this.levyProxy.data.forcedGoldCoin?this.sendNotification(app.command.CommandType.PAY):this.levyProxy.forcedLevy();break;case app.view.building.LevyView.LEVY:var e=function(){c.levyProxy.levy()};this.lTimer&&0<this.lTimer.time.getTime()?c.sendNotification(app.command.CommandType.CLEAR_TIME_HANDLE,{timer:b.data,handle:ClassUtils.delegate(this,e)}):e();break;case app.view.building.LevyView.CLEAR_FREEZE:this.sendNotification(app.command.CommandType.CLEAR_INDICATE_TIME,
b.data);break;case app.view.building.LevyView.CHOOSE:this.levyProxy.data.incident=0;this.levyProxy.levyIncident(b.data+1);break;case app.view.building.WorkShopView.PRODUCT:this.indicate=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_2);c=this;e=function(){c.workShopProxy.productGood(b.data)};0<this.workShopProxy.data.remainProduceNum?1==b.data[1]?this.userInfo.goldCoin>=app.view.building.WorkShopView.CRIT_GOLD?null==this.indicate||this.indicate&&
!0==this.indicate.full?this.sendNotification(app.command.CommandType.CLEAR_TIME_HANDLE,{timer:this.indicate,handle:ClassUtils.delegate(this,e)}):e():this.sendNotification(app.command.CommandType.PAY):null==this.indicate||this.indicate&&!0==this.indicate.full?this.sendNotification(app.command.CommandType.CLEAR_TIME_HANDLE,{timer:this.indicate,handle:ClassUtils.delegate(this,e)}):e():this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">\u751f\u4ea7\u6b21\u6570\u5df2\u7528\u5b8c</label>');
break;case app.view.building.WorkShopView.SELL:b.data&&0<b.data.stock?this.workShopProxy.sellGood(b.data):this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,'<label class="fc9">\u5e93\u5b58\u4e0d\u8db3</label>');break;case app.view.building.WorkShopView.FORCE_PRODUCT:this.userInfo.goldCoin>=this.workShopProxy.data.forceGoldNeeded?1==b.data[1]?this.userInfo.goldCoin>=app.view.building.WorkShopView.CRIT_GOLD+this.workShopProxy.data.forceGoldNeeded?this.workShopProxy.forceProductGood(b.data):
this.sendNotification(app.command.CommandType.PAY):this.workShopProxy.forceProductGood(b.data):this.sendNotification(app.command.CommandType.PAY);break;case app.view.building.WorkShopView.FORCE_CD:this.sendNotification(app.command.CommandType.CLEAR_INDICATE_TIME,b.data);break;case app.view.building.HubuFrameView.CLOSE:this.sendNotification(app.mediator.scene.HomeMediator.RESUME_RENDER),this.viewComponent=null}},show:function(b){var c=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.HuBu).level;
this.viewComponent.addEventListener(app.view.building.HubuFrameView.CLOSE,this);this.viewComponent.addEventListener(app.view.building.LevyView.CHOOSE,this);this.viewComponent.addEventListener(app.view.building.LevyView.CLEAR_FREEZE,this);this.viewComponent.addEventListener(app.view.building.LevyView.LEVY,this);this.viewComponent.addEventListener(app.view.building.LevyView.FORCED_LEVY,this);this.viewComponent.addEventListener(app.view.building.WorkShopView.PRODUCT,this);this.viewComponent.addEventListener(app.view.building.WorkShopView.SELL,
this);this.viewComponent.addEventListener(app.view.building.WorkShopView.FORCE_PRODUCT,this);this.viewComponent.addEventListener(app.view.building.WorkShopView.FORCE_CD,this);this.viewComponent.setData(c,this.levyProxy.data,this.workShopProxy.data,this.lTimer,this.wTimer,this.indicate,this.userInfo);this.viewComponent.show(b)}},{NAME:"HubuMediator",SHOWLEVELUP:"Hubu_ShowLevelUp",SHOW:"Hubu_Show"});puremvc.define({name:"app.proxy.DataService"},{facade:null,showLoading:!0,getService:function(b,c,e,f,g,h,j){if("get"==e){b+="?";if(c){var e="",k;for(k in c)e+=k+"="+c[k]+"&";b+=e}b+="r="+Math.random();b=this.appendUrlParam(b);b=Http.get(b)}else b+="?r="+Math.random(),b=this.appendUrlParam(b),b=Http.post(b,c);b.onData=ClassUtils.delegate(this,this.onComplete,f,g);b.onError=ClassUtils.delegate(this,this.onError,f,g);this.error=j;h||this.facade.sendNotification(app.mediator.system.LoadMediator.SHOW,
"\u52a0\u8f7d\u6e38\u620f\u6570\u636e\u4e2d...")},appendUrlParam:function(b){_DEBUG?(b+="&serverId="+app.GameData.serverId,b+="&uid="+app.GameData.uid):b+="&serverId="+app.GameData.serverId;return b},onComplete:function(b,c,e){this.facade.sendNotification(app.mediator.system.LoadMediator.CLOSE);var f;try{f=JSON.parse(b)}catch(g){e=b.split("\n");alert("error:"+e[0]);return}for(var h in f.result)if("main"!=h&&(b=app.proxy.ProxyManager.getInstance().getProxyName(h),null!=b))this.facade.retrieveProxy(b).onUpdate(f.result[h]);
if(f.result.error){if(c=f.result.error[0],c=c.msg.split("\n")[0],app.view.Alert.getInstance().show(c),null!=e.onError)e.onError(c)}else null!=c?c.call(e,f.result.main):null!=e.onComplete&&e.onComplete.call(e,f.result.main)},onError:function(b,c,e){this.facade.sendNotification(app.mediator.system.LoadMediator.CLOSE);app.view.Tooltip.getInstance().show("\u7f51\u7edc\u8fde\u63a5\u4e2d\u65ad\uff0c\u8bf7\u91cd\u65b0\u5237\u65b0\u6e38\u620f\uff01");e.onError&&e.onError.call(e,b);this.error&&null!=e.onComplete&&
e.onComplete.call(e,null)}},{_instance:null,getInstance:function(){var b=app.proxy.DataService;if(null==b._instance)b._instance=new app.proxy.DataService;return b._instance}});puremvc.define({name:"app.proxy.BaseDataProxy",parent:puremvc.Proxy,constructor:function(){puremvc.Proxy.call(this);this.dataService=app.proxy.DataService.getInstance()}},{getService:function(b,c,e,f,g,h){this.dataService.getService(b,c,e,f,this,g,h)},onComplete:function(){},onError:function(){},onUpdate:function(b){this.setData(b)}},{NAME:"BaseDataProxy"});puremvc.define({name:"app.proxy.ResourceProxy",parent:puremvc.Proxy},{cacheResource:null,preLoadResource:null},{NAME:"Resourceproxy"});puremvc.define({name:"app.proxy.HomeProxy",parent:app.proxy.BaseDataProxy,constructor:function(){app.proxy.BaseDataProxy.call(this)}},{init:function(){for(var b=app.data.HomeBuildingData,c=b.Building,e=[],f,g=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME),h=c.length,j=0;j<h;j++)f=clone(c[j]),f.src=b.Path+toFix(c[j].id,2)+".png",f.visible=null!=g.getBuildInfo(c[j].id),e.push(f);this.setData(e)},addBuilding:function(b){for(var c=this.data.length,e=0;e<c;e++)if(this.data[e].id==b||null!=this.data[e].builds&&
0<=this.data[e].builds.indexOf(b))return this.data[e].visible=!0,this.data[e];return null},getBuildingInfo:function(b){for(var c=this.data.length,e=0;e<c;e++)if(this.data[e].id==b)return this.data[e];return null},getHomeMapInfo:function(){return{id:"homeBg",src:app.GameData.imageSrc+"scene/home.gif"}}},{NAME:"HomeProxy"});puremvc.define({name:"app.proxy.LevelUpProxy",parent:app.proxy.BaseDataProxy},{first:!0,homeCityVo:null,levelUp:function(b,c){this.complteHandler=c;var e={id:b};this.getService(app.getServiceURL()+"increaseBuilding.json",e,"post")},onComplete:function(b){this.setData([b]);if(this.complteHandler)this.complteHandler(),this.complteHandler=null;this.sendNotification(app.proxy.LevelUpProxy.COMPLETE,b)},onUpdate:function(b){this.setData(b);this.sendNotification(app.proxy.LevelUpProxy.CHANGED)},setData:function(b){if(!this.data)this.data=
[];for(var c=!1,e=this.data.length,f=0;f<b.length;f++)if(null!=b[f].id){for(var c=!1,g=0;g<e;g++)if(b[f].id==this.data[g].id){c=!0;this.data[g].update(b[f]);break}c||(c=new app.data.BuildingVO,c.update(b[f]),this.data.push(c),this.first||(c=this.facade.retrieveProxy(app.proxy.HomeProxy.NAME).addBuilding(c.id),this.sendNotification(app.mediator.scene.HomeMediator.ADD_BUILDING,c)))}if(this.first)this.first=!1},getBuildInfo:function(b){for(var c=this.data.length,e=0;e<c;e++)if(this.data[e].id==b)return this.data[e];
return null},getBuildingLevel:function(b){for(var c=this.data.length,e=0;e<c;e++)if(this.data[e].id==b.id||b.builds&&this.data[e].id==b.builds[0])return this.data[e].level;return null},isBuildingShow:function(b){var c=app.data.HomeBuildingData.limit;if(8==b){c=app.data.HomeBuildingData.tradeLimit;b=0;if(null==this.techCityVo)this.techCityVo=this.getBuildInfo(app.data.HomeBuildingData.STRATEGY);return this.techCityVo.level>=c[b]}if(null==this.homeCityVo)this.homeCityVo=this.getBuildInfo(app.data.HomeBuildingData.HALL);
return this.homeCityVo.level>=c[b]}},{NAME:"LevelUpProxy",COMPLETE:"LevelUp_Complete",CHANGED:"LevelUpProxy_Changed"});puremvc.define({name:"app.proxy.UserInfoProxy",parent:app.proxy.BaseDataProxy},{onUpdate:function(b){for(var c=0;c<b.length;c++)this.setData(b[c]);this.sendNotification(app.proxy.UserInfoProxy.CHANGED)},setData:function(b){if(!this.data)this.data=new app.data.UserVO;this.data.update(b)},selectCountry:function(b,c){this.getService(app.getServiceURL()+"chooseCountry.json",{cid:b},"post",function(){c&&c()})},buyWarToken:function(b){this.getService(app.getServiceURL()+"buyWarToken.json",null,"post",b)}},
{NAME:"UserInfoProxy",CHANGED:"UserInfoProxy_Changed"});puremvc.define({name:"app.proxy.StrategyProxy",parent:app.proxy.BaseDataProxy},{loadData:function(){this.getService(app.getServiceURL()+"enterTech.json",null,null,this.loadDataComplete)},loadDataComplete:function(b){this.data={};var c,e,f,g,h,j,k,l,m,o;o=app.data.DataBase.getInstance().getTechDataInit();for(var q in b)if("techs"==q){j=b.techs;c=j.length;k=[];l=[];m=[];g=o.length;for(f=0;f<g;f++){h=o[f];for(e=0;e<c;e++)if(h.id==j[e].id)h.level=j[e].level;h.conf.typeId==app.proxy.StrategyProxy.TYPE_TECHNOLOGY?
k.push(h):h.conf.typeId==app.proxy.StrategyProxy.TYPE_FORMATION?l.push(h):m.push(h)}this.data.technologys=k;this.data.formations=l;this.data.trade=m}this.data.cdTime=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_5);this.sendNotification(app.proxy.StrategyProxy.COMPLETE,this.data)},levelUp:function(b){b={techid:b.id};this.getService(app.getServiceURL()+"increaseTech.json",b,null,this.levelUpComplete)},levelUpComplete:function(b){this.strategyUpdate(b.id,
b.level);this.data.cdTime=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_5);this.sendNotification(app.proxy.StrategyProxy.LEVEL_UP)},strategyUpdate:function(b,c){var e,f;e=new app.data.StrategyVO(b);if(e.conf.typeId==app.proxy.StrategyProxy.TYPE_TECHNOLOGY){e=this.data.technologys.length;for(f=0;f<e;f++)if(this.data.technologys[f].id==b)this.data.technologys[f].level=c}else if(e.conf.typeId==app.proxy.StrategyProxy.TYPE_FORMATION){e=this.data.formations.length;
for(f=0;f<e;f++)if(this.data.formations[f].id==b)this.data.formations[f].level=c}else{e=this.data.trade.length;for(f=0;f<e;f++)if(this.data.trade[f].id==b)this.data.trade[f].level=c}},onUpdate:function(b){if(this.data&&this.data.technologys&&this.data.formations&&this.data.trade&&b){var c,e,f,g,h,j;g=b.length;for(f=0;f<g;f++){h=new app.data.StrategyVO(b[f].id);j=h.conf.typeId==app.proxy.StrategyProxy.TYPE_TECHNOLOGY?this.data.technologys:h.conf.typeId==app.proxy.StrategyProxy.TYPE_FORMATION?this.data.formations:
this.data.trade;e=j.length;for(c=0;c<e;c++)if(j[c].id==h.id)j[c].level=h.level}}}},{NAME:"StrategyProxy",COMPLETE:"Strategy_Load_Complete",UPDATE:"StrategyProxy_Update",TYPE_TECHNOLOGY:1,TYPE_FORMATION:2,TYPE_TRADE:3,LEVEL_UP:"levelUp"});puremvc.define({name:"app.proxy.GameInfoProxy",parent:app.proxy.BaseDataProxy},{sceneMediatorName:"",onUpdate:function(b){for(var c=this.facade.retrieveProxy(app.proxy.ChatProxy.NAME),e=0;e<b.length;e++)if(this.setData(b[e]),null!=b[e].time)c.time=b[e].time;this.sendNotification(app.proxy.GameInfoProxy.CHANGED)},setData:function(b){if(!this.data)this.data=new app.data.GameVO;b.year&&(this.data.year=b.year);b.season&&(this.data.season=b.season);b.warTokenCost&&(this.data.warTokenCost=b.warTokenCost);
b.time&&(this.data.time=b.time);b.notice&&(this.data.notice=b.notice)},getSeasonDesc:function(){return["\u73b0\u5728\u662f#\u5e74\u6625\u5b63\uff0c\u6625\u5b63\u519b\u4ee4\u6062\u590d+1\u3002","\u73b0\u5728\u662f#\u5e74\u590f\u5b63\uff0c\u6700\u5927\u53ef\u5f81\u6536\u7684\u6b21\u6570+3","\u73b0\u5728\u662f#\u5e74\u79cb\u5b63\uff0c\u519c\u7530\u4ea7\u91cf\u589e\u52a020%","\u73b0\u5728\u662f#\u5e74\u51ac\u5b63\uff0c\u7981\u6b62\u4efb\u4f55\u5f62\u5f0f\u7684\u73a9\u5bb6\u5bf9\u6218"][this.data.season-
1].replace("#",this.data.year)}},{NAME:"GameInfoProxy",CHANGED:"GameInfoProxy_Changed"});puremvc.define({name:"app.proxy.IndicateProxy",parent:app.proxy.BaseDataProxy},{buildingIndsmall:null,onComplete:function(b){this.setData(b);this.sendNotification(app.proxy.IndicateProxy.COMPLETE)},onUpdate:function(b){this.setData(b);this.sendNotification(app.proxy.IndicateProxy.CHANGED)},setData:function(b){if(!(null==b||0>=b.length)){if(null==this.data)this.data=[];for(var c=!1,e,f=0;f<b.length;f++)e=this.getIndicateDataById(b[f].id),null==e&&(e=new app.data.IndicateVO,this.data.push(e),c=!0),
e.update(b[f]);!0==c&&(sortOn(this.data,"index"),this.sendNotification(app.proxy.IndicateProxy.ADD))}},getIndicateDataById:function(b){for(var c,e=0;e<this.data.length;e++)if(b==this.data[e].id){c=this.data[e];this.updateFull(c);break}return c},getIndicateDataByType:function(b){for(var c,e=[],f=0;f<this.data.length;f++)if(b==this.data[f].type)if(c=this.data[f],this.updateFull(c),7==b)e.push(c);else{e=c;break}return e},updateFull:function(b){if(null!=b.full&&0>=b.time.getTime())b.full=!1},buildingFull:function(){var b=
this.getIndicateDataByType(app.proxy.IndicateProxy.TYPE_7);this.buildingIndsmall=null;for(var c in b){if(null==this.buildingIndsmall||b[c].time.getTime()<this.buildingIndsmall.time.getTime())this.buildingIndsmall=b[c];if(!b[c].full)return!1}return!0},clearCoolTime:function(b,c){this.getService(app.getServiceURL()+"cdReset.json",{id:b},"post",function(){null!=c&&c(b)})},addBuildingQueue:function(){this.getService(app.getServiceURL()+"addBuildingQueue.json",null,"post")}},{NAME:"IndicateProxy",COMPLETE:"IndicateProxy_Complete",
ADD:"IndicateProxy_Add",CHANGED:"IndicateProxy_Changed",TYPE_1:1,TYPE_2:2,TYPE_3:3,TYPE_4:4,TYPE_5:5,TYPE_6:6,TYPE_7:7,TYPE_8:8,TYPE_9:9,TYPE_10:10,TYPE_11:11,TYPE_12:12,TYPE_13:13});puremvc.define({name:"app.proxy.InitProxy",parent:app.proxy.BaseDataProxy},{getInitInfo:function(b){this.completeHanlder=b;this.getService(app.getServiceURL()+"init.json")},onComplete:function(b){this.completeHanlder?(this.completeHanlder(),this.completeHanlder=null):this.sendNotification(app.proxy.LevelUpProxy.COMPLETE,b)}},{NAME:"InitProxy",COMPLETE:"InitProxy_Complete"});puremvc.define({name:"app.proxy.HerosProxy",parent:app.proxy.BaseDataProxy,constructor:function(){app.proxy.BaseDataProxy.call(this)}},{currValue:null,loadData:function(b){if(null!=b)this.handle=b;this.getService(app.getServiceURL()+"heros.json",null,null,this.loadDataComplete)},loadDataComplete:function(b){if(this.handle)this.handle(),this.handle=null;this.maxTime=120;this.time=0;this.data={};this.data.timeConf=[[1,0,0],[4,500,0],[8,2E3,0],[24,0,5],[72,0,50]];this.data.trainConf=[["\u4e00\u822c",
0],["\u4e25\u683c",1],["\u5669\u68a6",5],["\u5730\u72f1",20],["\u65e0\u53cc",50]];var c,e,f,g,h,j,k,l;for(l in b)if("herosList"==l){j=b.herosList;c=j.length;g=[];h=[];k=[];for(e=0;e<c;e++){f=new app.data.HeroVO(j[e].id);f.level=j[e].level;f.hp=j[e].hp;f.onJob=j[e].onJob;f.newBirth=j[e].newBirth;if(null!=j[e].train)f.train=j[e].train,f.train.time=new app.data.TimeVO(f.train.time),k.push(f);f.exp=j[e].exp;f.maxExp=j[e].maxExp;f.defaultSoldier=j[e].defaultSoldier;f.soldier=this.getSoldier(j[e].soldier);
if(null!=j[e].reSoldier)f.reSoldier=this.getSoldier(j[e].reSoldier);!0==f.onJob?g.push(f):h.push(f)}this.data.trainHeros=k;this.data.trainCount=k.length;this.data.onJobList=g;this.data.noJobList=h;app.controller.TimeController.getInstance().addListener(this)}else"formation"==l?this.facade.retrieveProxy(app.proxy.FormationProxy.NAME).setDefalut(b[l]):this.data[l]=b[l];this.sendNotification(app.proxy.HerosProxy.COMPLETE,this.data)},step:function(){this.time++;if(this.time>this.maxTime){if(0<this.data.trainHeros.length)this.onTraining();
this.time=0}},getSoldier:function(b){if(null==b)return null;for(var c=[],e,f=0;f<b.length;f++)e=new app.data.SoldierVO(b[f]),c.push(e);sortOn(c,"conf.soldierType");return c},onTraining:function(){this.getService(app.getServiceURL()+"hero/ontraining.json",null,null,this.onTrainingComplete,!0)},onTrainingComplete:function(b){if(null!=b.herosList){var c=b.herosList,e=c.length;this.data.trainHeros=[];b=this.data.onJobList.length;if(0<e)for(e=0;e<b;e++){var f=this.getArrayVo(c,this.data.onJobList[e].id);
null!=f?(this.data.onJobList[e].level=f.level,this.data.onJobList[e].exp=f.exp,this.data.onJobList[e].maxExp=f.maxExp,this.data.onJobList[e].hp=f.hp,this.data.onJobList[e].train=f.train,this.data.onJobList[e].train.time=new app.data.TimeVO(f.train.time),this.data.trainHeros.push(this.data.onJobList[e])):this.data.onJobList[e].train=null}else{b=this.data.onJobList.length;for(c=0;c<b;c++)this.data.onJobList[c].train=null}this.sendNotification(app.proxy.HerosProxy.HEROS_LIST_CHANGED);this.sendNotification(app.proxy.HerosProxy.HERO_INFO_CHANGED)}},
getArrayVo:function(b,c){for(var e=b.length,f=0;f<e;f++)if(b[f].id==c)return b[f];return null},accelerate:function(b){this.getService(app.getServiceURL()+"hero/train/accelerate.json",{hid:b.id},null,this.accelerateComplete)},accelerateComplete:function(b){var c=this.getHeroVO(b.id);if(null!=c)c.level=b.level,c.exp=b.exp,c.hp=b.hp,c.maxExp=b.maxExp,this.sendNotification(app.proxy.HerosProxy.HERO_INFO_CHANGED)},addLocation:function(){this.getService(app.getServiceURL()+"hero/train/addpos.json",null,
null,this.addLocationComplete)},addLocationComplete:function(b){this.data.trainQueue=b.trainQueue;this.sendNotification(app.proxy.HerosProxy.HEROS_LIST_CHANGED)},noJob:function(b){this.getService(app.getServiceURL()+"hero/offduty.json",{hid:b.id},null,this.noJobComplete)},noJobComplete:function(b){for(var c,e=this.data.onJobList.length,f=0;f<e;f++)if(this.data.onJobList[f].id==b.id){c=this.data.onJobList.splice(f,1)[0];break}this.delTrainHero(b.id);this.data.noJobList.push(c);this.sendNotification(app.proxy.HerosProxy.HEROS_LIST_CHANGED)},
delTrainHero:function(b){for(var c=this.data.trainHeros.length,e=0;e<c;e++)if(this.data.trainHeros[e].id==b){this.data.trainHeros.splice(e,1);break}},heroTransfer:function(b){this.getService(app.getServiceURL()+"hero/changeCareer.json",{hid:b.id},null,this.transferComplete)},transferComplete:function(b){var c=this.getHeroVO(b.id);if(null!=c)c.defaultSoldier=b.defaultSoldier,c.soldier=this.getSoldier(b.soldier);this.sendNotification(app.proxy.HerosProxy.HERO_INFO_CHANGED)},setDefalut:function(b){this.getService(app.getServiceURL()+
"hero/assignDefaultSoldier.json",b,null,this.setdefalutComplete)},setdefalutComplete:function(b){var c=this.getHeroVO(b.id);if(null!=c)c.defaultSoldier=b.defaultSoldier;this.sendNotification(app.proxy.HerosProxy.HERO_INFO_CHANGED)},changeSoldier:function(b){this.getService(app.getServiceURL()+"hero/replacesoldier.json",{hid:b.id},null,this.changeSoldierComplete)},changeSoldierComplete:function(b){var c=this.getHeroVO(b.id);if(null!=c)c.defaultSoldier=b.defaultSoldier,c.soldier=this.getSoldier(b.soldier),
c.reSoldier=null!=b.reSoldier?this.getSoldier(b.reSoldier):null;this.sendNotification(app.proxy.HerosProxy.HERO_INFO_CHANGED,c)},rebuildSoldier:function(b){this.getService(app.getServiceURL()+"hero/repractice.json",{hid:b.id},null,this.rebuildSoldierComplete)},rebuildSoldierComplete:function(b){var c=this.getHeroVO(b.id);null!=b.needMoney&&(this.data.needMoney=b.needMoney);if(null!=b.soldier&&null!=c)c.reSoldier=this.getSoldier(b.soldier),this.sendNotification(app.proxy.HerosProxy.HERO_INFO_CHANGED,
c)},newBirthHero:function(b){this.getService(app.getServiceURL()+"hero/reborn.json",{hid:b.id},null,this.newBirthComplete)},newBirthComplete:function(b){var c=this.getHeroVO(b.id);if(null!=c){if(null!=b.newBirth)c.newBirth=b.newBirth;if(null!=b.level)c.level=b.level;if(null!=b.hp)c.hp=b.hp;if(null!=b.exp)c.exp=b.exp;if(null!=b.maxExp)c.maxExp=b.maxExp;this.sendNotification(app.proxy.HerosProxy.HERO_INFO_CHANGED)}},startTrain:function(b){this.currValue=b;this.getService(app.getServiceURL()+"hero/train/begin.json",
{hid:b.hid,tid:b.time,mid:b.type},null,this.startTrainComplete)},startTrainComplete:function(){var b=this.getHeroVO(this.currValue.hid);if(null!=b)b.train={hour:this.currValue.time,type:this.currValue.type,time:3600*this.data.timeConf[this.currValue.time-1][0]},b.train.time=new app.data.TimeVO(b.train.time),this.data.trainHeros.push(b),this.data.trainCount=this.data.trainHeros.length,this.sendNotification(app.proxy.HerosProxy.HEROS_LIST_CHANGED)},changeMaster:function(b){this.currValue=b.id;this.getService(app.getServiceURL()+
"hero/assignLord.json",{hid:b.id},null,this.changeMasterComplete)},changeMasterComplete:function(){this.data.commander=this.currValue;this.sendNotification(app.proxy.HerosProxy.HEROS_LIST_CHANGED)},overTrain:function(b,c){null==c&&(c=!1);this.getService(app.getServiceURL()+"hero/train/cancel.json",{hid:b.id},null,this.overTrainComplete,c)},overTrainComplete:function(b){for(var c=this.data.trainHeros.length,e,f=0;f<c;f++)if(e=this.data.trainHeros[f],e.id==b.id){c=this.data.trainHeros.splice(f,1)[0];
c.level=b.level;c.exp=b.exp;c.hp=b.hp;c.maxExp=b.maxExp;c.train=null;break}this.data.trainCount=this.data.trainHeros.length;this.sendNotification(app.proxy.HerosProxy.HEROS_LIST_CHANGED)},recruitHero:function(b){this.getService(app.getServiceURL()+"hero/onduty.json",{hid:b.id},null,this.recruitHeroComplete)},recruitHeroComplete:function(b){for(var c=0;c<this.data.noJobList.length;c++)if(this.data.noJobList[c].id==b.id){this.data.noJobList.splice(c,1);break}c=new app.data.HeroVO(b.id);c.level=b.level;
c.hp=b.hp;c.onJob=b.onJob;c.newBirth=b.newBirth;c.exp=b.exp;c.maxExp=b.maxExp;c.defaultSoldier=b.defaultSoldier;c.soldier=this.getSoldier(b.soldier);this.data.onJobList.push(c);this.sendNotification(app.proxy.HerosProxy.HEROS_LIST_CHANGED)},onUpdate:function(b){if(null!=this.data){var c=!1;if(null!=b[0].commander&&this.data.commander!=b[0].commander)this.data.commander=b[0].commander,c=!0;if(null!=this.data&&null!=b[0].herosList&&null!=this.data.noJobList){for(var b=b[0].herosList,c=b.length,e=0;e<
c;e++){var f=!1,g=this.getHeroVO(b[e].id,!0);if(null==g&&(g=new app.data.HeroVO(b[e].id),f=!0,g.defaultSoldier=b[e].defaultSoldier,g.soldier=this.getSoldier(b[e].soldier),1==g.conf.isTalk))app.GameData.hero={name:g.conf.name,pic:g.conf.pic};g.level=b[e].level;g.hp=b[e].hp;g.onJob=b[e].onJob;g.newBirth=b[e].newBirth;g.exp=b[e].exp;g.maxExp=b[e].maxExp;!0==f&&(!0==g.onJob?this.data.onJobList.push(g):this.data.noJobList.push(g))}c=!0}!0==c&&this.sendNotification(app.proxy.HerosProxy.HEROS_LIST_CHANGED)}},
getHeroVO:function(b,c){var e,f=this.data.onJobList;!0==c&&(f=f.concat(this.data.noJobList));for(var g in f)if(e=f[g],e.id==b)return e;return null},herosMaxCount:function(b){b=app.data.DataBase.getInstance().getOfficialByPrestige(b);return null==b?3:b.heroNum}},{NAME:"HerosProxy",COMPLETE:"HerosProxy_complete",CHANGED:"HerosProxy_changed",HEROS_LIST_CHANGED:"Heros_list_changed",HERO_INFO_CHANGED:"hero_info_changed"});puremvc.define({name:"app.proxy.HeroProxy",parent:app.proxy.BaseDataProxy,constructor:function(){app.proxy.BaseDataProxy.call(this)}},{onUpdate:function(b){if(null!=b){var c=this.facade.retrieveProxy(app.proxy.HerosProxy.NAME);if(null!=c.getData()){for(var e=b.length,f=0;f<e;f++){var g=c.getHeroVO(b[f].id);if(null!=g)g.level=b[f].level,g.hp=b[f].hp,g.exp=b[f].exp,g.maxExp=b[f].maxExp}this.sendNotification(app.proxy.HerosProxy.HEROS_LIST_CHANGED)}}}},{NAME:"HeroProxy"});puremvc.define({name:"app.proxy.FarmProxy",parent:app.proxy.BaseDataProxy},{isEmpty:!0,getPreGrainInfo:function(){this.getService(app.getServiceURL()+"enterFarm.json",null,"post",this.onComplete)},getShInfo:function(){this.getService(app.getServiceURL()+"reapFarm.json",null,"post",this.shComplete)},onComplete:function(b){this.setData(b);this.sendNotification(app.proxy.FarmProxy.COMPLETE)},shComplete:function(b){this.setData(b);this.sendNotification(app.proxy.FarmProxy.ShCOMPLETE)},onUpdate:function(b){this.setData(b);
this.sendNotification(app.proxy.FarmProxy.CHANGED)},setData:function(b){if(!this.data)this.data=new app.data.FarmVO,this.data.update(b),this.isEmpty=!1}},{NAME:"FarmProxy",CHANGED:"Farm_CHANGE",COMPLETE:"Farm_COMPLETE",ShCOMPLETE:"sh_COMPLETE"});puremvc.define({name:"app.proxy.BagProxy",parent:app.proxy.BaseDataProxy},{bagList:null,storageList:null,stongList:null,storageAllList:null,heroWeaponList:null,selectEquip:null,totalBagNum:0,bagPrice:0,bagEmpty:0,strongRate:0,strongTrend:0,getBagInfo:function(){this.getService(app.getServiceURL()+"bag.json")},lockEquip:function(b){selectEquip=b;this.getService(app.getServiceURL()+"itemlock.json",{tid:b.id},null,function(b){void 0!=b.resultCode&&this.sendNotification(app.proxy.BagProxy.SHOWMSG,1==
b.resultCode?"\u9501\u5b9a \u6210\u529f!":"\u89e3\u9501 \u6210\u529f!")})},degradeEquip:function(b){selectEquip=b;this.getService(app.getServiceURL()+"itemDowngrade.json",{tid:b},null,function(b){void 0!=b.resultCode&&this.sendNotification(app.proxy.BagProxy.SHOWMSG,1==b.resultCode?"\u964d\u7ea7\u6210\u529f\uff0c\u60a8\u83b7\u5f97\u94f6\u5e01"+b.money:'<label class="fc9">\u964d\u7ea7 \u5931\u8d25!<label>')})},degradeEquipAll:function(b){selectEquip=b;this.getService(app.getServiceURL()+"itemDowngradeAll.json",
{tid:b},null,function(b){void 0!=b.resultCode&&this.sendNotification(app.proxy.BagProxy.SHOWMSG,1==b.resultCode?"\u964d\u7ea7\u6210\u529f\uff0c\u60a8\u83b7\u5f97\u94f6\u5e01"+b.money:'<label class="fc9">\u964d\u7ea7 \u5931\u8d25!<label>')})},upgradeEquip:function(b,c){selectEquip=b;var e=0<c?1:0;this.getService(app.getServiceURL()+"itemUpgrade.json",{tid:b,useGold:e},null,function(b){void 0!=b.resultCode&&this.sendNotification(app.proxy.BagProxy.SHOWMSG,1==b.resultCode?"\u5f3a\u5316 \u6210\u529f!":
'<label class="fc9">\u5f3a\u5316 \u5931\u8d25!<label>')})},obtainEquip:function(b){this.selectEquip=b;this.getService(app.getServiceURL()+"itemGet.json",{tid:b})},addBagSize:function(){this.getService(app.getServiceURL()+"itemBagSize.json",null,null,function(b){void 0!=b.resultCode&&this.sendNotification(app.proxy.BagProxy.SHOWMSG,1==b.resultCode?"\u589e\u52a0\u80cc\u5305\u4f4d \u6210\u529f!":'<label class="fc9">\u589e\u52a0\u80cc\u5305\u4f4d \u5931\u8d25!</lbael>')})},sellEquip:function(b){this.selectEquip=
b;this.getService(app.getServiceURL()+"itemSell.json",{tid:b},null,this.sellEquipHandler)},sellEquipHandler:function(b){this.removeItem(b.id);this.sendNotification(app.proxy.BagProxy.SHOWMSG,"\u5356\u51fa\u6210\u529f\uff0c\u60a8\u83b7\u5f97\u94f6\u5e01"+b.money);this.sendNotification(app.proxy.BagProxy.ITEM_CHANGED);this.sendNotification(app.proxy.BagProxy.ITEM_SELL)},onUpdate:function(b){var b=b[0],c;if(b.rate&&0<=b.rate)this.strongRate=b.rate,this.strongTrend=b.up,c=3;if(this.bagList){if(0<=b.size||
0<=b.price)this.totalBagNum=b.size,this.bagPrice=b.price,c=0;var e=b.list;if(void 0!=e)var f=e.length;if(null!=e&&0<f)for(var g=0;g<f;g++){var h=this.getItemData(e[g].id);h?(h.update(e[g]),c=0==h.canObtain?0:2,h.heroName=0<h.heroId?app.data.DataBase.getInstance().getHeroInfo(h.heroId).name:"",h.canObtain=0<h.canObtain?new app.data.TimeVO(h.canObtain):-1):(this.addItem(e[g]),c=1)}}else this.setData(b);sortOn(this.bagList,"conId");this.reStorage();0==c?this.sendNotification(app.proxy.BagProxy.BAGINFO_CHANGED):
1==c?this.sendNotification(app.proxy.BagProxy.ITEM_CHANGED,b):2==c?this.sendNotification(app.proxy.BagProxy.ITEMINFO_CHANGED):3==c&&this.sendNotification(app.proxy.BagProxy.STRONGINFO_CHANGED)},getItemData:function(b){for(var c=0;c<this.bagList.length;c++)if(b==this.bagList[c].id)return this.bagList[c];return null},setData:function(b){this.totalBagNum=b.size;this.bagPrice=b.price;this.bagList=[];this.storageList=[];if(null!=b.list)for(var c=b.list.length,b=b.list,e=0;e<c;e++)this.addItem(b[e]);this.reStorage();
this.sendNotification(app.proxy.BagProxy.COMPLETE)},reStorage:function(){this.storageList=[];this.storageAllList=[];this.heroWeaponList=[];this.stongList=[];for(var b=this.bagList.length,c=0,e=0;e<b;e++){var f=this.bagList[e].gettypeId(),g=this.bagList[e].canObtain;0>=this.bagList[e].heroId&&(8!=f&&-1==g&&this.storageList.push(this.bagList[e]),-1==g&&c++);8==f&&-1==g&&this.heroWeaponList.push(this.bagList[e]);8!=f&&-1==g&&this.stongList.push(this.bagList[e]);8!=f&&this.storageAllList.push(this.bagList[e])}sortOn(this.stongList,
"conId",1);sortOn(this.storageAllList,"conId",1);sortOn(this.storageList,"conId",1);this.bagEmpty=this.totalBagNum-c},refreshData:function(){for(var b=0;b<this.bagList.length;b++)-1!=this.bagList[b].canObtain&&0>=this.bagList[b].canObtain.getTime()&&(this.bagList.splice(b,1),b--);this.reStorage();this.sendNotification(app.proxy.BagProxy.BAGINFO_CHANGED)},addItem:function(b){this.bagList.push(new app.data.BagVO(b))},removeItem:function(b){if(this.bagList){var c=this.bagList.length,e;for(e=0;e<c;e++)if(this.bagList[e].id==
b){this.bagList.splice(e,1);this.reStorage();break}}},getHeroItem:function(b){var c=[],e=this.bagList.length,f;for(f=0;f<e;f++)this.bagList[f].heroId==b&&c.push(this.bagList[f]);return c},isDownHero:function(b){return this.getHeroItem(b).length<=this.bagEmpty},getItemByType:function(b){for(var c=[],e=0;e<this.storageList.length;e++)this.storageList[e].gettypeId()==b&&-1==this.storageList[e].canObtain&&c.push(this.storageList[e]);sortOn(c,"conId",1);return c},getItemByHero:function(b,c){var e;for(e=
0;e<this.bagList.length;e++)if(this.bagList[e].heroId==b&&this.bagList[e].gettypeId()==c)return e=this.bagList[e];return null},getItemsForEquip:function(b,c){var e=this.getItemByType(c),f=this.getItemByHero(b,c);null!=f&&e.unshift(f);return e}},{NAME:"BagProxy",COMPLETE:"BagInfo_Complete",BAGINFO_CHANGED:"BagInfo_Changed",ITEM_CHANGED:"Newitem_changed",ITEMINFO_CHANGED:"Info_Changed",STRONGINFO_CHANGED:"StrongInfo_Changed",ITEM_SELL:"ITEM_sell",SHOWMSG:"show_msg"});puremvc.define({name:"app.proxy.ShopProxy",parent:app.proxy.BaseDataProxy},{shopList:null,getShopInfo:function(b){this.nextHandler=b;this.getService(app.getServiceURL()+"shop.json",null,null,ClassUtils.delegate(this,this.onShopInfoComplete))},onShopInfoComplete:function(b){this.setData(b);if(this.nextHandler)this.nextHandler(),this.nextHandler=null},buyItem:function(b){this.selectEquip=b;this.getService(app.getServiceURL()+"itemBuy.json",{tid:b},null,function(b){void 0!=b.tid&&0<b.tid&&(b=app.data.DataBase.getInstance().getItemInfo(b.id),
this.sendNotification(app.proxy.ShopProxy.SHOWMSG,"\u83b7\u5f97 "+b.name))})},onUpdate:function(b){this.setData(b);this.sendNotification(app.proxy.ShopProxy.CHANGED)},setData:function(b){if(!this.shopList)this.shopList=[];for(var c=app.GameData.imageSrc,e=b.length,f=0;f<e;f++){var g=this.getShopData(b[f].conId);null!=g?g.update(b[f]):(g=new app.data.ShopVO(b[f]),g.img=c+"items/"+g.tid+".jpg",this.shopList.push(g))}sortOn(this.shopList,"conId")},getShopData:function(b){for(var c=0;c<this.shopList.length;c++)if(this.shopList[c].conId==
b)return this.shopList[c];return null}},{NAME:"ShopProxy",COMPLETE:"ShopInfo_Complete",CHANGED:"ShopInfo_Changed",SHOWMSG:"show_msg"});puremvc.define({name:"app.proxy.LevyProxy",parent:app.proxy.BaseDataProxy},{getLevyInfo:function(b){this.completeHanlder=b;this.getService(app.getServiceURL()+"/taxInfo.json")},onComplete:function(b){this.setData(b);this.completeHanlder&&this.completeHanlder();this.completeHanlder=null},levy:function(){var b=this;this.getService(app.getServiceURL()+"tax.json",null,"post",function(c){b.sendNotification(app.proxy.LevyProxy.SHOWREWARDS,c)})},forcedLevy:function(){var b=this;this.getService(app.getServiceURL()+
"forceTax.json",null,"post",function(c){b.sendNotification(app.proxy.LevyProxy.SHOWREWARDS,c)})},levyIncident:function(b){var b={choose:b},c=this;this.getService(app.getServiceURL()+"taxEvent.json",b,"post",function(b){c.sendNotification(app.proxy.LevyProxy.SHOWREWARDS,b)})},onUpdate:function(b){for(var c=0;c<b.length;c++)this.setData(b[c]);this.sendNotification(app.proxy.LevyProxy.CHANGED)},setData:function(b){if(null==this.data)this.data=new app.data.LevyVO;this.data.update(b)}},{NAME:"LevyProxy",
COMPLETE:"LevyProxy_Complete",SHOWREWARDS:"LevyProxy_SHOWREWARDS",CHANGED:"LevyProxy_Changed"});puremvc.define({name:"app.proxy.OfficialProxy",parent:app.proxy.BaseDataProxy},{getOfficialInfo:function(b){this.completeHanlder=b;if(null==this.data)this.getService(app.getServiceURL()+"rankInfo.json");else this.onComplete()},onComplete:function(b){this.setData(b);this.completeHanlder&&this.completeHanlder();this.completeHanlder=null},onUpdate:function(b){for(var c=0;c<b.length;c++)this.setData(b[c]);this.sendNotification(app.proxy.OfficialProxy.CHANGED)},setData:function(b){if(null!=b){if(null==
this.data)this.data=new app.data.OfficialVO;this.data.update(b)}},getPay:function(b){var c=this;this.getService(app.getServiceURL()+"getPay.json",null,"post",function(e){this.data.update(e);c.sendNotification(app.proxy.OfficialProxy.CHANGED);b&&b()})},exchangePrestige:function(b){var c=this;this.getService(app.getServiceURL()+"exchangePrestige.json",null,"post",function(e){this.data.update(e);c.sendNotification(app.proxy.OfficialProxy.CHANGED);b&&b()})}},{NAME:"OfficialProxy",CHANGED:"OfficialProxy_Changed"});puremvc.define({name:"app.proxy.MarketProxy",parent:app.proxy.BaseDataProxy},{getMarketInfo:function(b){this.nextHandler=b;this.getService(app.getServiceURL()+"marketInfo.json",null,"post",this.onMarketComplete)},getTradeInfo:function(b){this.getService(app.getServiceURL()+"marketTrade.json",b,"post",this.onMarketUpdate)},onMarketComplete:function(b){this.setData(b);this.sendNotification(app.proxy.MarketProxy.COMPLETE);if(this.nextHandler)this.nextHandler(),this.nextHandler=null},onMarketUpdate:function(b){this.setData(b);
this.sendNotification(app.proxy.MarketProxy.CHANGED)},onUpdate:function(b){this.setData(b[0]);this.sendNotification(app.proxy.MarketProxy.CHANGED)},setData:function(b){if(!this.data)this.data=new app.data.MarketVO;this.data.update(b)}},{NAME:"MarketProxy",COMPLETE:"Market_Complete",CHANGED:"Market_Changed"});puremvc.define({name:"app.proxy.BattleProxy",parent:app.proxy.BaseDataProxy},{getBattleResult:function(b){this.getService(app.getServiceURL()+"battle.json",{bid:b},"get",handler)},getWarfareResult:function(b,c){this.getService(app.getServiceURL()+"battle.json",{bid:b},"get",c)},onUpdate:function(b){try{this.setData(b[0]),this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.BattleFieldMediator)}catch(c){console.log(c)}},battleBg:"",getBattleResource:function(){var b=app.GameData.imageSrc,
c=[];this.battleBg="cj_1";c[0]={id:this.battleBg,src:b+"scene/"+this.battleBg+".jpg"};c[1]={id:"numberBmp",src:b+"skill/number.png"};c[2]={id:"fontbg",src:b+"effect/fontbg.png"};c[3]={id:"qizhi_1",src:b+"effect/qizhi_1.png"};c[4]={id:"qizhi_2",src:b+"effect/qizhi_2.png"};c[5]={id:"morale_a",src:b+"skill/morale_a.png"};c[6]={id:"morale_a_data",src:b+"skill/morale_a.zb"};c[7]={id:"morale_b",src:b+"skill/morale_b.png"};c[8]={id:"morale_b_data",src:b+"skill/morale_b.zb"};c[9]={id:"title",src:b+"effect/title.png"};
var e,f,g,h=this.data.fighters;f="\u6b63\u5728\u52a0\u8f7d\u5175\u79cd\u7d20\u6750";for(e=0;e<h.length;e++)g="soldier_"+toFix(h[e].soldierId,3),c.push({id:g,src:b+"soldiers/"+g+".png",descript:f}),c.push({id:g+"_data",src:b+"soldiers/"+g+".zb"});h=this.data.skills;f="\u6b63\u5728\u52a0\u8f7d\u6280\u80fd";if(null!=h)for(e=0;e<h.length;e++)g=app.data.DataBase.getInstance().getSkillInfo(h[e]),c.push({id:g.effectId,src:b+"skill/"+g.effectId+".png",descript:f+g.name}),c.push({id:g.effectId+"_data",src:b+
"skill/"+g.effectId+".zb"});h=this.data.buffers;if(null!=h)for(e=0;e<h.length;e++)g=app.data.DataBase.getInstance().getBufferInfo(h[e]),c.push({id:g.effectId,src:b+"skill/"+g.effectId+".png",descript:f+g.name}),c.push({id:g.effectId+"_data",src:b+"skill/"+g.effectId+".zb"});return c},clear:function(){this.setData(null)}},{NAME:"BattleProxy"});puremvc.define({name:"app.proxy.TalksProxy",parent:app.proxy.BaseDataProxy},{onUpdate:function(b){null==this.data?(this.data=new app.data.TalksVO(b[0].id),this.data.count=b[0].count):(this.data.id=b[0].id,this.data.count=b[0].count,this.data.upConf(),this.sendNotification(app.proxy.TalksProxy.CHANGED,this.data))},seekOther:function(){this.getService(app.getServiceURL()+"talk/switch.json")},startTalks:function(){this.getService(app.getServiceURL()+"talk.json",{p:1},null,this.talksComplete)},talksComplete:function(b){this.data.setReward(b);
this.sendNotification(app.proxy.TalksProxy.COMPLETE,this.data)}},{NAME:"TalksProxy",CHANGED:"TalksProxy_changed",COMPLETE:"TalksProxy_complete"});puremvc.define({name:"app.proxy.FolkHouseProxy",parent:app.proxy.BaseDataProxy},{patrolData:null,loadPatrolData:function(){this.getService(app.getServiceURL()+"inspectInfo.json")},loadDataComplete:function(){},patrolRefresh:function(b){b={type:b};this.getService(app.getServiceURL()+"refreshInspect.json",b)},patrolRefreshComplete:function(){},patrolGo:function(){this.getService(app.getServiceURL()+"inspect.json",null,null,this.patrolGoComplete)},patrolGoComplete:function(b){b&&0<b.length&&(app.data.DataBase.getInstance().getRewardInfo(b),
this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_REWARDS,b))},onUpdate:function(b){if(null==this.patrolData)this.patrolData=new app.data.PatrolVO;if(b&&0<b.length&&b[0]){if(b[0].hasOwnProperty("count"))this.patrolData.count=b[0].count;if(b[0].hasOwnProperty("total"))this.patrolData.total=b[0].total;this.patrolData.equipId=b[0].hasOwnProperty("equipId")?b[0].equipId:null;if(b[0].hasOwnProperty("areaId"))this.patrolData.areaId=b[0].areaId;if(b[0].hasOwnProperty("placeId"))this.patrolData.placeId=
b[0].placeId;if(b[0].hasOwnProperty("humanId"))this.patrolData.humanId=b[0].humanId;b[0].hasOwnProperty("areaId")&&b[0].hasOwnProperty("placeId")&&b[0].hasOwnProperty("humanId")?this.sendNotification(app.proxy.FolkHouseProxy.PATROL_UPDATE,[this.patrolData,app.view.building.PatrolView.PATROL_ALL]):(b[0].hasOwnProperty("areaId")&&this.sendNotification(app.proxy.FolkHouseProxy.PATROL_REFRESH,[this.patrolData,app.view.building.PatrolView.PATROL_AREA]),b[0].hasOwnProperty("placeId")&&this.sendNotification(app.proxy.FolkHouseProxy.PATROL_REFRESH,
[this.patrolData,app.view.building.PatrolView.PATROL_PLACE]),b[0].hasOwnProperty("humanId")&&this.sendNotification(app.proxy.FolkHouseProxy.PATROL_REFRESH,[this.patrolData,app.view.building.PatrolView.PATROL_HUMAN]))}}},{NAME:"FolkHouseProxy",PATROL_UPDATE:"Patrol_update",PATROL_REFRESH:"Patrol_refresh",PATROL_NPCEVENT:"Patro_npcEvent"});puremvc.define({name:"app.proxy.LiegemanProxy",parent:app.proxy.BaseDataProxy},{getLiegemanInfo:function(b){this.completeHanlder=b;if(null==this.data)this.getService(app.getServiceURL()+"liegemanList.json");else this.onComplete()},onComplete:function(b){this.setData(b);this.completeHanlder&&this.completeHanlder();this.completeHanlder=null},kickLiegeman:function(b,c){var e={liegemanId:b},f=this;this.getService(app.getServiceURL()+"kickLiegeman.json",e,"post",function(){var e=f.removeLiegeManData(b);
f.sendNotification(app.proxy.LiegemanProxy.CHANGED);c&&c(e)})},setData:function(b){var c;if(null!=b){this.data=[];for(var e=0;e<b.length;e++)c=new app.data.OfficialVO,c.update(b[e]),this.data.push(c)}},removeLiegeManData:function(b){for(var c=0;c<this.data.length;c++)if(this.data[c].liegemanId==b)return this.data.splice(c,1),c;return-1}},{NAME:"LiegemanProxy",COMPLETE:"LiegemanProxy_complete",CHANGED:"LiegemanProxy_changed"});puremvc.define({name:"app.proxy.FormationProxy",parent:app.proxy.BaseDataProxy},{onUpdate:function(b){var c,e;c=b.length;var f;if(null==this.data)this.data={};if(null==this.data.formation){this.data.formation=[];for(f=0;f<c;f++)e=new app.data.FormationVO(b[f].id),e.level=b[f].level,e.increase=b[f].increase,e.location=b[f].location,this.herosIdToPic(e),this.data.formation.push(e)}else for(f=0;f<c;f++)e=this.getFormationVo(b[f].id),null!=e?(e.level=b[f].level,e.increase=b[f].increase,e.location=b[f].location):
(e=new app.data.FormationVO(b[f].id),e.level=b[f].level,e.increase=b[f].increase,e.location=b[f].location,this.data.formation.push(e)),this.herosIdToPic(e);this.sendNotification(app.proxy.FormationProxy.CHANGED,this.data)},herosIdToPic:function(b){if(null!=b){b.herosPic=[];for(var c=0;9>c;c++)if(b.herosPic[c]=0,0<b.location[c])b.herosPic[c]=app.data.DataBase.getInstance().getHeroInfo(b.location[c]).pic}},getFormationVo:function(b){for(var c=this.data.formation.length,e=0;e<c;e++)if(this.data.formation[e].id==
b)return this.data.formation[e];return null},getHeros:function(){if(!this.data.defalut)return[];for(var b=this.getFormationVo(this.data.defalut).location,c=b.length,e=[],f=0;f<c;f++)0<b[f]&&e.push(b[f]);return e},setDefalut:function(b){if(null==this.data)this.data={};this.data.defalut=b},upHero:function(b){this.getService(app.getServiceURL()+"formation/on.json",b,null,this.upHeroComplete)},upHeroComplete:function(b){var c=this.getFormationVo(b.id);c.location=b.location;this.herosIdToPic(c);this.sendNotification(app.proxy.FormationProxy.CHANGED,
this.data)},downHero:function(b){this.getService(app.getServiceURL()+"formation/off.json",b,null,this.upHeroComplete)},save:function(b){this.getService(app.getServiceURL()+"formation/set.json",b,null,this.upHeroComplete)},deFormation:function(b){this.currValue=b;this.getService(app.getServiceURL()+"formation/default.json",{fid:b},null,this.defaultComplete)},defaultComplete:function(){this.data.defalut=this.currValue;this.sendNotification(app.proxy.FormationProxy.CHANGED,this.data)}},{NAME:"FormationProxy",
CHANGED:"FormationProxy_changed",COMPLETE:"FormationProxy_complete"});puremvc.define({name:"app.proxy.WorkShopProxy",parent:app.proxy.BaseDataProxy},{loadData:function(b){this.completeHanlder=b;this.getService(app.getServiceURL()+"workShop.json",null,null,this.loadDataComplete)},loadDataComplete:function(b){this.data=new app.data.WorkShopVO(b);this.sendNotification(app.proxy.WorkShopProxy.COMPLETE);this.completeHanlder&&this.completeHanlder();this.completeHanlder=null},productGood:function(b){b&&(b={id:b[0].id,baoji:b[1]},this.getService(app.getServiceURL()+"produce.json",
b,null,this.productGoodComplete))},productGoodComplete:function(b){this.data.remainProduceNum=b.remainProduceNum;this.data.coolTime=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_2);this.buildLevel=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.HuBu).level;var c,e,f,g,h;h="";f=b.goods[0];c=this.data.goods.length;for(b=0;b<c;b++)if(e=this.data.goods[b],e.id==f.id)e.quality=f.quality,e.qualityExp=
f.qualityExp,g=f.stock-e.stock,e.stock=f.stock,e.value=f.value,e.quality==this.buildLevel&&(h="\u8be5\u8d44\u6e90\u54c1\u8d28\u5df2\u8fbe\u6700\u9ad8\uff0c\u8bf7\u5347\u7ea7\u6237\u90e8\u83b7\u5f97\u66f4\u9ad8\u7684\u54c1\u8d28<br>");this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,h+("\u4ea7\u91cf\u589e\u52a0"+g));this.sendNotification(app.proxy.WorkShopProxy.PRODUCT,f)},forceProductGood:function(b){b&&(b={id:b[0].id,baoji:b[1]},this.getService(app.getServiceURL()+"forceproduce.json",
b,null,this.forceProductGoodComplete))},forceProductGoodComplete:function(b){if(b){this.buildLevel=this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.HuBu).level;this.data.forceGoldNeeded=b.forceGoldNeeded;var c,e,f,g,h;h="";f=b.goods[0];c=this.data.goods.length;for(b=0;b<c;b++)if(e=this.data.goods[b],e.id==f.id)e.quality=f.quality,e.qualityExp=f.qualityExp,g=f.stock-e.stock,e.stock=f.stock,e.value=f.value,e.quality==this.buildLevel&&(h="\u8be5\u8d44\u6e90\u54c1\u8d28\u5df2\u8fbe\u6700\u9ad8\uff0c\u8bf7\u5347\u7ea7\u6237\u90e8\u83b7\u5f97\u66f4\u9ad8\u7684\u54c1\u8d28<br>");
this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,h+("\u4ea7\u91cf\u589e\u52a0"+g));this.sendNotification(app.proxy.WorkShopProxy.FORCE_PRODUCT,f)}},sellGood:function(b){if(b)this.selectedGood=b,b={id:b.id},this.getService(app.getServiceURL()+"sell.json",b,null,this.sellGoodComplete)},sellGoodComplete:function(b){var c,e,f,g;e=this.data.goods.length;for(c=0;c<e;c++)if(f=this.data.goods[c],f.id==this.selectedGood.id)g=f,f.stock=0,f.value=0;b&&this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,
"\u5356\u51fa\u83b7\u5f97\u94f6\u5e01"+b.value);this.sendNotification(app.proxy.WorkShopProxy.SELL,g)},onUpdate:function(){}},{NAME:"WorkShopProxy",COMPLETE:"WorkShop_Load_Complete",ID_COMPASS:1,ID_GUNPOWER:2,ID_PRINT:3,ID_PAPERMAKING:4,LEVEL_UP:"levelUp",FORCE_PRODUCT:"Force_product",SELL:"Sell",PRODUCT:"Product"});puremvc.define({name:"app.proxy.BarracksProxy",parent:app.proxy.BaseDataProxy},{freeTimes:0,changeUnit:100,foodExpense:0,freeMax:0,getBarracksInfo:function(b){if(null!=b)this.handle=b;this.getService(app.getServiceURL()+"enterBarrack.json")},getFreeSoldiers:function(){this.getService(app.getServiceURL()+"recruitVolunteer.json",null,null,function(b){void 0!=b.volumteerNum&&0<b.volumteerNum&&this.sendNotification(app.proxy.BagProxy.SHOWMSG,'\u672c\u6b21\u52df\u96c6\u4e49\u5175\u83b7\u5f97<label class="fc9">'+
b.volumteerNum+"</label>\u5175\u529b");this.setData(b)})},getSoldiers:function(b){this.getService(app.getServiceURL()+"recruit.json",{num:b})},onComplete:function(b){if(this.handle)this.handle(),this.handle=null;null!=b&&this.setData(b)},onUpdate:function(b){this.setData(b)},setData:function(b){if(b.remainTime&&0<b.remainTime)this.coolingTime=new app.data.TimeVO(b.remainTime);if(b.remainRecruit)this.freeTimes=b.remainRecruit;if(b.maxVolunteer)this.freeMax=b.maxVolunteer;if(b.foodExpense)this.foodExpense=
b.foodExpense*this.changeUnit;this.sendNotification(app.proxy.BarracksProxy.CHANGED)}},{NAME:"BarracksProxy",CHANGED:"BarracksProxy_changed"});puremvc.define({name:"app.proxy.AppointProxy",parent:app.proxy.BaseDataProxy},{weapon:null,armor:null,acc:null,itemId:null,coolingTime:null,cooling:null,getAppointInfo:function(b){this.complteHandler=b;this.getService(app.getServiceURL()+"appoint.json")},appointGet:function(b){this.getService(app.getServiceURL()+"itemAppoint.json",{tid:b.id,type:b.type})},appointAccGet:function(b){this.getService(app.getServiceURL()+"itemAppointGet.json",{tid:b})},onUpdate:function(b){this.setData(b);if(this.complteHandler)this.complteHandler(),
this.complteHandler=null;this.sendNotification(app.proxy.AppointProxy.CHANGE)},setData:function(b){var c=b[0],e=c.weapons,b=c.armors,c=c.accs,f;if(0<e.length){this.weapon=[];for(f=0;f<e.length;f++){var g={};g.id=e[f].id;g.type=0;g.money=e[f].money;this.weapon[e[f].id]=g}}if(0<b.length){this.armor=[];for(f=0;f<b.length;f++)e={},e.id=b[f].id,e.type=1,e.money=b[f].money,this.armor[b[f].id]=e}if(0<c.length){if(!this.acc)this.acc=[];this.getAccData(c)}},getAccData:function(b){for(var c,e=0;e<b.length;e++){c=
!1;for(var f=0;f<this.acc.length;f++)if(this.acc[f].conId==b[e].conId){this.acc[f].n=b[e].n;this.acc[f].c=b[e].c;this.acc[f].name=app.data.DataBase.getInstance().getItemInfo(b[e].conId).name;c=!0;break}if(!c)c={},c.conId=b[e].conId,c.n=b[e].n,c.c=b[e].c,c.name=app.data.DataBase.getInstance().getItemInfo(b[e].conId).name,this.acc.push(c)}}},{NAME:"AppointProxy",COMPLETE:"appoint_Complete",CHANGE:"appoint_changed"});puremvc.define({name:"app.proxy.EquipProxy",parent:app.proxy.BaseDataProxy},{exchangeHeroEquip:function(b){this.getService(app.getServiceURL()+"changeAll.json",b,"post",this.exchangeComplete)},exchangeComplete:function(b){this.sendNotification(app.proxy.EquipProxy.exchangeHeroComplete,b.resultCode)},equipOn:function(b){this.getService(app.getServiceURL()+"equip.json",b,"post",this.onequipComplete)},onequipComplete:function(){this.sendNotification(app.proxy.EquipProxy.equipOnComplete)},equipUn:function(b){this.getService(app.getServiceURL()+
"unEquip.json",b,"post",this.unequipComplete)},unequipComplete:function(){this.sendNotification(app.proxy.EquipProxy.equipUnComplete)},unAllEquip:function(b){this.getService(app.getServiceURL()+"unEquipAll.json",b,"post",this.unequipAllComplete)},unequipAllComplete:function(){this.sendNotification(app.proxy.EquipProxy.equipUnAllComplete)},setData:function(){}},{NAME:"EquipProxy",exchangeHeroComplete:"Equip_exchangeComplete",equipOnComplete:"equipOnComplete",equipUnComplete:"equipUnComplete",equipUnAllComplete:"equipUnAllComplete"});puremvc.define({name:"app.proxy.WorldProxy",parent:app.proxy.BaseDataProxy},{loadResourceStatus:!1,getInitData:function(){this.getService(app.getServiceURL()+"world.json",null,"post",this.onInitComplete)},onInitComplete:function(b){this.setCityData(b);this.sendNotification(app.proxy.WorldProxy.COMPLETE,b)},getWorldResource:function(){var b=app.GameData.imageSrc,c=[];c[0]={id:"worldBg",src:b+"city/world.jpg"};c.push({id:"city_1",src:b+"area/city_1.png"});c.push({id:"city_2",src:b+"area/city_2.png"});
c.push({id:"city_3",src:b+"area/city_3.png"});c.push({id:"city_4",src:b+"area/city_4.png"});c.push({id:"city_selecter",src:app.GameData.imageSrc+"effect/city_selecter.png"});c.push({id:"city_selecter_data",src:app.GameData.imageSrc+"effect/city_selecter.zb"});c.push({id:"cityDevelop",src:app.GameData.imageSrc+"effect/cityDevelop.png"});c.push({id:"cityDevelop_data",src:app.GameData.imageSrc+"effect/cityDevelop.zb"});return c},getImgInData:function(b){this.getService(app.getServiceURL()+"moveCity.json",
b,"post",null)},getDevelopData:function(b,c){this.getService(app.getServiceURL()+"devCity.json",b,"post",function(){c&&c()})},getCityDataByID:function(b){for(var c=app.data.WorldMapData.cities,e=0;e<c.length;e++)if(c[e].id==b)return c[e]},getPostCityData:function(b,c){this.complteHandler=c;var e={id:b};this.getService(app.getServiceURL()+"cityInfo.json",e,"post",this.dataComplete)},dataComplete:function(b){this.postData=b;this.complteHandler();this.complteHandler=null},setCityData:function(b){this.CityData=
b}},{NAME:"WorldProxy",COMPLETE:"WorldProxy_Complete",getDevelopComplete:"WorldProxy_getDevelopComplete",getImgInComplete:"WorldProxy_ getImgInComplete"});puremvc.define({name:"app.proxy.BattleMapProxy",parent:app.proxy.BaseDataProxy,constructor:function(){app.proxy.BaseDataProxy.call(this)}},{loadResourceStatus:!1,isBattleReport:!1,loadData:function(b,c){switch(b){case app.proxy.BattleMapProxy.LOAD_INIT:this.getService(app.getServiceURL()+"allMapInfo.json",null,null,this.initComplete);break;case app.proxy.BattleMapProxy.LOAD_MAP:this.getService(app.getServiceURL()+"mapInfo.json",{mapId:c.id},null,this.loadMapComplete);break;case app.proxy.BattleMapProxy.LOAD_STRATEGYLIST:this.armyVo=
c;this.getService(app.getServiceURL()+"barrierhistory.json",{mapId:this.data.map.id,barrierId:this.armyVo.id},null,this.strategyListComplete);break;case app.proxy.BattleMapProxy.LOAD_STRATEGY_SHOW:this.getService(app.getServiceURL()+"battle.json",c,"get");break;case app.proxy.BattleMapProxy.START_FIGHT:this.getService(app.getServiceURL()+"fightbarrier.json",{mapId:this.data.map.id,barrierId:c.id});break;case app.proxy.BattleMapProxy.STORM_FIGHT:this.getService(app.getServiceURL()+"forcefightbarrier.json",
{mapId:this.data.map.id,barrierId:c.id});break;case app.proxy.BattleMapProxy.RELOAD:this.getService(app.getServiceURL()+"allMapInfo.json",null,null,this.reLoadComplete,!0)}},onUpdate:function(b){if(null==this.data)this.data={};var c,e;c=b.length;null==this.data.mapList&&(this.data.mapList=[]);for(i=0;i<c;i++)if(e=this.getMapVo(b[i].id),null!=e?e.complete=b[i].complete:(e=new app.data.BattleMapVO(b[i].id),e.complete=b[i].complete,this.data.mapList.push(e)),null!=this.data.map&&e.id==this.data.map.id)this.data.map.complete=
e.complete;this.sendNotification(app.proxy.BattleMapProxy.MAPLIST_CHANGE,this.data)},strategyListComplete:function(b){this.armyVo.strategyList=null!=b?b:[];this.sendNotification(app.proxy.BattleMapProxy.LOAD_STRATEGYLIST_COMPLETE,this.armyVo)},loadMapComplete:function(b){this.setMapData(b);this.sendNotification(app.proxy.BattleMapProxy.LOAD_MAP_COMPLETE)},initComplete:function(b){if(null==this.data)this.data={};null!=b&&this.setMapData(b);this.sendNotification(app.proxy.BattleMapProxy.COMPLETE)},
reLoadComplete:function(b){null!=b&&this.setMapData(b)},setMapData:function(b){var c,e;this.data.map=new app.data.BattleMapVO(b.id);this.data.map.complete=b.complete;this.data.map.isFirst=b.isFirst;this.data.map.getArmyList(b.id);b=b.armyList;sortOn(b,"id");c=b.length;for(i=0;i<c;i++)if(e=this.getArmyVo(b[i].id),null!=e&&(e.passed=b[i].passed,e.count=b[i].count,e.attack=b[i].attack,null!=b[i].goods&&e.setReward(b[i].goods),null!=b[i].probability))e.probability=b[i].probability;this.data.map.setGroupList();
this.updateState()},getLastPassed:function(){var b=this.data.map.armyList,c=b.length;if(0<c){for(var e=0;e<c;e++)if(!1==b[e].passed)return 0==e?null:[this.data.map.id,b[e-1].id];return[this.data.map.id,b[c-1].id]}return null},getArmyVo:function(b){if(null==b||0==b)return null;var c=this.data.map.armyList,e;for(e in c)if(c[e].id==b)return c[e];return null},updateState:function(){var b,c,e=this.data.map.groupList,f=e.length;for(c=0;c<f;c++)b=e[c],b.updatePassed(),b.prevGroupPassed=this.setPrevGroup(b.armyList[0].conf.preBarrierId);
for(c=0;c<f;c++)if(b=e[c],!1==b.passed){this.data.map.index=c;this.data.map.gId=b.id;break}},setPrevGroup:function(b){b=this.getArmyVo(b);if(null!=b)for(var c=this.data.map.groupList,e=c.length,f=0;f<e;f++)if(c[f].id==b.conf.groupId)return c[f].passed;return!1},getMapVo:function(b){for(var c in this.data.mapList)if(this.data.mapList[c].id==b)return this.data.mapList[c];return null},getMapBg:function(){for(var b=[],c=this.data.map.groupList.length,e={},f=0;f<c;f++){var g=this.data.map.groupList[f].conf;
e[g.picId]={id:"map_army"+g.picId,src:app.GameData.imageSrc+"map/army"+g.picId+".png"}}for(var h in e)b.push(e[h]);b.push({id:"map_"+this.data.map.id,src:app.GameData.imageSrc+"map/map_"+this.data.map.conf.bgId+".jpg"});return b},resource:null,bgResource:null},{NAME:"BattleMapProxy",LOAD_INIT:"BattleMapProxy_load_init",LOAD_MAP:"BattleMapProxy_load_map",LOAD_MAP_COMPLETE:"BattleMapProxy_load_map_complete",LOAD_STRATEGYLIST:"BattleMapProxy_load_strategyList",LOAD_STRATEGYLIST_COMPLETE:"BattleMapProxy_load_strategyList_complete",
LOAD_STRATEGY_SHOW:"BattleMapProxy_load_strategy_show",START_FIGHT:"BattleMapProxy_startFight",MAPLIST_CHANGE:"BattleMapProxy_mapList_change",COMPLETE:"BattleMapProxy_complete",STORM_FIGHT:"BattleMapProxy_stormFight",RELOAD:"BattleMapProxy_reLoad"});puremvc.define({name:"app.proxy.BattleMapArmyProxy",parent:app.proxy.BaseDataProxy,constructor:function(){app.proxy.BaseDataProxy.call(this)}},{onUpdate:function(b){var c=this.facade.retrieveProxy(app.proxy.BattleMapProxy.NAME);this.data=c.getData();if(null!=this.data){for(var e=b.length,f,g=0;g<e;g++)if(f=this.getArmyVo(b[g].id),null!=f)for(var h in b[g])"goods"==h?f.setReward(b[g].goods):f[h]=b[g][h];c.updateState()}},getArmyVo:function(b){var c=this.data.map.armyList;for(s in c)if(c[s].id==b)return c[s];
return null}},{NAME:"BattleMapArmyProxy",CHANGE:"BattleMapArmyProxy_change"});puremvc.define({name:"app.proxy.AreaProxy",parent:app.proxy.BaseDataProxy},{areaData:null,countryId:null,page:null,loadResourceStatus:!1,loadData:function(b){if(b)this.page=b;null==this.page?(b={id:this.countryId},this.getService(app.getServiceURL()+"enterCity.json",b,null,this.loadDataComplete,!0)):(b={city:this.countryId,block:this.page},this.getService(app.getServiceURL()+"getUsers.json",b,null,this.loadDataComplete,!0))},loadDataComplete:function(b){if(null==this.areaData)this.areaData=new app.data.AreaVO;
this.areaData.countryId=this.countryId;this.areaData.maxPageNum=b.maxBlockNum;if(0==this.areaData.maxPageNum)this.areaData.maxPageNum=1;this.areaData.page=b.block;this.areaData.protectTime=new app.data.TimeVO(b.protectTime);if(b.areaList){var c,e,f;e=b.areaList.length;if(0<e)for(c=0;c<e;c++)f=b.areaList[c],f=f.protectTime,b.areaList[c].protectTime=new app.data.TimeVO(f)}this.areaData.townList=b.areaList;this.sendNotification(app.mediator.scene.AreaMediator.LOAD_COMPLETE,this.areaData)},attackHandle:function(b){b=
{id:b};this.getService(app.getServiceURL()+"attack.json",b,null,this.attackComplete)},attackComplete:function(b){var c,e,f;if(b.hasOwnProperty("areaData")){f=b.areaData;c=this.areaData.townList.length;for(b=0;b<c;b++)if(e=this.areaData.townList[b],e.position==f.id){if(f.hasOwnProperty("status"))e.status=f.status;e.protectTime=new app.data.TimeVO(f.cooldownTime)}}this.sendNotification(app.mediator.system.AreaControlMediator.CLOSE);this.sendNotification(app.mediator.scene.AreaMediator.LOAD_COMPLETE,
this.areaData)},conquerHandle:function(b){b={id:b};this.getService(app.getServiceURL()+"conquer.json",b,null,this.conquerComplete)},conquerComplete:function(b){var c,e,f;if(b.hasOwnProperty("areaData")){f=b.areaData;c=this.areaData.townList.length;for(b=0;b<c;b++)if(e=this.areaData.townList[b],e.position==f.id)e.masterId=f.masterId,e.masterName=f.masterName}this.sendNotification(app.mediator.system.AreaControlMediator.CLOSE);this.sendNotification(app.mediator.scene.AreaMediator.LOAD_COMPLETE,this.areaData)},
tradeHandle:function(b){this.selectedTown=b;b={id:this.selectedTown.rid};this.getService(app.getServiceURL()+"enterShop.json",b,null,this.tradeComplete)},tradeComplete:function(b){b.hasOwnProperty("tradeData")&&this.sendNotification(app.mediator.system.TradeControlMediator.SHOW,[this.selectedTown,b.tradeData])},sellHandle:function(b){this.torid=b[0].rid;this.goodId=b[1];b={good:this.goodId,id:this.torid};this.getService(app.getServiceURL()+"sellById_v2.json",b,null,this.tradeSellComplete)},tradeSellComplete:function(b){this.sendNotification(app.mediator.system.TradeControlMediator.UPDATE,
b);b.hasOwnProperty("reward")&&this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,"\u5356\u51fa\u83b7\u5f97\u94f6\u5e01"+b.reward.value)},modifyNoteHandle:function(b){this.updateTown=b;b={note:b.note};this.getService(app.getServiceURL()+"changeDesc.json",b,null,this.modifyNoteComplete)},modifyNoteComplete:function(){this.sendNotification(app.mediator.system.NoteControlMediator.CLOSE);this.sendNotification(app.mediator.system.AreaControlMediator.SHOW,this.updateTown)},modifyTownLogoHandle:function(b){this.updateTown=
b;b={flag:b.flag};this.getService(app.getServiceURL()+"changeFlag.json",b,null,this.modifyTownLogoComplete)},modifyTownLogoComplete:function(){this.sendNotification(app.mediator.system.TownLogoControlMediator.CLOSE);this.sendNotification(app.mediator.system.AreaControlMediator.CLOSE);this.sendNotification(app.mediator.scene.AreaMediator.LOAD_COMPLETE,this.areaData)}},{NAME:"AreaProxy"});puremvc.define({name:"app.proxy.ResProxy",parent:app.proxy.BaseDataProxy},{resourceData:null,countryId:null,page:null,loadResourceStatus:!1,loadResData:function(b){if(b)this.page=b;this.initRes(this.countryId,this.page);b={city:this.countryId,block:this.page};this.getService(app.getServiceURL()+"getResource_v2.json",b,null,this.loadDataComplete,!0)},loadDataComplete:function(b){if(b&&b.resList&&0<b.resList.length){var c,e,f,g,h,j,k;k=this.resourceData.resList;f=k.length;c=b.resList.length;for(e=0;e<
c;e++){h=b.resList[e];for(g=0;g<f;g++)if(j=k[g],j.id==h.id&&j.type==h.type)j.captureTime=new app.data.TimeVO(h.captureTime),j.protectTime=new app.data.TimeVO(h.protectTime),j.userId=h.rid,j.userName=h.userName,j.level=h.level,j.isDouble=h.openDouble,j.isPatrol=h.openInspect,j.canOpenDouble=h.canOpenDouble,j.flag=h.flag}}this.sendNotification(app.mediator.scene.ResourceMediator.LOAD_COMPLETE,this.resourceData)},initRes:function(b,c){this.resourceData=new app.data.ResourceVO;this.resourceData.countryId=
b;this.resourceData.page=c;this.resourceData.maxPageNum=this.resourceData.getResMaxPage(b);var e=this.resourceData.getInfoByCountryId(b,c);if(e&&0<e.length){var f,g,h,j;g=e.length;this.resourceData.resList=[];for(f=0;f<g;f++)j=e[f],h=new app.data.ResourceNpcVO,h.countryId=b,h.page=c,h.id=j.resid,h.type=j.type,h.output=j.output,h.iconId=j.image,h.desc=j.info,h.posX=j.x,h.posY=j.y,this.resourceData.resList.push(h)}},captureHandle:function(b){var c={city:this.countryId,block:this.resourceData.page,id:b.id,
type:b.type};this.captureType=b.type;this.getService(app.getServiceURL()+"captureResource.json",c,null,this.captureComplete)},captureComplete:function(b){var c,e,f;if(b&&b.hasOwnProperty("resData")){f=b.resData;c=this.resourceData.resList.length;for(b=0;b<c;b++)if(e=this.resourceData.resList[b],e.id==f.id&&e.type==this.captureType)e.userId=f.rid,e.userName=f.userName,e.level=f.level,e.captureTime=new app.data.TimeVO(f.captureTime),e.flag=f.flag,e.canOpenDouble=f.canOpenDouble,e.protectTime=null,e.isPatrol=
!1,e.isDouble=!1}this.sendNotification(app.mediator.system.ResControlMediator.CLOSE);this.sendNotification(app.mediator.scene.ResourceMediator.LOAD_COMPLETE,this.resourceData)},giveupHandle:function(b){var c={city:this.countryId,block:this.resourceData.page,id:b.id,type:b.type};this.giveupType=b.type;this.getService(app.getServiceURL()+"abandonResource.json",c,null,this.giveupComplete)},giveupComplete:function(b){var c,e,f;if(b){e=this.resourceData.resList.length;for(c=0;c<e;c++)if(f=this.resourceData.resList[c],
f.id==b.id&&f.type==this.giveupType)f.userId=null,f.userName=null,f.level=null,f.captureTime=null,f.protectTime=null,f.isPatrol=!1,f.isDouble=!1,f.canOpenDouble=!1}this.sendNotification(app.mediator.system.ResControlMediator.CLOSE);this.sendNotification(app.mediator.scene.ResourceMediator.LOAD_COMPLETE,this.resourceData)},stealHandle:function(b){var c={city:this.countryId,block:this.resourceData.page,id:b.id,type:b.type};this.stealType=b.type;this.getService(app.getServiceURL()+"robResource.json",
c,null,this.stealComplete)},stealComplete:function(b){this.resourceData.stealCount=this.facade.retrieveProxy(app.proxy.IndicateProxy.NAME).getIndicateDataByType(app.proxy.IndicateProxy.TYPE_10).num;var c,e,f;if(b&&b.hasOwnProperty("resData")){f=b.resData;c=this.resourceData.resList.length;for(b=0;b<c;b++)if(e=this.resourceData.resList[b],e.id==f.id&&e.type==this.stealType&&(e.captureTime=new app.data.TimeVO(f.captureTime),e.protectTime=new app.data.TimeVO(f.protectTime),0==e.captureTime))e.userId=
null,e.userName=null,e.level=null,e.protectTime=null,e.isPatrol=!1,e.isDouble=!1;this.sendNotification(app.mediator.scene.ResourceMediator.SHOW_STEAL_SPRITE);this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,"\u63a0\u593a\u6210\u529f\uff01")}this.sendNotification(app.mediator.system.ResControlMediator.CLOSE);this.sendNotification(app.mediator.scene.ResourceMediator.LOAD_COMPLETE,this.resourceData)},doubleHandle:function(b){var c={city:this.countryId,block:this.resourceData.page,
id:b.id,type:b.type};this.doubleId=b.id;this.doubleType=b.type;this.getService(app.getServiceURL()+"doubleOutputResource.json",c,null,this.doubleComplete)},doubleComplete:function(){var b,c,e,f;c=this.resourceData.resList.length;for(b=0;b<c;b++)if(e=this.resourceData.resList[b],e.id==this.doubleId&&e.type==this.doubleType)e.isDouble=!0,f=e;this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,"\u5929\u9053\u916c\u52e4\u5f00\u542f\u6210\u529f!");this.sendNotification(app.mediator.scene.ResourceMediator.LOAD_COMPLETE,
this.resourceData);this.sendNotification(app.mediator.system.ResControlMediator.SHOW,f)},patrolHandle:function(b){var c={city:this.countryId,block:this.resourceData.page,id:b.id,type:b.type};this.patrolId=b.id;this.patrolType=b.type;this.getService(app.getServiceURL()+"inspectResource.json",c,null,this.patrolComplete)},patrolComplete:function(){var b,c,e,f;c=this.resourceData.resList.length;for(b=0;b<c;b++)if(e=this.resourceData.resList[b],e.id==this.patrolId&&e.type==this.patrolType)e.isPatrol=!0,
f=e;this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_MSG,"\u52a0\u5f3a\u5de1\u903b\u5f00\u542f\u6210\u529f!");this.sendNotification(app.mediator.scene.ResourceMediator.LOAD_COMPLETE,this.resourceData);this.sendNotification(app.mediator.system.ResControlMediator.SHOW,f)}},{NAME:"ResProxy",RES_TYPE_SILVER:1,RES_TYPE_FARM:2});puremvc.define({name:"app.proxy.ChatProxy",parent:app.proxy.BaseDataProxy,constructor:function(){app.proxy.BaseDataProxy.call(this)}},{time:null,maxId:0,timeId:0,onRegister:function(){this.data=[]},sendMsg:function(b,c){this.complete=c;this.getService(app.getServiceURL()+"sendMsg.json",b,"post",this.sendComplete,!0)},sendComplete:function(){if(this.complete)this.complete(),this.complete=null},queryTarget:function(b,c){this.complete=c;this.getService(app.getServiceURL()+"getRoleId.json",{name:b},"post",
this.queryTargetComplete)},queryTargetComplete:function(b){if(this.complete)this.complete(b),this.complete=null},received:function(){if(!_DISABLED_CHAT){var b=this;this.timeId=setTimeout(function(){b.getMsg()},5E3)}},getMsg:function(){var b={};b.time=this.time+"";if(this.maxId)b.maxId=this.maxId.toString();this.getService(app.getServiceURL()+"getMsg.json",b,"post",null,!0,!0)},onComplete:function(b){if(null!=b)this.time=b.time,this.maxId=b.maxId;this.received()},onUpdate:function(b){b=this.appendData(b);
this.sendNotification(app.mediator.system.ChatMediator.RECEIVED,b)},appendData:function(b){for(var c=[],e=0;e<b.length;e++)c.push(new app.data.ChatMessageVO(b[e]));if(!this.data)this.data=[];this.data=this.data.concat(c);return c},getDataByGroup:function(b){for(var b=b||0,c=[],e=this.data.length,f=0;f<e;f++)(this.data[f].group==b||0==b)&&c.push(this.data[f]);return c}},{NAME:"ChatProxy"});puremvc.define({name:"app.proxy.NpcEventProxy",parent:app.proxy.BaseDataProxy},{npcEventHandle:function(b){b={chooseNum:b};this.getService(app.getServiceURL()+"npcEvent.json",b,null)}},{NAME:"NpcEventProxy"});puremvc.define({name:"app.proxy.CampaignProxy",parent:app.proxy.BaseDataProxy},{campaignData:null,loadCampaignData:function(b){this.nextHandler=b;this.getService(app.getServiceURL()+"activescore/info.json",null,null,this.loadCampaignDataComplete)},loadCampaignDataComplete:function(b){this.campaignData=b;var c=this.getCampaignInfo(b.id);this.campaignData.name=c.name;this.campaignData.desc=c.desc;this.campaignData.time=new app.data.TimeVO(b.time/1E3);this.sendNotification(app.proxy.CampaignProxy.LOAD_COMPLETE,
this.campaignData);if(this.nextHandler)this.nextHandler(),this.nextHandler=null},getCampaignInfo:function(b){var c=app.data.CampaignData,e,f,g;f=c.conf.length;for(e=0;e<f;e++)if(g=c.conf[e],g.id==b)return g},getCampaignReward:function(){this.getService(app.getServiceURL()+"/activescore/recieve.json",null,null,this.getCampaignRewardComplete)},getCampaignRewardComplete:function(b){this.campaignData.canGetReward=0;this.sendNotification(app.proxy.CampaignProxy.GET_CAMPAIGN_REWARD_COMPLETE,b)}},{NAME:"CampaignProxy",
GET_CAMPAIGN_REWARD_COMPLETE:"CampaignProxy_getreward",LOAD_COMPLETE:"CampaignProxy_LOAD_COMPLETE"});puremvc.define({name:"app.proxy.TaskMainProxy",parent:app.proxy.BaseDataProxy},{taskMain:null,nextHandler:null,getTaskMInfo:function(b){this.nextHandler=b;this.getService(app.getServiceURL()+"task/list.json",null,null,this.onTaskInfoComplete)},onTaskInfoComplete:function(){if(this.nextHandler)this.nextHandler(),this.nextHandler=null},mainGet:function(b){var c=this;this.getService(app.getServiceURL()+"task/finish.json",{tid:b},null,function(e){void 0!=e[0].tid&&0<e[0].tid&&(c.removeTask(b),e=app.data.DataBase.getInstance().getRewardInfo(e[0]),
this.sendNotification(app.proxy.TaskMainProxy.SHOWMSG,"\u83b7\u5f97 "+e.name+"*"+e.value));0==this.getEnableTask()&&this.sendNotification(app.proxy.TaskStatusProxy.ICON_STATUS,0)})},onUpdate:function(b){b=b[0].tmain;if(this.taskMain){if(b&&0<b.length){for(var c=0;c<b.length;c++){var e=this.getTaskMain(b[c].taskId);e?e.update(b[c]):this.addTaskMain(b[c])}sortOn(this.taskMain,"status",Array.DESC);this.sendNotification(app.proxy.TaskMainProxy.TASKMAIN_CHANGED)}}else{this.taskMain=[];for(c=0;c<b.length;c++)this.addTaskMain(b[c]);
sortOn(this.taskMain,"status",Array.DESC)}},getTaskMain:function(b){for(var c=0;c<this.taskMain.length;c++)if(b==this.taskMain[c].taskId)return this.taskMain[c];return null},addTaskMain:function(b){this.taskMain.push(new app.data.TaskMainVO(b))},removeTask:function(b){if(this.taskMain){var c=this.taskMain.length,e;for(e=0;e<c;e++)if(this.taskMain[e].taskId==b){this.taskMain.splice(e,1);sortOn(this.taskMain,"status",Array.DESC);this.sendNotification(app.proxy.TaskMainProxy.TASKMAIN_CHANGED);break}}},
getEnableTask:function(){var b=0;if(this.taskMain)for(var c=0;c<this.taskMain.length;c++)2==this.taskMain[c].status&&b++;return b}},{NAME:"TaskMainProxy",COMPLETE:"TaskProxy_Complete",TASKMAIN_CHANGED:"TaskMain_Changed",SHOWMSG:"show_msg"});puremvc.define({name:"app.proxy.TaskDayProxy",parent:app.proxy.BaseDataProxy},{taskDay:null,nextHandler:null,getTaskDInfo:function(b){this.nextHandler=b;this.getService(app.getServiceURL()+"everyday/getTask.json",null,null,this.onTaskInfoComplete)},onTaskInfoComplete:function(){if(this.nextHandler)this.nextHandler(),this.nextHandler=null},lotteryGet:function(){this.getService(app.getServiceURL()+"everyday/getAward.json",null,null,this.getHandle)},getHandle:function(b){void 0!=b&&(b=app.data.DataBase.getInstance().getRewardInfo(b[0]),
this.sendNotification(app.proxy.TaskDayProxy.TASKDAY_LOTTERYRESULT,b))},freshTask:function(){this.getService(app.getServiceURL()+"everyday/refreshTask.json")},finishTask:function(){this.getService(app.getServiceURL()+"everyday/forceFinish.json",null,null,this.finishHandel)},finishHandel:function(b){if(1==b.result)this.taskDay.progress=this.taskDay.progressTotal,this.taskDay.status=2,this.sendNotification(app.proxy.TaskDayProxy.TASKDAY_CHANGED)},getNewTaskD:function(){this.getService(app.getServiceURL()+
"everyday/getNewTask.json")},onUpdate:function(b){b=b[0];0<b.tid?(b=new app.data.TaskDayVO(b),this.taskDay={},this.taskDay=b,this.sendNotification(app.proxy.TaskDayProxy.TASKDAY_CHANGED)):this.taskDay&&this.taskDay.update(b)}},{NAME:"TaskDayProxy",TASKDAY_CHANGED:"TaskDay_Changed",TASKDAY_LOTTERYRESULT:"TaskDay_lotteryresult"});puremvc.define({name:"app.proxy.MailProxy",parent:app.proxy.BaseDataProxy},{mailData:null,loadMailData:function(){this.getService(app.getServiceURL()+"mailData.json",null,null,this.loadMailDataComplete)},loadMailDataComplete:function(){this.sendNotification(app.mediator.system.MailMediator.LOAD_COMPLETE,this.mailData)},readMail:function(b){var c=b[0],e={mailId:c.id};this.readMailId=c.id;0==c.readStatus?this.getService(app.getServiceURL()+"readMailData.json",e,null,this.readMailComplete):this.sendNotification(app.mediator.system.MailDetailMediator.SHOW,
[c,b[1]])},readMailComplete:function(b){if(1==b.resultCode){var c,e,f,g;c=this.mailData.length;for(b=0;b<c;b++)if(e=this.mailData[b],e.id==this.readMailId)e.readStatus=1,f=e,g=b;this.sendNotification(app.mediator.system.MailMediator.LOAD_COMPLETE,this.mailData);this.sendNotification(app.mediator.system.MailDetailMediator.SHOW,[f,g])}},delMail:function(b){var c={mailId:b.id};this.delMailId=b.id;this.getService(app.getServiceURL()+"delMailData.json",c,null,this.delMailComplete)},delMailComplete:function(b){if(1==
b.resultCode){var c,e;c=this.mailData.length;for(b=0;b<c;b++)if(e=this.mailData[b],e.id==this.delMailId){this.mailData.splice(b,1);break}this.sendNotification(app.mediator.system.MailMediator.LOAD_COMPLETE,this.mailData)}},sendMail:function(b){b={name:b.sendName,title:b.sendTitle,content:b.sendContent};this.getService(app.getServiceURL()+"sendMailData.json",b,null,this.sendMailComplete)},sendMailComplete:function(b){1==b.resultCode&&this.sendNotification(app.mediator.system.MailDetailMediator.SEND_COMPLETE)},
delAllMail:function(b){var c={type:b};this.delType=b;this.getService(app.getServiceURL()+"delAllMail.json",c,null,this.delAllMailComplete)},delAllMailComplete:function(b){if(1==b.resultCode){var c;if(0==this.delType)this.mailData=[];else for(b=this.mailData.length-1;0<=b;b--)c=this.mailData[b],c.type==this.delType&&this.mailData.splice(b,1);this.sendNotification(app.mediator.system.MailMediator.LOAD_COMPLETE,this.mailData)}},onUpdate:function(b){if(b){if(null==this.mailData||0==this.mailData.length)this.mailData=
[];var c,e;e=b.length;for(c=0;c<e;c++)this.mailData.unshift(b[c]);this.sendNotification(app.proxy.MailProxy.ICON_STATUS,1)}}},{NAME:"MailProxy",ICON_STATUS:"Mail_icon_status"});puremvc.define({name:"app.proxy.AchievementProxy",parent:app.proxy.BaseDataProxy},{achievementList:null,copyList:null,getCopyInfo:function(b){this.nextHandler=b;this.getService(app.getServiceURL()+"achievement/map.json",null,null,this.onCopyInfoComplete)},onCopyInfoComplete:function(b){this.copyList=[];this.achievementList=[];for(var c=0;c<b.length;c++)this.copyList.push(app.data.DataBase.getInstance().getBattleMapInfo(b[c]));if(this.nextHandler)this.nextHandler(),this.nextHandler=null;this.sendNotification(app.proxy.AchievementProxy.COPY_COMPLETE)},
getAchievementInfo:function(b,c){this.nextHandler=b;this.getService(app.getServiceURL()+"achievement/list.json",{mapId:c},null,this.onAchievementInfoComplete)},onAchievementInfoComplete:function(b){b=this.addAchievement(b);if(this.nextHandler)this.nextHandler(),this.nextHandler=null;this.sendNotification(app.proxy.AchievementProxy.ACHIEVEMENT_COMPLETE,b)},getAchievement:function(b,c){var e=this;this.getService(app.getServiceURL()+"achievement/finish.json",{id:c},null,function(f){void 0!=f[0].tid&&
0<f[0].tid&&(e.getAward(b,c),f=app.data.DataBase.getInstance().getRewardInfo(f[0]),this.sendNotification(app.proxy.AchievementProxy.SHOWMSG,"\u83b7\u5f97 "+f.name+"*"+f.value))})},getAInfo:function(b){for(var c=0;c<this.achievementList.length;c++)if(b==this.achievementList[c].mapId)return this.achievementList[c];return null},addAchievement:function(b){if(!this.achievementList)this.achievementList=[];b=new app.data.AchievementVO(b);this.achievementList.push(b);return b},getAward:function(b,c){for(var e=
0;e<this.achievementList.length;e++)if(b==this.achievementList[e].mapId)for(var f=0;f<this.achievementList[e].AchDetail.length;f++)if(this.achievementList[e].AchDetail[f].id==c){this.achievementList[e].AchDetail[f].status=3;this.sendNotification(app.proxy.AchievementProxy.ACHIEVEMENT_COMPLETE,this.achievementList[e]);return}}},{NAME:"achievementProxy",COPY_COMPLETE:"copy_Complete",ACHIEVEMENT_COMPLETE:"Achievement_Complete",SHOWMSG:"show_msg"});puremvc.define({name:"app.proxy.PlayerinfoProxy",parent:app.proxy.BaseDataProxy},{data:null,loadData:function(b){b={id:b};this.getService(app.getServiceURL()+"playerinfo.json",b,null,this.loadDataComplete)},loadDataComplete:function(b){this.data=b;this.sendNotification(app.mediator.system.PlayerInfoMediator.LOAD_COMPLETE)}},{NAME:"PlayerinfoProxy"});puremvc.define({name:"app.proxy.RefreshProxy",parent:app.proxy.BaseDataProxy},{repeatAction:{},onUpdate:function(b){b=b[0];this.setData(b);var c=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME),e=this;if(0<b.warTokenCount)this.repeatAction.warTokenTime&&this.repeatAction.warTokenTime.depose(),this.repeatAction.warTokenTime=new app.controller.RepeatAction(function(){c.data.warToken++;e.data.warTokenCount--;e.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).sendNotification(app.proxy.UserInfoProxy.CHANGED);
app.trace("\u519b\u4ee4\u5237\u65b0\u4e86\uff01\uff01\uff01\uff01")},b.warTokenTime,1800,b.warTokenCount),this.repeatAction.warTokenTime.start(),app.trace("\u6062\u590d\u519b\u4ee4\u8bb0\u65f6\u5668\u542f\u52a8\u4e86, time["+b.warTokenTime+"], count["+b.warTokenCount+"]")},setData:function(b){if(!this.data)this.data={};for(var c in b)this.data[c]=b[c]}},{NAME:"RefreshProxy"});puremvc.define({name:"app.proxy.ArmyGroupProxy",parent:app.proxy.BaseDataProxy},{status:null,time:null,pos:null,getInfo:function(b,c,e,f){this.nextHandler=f;this.getService(app.getServiceURL()+"group/enterArmyGroup.json",{gl:b,il:c,al:e},null,this.onInfoComplete)},onInfoComplete:function(){if(this.nextHandler)this.nextHandler(),this.nextHandler=null},onUpdate:function(b){b=b[0];if(void 0!=b.status)this.status=b.status;if(void 0!=b.time)this.time=new app.data.TimeVO(b.time);if(void 0!=b.pos)this.pos=
b.pos;this.sendNotification(app.proxy.ArmyGroupProxy.INFO_CHANGED)},getPower:function(b,c){return c>=[5,6,7,8][b]?!0:!1},cancelDismiss:function(){this.getService(app.getServiceURL()+"group/cancelDismissArmyGroup.json",null,null,function(b){if(void 0!=b.result&&1==b.result)this.status=0,this.sendNotification(app.proxy.ArmyGroupProxy.REENTER)})},advancement:function(b){var c=this.pos;this.getService(app.getServiceURL()+"group/promoteOfficialPositon.json",{gid:b},null,function(b){if(1==b.result&&b.member.pos){var f,
g=b.member.pos;if(g>c){f="\u5347\u804c\u6210\u529f!";for(var h=this.facade.retrieveProxy(app.proxy.ArmyGroupTeamProxy.NAME),j=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME),k=this.facade.retrieveProxy(app.proxy.ArmyGroupListProxy.NAME),l=0;l<h.list.length;l++)if(h.list[l].id==j.data.roleId){h.list[l].pos=g;h.list[l].rank=b.member.rank;break}if(8==g)for(l=0;l<h.list.length;l++)if(8==h.list[l].pos&&h.list[l].id!=j.data.roleId){h.list[l].pos=1;break}if(b.group){k.ourGroupInfo.update(b.group);
for(l=0;l<k.list.length;l++)if(k.list[l].id==k.ourGroupInfo.id){k.list[l]=k.ourGroupInfo;break}}}else f=7==c?'<label class="fc9">\u63d0\u5347\u5931\u8d25\uff0c\u53ea\u6709\u519b\u56e2\u957f\u8fde\u7eed30\u5929\u672a\u4e0a\u7ebf\u60a8\u624d\u53ef\u4ee5\u63d0\u5347\u4e3a\u519b\u56e2\u957f\uff01<label>':'<label class="fc9">\u63d0\u5347\u5931\u8d25\uff0c\u8bf7\u63d0\u9ad8\u60a8\u7684\u8d21\u732e\u503c\u3002<label>';this.pos=g}else f=7==c?'<label class="fc9">\u63d0\u5347\u5931\u8d25\uff0c\u53ea\u6709\u519b\u56e2\u957f\u8fde\u7eed30\u5929\u672a\u4e0a\u7ebf\u60a8\u624d\u53ef\u4ee5\u63d0\u5347\u4e3a\u519b\u56e2\u957f\uff01<label>':
'<label class="fc9">\u63d0\u5347\u5931\u8d25\uff0c\u8bf7\u63d0\u9ad8\u60a8\u7684\u8d21\u732e\u503c\u3002<label>';this.sendNotification(app.proxy.BagProxy.SHOWMSG,f)})},exit:function(){this.getService(app.getServiceURL()+"group/quitArmyGroup.json",null,null,function(b){if(void 0!=b.result)1==b.result?(b="\u9000\u51fa\u6210\u529f!",this.status=0,this.sendNotification(app.proxy.ArmyGroupProxy.REENTER)):b='<label class="fc9">\u9000\u51fa\u5931\u8d25!<label>',this.sendNotification(app.proxy.BagProxy.SHOWMSG,
b)})}},{NAME:"ArmyGroupProxy",REENTER:"ArmyGroup_reenter",INFO_CHANGED:"groupInfo_change"});puremvc.define({name:"app.proxy.ArmyGroupListProxy",parent:app.proxy.BaseDataProxy},{len:0,list:null,nowList:0,nextHandler:null,nowStart:0,ourGroupInfo:null,slen:0,sList:null,searchStart:0,pageNum:24,nowPage:1,nowSPage:1,sKey:null,getList:function(b,c){var e;0==this.nowList?(e=0==c?this.nowStart-this.pageNum:this.nowStart+this.pageNum,this.sendList(b,e,this.pageNum)):(e=0==c?this.searchStart-this.pageNum:this.searchStart+this.pageNum,this.sendSearchList(b,e,this.pageNum))},sendList:function(b,c,e){this.nowList=
0;var e=e?e:this.pageNum,f=this.facade.retrieveProxy(app.proxy.ArmyGroupProxy.NAME).status;this.getService(app.getServiceURL()+"group/getArmyGroups.json",{gid:b,start:c,num:e,status:f},null,null)},sendSearchList:function(b,c,e){b=null!=b?b:this.sKey;e=e?e:this.pageNum;this.getService(app.getServiceURL()+"group/searchArmyGroupsPerPage.json",{con:b,start:c,num:e},null,ClassUtils.delegate(this,this.onSearchUpdate,b,c))},onSearchUpdate:function(b,c,e){if(null!=b.gl)this.slen=b.gl;if(0<this.slen){this.nowList=
1;this.sKey=c;this.searchStart=e;this.nowSPage=Math.ceil((this.searchStart+1)/this.pageNum);this.sList=[];for(c=0;c<b.list.length;c++)this.addList(b.list[c],c,1);this.sendNotification(app.proxy.ArmyGroupListProxy.LIST_CHANGED)}else app.view.Alert.getInstance().show("\u6ca1\u6709\u627e\u5230\u60a8\u8f93\u5165\u7684\u519b\u56e2\u4fe1\u606f</br>\u8bf7\u786e\u8ba4\u60a8\u6240\u8f93\u5165\u7684\u519b\u56e2\u4fe1\u606f\u662f\u5426\u6b63\u786e")},onUpdate:function(b){b=b[0];if(void 0!=b.start)this.nowStart=
b.start;this.nowPage=Math.ceil((this.nowStart+1)/this.pageNum);if(void 0!=b.gl)this.len=b.gl;this.list=[];for(var c=0;c<b.list.length;c++)this.addList(b.list[c],c,0);this.sendNotification(app.proxy.ArmyGroupListProxy.LIST_CHANGED)},getInfoById:function(b,c){for(var e=0==c?this.list:this.sList,f=0;f<e.length;f++)if(e[f].id==b)return e[f]},addList:function(b,c,e){b=new app.data.GroupVO(b);if(0==e){if(0==this.nowStart&&0==c)this.ourGroupInfo=b;this.list.push(b)}else this.sList.push(b)},search:function(b,
c){this.getList(c,1,1)},newPub:function(b,c){c!=this.ourGroupInfo.announcement&&this.getService(app.getServiceURL()+"group/changeAnnouncement.json",{gid:b,str:c},null,function(b){if(void 0!=b.result){if(1==b.result){b="\u4fee\u6539\u6210\u529f!";this.ourGroupInfo.announcement=c;if(this.list)for(var f=0;f<this.list.length;f++)if(this.list[f].id==this.ourGroupInfo.id){this.list[f].announcement=c;break}if(this.sList)for(f=0;f<this.sList.length;f++)if(this.sList[f].id==this.ourGroupInfo.id){this.sList[f].announcement=
c;break}this.sendNotification(app.proxy.ArmyGroupListProxy.GROUPINFO_CHANGED)}else b='<label class="fc9">\u4fee\u6539\u5931\u8d25!<label>';this.sendNotification(app.proxy.BagProxy.SHOWMSG,b)}})},newExplain:function(b,c){c!=this.ourGroupInfo.declaration&&this.getService(app.getServiceURL()+"group/changeDeclaration.json",{gid:b,str:c},null,function(b){if(void 0!=b.result){if(1==b.result){b="\u4fee\u6539\u6210\u529f!";this.ourGroupInfo.declaration=c;if(this.list)for(var f=0;f<this.list.length;f++)if(this.list[f].id==
this.ourGroupInfo.id){this.list[f].declaration=c;break}if(this.sList)for(f=0;f<this.sList.length;f++)if(this.sList[f].id==this.ourGroupInfo.id){this.sList[f].declaration=c;break}this.sendNotification(app.proxy.ArmyGroupListProxy.GROUPINFO_CHANGED)}else b='<label class="fc9">\u4fee\u6539\u5931\u8d25!<label>';this.sendNotification(app.proxy.BagProxy.SHOWMSG,b)}})},cancleJoin:function(){this.getService(app.getServiceURL()+"group/cancelApplyArmyGroup.json",null,null,function(b){void 0!=b.result&&(1==
b.result?(b="\u53d6\u6d88\u6210\u529f!",this.sendNotification(app.proxy.ArmyGroupListProxy.REENTER)):b='<label class="fc9">\u53d6\u6d88\u5931\u8d25!<label>',this.sendNotification(app.proxy.BagProxy.SHOWMSG,b))})},creat:function(b,c){this.getService(app.getServiceURL()+"group/createArmyGroup.json",{name:c},null,function(b){void 0!=b.result&&(1==b.result?(b="\u6210\u7acb\u6210\u529f!",this.sendNotification(app.proxy.ArmyGroupListProxy.REENTER)):b='<label class="fc9">\u6210\u7acb\u5931\u8d25!<label>',
this.sendNotification(app.proxy.BagProxy.SHOWMSG,b))})},join:function(b){this.getService(app.getServiceURL()+"group/applyArmyGroup.json",{gid:b},null,function(b){void 0!=b.result&&(1==b.result?(b="\u53d1\u9001\u7533\u8bf7\u6210\u529f\uff0c\u8bf7\u7b49\u5f85\u6279\u51c6!",this.sendNotification(app.proxy.ArmyGroupListProxy.REENTER)):b='<label class="fc9">\u53d1\u9001\u7533\u8bf7\u5931\u8d25!<label>',this.sendNotification(app.proxy.BagProxy.SHOWMSG,b))})}},{NAME:"ArmyGroupListProxy",GROUPINFO_CHANGED:"groupInfo_changed",
REENTER:"groupList_reenter",LIST_CHANGED:"groupList_change"});puremvc.define({name:"app.proxy.ArmyGroupResearchProxy",parent:app.proxy.BaseDataProxy},{defaultId:null,dNum:null,len:null,list:null,nextHandler:null,nowStart:0,pageNum:24,readType:1,nowPage:1,getList:function(b,c){var e,f;e=0==c?this.nowStart-this.pageNum:this.nowStart+this.pageNum;f=this.pageNum;this.readType=1;this.sendList(b,e,f)},sendList:function(b,c,e,f){this.nextHandler=f;this.getService(app.getServiceURL()+"ask_list",{gid:b,start:c,len:e},null,this.onInfoComplete)},onInfoComplete:function(){if(this.nextHandler)this.nextHandler(),
this.nextHandler=null},delOne:function(b){this.getService(app.getServiceURL()+"del_list",{id:b},null,function(b){void 0!=b.result&&this.sendNotification(app.proxy.BagProxy.SHOWMSG,1==b.result?"\u8bbe\u7f6e\u6210\u529f!":'<label class="fc9">\u8bbe\u7f6e\u5931\u8d25!<label>')})},onUpdate:function(b){var b=b[0],c=0;if(1==this.readType&&void 0!=b.start)this.nowStart=b.start;if(void 0!=b.defaultId)this.defaultId=b.defaultId;if(void 0!=b.dNum)this.dNum=b.dNum;this.nowPage=Math.ceil((this.nowStart+1)/this.pageNum);
if(null==this.list)this.list=[];this.len=b.list.length;for(var e=0;e<this.len;e++)(c=this.getById(b.list[e].id))?(c.update(b.list[e]),c=1):(this.addList(b.list[e]),c=0);this.sendNotification(0==c?app.proxy.ArmyGroupResearchProxy.LIST_CHANGED:app.proxy.ArmyGroupResearchProxy.INFO_CHANGED)},getById:function(b){for(var c=0;c<this.list.length;c++)if(this.list[c].id==b)return this.list[c];return null},addList:function(b){this.list.push(new app.data.GroupResearchVO(b))},removeMembers:function(b){if(this.list){var c=
this.list.length,e;for(e=0;e<c;e++)if(this.list[e].id==b){this.list.splice(e,1);this.sendNotification(app.proxy.ArmyGroupResearchProxy.LIST_CHANGED);break}}},setDefault:function(b,c){this.getService(app.getServiceURL()+"group/setDefaultTeck.json",{id:c},null,function(b){if(void 0!=b.result)1==b.result?(b="\u8bbe\u7f6e\u6210\u529f!",this.defaultId=c,this.sendNotification(app.proxy.ArmyGroupResearchProxy.INFO_CHANGED)):b='<label class="fc9">\u8bbe\u7f6e\u5931\u8d25!<label>',this.sendNotification(app.proxy.BagProxy.SHOWMSG,
b)})},researchTeck:function(b,c,e){this.getService(app.getServiceURL()+"group/researchTeck.json",{gid:b,tech:c,no:e},null,function(b){if(void 0!=b.result){var c;if(1==b.result){c="\u6350\u732e\u6210\u529f!";for(var h=this.facade.retrieveProxy(app.proxy.ArmyGroupTeamProxy.NAME),j=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME),k=this.facade.retrieveProxy(app.proxy.ArmyGroupListProxy.NAME),l=0;l<h.list.length;l++)if(h.list[l].id==j.data.roleId){h.list[l].donation+=e;break}if(b.group){k.ourGroupInfo.update(b.group);
for(l=0;l<k.list.length;l++)if(k.list[l].id==k.ourGroupInfo.id){k.list[l]=k.ourGroupInfo;break}}}else c='<label class="fc9">\u6350\u732e\u5931\u8d25!<label>';this.sendNotification(app.proxy.BagProxy.SHOWMSG,c)}})}},{NAME:"ArmyGroupResearchProxy",LIST_CHANGED:"research_change",INFO_CHANGED:"info_change"});puremvc.define({name:"app.proxy.ArmyGroupAskProxy",parent:app.proxy.BaseDataProxy},{len:null,list:null,nextHandler:null,nowStart:0,pageNum:24,readType:1,nowPage:1,getList:function(b,c){var e,f;e=0==c?this.nowStart-this.pageNum:this.nowStart+this.pageNum;f=this.pageNum;this.readType=1;this.sendList(b,e,f)},sendList:function(b,c,e,f){this.nextHandler=f;this.getService(app.getServiceURL()+"group/getArmyGroupApplyListByPage.json",{gid:b,start:c,num:e},null,null)},onInfoComplete:function(){if(this.nextHandler)this.nextHandler(),
this.nextHandler=null},backHandle:function(b,c,e){void 0!=b.result&&(1==b.result?(b="\u64cd\u4f5c\u6210\u529f!",1==e&&this.facade.retrieveProxy(app.proxy.ArmyGroupTeamProxy.NAME).reReadData(),this.actMembers(c)):b='<label class="fc9">\u64cd\u4f5c\u5931\u8d25(\u53ef\u80fd\u4f60\u6ca1\u6709\u8be5\u6743\u9650)!<label>',this.sendNotification(app.proxy.BagProxy.SHOWMSG,b))},onUpdate:function(b){b=b[0];if(1==this.readType&&void 0!=b.start)this.nowStart=b.start;if(void 0!=b.al)this.len=b.al;this.nowPage=
Math.ceil((this.nowStart+1)/this.pageNum);if(null==this.list||1==this.readType)this.list=[];if(b.list)for(var c=0;c<b.list.length;c++)this.addList(b.list[c]);this.sendNotification(app.proxy.ArmyGroupAskProxy.LIST_CHANGED)},getById:function(b){for(var c=0;c<this.list.length;c++)if(this.list[c].id==b)return this.list[c]},addList:function(b){b.address=this.getCityDataByID(b.city).name+b.block;this.list.push(b)},actMembers:function(b){if(this.list){var c=this.list.length,e;for(e=0;e<c;e++)if(this.list[e].id==
b){this.list[e].act=1;this.sendNotification(app.proxy.ArmyGroupAskProxy.INFO_CHANGED);break}}},getCityDataByID:function(b){for(var c=app.data.WorldMapData.cities,e=0;e<c.length;e++)if(c[e].id==b)return c[e]},approveMember:function(b,c){this.getService(app.getServiceURL()+"group/approveMember.json",{id:c},null,ClassUtils.delegate(this,this.backHandle,c,1))},refuseMember:function(b,c){this.getService(app.getServiceURL()+"group/refuseMember.json",{id:c},null,ClassUtils.delegate(this,this.backHandle,
c,2))}},{NAME:"ArmyGroupAskProxy",INFO_CHANGED:"askList_infochange",LIST_CHANGED:"askList_change"});puremvc.define({name:"app.proxy.ArmyGroupTeamProxy",parent:app.proxy.BaseDataProxy},{len:null,list:null,nextHandler:null,nowStart:0,pageNum:48,readType:1,nowPage:1,getList:function(b,c){var e,f;e=0==c?this.nowStart-this.pageNum:this.nowStart+this.pageNum;f=this.pageNum;this.readType=1;this.sendList(b,e,f)},sendList:function(b,c,e,f){this.nextHandler=f;this.getService(app.getServiceURL()+"group/getArmyGroupInfo.json",{gid:b,start:c,num:e},null,this.onInfoComplete)},onInfoComplete:function(){if(this.nextHandler)this.nextHandler(),
this.nextHandler=null},delOne:function(b){var c=this.list.length,e=this.len;this.getService(app.getServiceURL()+"del_list",{id:b},null,function(f){if(void 0!=f.result){if(1==f.result){if(f="\u6210\u529f!",this.removeMembers(b),c<e)this.readType=2,this.sendList(c,1)}else f='<label class="fc9">\u5931\u8d25\uff01<label>';this.sendNotification(app.proxy.BagProxy.SHOWMSG,f)}})},onUpdate:function(b){b=b[0];if(1==this.readType&&void 0!=b.start)this.nowStart=b.start;if(void 0!=b.len){this.len=b.len;var c=
this.facade.retrieveProxy(app.proxy.ArmyGroupListProxy.NAME);if(c.ourGroupInfo)c.ourGroupInfo.teamNum=this.len}this.nowPage=Math.ceil((this.nowStart+1)/this.pageNum);this.list=[];for(c=0;c<b.list.length;c++)this.addList(b.list[c]);if(0==this.nowStart)this.facade.retrieveProxy(app.proxy.ArmyGroupProxy.NAME).pos=this.list[0].pos;this.sendNotification(app.proxy.ArmyGroupTeamProxy.LIST_CHANGED)},getById:function(b){for(var c=0;c<this.list.length;c++)if(this.list[c].id==b)return this.list[c]},addList:function(b){b.address=
this.getCityDataByID(b.city).name+b.block;this.list.push(b)},getCityDataByID:function(b){for(var c=app.data.WorldMapData.cities,e=0;e<c.length;e++)if(c[e].id==b)return c[e]},removeMembers:function(b){if(this.list){var c=this.list.length,e;for(e=0;e<c;e++)if(this.list[e].id==b){this.list.splice(e,1);this.sendNotification(app.proxy.ArmyGroupTeamProxy.LIST_CHANGED);break}}},reReadData:function(){this.sendList(this.facade.retrieveProxy(app.proxy.ArmyGroupListProxy.NAME).ourGroupInfo.id,this.nowStart,
this.pageNum)},fire:function(b,c){this.getService(app.getServiceURL()+"group/fireMember.json",{gid:b,rid:c},null,function(b){void 0!=b.result&&(1==b.result?(b="\u5f00\u9664\u6210\u529f!",this.reReadData()):b='<label class="fc9">\u5f00\u9664\u5931\u8d25!<label>',this.sendNotification(app.proxy.BagProxy.SHOWMSG,b))})},assign:function(b,c){this.getService(app.getServiceURL()+"group/assignGroupLeader.json",{gid:b,rid:c},null,function(e){if(void 0!=e.result){var f;if(1==e.result){f="\u8f6c\u8ba9\u6210\u529f!";
var g=this.facade.retrieveProxy(app.proxy.ArmyGroupProxy.NAME),h=this.facade.retrieveProxy(app.proxy.ArmyGroupListProxy.NAME),j=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME);g.pos=1;for(var g="",k=0;k<this.list.length;k++){if(this.list[k].id==j.data.roleId)this.list[k].pos=e.member.pos,this.list[k].rank=e.member.rank;if(this.list[k].id==c)this.list[k].pos=8,this.list[k].rank=1,g=this.list[k].name}h.ourGroupInfo.colonel=g;h.ourGroupInfo.colonelId=c;for(k=0;k<h.list.length;k++)if(h.list[k].id==
b){h.list[k].colonel=g;h.list[k].colonelId=c;break}this.sendNotification(app.proxy.ArmyGroupProxy.INFO_CHANGED)}else f='<label class="fc9">\u8f6c\u8ba9\u5931\u8d25!<label>';this.sendNotification(app.proxy.BagProxy.SHOWMSG,f)}})}},{NAME:"ArmyGroupTeamProxy",LIST_CHANGED:"team_change"});puremvc.define({name:"app.proxy.GiftProxy",parent:app.proxy.BaseDataProxy},{listS:null,listN:null,active:null,keyGift:1,nextHandler:null,_intervalID:null,iconState:null,getInfo:function(b){this.nextHandler=b;this.getService(app.getServiceURL()+"giftInfo.json",null,null,this.onInfoComplete)},onInfoComplete:function(){if(this.nextHandler)this.nextHandler(),this.nextHandler=null},onUpdate:function(b){b=b[0];b.newServer&&this.addList(b.newServer,0);b.newer&&this.addList(b.newer,1);b.festival&&this.addActive(b.festival);
if(null!=b.r)this.keyGift=b.r;this.sendNotification(app.proxy.GiftProxy.LIST_CHANGED)},addList:function(b,c){var e={};if(b.id)e.id=b.id;if(b.time)e.time=0==c?b.time:new app.data.TimeVO(b.time/1E3);if(b.status)e.status=b.status;if(b.rewardResp){for(var f=[],g=0;g<b.rewardResp.length;g++){var h=app.data.DataBase.getInstance().getRewardInfo(b.rewardResp[g]);f.push(h)}e.reward=f}0==c?this.listS=e:this.listN=e},addActive:function(b){if(null==this.active)this.active={};if(null!=b.time){var c=b.time;this._intervalActID=
setTimeout(ClassUtils.delegate(this,this.activeTimeout),1E3*c);this.active.time=new app.data.TimeVO(c);this.active.actRun=0>=this.active.time.getTime()?!1:!0}if(null!=b.id)this.active.id=b.id;if(null!=b.score)this.active.score=b.score;if(null!=b.rewardTimes)this.active.rewardTimes=b.rewardTimes;this.active.status=0<this.active.rewardTimes?2:1;if(null!=b.name)this.active.name=b.name},freshData:function(){this._intervalID&&clearTimeout(this._intervalID);this._intervalID=null;var b=0;if(0<this.listN.id&&
2==this.listN.status||0<this.listS.id&&2==this.listS.status||this.active&&0<this.active.rewardTimes)b=2;else if(0<this.listN.id||0<this.listS.id){if(b=1,this.listN.time&&0<this.listN.time.getTime()){var c=this.listN.time.getTime();this._intervalID=setTimeout(ClassUtils.delegate(this,this.timeout),c)}}else b=1==this.keyGift&&null==this.active?0:1;this.sendNotification(app.proxy.GiftProxy.ICON_STATUS,b)},activeTimeout:function(){this._intervalActID&&clearTimeout(this._intervalID);this.active=this._intervalActID=
null;this.freshData()},timeout:function(){this._intervalID&&clearTimeout(this._intervalID);this._intervalID=null;this.listN.status=2;this.sendNotification(app.proxy.GiftProxy.ICON_STATUS,2)},getGift:function(b){this.getService(app.getServiceURL()+"gift/recieve.json",{type:b+1},null,function(c){c&&0<c.length&&(b="\u5956\u52b1\u5df2\u7ecf\u53d1\u653e\uff0c\u88c5\u5907\u8bf7\u5728\u80cc\u5305\u4e2d\u67e5\u770b\u3002",this.sendNotification(app.proxy.GiftProxy.SHOWMSG,b))})},getAct:function(){this.getService(app.getServiceURL()+
"festivalReward.json",null,null,function(b){void 0!=b[0].tid&&0<b[0].tid&&(b=app.data.DataBase.getInstance().getRewardInfo(b[0]),this.sendNotification(app.proxy.GiftProxy.SHOWMSG,"\u83b7\u5f97 "+b.name+"*"+b.value))})},getByKey:function(b){var c=this;this.getService(app.getServiceURL()+"gift/key.json",{key:b},null,function(b){if(b&&0<b.length){for(var f=[],g=0;g<b.length;g++)f.push(app.data.DataBase.getInstance().getRewardInfo(b[g]));c.keyGift=1;c.sendNotification(app.proxy.GiftProxy.SHOWGIFT,f);
c.sendNotification(app.proxy.GiftProxy.LIST_CHANGED)}})}},{NAME:"GiftProxy",LIST_CHANGED:"giftList_change",SHOWMSG:"showMsg",SHOWGIFT:"showGift",ICON_STATUS:"icon_status"});puremvc.define({name:"app.proxy.GroupWarProxy",parent:app.proxy.BaseDataProxy},{gid:null,list:[],tList:[],state:null,groupInfo:null,mid:null,bid:null,_intervalID:null,levelCon:[20,40,60,80,100],teamCon:["\u76f8\u540c\u56fd\u5bb6","\u76f8\u540c\u519b\u56e2"],numCon:[4,5,6,7,8],time:null,setInfo:function(b){this.groupInfo=b;this.mid=b.conf.mapId;this.bid=b.conf.barrierId;this.groupInfo.name=b.conf.name.split("\uff08",2)[0];this.groupInfo.rewardGet=b.getProbability()},getInfo:function(b,c,e,f){if(!(null==
b||null==c))this.closeInterval(),this.nextHandler=f,null!=this.state&&0<this.state?this.getService(app.getServiceURL()+"groupWar/list.json",{mid:b,bid:c,id:this.gid,time:this.time},null,this.onInfoComplete,e):this.getService(app.getServiceURL()+"groupWar/list.json",{mid:b,bid:c},null,this.onInfoComplete,e)},onInfoComplete:function(){if(this.nextHandler)this.nextHandler(),this.nextHandler=null},onUpdate:function(b){b=b[0];if(null!=b.status)this.state=b.status;if(null!=b.id)this.gid=b.id;if(null!=b.time)this.time=
b.time;if(b.gList)this.list=b.gList;if(b.tList)this.tList=b.tList;if(0<this.state)for(b=0;b<this.list.length;b++)if(this.list[b].id==this.gid){this.list.unshift(this.list.splice(b,1)[0]);break}this.sendNotification(app.proxy.GroupWarProxy.LIST_CHANGED);this.setInterval()},creat:function(b){this.closeInterval();var c=this,e=b.team+1;this.getService(app.getServiceURL()+"groupWar/create.json",{mid:this.mid,bid:this.bid,level:this.levelCon[b.level],team:e,num:this.numCon[b.num]},function(){c.setInterval()})},
join:function(b){this.closeInterval();var c=this;this.getService(app.getServiceURL()+"groupWar/joinIn.json",{id:b},null,function(){c.setInterval()})},fire:function(b){this.closeInterval();var c=this;this.getService(app.getServiceURL()+"groupWar/fire.json",{rid:b},null,function(){c.setInterval()})},quit:function(){this.closeInterval();var b=this;this.getService(app.getServiceURL()+"groupWar/quit.json",{id:this.gid},null,function(){b.setInterval()})},setInterval:function(){this._intervalID=null;this._intervalID=
setTimeout(ClassUtils.delegate(this,this.getInfo,this.mid,this.bid,!0,null),3E3)},onError:function(){this.setInterval()},closeInterval:function(){clearTimeout(this._intervalID);this._intervalID=null},clearData:function(){var b=0==this.state?0:1;this.facade.retrieveProxy(app.proxy.ChallengeProxy.NAME).setNow(this.mid,this.bid,b);this.gid=this.time=this.state=this.mid=this.groupInfo=this.bid=null}},{NAME:"GroupWarProxy",LIST_CHANGED:"GroupWar_change"});puremvc.define({name:"app.proxy.SmallGameProxy",parent:app.proxy.BaseDataProxy},{data:null,loadResourceStatus:!1,picId:null,loadData:function(){this.getService(app.getServiceURL()+"smallGameData.json",null,null,this.loadDataComplete)},loadDataComplete:function(b){this.data=b;this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.SmallGameMediator)},gameOver:function(b){b={money:b[0],feat:b[1],warToken:b[2]};this.getService(app.getServiceURL()+"smallGameOver.json",b,null,this.gameOverComplete)},
gameOverComplete:function(b){this.data.count=b.count;this.data.enemyList=b.enemyList;this.sendNotification(app.mediator.scene.SmallGameMediator.UPDATE)}},{NAME:"SmallGameProxy"});puremvc.define({name:"app.proxy.NewPlayerGuideProxy",parent:app.proxy.BaseDataProxy},{data:null,battleData:null,battleDataUpdate:!1,guideNextComplete:function(){if(999==this.guideId)this.data.id=this.guideId},goNextPhase:function(b,c){var e;e=b;null==e&&(e=app.data.DataBase.getInstance().getGuideById(this.data.id),e=app.data.DataBase.getInstance().getNextPhaseId(e.phaseId+1),null==e&&(e=17));if(999==e)this.guideId=e;e={id:e,type:c};this.getService(app.getServiceURL()+"nextStage.json",e,null,this.guideNextComplete,
!0)},nextStep:function(b){var c;if(1==this.data.type){this.data.id=b.id+1;b=app.data.DataBase.getInstance().getGuideById(b.id);b=b.phaseId;if(c=app.data.DataBase.getInstance().getGuideById(this.data.id))c=c.phaseId,c>b&&this.goNextPhase(app.data.DataBase.getInstance().getNextPhaseId(c+1),1);if(5==this.data.id)this.sendNotification(app.mediator.building.LevelUpMediator.SHOW,app.data.HomeBuildingData.HALL);else if(6==this.data.id)this.sendNotification(app.command.CommandType.LEVEL_UP,app.data.HomeBuildingData.HALL),
this.goNextPhase(17,1);else if(7==this.data.id)this.sendNotification(app.mediator.building.LevelUpMediator.CLOSE,app.data.HomeBuildingData.HALL);else if(8==this.data.id)this.sendNotification(app.mediator.building.TaskMediator.SHOW);else if(11==this.data.id)c=this.facade.retrieveMediator(app.mediator.building.TaskMediator.NAME).viewComponent,c.taskMainView.handleEvent({currentTarget:c.taskMainView.taskMainGetBtn});else if(13==this.data.id)c=this.facade.retrieveMediator(app.mediator.building.TaskMediator.NAME).viewComponent,
c.depose();else if(15==this.data.id)this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!1),this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.BattleMapMediator);else if(16==this.data.id)b=this.facade.retrieveProxy(app.proxy.BattleMapProxy.NAME),this.sendNotification(app.mediator.scene.BattleMapMediator.GUIDE_SELECT_ARMYGROUP,b.data.map.groupList[0]);else if(17==this.data.id){c=this.facade.retrieveMediator(app.mediator.scene.BattleMapMediator.NAME).battleMapPop;
c.startFight();this.sendNotification(app.mediator.system.NewPlayerGuideMediator.CLOSE);return}}else if(2==this.data.type){this.data.battleId=b.id+1;if(2==this.data.battleId||20==this.data.battleId||44==this.data.battleId||52==this.data.battleId||57==this.data.battleId||62==this.data.battleId||67==this.data.battleId||72==this.data.battleId){this.sendNotification(app.mediator.system.NewPlayerGuideMediator.CLOSE);return}if(4==this.data.battleId)this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,
!1),this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.HomeMediator);else if(5==this.data.battleId)this.sendNotification(app.mediator.building.LevelUpMediator.SHOW,app.data.HomeBuildingData.MARKET);else if(6==this.data.battleId)this.sendNotification(app.mediator.building.LevelUpMediator.CLOSE,app.data.HomeBuildingData.MARKET),this.sendNotification(app.mediator.building.StoresMediator.SHOW,0);else if(8==this.data.battleId)c=this.facade.retrieveMediator(app.mediator.building.StoresMediator.NAME).viewComponent.shopView,
c.showPageInfo(0);else if(9==this.data.battleId){if(b=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data,c=this.facade.retrieveMediator(app.mediator.building.StoresMediator.NAME).viewComponent.shopView,c.workHandler({currentTarget:c.buyBtn},app.view.building.ShopView.BUY_EQUIP),200>b.silverCoin){this.sendNotification(app.mediator.system.NewPlayerGuideMediator.CLOSE);return}}else if(10==this.data.battleId)this.sendNotification(app.mediator.building.StoresMediator.CLOSE);else if(11==this.data.battleId)this.sendNotification(app.mediator.system.HeroMediator.SHOW,
0);else if(12==this.data.battleId)b=this.facade.retrieveMediator(app.mediator.system.HeroMediator.NAME),b.viewComponent.depose(),b.onRemove(),this.sendNotification(app.mediator.system.HeroMediator.SHOW,1);else if(13==this.data.battleId)c=this.facade.retrieveMediator(app.mediator.system.HeroMediator.NAME).viewComponent.equipView,c.equipLayOutHandler(null,1);else if(14==this.data.battleId)c=this.facade.retrieveMediator(app.mediator.system.HeroMediator.NAME).SelectEquipView,c.equipInstallHandler();else if(15==
this.data.battleId)b=this.facade.retrieveMediator(app.mediator.system.HeroMediator.NAME),b.SelectEquipView.depose(),b.SelectEquipView=null;else if(17==this.data.battleId)b=this.facade.retrieveMediator(app.mediator.system.HeroMediator.NAME),b.viewComponent.depose(),b.onRemove(),this.sendNotification(app.mediator.system.HeroMediator.SHOW,3);else if(22==this.data.battleId)this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!1),this.sendNotification(app.command.CommandType.GO_SCENE,
app.mediator.scene.HomeMediator);else if(23==this.data.battleId)this.sendNotification(app.mediator.building.LevelUpMediator.SHOW,app.data.HomeBuildingData.DRILL_GROUND);else if(24==this.data.battleId)this.sendNotification(app.mediator.building.LevelUpMediator.CLOSE,app.data.HomeBuildingData.DRILL_GROUND),this.sendNotification(app.mediator.building.DrillGroundMediator.SHOW,1);else if(25==this.data.battleId)c=this.facade.retrieveMediator(app.mediator.building.DrillGroundMediator.NAME).viewComponent.herosRecruit,
this.facade.retrieveMediator(app.mediator.building.DrillGroundMediator.NAME).viewComponent.herosRecruit.index=0,this.facade.retrieveMediator(app.mediator.building.DrillGroundMediator.NAME).viewComponent.herosRecruit.distance=0,c.mouseUp();else if(26==this.data.battleId)c=this.facade.retrieveMediator(app.mediator.building.DrillGroundMediator.NAME).recruitHero,this.sendNotification(app.mediator.building.DrillGroundMediator.START_RECRUIT,c.heroVo),c.depose();else if(27==this.data.battleId){if(b=this.facade.retrieveProxy(app.proxy.HerosProxy.NAME),
this.facade.retrieveProxy(app.proxy.LevelUpProxy.NAME).getBuildInfo(app.data.HomeBuildingData.HALL).level==b.data.onJobList[0].level||b.data.trainHeros&&0<b.data.trainHeros.length)this.data.battleId=36}else if(29==this.data.battleId)b=this.facade.retrieveMediator(app.mediator.building.DrillGroundMediator.NAME),b.viewComponent.depose(),b.onRemove(),this.sendNotification(app.mediator.building.DrillGroundMediator.SHOW,0);else if(30==this.data.battleId)b=this.facade.retrieveMediator(app.mediator.building.DrillGroundMediator.NAME),
b.viewComponent.herosTrain.handler(null,!1);else if(31==this.data.battleId)c=this.facade.retrieveMediator(app.mediator.building.DrillGroundMediator.NAME).trainPop,c.clickHeroDiv(null,c.data.onJobList[0]);else if(32==this.data.battleId)c=this.facade.retrieveMediator(app.mediator.building.DrillGroundMediator.NAME).trainPop,c.startTrain();else if(34==this.data.battleId)c=this.facade.retrieveMediator(app.mediator.building.DrillGroundMediator.NAME).viewComponent.herosTrain,c.handler(c.herosData.trainHeros[0],
!1);else if(35==this.data.battleId)b=this.facade.retrieveProxy(app.proxy.HerosProxy.NAME),this.sendNotification(app.command.CommandType.QUICKEN_COMMAND,b.data.trainHeros[0]);else if(36==this.data.battleId||37==this.data.battleId){b=this.facade.retrieveMediator(app.mediator.building.DrillGroundMediator.NAME);if(b.trainPop)b.trainPop.depose(),b.trainPop=null;b.viewComponent&&b.viewComponent.depose();b.onRemove()}else 38==this.data.battleId?this.sendNotification(app.mediator.system.HeroMediator.SHOW,
0):39==this.data.battleId?(b=this.facade.retrieveMediator(app.mediator.system.HeroMediator.NAME),b.viewComponent.depose(),b.onRemove(),this.sendNotification(app.mediator.system.HeroMediator.SHOW,2)):40==this.data.battleId?(c=this.facade.retrieveMediator(app.mediator.system.HeroMediator.NAME).viewComponent.herosFormation,c.clickHero(null,1,c.herosList_html.childNodes[1])):41==this.data.battleId?(c=this.facade.retrieveMediator(app.mediator.system.HeroMediator.NAME).viewComponent.herosFormation,c.clickFormation(null,
4)):42==this.data.battleId?(c=this.facade.retrieveMediator(app.mediator.system.HeroMediator.NAME).viewComponent.herosFormation,c.saveFormation()):46==this.data.battleId?(this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!1),c=this.facade.retrieveMediator(app.mediator.scene.BattleMapMediator.NAME).viewComponent,b=this.facade.retrieveProxy(app.proxy.BattleMapProxy.NAME),b.loadData(app.proxy.BattleMapProxy.LOAD_MAP,{id:c.data.map.id+1})):48==this.data.battleId||54==this.data.battleId||
59==this.data.battleId||64==this.data.battleId||69==this.data.battleId?this.sendNotification(app.mediator.system.MainMenuMediator.SHOW_MENU,3):49==this.data.battleId||55==this.data.battleId||60==this.data.battleId||65==this.data.battleId||70==this.data.battleId?(this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!1),this.sendNotification(app.mediator.system.MainMenuMediator.HIDE_MENU),this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.WorldMediator)):51==
this.data.battleId&&this.sendNotification(app.mediator.scene.WorldDialogMediator.SHOW,2)}else if(this.data.levelUpId=b.id+1,3==this.data.levelUpId)this.sendNotification(app.mediator.building.LevelUpMediator.SHOW,app.data.HomeBuildingData.STRATEGY);else if(5==this.data.levelUpId)this.sendNotification(app.mediator.building.LevelUpMediator.CLOSE,app.data.HomeBuildingData.STRATEGY),this.sendNotification(app.mediator.building.StrategyCenterMediator.SHOW,0);else if(7==this.data.levelUpId)c=this.facade.retrieveMediator(app.mediator.building.StrategyCenterMediator.NAME).viewComponent,
c.depose(),this.sendNotification(app.mediator.building.StrategyCenterMediator.SHOW,1);else if(9==this.data.levelUpId)c=this.facade.retrieveMediator(app.mediator.building.StrategyCenterMediator.NAME).viewComponent,c.depose();else{if(10==this.data.levelUpId||29==this.data.levelUpId||34==this.data.levelUpId||40==this.data.levelUpId||46==this.data.levelUpId||50==this.data.levelUpId||54==this.data.levelUpId||58==this.data.levelUpId||60==this.data.levelUpId||62==this.data.levelUpId){this.sendNotification(app.mediator.system.NewPlayerGuideMediator.CLOSE);
return}if(12==this.data.levelUpId)this.sendNotification(app.mediator.building.LevelUpMediator.SHOW,app.data.HomeBuildingData.HuBu);else if(14==this.data.levelUpId)this.sendNotification(app.mediator.building.LevelUpMediator.CLOSE,app.data.HomeBuildingData.HuBu);else if(18==this.data.levelUpId)this.sendNotification(app.mediator.system.MainMenuMediator.SHOW_MENU,0);else if(19==this.data.levelUpId)this.sendNotification(app.mediator.system.MainMenuMediator.HIDE_MENU),this.sendNotification(app.mediator.building.AchievementMediator.SHOW);
else if(21==this.data.levelUpId)c=this.facade.retrieveMediator(app.mediator.building.AchievementMediator.NAME).viewComponent,2!=c.achievementInfo.AchDetail[0].status&&(this.data.levelUpId=22);else if(22==this.data.levelUpId)c=this.facade.retrieveMediator(app.mediator.building.AchievementMediator.NAME).viewComponent,2==c.achievementInfo.AchDetail[0].status&&c.sendEvent(null,app.view.building.AchievementView.Achievement_get,c.achievementInfo.AchDetail[0].id),this.sendNotification(app.mediator.building.AchievementMediator.CLOSE);
else if(23==this.data.levelUpId)(c=this.facade.retrieveMediator(app.mediator.building.AchievementMediator.NAME).viewComponent)&&this.sendNotification(app.mediator.building.AchievementMediator.CLOSE);else if(24==this.data.levelUpId||37==this.data.levelUpId)this.sendNotification(app.mediator.system.MainMenuMediator.SHOW_MENU,3);else if(25==this.data.levelUpId)this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!1),this.sendNotification(app.mediator.system.MainMenuMediator.HIDE_MENU),
b=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data,c=this.facade.retrieveProxy(app.proxy.AreaProxy.NAME),c.countryId=b.cityId,c.page=null,this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.AreaMediator);else if(38==this.data.levelUpId)this.sendNotification(app.mediator.system.MainMenuMediator.HIDE_MENU),this.sendNotification(app.mediator.system.NewPlayerGuideMediator.VISIBLE,!1),b=this.facade.retrieveProxy(app.proxy.UserInfoProxy.NAME).data,c=this.facade.retrieveProxy(app.proxy.ResProxy.NAME),
c.countryId=b.cityId,c.page=1,this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.ResourceMediator)}this.sendNotification(app.mediator.system.NewPlayerGuideMediator.SHOW)},onUpdate:function(b){if(b[0])b[0].hasOwnProperty("mapId")&&b[0].hasOwnProperty("barrierId")?(this.battleData=[],this.battleData.push(b[0].mapId),this.battleData.push(b[0].barrierId),this.battleDataUpdate=!0):this.data=b[0]}},{NAME:"NewPlayerGuideProxy"});puremvc.define({name:"app.proxy.RankProxy",parent:app.proxy.BaseDataProxy},{rankData:null,loadRankData:function(){this.getService(app.getServiceURL()+"/rank/list.json",null,null,this.loadRankDataComplete)},loadRankDataComplete:function(b){this.rankData=b;this.sendNotification(app.mediator.system.RankMediator.LOAD_COMPLETE,this.rankData)}},{NAME:"RankProxy"});puremvc.define({name:"app.proxy.SignInProxy",parent:app.proxy.BaseDataProxy},{signInData:null,activeData:null,loadSignInData:function(b){this.nextHandler=b;this.getService(app.getServiceURL()+"active/score.json",null,null,this.loadSignInDataComplete)},loadSignInDataComplete:function(b){this.signInData=b;5==this.signInData.signInDay&&!1==this.signInData.signInToday&&(this.signInData.signInDay=0);this.sendNotification(app.proxy.SignInProxy.LOAD_COMPLETE,this.signInData);if(this.nextHandler)this.nextHandler(),
this.nextHandler=null},getActiveReward:function(b){this.getActiveRewardId=b;b={id:this.getActiveRewardId};this.getService(app.getServiceURL()+"/active/reward.json",b,null,this.getActiveRewardComplete)},getActiveRewardComplete:function(b){var c,e,f;e=this.signInData.detail.length;for(c=0;c<e;c++)if(f=this.signInData.detail[c],f.id==this.getActiveRewardId)f.status=app.view.system.SignInView.ACTIVE_REWARD_STATUS_GET;this.sendNotification(app.proxy.SignInProxy.GET_ACTIVE_REWARD_COMPLETE,[this.signInData,
b]);b&&b.hasOwnProperty("rewardList")&&this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_REWARDS,b.rewardList)},signIn:function(){var b={day:this.signInData.signInDay+1};this.getService(app.getServiceURL()+"signin.json",b,null,this.signInComplete)},signInComplete:function(b){this.signInData.signInDay++;this.signInData.signInToday=!0;this.sendNotification(app.proxy.SignInProxy.SIGN_IN,[this.signInData,b]);b&&b.hasOwnProperty("rewardList")&&this.sendNotification(app.mediator.system.AutoPopUpMsgMediator.SHOW_REWARDS,
b.rewardList)},loadActiveData:function(){this.getService(app.getServiceURL()+"/active/detail.json",null,null,this.loadActiveDataComplete)},loadActiveDataComplete:function(b){this.activeData=b;this.sendNotification(app.mediator.system.ActiveMediator.SHOW,this.activeData)}},{NAME:"SignInProxy",LOAD_COMPLETE:"SignInProxy_loadcomplete",SIGN_IN:"SignInProxy_signin",GET_ACTIVE_REWARD_COMPLETE:"SignInProxy_getreward"});puremvc.define({name:"app.proxy.WarfareProxy",parent:app.proxy.BaseDataProxy},{loadResourceStatus:!1,getBattleData:function(){this.getService(app.GameData.url+"warfare.json")},onUpdate:function(b){try{this.setData(b[0])}catch(c){console.log(c)}this.sendNotification(app.command.CommandType.GO_SCENE,app.mediator.scene.WarfareMediator);this.sendNotification(app.proxy.WarfareProxy.UPDATE)},clear:function(){this.setData(null)}},{NAME:"WarfareProxy",UPDATE:"WarfareProxy_Update"});puremvc.define({name:"app.proxy.ChallengeProxy",parent:app.proxy.BaseDataProxy},{list:[],nowJoin:null,getInfo:function(){this.getService(app.getServiceURL()+"challenge.json",null,null,this.onUpdate)},onUpdate:function(b){this.list=[];this.nowJoin=null;for(var c=0;c<b.length;c++)if(this.addList(b[c]),b[c].isIn)this.nowJoin=c;this.sendNotification(app.proxy.ChallengeProxy.LIST_CHANGED)},setNow:function(b,c,e){for(var f=0;f<this.list.length;f++)if(this.list[f].mapId==b&&this.list[f].id==c){this.list[f].isIn=
e;b=this.nowJoin;if(e)this.nowJoin=f;else if(this.nowJoin==f)this.nowJoin=null;b!=this.nowJoin&&this.sendNotification(app.proxy.ChallengeProxy.LIST_CHANGED);break}},addList:function(b){var c=new app.data.ArmyVO(b.mapId,b.id);c.setReward(b.goods);c.update(b);this.list.push(c)}},{NAME:"ChallengeProxy",INFO_CHANGED:"ChallengeProxy_infochange",LIST_CHANGED:"ChallengeProxy_change"});puremvc.define({name:"app.proxy.PayProxy",parent:app.proxy.BaseDataProxy},{conf:"\u8bad\u7ec3\u6a21\u5f0f\uff1a\u53ef\u9009\u62e9?\u7684\u8bad\u7ec3\u6a21\u5f0f,\u5efa\u7b51\u4f4d\uff1a\u589e\u52a0\u5efa\u7b51\u4f4d\u7684\u4e0a\u9650\u5230?\u4e2a,\u8bad\u7ec3\u4f4d\uff1a\u589e\u52a0\u6b66\u5c06\u8bad\u7ec3\u7684\u4f4d\u7f6e\u4e0a\u9650\u5230?\u4e2a,\u8bad\u7ec3\u65f6\u95f4\uff1a\u53ef\u9009\u62e9?\u7684\u8bad\u7ec3\u65f6\u95f4,\u519b\u4ee4\u8d2d\u4e70\uff1a\u6bcf\u5929\u8d2d\u4e70\u6700\u591a?\u4e2a\u519b\u4ee4,\u88c5\u5907\u91cd\u94f8\uff1a\u589e\u52a0?\u7684\u88c5\u5907\u91cd\u94f8\u6a21\u5f0f,\u91d1\u5e01\u7a81\u98de\uff1a\u5f00\u901a\u91d1\u5e01\u7a81\u98de\u6a21\u5f0f,\u5f3a\u5236\u5de1\u67e5\uff1a\u5f00\u901a\u5f3a\u5236\u5de1\u67e5\u6a21\u5f0f,\u91d1\u5e01\u5956\u52b1\uff1a\u5c06\u8fd4\u8fd8?\u91d1\u5e01".split(","),
payTip:[[{t:1,v:[4]},{t:2,v:[7]},{t:3,v:[1,2,3,4]},{t:4,v:[20]},{t:8,v:[5]}],[{t:0,v:[1,2,3,4]},{t:4,v:[30]},{t:8,v:[30]}],[{t:1,v:[5]},{t:2,v:[9]},{t:4,v:[40]},{t:8,v:[45]}],[{t:4,v:[50]},{t:8,v:[100]}],[{t:1,v:[6]},{t:2,v:[11]},{t:3,v:[1,2,3,4,5]},{t:4,v:[60]},{t:8,v:[320]}],[{t:0,v:[1,2,3,4,5]},{t:4,v:[70]},{t:8,v:[600]}],[{t:1,v:[7]},{t:2,v:[13]},{t:4,v:[80]},{t:8,v:[1300]}],[{t:2,v:[15]},{t:4,v:[90]},{t:8,v:[4100]}],[{t:1,v:[8]},{t:2,v:[17]},{t:4,v:[100]},{t:8,v:[7500]}],[{t:2,v:[20]},{t:4,v:[110]},
{t:8,v:[13500]}]],trainMode:",\u4e00\u822c\u8bad\u7ec3,\u4e25\u683c\u8bad\u7ec3,\u5669\u68a6\u8bad\u7ec3,\u5730\u72f1\u8bad\u7ec3,\u65e0\u53cc\u8bad\u7ec3".split(","),trainTime:",1\u5c0f\u65f6,4\u5c0f\u65f6,8\u5c0f\u65f6,24\u5c0f\u65f6,72\u5c0f\u65f6".split(","),paid:null,paylevel:null,nextPay:null,nextPayNum:null,getInfo:function(){this.getService(app.getServiceURL()+"enterPay.json",null,null,this.onUpdate)},onUpdate:function(b){if(null!=b.paid)this.paid=b.paid;if(null!=b.paylevel)this.paylevel=
b.paylevel;if(null!=b.nextPayNum)this.nextPayNum=b.nextPayNum;this.nextPay=[];this.payTip[this.paylevel]&&this.addList();this.sendNotification(app.proxy.PayProxy.INFO_CHANGED)},addList:function(){var b,c,e,f;b=this.payTip[this.paylevel];for(var g=0;g<b.length;g++)c=[],e=b[g].t,f=b[g].v,5!=e&&6!=e&&7!=e&&(0==e?(e=f.pop(),c.push(this.trainMode[e])):3==e?(e=f.pop(),c.push(this.trainTime[e])):c=f,c=this.replace(this.conf[b[g].t],c,"?"),this.nextPay.push(c))},replace:function(b,c,e){for(var b=b.split(e),
e="",f=0;f<b.length;f++)e+=b[f],c[f]&&(e+=c[f]);return e},goPay:function(){window.open(app.getServiceURL()+"pay.json?serverId="+app.GameData.serverId,"_self")}},{NAME:"PayProxy",SHOWMSG:"PayProxy_SHOWMSG",INFO_CHANGED:"INFO_CHANGED"});puremvc.define({name:"app.proxy.SimpleBattleProxy",parent:app.proxy.BaseDataProxy,constructor:function(){app.proxy.BaseDataProxy.call(this)}},{isLose:!1,onUpdate:function(b){this.setData(b[0]);this.isLose=!0;this.sendNotification(app.command.CommandType.SIMPLE_BATTLE_RESULT,this.getData())}},{NAME:"SimpleBattleProxy"});puremvc.define({name:"app.proxy.TaskStatusProxy",parent:app.proxy.BaseDataProxy},{onUpdate:function(b){this.data=b[0].existFinishedTask;null!=this.facade.retrieveMediator(app.mediator.system.MainMenuMediator.NAME).funBtns&&this.sendNotification(app.proxy.TaskStatusProxy.ICON_STATUS,this.data)}},{NAME:"TaskStatus_proxy",ICON_STATUS:"TaskStatus_ICON_STATUS"});puremvc.define({name:"app.proxy.ProxyManager",constructor:function(){}},{proxys:[{id:"game",name:app.proxy.GameInfoProxy.NAME},{id:"user",name:app.proxy.UserInfoProxy.NAME},{id:"levelUp",name:app.proxy.LevelUpProxy.NAME},{id:"indicate",name:app.proxy.IndicateProxy.NAME},{id:"farm",name:app.proxy.FarmProxy.NAME},{id:"heros",name:app.proxy.HerosProxy.NAME},{id:"hero",name:app.proxy.HeroProxy.NAME},{id:"talks",name:app.proxy.TalksProxy.NAME},{id:"formation",name:app.proxy.FormationProxy.NAME},{id:"maps",
name:app.proxy.BattleMapProxy.NAME},{id:"army",name:app.proxy.BattleMapArmyProxy.NAME},{id:"official",name:app.proxy.OfficialProxy.NAME},{id:"levy",name:app.proxy.LevyProxy.NAME},{id:"bag",name:app.proxy.BagProxy.NAME},{id:"shop",name:app.proxy.ShopProxy.NAME},{id:"market",name:app.proxy.MarketProxy.NAME},{id:"techs",name:app.proxy.StrategyProxy.NAME},{id:"folkhouse",name:app.proxy.FolkHouseProxy.NAME},{id:"appoint",name:app.proxy.AppointProxy.NAME},{id:"resource",name:app.proxy.ResourceProxy.NAME},
{id:"task",name:app.proxy.TaskMainProxy.NAME},{id:"ourGroup",name:app.proxy.ArmyGroupProxy.NAME},{id:"group",name:app.proxy.ArmyGroupListProxy.NAME},{id:"groupItem",name:app.proxy.ArmyGroupTeamProxy.NAME},{id:"groupResearch",name:app.proxy.ArmyGroupResearchProxy.NAME},{id:"groupAsk",name:app.proxy.ArmyGroupAskProxy.NAME},{id:"gift",name:app.proxy.GiftProxy.NAME},{id:"armyGroupWar",name:app.proxy.GroupWarProxy.NAME},{id:"tDay",name:app.proxy.TaskDayProxy.NAME},{id:"resource",name:app.proxy.ResourceProxy.NAME},
{id:"chatReceived",name:app.proxy.ChatProxy.NAME},{id:"battle",name:app.proxy.BattleProxy.NAME},{id:"achievement",name:app.proxy.AchievementProxy.NAME},{id:"refreshTime",name:app.proxy.RefreshProxy.NAME},{id:"worldProxy",name:app.proxy.WorldProxy.NAME},{id:"copyBattle",name:app.proxy.WarfareProxy.NAME},{id:"guide",name:app.proxy.NewPlayerGuideProxy.NAME},{id:"mailData",name:app.proxy.MailProxy.NAME},{id:"simpleBattle",name:app.proxy.SimpleBattleProxy.NAME},{id:"taskstatus",name:app.proxy.TaskStatusProxy.NAME}],
getProxyName:function(b){for(var c=0;c<this.proxys.length;c++)if(this.proxys[c].id==b)return this.proxys[c].name;return null}},{_instance:null,getInstance:function(){var b=app.proxy.ProxyManager;if(null==b._instance)b._instance=new b;return b._instance}});puremvc.define({name:"app.data.CONST"},{},{MSG_NOT_ENOUGH_MONEY:"\u94f6\u5e01\u4e0d\u8db3",MSG_TOO_MUCH_MONEY:"\u8d85\u51fa\u94f6\u5e93\u4e0a\u9650\uff0c\u8bf7\u5347\u7ea7\u6c11\u5c45\uff0c\u589e\u52a0\u4e0a\u9650"});puremvc.define({name:"app.data.TimeVO",constructor:function(b){0<=b&&this.setTime(b)}},{_timeCount:0,_time:0,setTime:function(b){this._timeCount=b;this._time=Date.now()+1E3*this._timeCount},getTime:function(){var b=this._time-Date.now();0>b&&(b=0);return b},toString:function(){return app.data.TimeVO.formatTime(this.getTime())}},{formatTime:function(b){var c=Math.floor(b/36E5),e=Math.floor((b-36E5*c)/6E4),b=Math.floor((b-36E5*c-6E4*e)/1E3);return(10>c?"0"+c:""+c)+":"+(10>e?"0"+e:""+e)+":"+(10>b?"0"+
b:""+b)},formatTime2:function(b){if(b){var c=Math.floor(b/864E5),e=Math.floor((b-864E5*c)/36E5),f=Math.floor((b-864E5*c-36E5*e)/6E4);return""+c+"\u5929"+(""+e)+"\u5c0f\u65f6"+(""+f)+"\u5206"+(""+Math.floor((b-864E5*c-36E5*e-6E4*f)/1E3))+"\u79d2"}return null}});puremvc.define({name:"app.data.HomeBuildingData"},{},{HALL:1,FOLK_HOUSE:2,MARKET:3,STRATEGY:4,DRILL_GROUND:5,SMALL_GAME:6,ARMYGROUP:7,HuBu:8,limit:[10,25,45,2,15,35,8,8,40,1,1,15,30,10,10,15,40,2,2,15,30,35,2,2,2,2,2,10,20,10,20,2],tradeLimit:[40],Building:[{id:1,name:"\u4e3b\u57ce",x:470,y:50,buttons:["\u5b98\u804c","\u5c5e\u81e3"],descript:["\u4e3b\u57ce\u7684\u7b49\u7ea7\u5c31\u662f\u73a9\u5bb6\u7684\u7b49\u7ea7\uff0c\u5176\u4ed6\u5efa\u7b51\u548c\u6b66\u5c06\u7b49\u7ea7\u90fd\u65e0\u6cd5\u8d85\u8d8a\u4e3b\u57ce\u7b49\u7ea7\u3002"]},
{id:2,name:"\u6c11\u5c45",x:359,y:134,buttons:["\u5de1\u67e5"],descript:["\u6c11\u5c45\u7684\u7b49\u7ea7\u8d8a\u9ad8\uff0c\u5f81\u6536\u83b7\u5f97\u7684\u94f6\u5e01\u8d8a\u591a\uff0c\u94f6\u5e01\u548c\u7cae\u98df\u7684\u5b58\u50a8\u4e0a\u9650\u4e5f\u8d8a\u9ad8\u3002"]},{id:3,name:"\u5e02\u573a",x:454,y:178,buttons:["\u5175\u5668\u94fa","\u7cae\u98df\u4e70\u5356","\u59d4\u6d3e"],descript:["\u8fdb\u884c\u88c5\u5907\u8d2d\u4e70\u3001\u7cae\u98df\u4e70\u5356\u7684\u5730\u65b9\u3002\u5347\u7ea7\u5e02\u573a\u53ef\u4ee5\u63d0\u9ad8\u6bcf\u65e5\u7cae\u98df\u4e70\u5356\u7684\u4ea4\u6613\u91cf\u3002"]},
{id:4,name:"\u7b56\u7565\u5e9c",x:276,y:60,buttons:["\u79d1\u6280","\u9635\u6cd5"],descript:["\u8fdb\u884c\u79d1\u6280\u3001\u9635\u6cd5\u548c\u5546\u4e1a\u7814\u7a76\u7684\u5730\u65b9\uff0c\u5347\u7ea7\u7b56\u7565\u5e9c\u53ef\u4ee5\u5f00\u542f\u65b0\u7684\u7814\u7a76\u9879\u76ee\u3002"]},{id:5,name:"\u6821\u573a",x:333,y:281,buttons:["\u8bad\u7ec3","\u62db\u52df","\u5f81\u5175"],descript:["\u8fdb\u884c\u6b66\u5c06\u8bad\u7ec3\u3001\u62db\u52df\u548c\u5f81\u5175\u7684\u5730\u65b9\u3002\u6821\u573a\u7b49\u7ea7\u8d8a\u9ad8\uff0c\u6b66\u5c06\u8bad\u7ec3\u65f6\u83b7\u5f97\u7684\u7ecf\u9a8c\u8d8a\u591a\uff0c\u5e76\u4e14\u53ef\u4ee5\u63d0\u9ad8\u5175\u529b\u4e0a\u9650\u3002"]},
{id:6,name:"\u5b88\u57ce",x:158,y:283,buttons:[],descript:[""]},{id:7,name:"\u519b\u56e2",x:174,y:189,buttons:[],descript:[""]},{id:8,name:"\u6237\u90e8",x:562,y:224,buttons:["\u5f81\u6536","\u6536\u83b7","\u751f\u4ea7"],descript:['\u6237\u90e8\u7684\u7b49\u7ea7\u51b3\u5b9a\u4e86\u751f\u4ea7\u5546\u54c1\u7684\u7b49\u7ea7\u548c\u6536\u83b7\u7684\u7cae\u98df\u4ea7\u91cf\u3002<label class="fc4">\u6ce8\uff1a\u6bcf\u65e5\u51cc\u66684\u70b9</label>\uff0c\u7cfb\u7edf\u5c06\u5bf9\u751f\u4ea7\u4e2d\u7684\u5269\u4f59\u5e93\u5b58\u6309\u7167\u5e02\u573a\u4ef7\u683c\u51fa\u552e\u3002']}],
Path:app.GameData.imageSrc+"building/build"});puremvc.define({name:"app.data.BaseVO"},{update:function(b){for(var c in b)null!=b[c]&&(this[c]=b[c])}});puremvc.define({name:"app.data.BuildingVO",parent:app.data.BaseVO},{id:0,level:1,needMoney:0,needTime:null});puremvc.define({name:"app.data.DataBase"},{data:null,setData:function(b){this.data=b},getTalkEvent:function(b){for(var c in this.data.SysConfTalkEvent)if(this.data.SysConfTalkEvent[c].id==b)return this.data.SysConfTalkEvent[c];return null},getLevyEvent:function(b){for(var c in this.data.SysConfTaxEvent)if(this.data.SysConfTaxEvent[c].id==b)return this.data.SysConfTaxEvent[c];return null},getOfficialInfo:function(b){for(var c in this.data.SysConfPrestige)if(this.data.SysConfPrestige[c].level==b)return this.data.SysConfPrestige[c];
return null},getOfficialDescript:function(b,c){var e="";if(null!=b.heroIds&&0<b.heroIds.length){for(var e=b.heroIds.split(","),f=[],g,h=0;h<e.length;h++)(g=app.data.DataBase.getInstance().getHeroInfo(parseInt(e[h].trim())))&&g.countryId==c&&f.push(g.name);e="\u53ef\u4ee5\u83b7\u5f97\u65b0\u6b66\u5c06\uff1a"+f.join("&nbsp;")}else if(null!=b.description&&0<b.description.length)e=b.description;return e},getOfficialByPrestige:function(b){for(var c=this.data.SysConfPrestige.length,e=0;e<c;e++){if(e<c-
1&&b>=this.data.SysConfPrestige[e].value&&b<this.data.SysConfPrestige[e+1].value)return this.data.SysConfPrestige[e];if(e==c-1&&b>=this.data.SysConfPrestige[e].value)return this.data.SysConfPrestige[c-1]}},queryOfficialInfoByCount:function(b,c){for(var e=this.data.SysConfPrestige.length,f,g=0;g<e;g++){switch(c){case 1:f=this.data.SysConfPrestige[g].heroNum;break;case 2:f=this.data.SysConfPrestige[g].liegemanNum;break;case 3:f=this.data.SysConfPrestige[g].fieldNum;break;case 4:f=this.data.SysConfPrestige[g].mineNum}if(b==
f)return this.data.SysConfPrestige[g]}},getHeroCareer:function(b){for(var c in this.data.SysConfHeroCareer)if(this.data.SysConfHeroCareer[c].id==b)return this.data.SysConfHeroCareer[c]},getBufferInfo:function(b){for(var c in this.data.SysConfBuffer)if(this.data.SysConfBuffer[c].id==b)return this.data.SysConfBuffer[c];return null},getSkillInfo:function(b){for(var c in this.data.SysConfSkill)if(this.data.SysConfSkill[c].id==b)return this.data.SysConfSkill[c];return null},getBattleMapInfo:function(b){for(var c in this.data.SysConfMap)if(this.data.SysConfMap[c].id==
b)return this.data.SysConfMap[c];return null},getArmyInfo:function(b,c){if(0==c)return null;for(var e in this.data.SysConfBarrier)if(this.data.SysConfBarrier[e].mapId==b&&this.data.SysConfBarrier[e].barrierId==c)return this.data.SysConfBarrier[e];return null},getMapArmyList:function(b){var c=[],e;for(e in this.data.SysConfBarrier)this.data.SysConfBarrier[e].mapId==b&&c.push(this.data.SysConfBarrier[e]);if(0==c.length)return null;sortOn(c,"barrierId");return c},getArmyGroupInfo:function(b,c){for(var e in this.data.SysConfMapPos)if(this.data.SysConfMapPos[e].mapId==
c&&this.data.SysConfMapPos[e].id==b)return this.data.SysConfMapPos[e];return null},getHeroInfo:function(b){var c={},e;for(e in this.data.SysConfHero)if(c=this.data.SysConfHero[e],c.id==b){c=clone(c);b=this.getHeroCareer(this.data.SysConfHero[e].careerId);null!=b&&(c.careerName=b.name);e=this.getSkillInfo(this.data.SysConfHero[e].skillId);if(null!=e)c.skillName=e.name,c.desc=e.desc;return c}return null},getSoldierTypeInfo:function(b){for(var c in this.data.SysConfSoldierType)if(this.data.SysConfSoldierType[c].id==
b)return this.data.SysConfSoldierType[c];return null},getSoldierInfo:function(b){for(var c in this.data.SysConfSoldier)if(this.data.SysConfSoldier[c].id==b){b=clone(this.data.SysConfSoldier[c]);if(c=app.data.DataBase.getInstance().getSoldierTypeInfo(b.soldierType))b.typeName=c.name;return b}return null},getCapacityRank:function(b,c){switch(b){case 1:case 3:case 5:if(0.95<=c)return"S";if(0.8<=c&&0.95>c)return"A";if(0.65<=c&&0.8>c)return"B";if(0.55<=c&&0.65>c)return"C";if(0.3<=c&&0.55>c)return"D";if(0.3>
c)return"E";break;case 2:case 4:case 6:if(0.8<=c)return"S";if(0.6<c&&0.8>c)return"A";if(0.5<=c&&0.6>=c)return"B";if(0.3<c&&0.5>c)return"C";if(0.2<=c&&0.3>=c)return"D";if(0.2>c)return"E"}},getItemInfo:function(b){for(var c in this.data.SysConfEquipment)if(this.data.SysConfEquipment[c].id==b)return this.data.SysConfEquipment[c];return null},getAttrName:function(b){return"\u7269\u7406\u653b\u51fb,\u7269\u7406\u9632\u5fa1,\u6218\u6cd5\u9632\u5fa1,\u8ba1\u7b56\u9632\u5fa1,\u6218\u6cd5\u653b\u51fb,\u8ba1\u7b56\u653b\u51fb,\u5e26\u5175\u91cf,\u5355\u6311\u4f24\u5bb3,\u5355\u6311\u6b66\u529b,\u5355\u6311\u8840\u91cf".split(",")[b-
1]},getTechDataInit:function(){var b,c;b=[];for(var e in this.data.SysConfTech)c=new app.data.StrategyVO(this.data.SysConfTech[e].id),c.level=0,b.push(c);return b},getTechInfo:function(b){for(var c in this.data.SysConfTech)if(this.data.SysConfTech[c].id==b)return this.data.SysConfTech[c];return null},getCoolDownInfo:function(b){for(var c in this.data.SysConfCooldownQueue)if(this.data.SysConfCooldownQueue[c].id==b)return this.data.SysConfCooldownQueue[c];return null},getCollDownMoney:function(b,c){var e=
app.data.DataBase.getInstance().getCoolDownInfo(b);return c<=e.baseTime?e.baseMoney:e.baseMoney+Math.ceil((c-e.baseTime)/e.intervalTime)*e.intervalMoney},getShopInfo:function(b){for(var c in this.data.SysConfShop)if(this.data.SysConfShop[c].id==b)return this.data.SysConfShop[c];return null},getRewardName:function(b){for(var c in this.data.SysConfRewardType)if(this.data.SysConfRewardType[c].id==b)return this.data.SysConfRewardType[c].name},getRewardInfo:function(b){for(var c in this.data.SysConfRewardType)if(this.data.SysConfRewardType[c].id==
b.tid){var e={};e.tid=b.tid;e.name=this.data.SysConfRewardType[c].name;e.value=b.value;e.itemClass="fc7";if(10==e.tid)e.name=this.getItemInfo(b.id).name,e.itemId=b.id,e.itemClass=app.getStyle(this.getItemInfo(b.id).qualityId);e.img=this.getImg(e);return e}},getImg:function(b){var c=app.GameData.imageSrc;1==b.tid?c+="ui/silvercoin.png":2==b.tid?c+="ui/goldcoin.png":4==b.tid?c+="ui/food.gif":5==b.tid||7==b.tid?c+="ui/zhangong.gif":8==b.tid?c+="ui/weiwang.gif":10==b.tid&&(c+="items/i_"+b.itemId+".jpg");
return c},getInspectInfo:function(b,c){var e=["SysConfInspectRole","SysConfInspectRegion","SysConfInspectLocation"][b];if(this.data[e])for(var f in this.data[e])if(this.data[e][f].id==c)return this.data[e][f]},getInpectRoleName:function(b){for(var c in this.data.SysConfInspectRole)if(this.data.SysConfInspectRole[c].id==b)return this.data.SysConfInspectRole[c].name;return""},computeCost:function(b,c){if(!(0>c))for(var e in this.data.SysConfCooldownQueue)if(this.data.SysConfCooldownQueue[e].id==b){var f=
this.data.SysConfCooldownQueue[e];if(f)return c<f.baseTime?f.baseMoney:f.baseMoney+Math.ceil((c-f.baseTime)/f.intervalTime)*f.intervalMoney}return 0},getResourcePageCount:function(b){var c=0,e;for(e in this.data.SysConfResources)this.data.SysConfResources[e].city==b&&(c+=1);return c},getResourceInfo:function(b,c){var e,f,g=[];for(f in this.data.SysConfResources)this.data.SysConfResources[f].city==b&&this.data.SysConfResources[f].block==c&&(e=this.data.SysConfResources[f]);if(null!=e)for(f in e=e.silver,
this.data.SysConfResourcesType)this.data.SysConfResourcesType[f].id==e&&g.push(this.data.SysConfResourcesType[f]);return g},getNPCEvent:function(b){for(var c in this.data.SysConfNPCEvent)if(this.data.SysConfNPCEvent[c].id==b)return this.data.SysConfNPCEvent[c]},getMainCityDescription:function(b){for(var c in this.data.SysConfMainCityStatus)if(this.data.SysConfMainCityStatus[c].id==b)return this.data.SysConfMainCityStatus[c].description},getTasksByCategory:function(b){var c=[],e;for(e in this.data.SysConfTask)this.data.SysConfTask[e].category==
b&&c.push(this.data.SysConfTask[e]);return c},getAllCountrys:function(){for(var b=[],c,e=0;e<this.data.SysConfCountry.length;e++){c={};for(var f in this.data.SysConfCountry[e])c[f]=this.data.SysConfCountry[e][f];b.push(c)}return b},getTasksById:function(b){for(var c in this.data.SysConfTask)if(this.data.SysConfTask[c].id==b)return this.data.SysConfTask[c]},getGuideById:function(b){for(var c in this.data.SysConfGuide)if(this.data.SysConfGuide[c].id==b)return this.data.SysConfGuide[c]},getGuideByLevelId:function(b){for(var c in this.data.SysConfGuideLevelUp)if(this.data.SysConfGuideLevelUp[c].id==
b)return this.data.SysConfGuideLevelUp[c]},getGuideByBattleId:function(b){for(var c in this.data.SysConfGuideBattle)if(this.data.SysConfGuideBattle[c].id==b)return this.data.SysConfGuideBattle[c]},getGuideByLevel:function(b){for(var c in this.data.SysConfGuideLevelUp)if(this.data.SysConfGuideLevelUp[c].condition==b)return this.data.SysConfGuideLevelUp[c]},getGuideByEnemyId:function(b){for(var c in this.data.SysConfGuideBattle)if(this.data.SysConfGuideBattle[c].condition==b)return this.data.SysConfGuideBattle[c]},
getNextPhaseId:function(b){for(var c in this.data.SysConfGuide)if(this.data.SysConfGuide[c].phaseId==b)return this.data.SysConfGuide[c].id},getFestivalInfo:function(b){for(var c in this.data.SysConfFestival)if(this.data.SysConfFestival[c].id==b)return this.data.SysConfFestival[c]}},{_instance:null,getInstance:function(){var b=app.data.DataBase;if(null==b._instance)b._instance=new b;return b._instance}});puremvc.define({name:"app.data.GameVO",parent:app.data.BaseVO},{year:180,season:0,warTokenCost:0,time:0,notice:null});puremvc.define({name:"app.data.IndicateVO",parent:app.data.BaseVO},{id:0,type:0,index:0,time:0,num:0,maxNum:0,full:!1,update:function(b){var c=app.proxy.IndicateProxy,e;for(e in b)if(null!=b[e])"time"==e?this.time=new app.data.TimeVO(b.time):("type"==e&&(b[e]==c.TYPE_3?this.index=1:b[e]==c.TYPE_6?this.index=2:b[e]==c.TYPE_5?this.index=3:b[e]==c.TYPE_4?this.index=4:b[e]==c.TYPE_9?this.index=5:b[e]==c.TYPE_7&&(this.index=b.id)),this[e]=b[e])}});puremvc.define({name:"app.data.UserVO",parent:app.data.BaseVO},{roleId:0,heroId:0,name:"",silverCoin:0,maxSilverCoin:0,goldCoin:0,grain:0,maxGrain:0,feat:0,troop:0,maxTroop:0,prestige:0,vip:0,warToken:0,maxWarToken:0,cityId:0,country:1,armyGroup:0,forceGolden:0,stealIndicate:null,canBuyWarToken:!0,hasChallenge:!1,hasWorld:!1});puremvc.define({name:"app.data.HeroVO",parent:app.data.BaseVO,constructor:function(b){this.id=b;this.conf=app.data.DataBase.getInstance().getHeroInfo(b)}},{id:0,level:1,defaultSoldier:null,soldier:null,reSoldier:null,onJob:!1,hp:"",newBirth:0,train:null,exp:0,maxExp:0});puremvc.define({name:"app.data.FormationVO",parent:app.data.BaseVO,constructor:function(b){this.id=b;this.conf=app.data.DataBase.getInstance().getTechInfo(b)}},{id:0,level:0,increase:0,location:null,herosPic:null});puremvc.define({name:"app.data.FarmVO",parent:app.data.BaseVO},{nextNumber:0});puremvc.define({name:"app.data.ShopVO",parent:app.data.BaseVO,constructor:function(b){this.update(b);this.conf=app.data.DataBase.getInstance().getItemInfo(b.conId);this.buyCon=app.data.DataBase.getInstance().getShopInfo(b.conId)}},{conId:0,heroName:0,level:1,strike:0,fightBack:0,mitigate:0,nowNum:0,type:0,price:0,getItemName:function(){return this.conf.name},getuseLevel:function(){return this.conf.useLevel},getquality:function(){return this.conf.quality},getattrType:function(){return this.conf.attrType},
gettypeId:function(){return this.conf.typeId},getattrName:function(){return app.data.DataBase.getInstance().getAttrName(this.gettypeId())},getTroop:function(){return this.conf.initTroops},getAtt:function(){return this.conf.initAttr},getBuyNum:function(){return this.buyCon.num},getBuyPrice:function(){return this.buyCon.price},getBuyTypeName:function(){return 1==this.type?"\u94f6\u5e01":"\u91d1\u5e01"},getBuyNumString:function(){return-1!=this.nowNum?"\u5546\u54c1\u6570\u91cf\uff1a"+this.nowNum:"&nbsp;"}});puremvc.define({name:"app.data.BagVO",parent:app.data.BaseVO,constructor:function(b){this.update(b);this.canObtain=0<b.canObtain?new app.data.TimeVO(b.canObtain):-1;this.conf=app.data.DataBase.getInstance().getItemInfo(b.conId);this.heroName=0<b.heroId?app.data.DataBase.getInstance().getHeroInfo(this.heroId).name:""}},{id:0,conId:0,heroId:0,heroName:0,level:1,strike:0,fightBack:0,mitigate:0,lock:0,canObtain:-1,upMoney:0,downMoney:0,getItemName:function(){return this.conf.name},getSellPrice:function(){return this.conf.sellPrice},
getuseLevel:function(){return this.conf.useLevel},getWeaponLevel:function(){return this.conf.level},getquality:function(){return this.conf.qualityId},getattrType:function(){return this.conf.attrType},getattrName:function(){var b;8==this.conf.typeId?0<this.conf.hurt?b=8:0<this.conf.strength?b=9:0<this.conf.hp&&(b=10):b=this.conf.typeId;return app.data.DataBase.getInstance().getAttrName(b)},gettypeId:function(){return this.conf.typeId},getTroop:function(){return this.conf.initTroops+(this.level-1)*
this.conf.troopsGrow},getAtt:function(){if(8==this.conf.typeId){var b;if(0<this.conf.hurt)b=this.conf.hurt;else if(0<this.conf.strength)b=this.conf.strength;else if(0<this.conf.hp)b=this.conf.hp;return b}return this.conf.initAttr+(this.level-1)*this.conf.attrGrow}});puremvc.define({name:"app.data.LevyVO",parent:app.data.BaseVO},{gainSilverCoin:0,forcedGoldCoin:5,popularFeeling:0,people:0,development:0,account:0,tax:0,coinage:0,incident:0});puremvc.define({name:"app.data.OfficialVO",parent:app.data.BaseVO},{canGet:!1,needFeat:0,obtainPrestige:0,needTime:null,update:function(b){for(var c in b)"needTime"==c?this.needTime=new app.data.TimeVO(b.needTime):this[c]=b[c]}});puremvc.define({name:"app.data.SoldierVO",parent:app.data.BaseVO,constructor:function(b){this.id=b;this.conf=app.data.DataBase.getInstance().getSoldierInfo(b);this.attackStr=app.data.DataBase.getInstance().getCapacityRank(1,this.conf.attack);this.defenseStr=app.data.DataBase.getInstance().getCapacityRank(2,this.conf.defense);this.battleAttackStr=app.data.DataBase.getInstance().getCapacityRank(3,this.conf.battleAttack);this.battleDefenseStr=app.data.DataBase.getInstance().getCapacityRank(4,this.conf.battleDefense);
this.strategyAttackStr=app.data.DataBase.getInstance().getCapacityRank(5,this.conf.strategyAttack);this.strategyDefenseStr=app.data.DataBase.getInstance().getCapacityRank(6,this.conf.strategyDefense)}},{id:0});puremvc.define({name:"app.data.MarketVO",parent:app.data.BaseVO},{maxTrade:null,traded:null,rate:null,up:null});puremvc.define({name:"app.data.TroopVO",parent:app.data.BaseVO},{position:0,name:0,hp:0,maxHp:0,morale:0,level:0,isAttack:!1});puremvc.define({name:"app.data.StrategyVO",parent:app.data.BaseVO,constructor:function(b){this.id=b;this.conf=app.data.DataBase.getInstance().getTechInfo(b)}},{id:0,level:0});puremvc.define({name:"app.data.LiegemanVO",parent:app.data.BaseVO},{liegemanId:0,name:"",level:0,post:0,group:"",area:"",handInCoin:0,handInTime:""});puremvc.define({name:"app.data.TalksVO",parent:app.data.BaseVO,constructor:function(b){this.init(b)}},{type:0,prevType:0,id:0,count:0,goldCoin:10,maxCount:6,reward:null,savePrevConf:function(){this.prevConf={};for(var b in this.conf)this.prevConf[b]=this.conf[b];this.prevType=this.type},upConf:function(){this.savePrevConf();this.init(this.id)},setReward:function(b){this.reward=[];for(var c,e=0;e<b.length;e++){c=b[e];if(10==c.tid){var f=app.data.DataBase.getInstance().getItemInfo(c.id);c.name=f.name;
c.qualityId=f.qualityId}else c.name=app.data.DataBase.getInstance().getRewardName(c.tid);this.reward.push(c)}},init:function(b){0<b?(this.id=b,this.type=0,this.conf=app.data.DataBase.getInstance().getTalkEvent(this.id),this.conf.name=app.data.DataBase.getInstance().getInpectRoleName(this.conf.person)):(this.id=Math.abs(b),this.type=1,this.conf=app.data.DataBase.getInstance().getHeroInfo(this.id))}});puremvc.define({name:"app.data.WorkShopGoodsVO",parent:app.data.BaseVO,constructor:function(b){this.id=b.id;this.name=this.getName(b.id);this.quality=b.quality;this.qualityExp=b.qualityExp;this.stock=b.stock;this.value=b.value}},{id:0,name:null,quality:0,qualityExp:0,stock:0,value:0,getName:function(b){switch(b){case 1:return"\u6307\u5357\u9488";case 2:return"\u706b\u836f";case 3:return"\u5370\u5237";case 4:return"\u9020\u7eb8"}}});puremvc.define({name:"app.data.WorkShopVO",parent:app.data.BaseVO,constructor:function(b){this.remainProduceNum=b.remainProduceNum;this.forceGoldNeeded=b.forceGoldNeeded;this.goods=b.goods}},{remainProduceNum:0,coolTime:null,forceGoldNeeded:0,goods:null,selectedIdx:0});puremvc.define({name:"app.data.PatrolVO",parent:app.data.BaseVO,constructor:function(){}},{count:0,total:0,humanId:0,areaId:0,placeId:0,equipId:null,getName:function(b,c){var e=app.data.DataBase.getInstance().getInspectInfo(b,c);if(b==app.view.building.PatrolView.PATROL_AREA)return e.region;if(b==app.view.building.PatrolView.PATROL_PLACE)return e.location;if(b==app.view.building.PatrolView.PATROL_HUMAN)return e.name},getEquip:function(b){return b&&(b=app.data.DataBase.getInstance().getItemInfo(b))?
b:""}});puremvc.define({name:"app.data.ArmyVO",parent:app.data.BaseVO,constructor:function(b,c){if(null!=b)this.id=c,this.conf=app.data.DataBase.getInstance().getArmyInfo(b,c)}},{id:0,passed:!1,count:0,reward:"",quality:1,probability:0,attack:!1,strategyList:null,setReward:function(b){b=app.data.DataBase.getInstance().getItemInfo(Number(b));this.reward=b.name;this.quality=b.qualityId},getProbability:function(){return",\u6781\u9ad8,\u8f83\u9ad8,\u4e00\u822c,\u8f83\u4f4e,\u6781\u4f4e".split(",")[this.probability]}});puremvc.define({name:"app.data.BattleMapVO",parent:app.data.BaseVO,constructor:function(b){this.id=b;this.conf=app.data.DataBase.getInstance().getBattleMapInfo(b)}},{id:0,isFirst:!1,complete:0,groupList:null,index:0,gId:0,setGroupList:function(){var b=this.armyList.length,c,e;this.groupList=[];for(var f=0;f<b;f++){e=this.armyList[f];var g=e.conf.groupId;null==this.groupList[g-1]?(c=new app.data.ArmyGroupVO(e.conf.groupId,this.id),c.armyList=[],c.barrierType=e.conf.barrierType,c.armyList.push(e),this.groupList[g-
1]=c):this.groupList[g-1].armyList.push(e)}},getArmyList:function(b){var b=app.data.DataBase.getInstance().getMapArmyList(b),c=b.length,e;this.armyList=[];for(i=0;i<c;i++)e=new app.data.ArmyVO,e.id=b[i].barrierId,e.conf=b[i],this.armyList.push(e)}});puremvc.define({name:"app.data.ArmyGroupVO",parent:app.data.BaseVO,constructor:function(b,c){this.id=b;this.conf=app.data.DataBase.getInstance().getArmyGroupInfo(b,c)}},{id:0,armyList:null,passed:!1,armyId:0,barrierType:0,prevGroupPassed:!1,updatePassed:function(){for(var b=!0,c=0;c<this.armyList.length;c++)if(!1==this.armyList[c].passed){b=!1;this.armyId=this.armyList[c].id;break}this.passed=b}});puremvc.define({name:"app.data.ResourceVO",parent:app.data.BaseVO,constructor:function(){}},{countryId:null,resList:null,type:null,page:null,maxPageNum:null,getInfoByCountryId:function(b,c){return null!=b?app.data.DataBase.getInstance().getResourceInfo(b,c):null},getResMaxPage:function(b){return null!=b?app.data.DataBase.getInstance().getResourcePageCount(b):null}});puremvc.define({name:"app.data.ResourceNpcVO",parent:app.data.BaseVO,constructor:function(){}},{countryId:null,page:null,id:null,type:null,output:null,iconId:null,captureTime:null,protectTime:0,userId:null,userName:null,level:null,desc:null,posX:null,posY:null,isPatrol:!1,isDouble:!1,flag:null});puremvc.define({name:"app.data.WorldMapData"},{},{cities:[{id:1,name:"\u957f\u5b89",x:398,y:334,color:1,countryname:"\u4e2d\u7acb",levelmax:10,characteristic:"\u666e\u901a",ishold:0,business:1E4,businessmax:6E4,trade:1E4,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u82f1\u96c4\u4e0d\u95ee\u51fa\u5904",combatloss:0,bgId:1},{id:2,name:"\u6d1b\u9633",x:283,y:334,color:1,countryname:"\u4e2d\u7acb",levelmax:20,characteristic:"\u666e\u901a",
ishold:0,business:1E4,businessmax:6E4,trade:1E4,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u767d\u8d77",combatloss:0.2,bgId:3},{id:3,name:"\u71d5\u4eac",x:509,y:100,color:2,countryname:"\u534e\u590f",levelmax:40,characteristic:"\u666e\u901a",ishold:0,business:1E4,businessmax:6E4,trade:1E4,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u674e\u65af",
combatloss:0.3,bgId:2},{id:4,name:"\u90ba\u57ce",x:375,y:193,color:2,countryname:"\u534e\u590f",levelmax:60,characteristic:"\u666e\u901a",ishold:0,business:1E4,businessmax:6E4,trade:1E4,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u8427\u4f55",combatloss:0.4,bgId:2},{id:5,name:"\u5357\u76ae",x:624,y:183,color:2,countryname:"\u534e\u590f",levelmax:60,characteristic:"\u666e\u901a",ishold:0,business:1E4,businessmax:6E4,
trade:1E4,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u8427\u4f55",combatloss:0.4,bgId:1},{id:6,name:"\u5317\u6d77",x:810,y:84,color:2,countryname:"\u534e\u590f",levelmax:80,characteristic:"\u666e\u901a",ishold:0,business:1E4,businessmax:6E4,trade:15E3,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u5415\u5e03",combatloss:0.7,
bgId:2},{id:7,name:"\u897f\u4eac",x:803,y:222,color:2,countryname:"\u534e\u590f",levelmax:80,characteristic:"\u666e\u901a",ishold:0,business:15E3,businessmax:6E4,trade:1E4,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u5415\u5e03",combatloss:0.7,bgId:1},{id:8,name:"\u8bb8\u660c",x:484,y:240,color:2,countryname:"\u534e\u590f",levelmax:100,characteristic:"\u666e\u901a",ishold:0,business:15E3,businessmax:6E4,trade:15E3,
trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u53f8\u9a6c\u61ff",combatloss:1,bgId:1},{id:9,name:"\u4e91\u5357",x:135,y:513,color:3,countryname:"\u80e1\u5937",levelmax:40,characteristic:"\u666e\u901a",ishold:0,business:1E4,businessmax:6E4,trade:1E4,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u674e\u65af",combatloss:0.3,
bgId:3},{id:10,name:"\u57ce\u90fd",x:172,y:393,color:3,countryname:"\u80e1\u5937",levelmax:60,characteristic:"\u666e\u901a",ishold:0,business:1E4,businessmax:6E4,trade:1E4,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u8427\u4f55",combatloss:0.4,bgId:3},{id:11,name:"\u6c74\u6881",x:83,y:229,color:3,countryname:"\u80e1\u5937",levelmax:60,characteristic:"\u666e\u901a",ishold:0,business:1E4,businessmax:6E4,trade:1E4,
trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u8427\u4f55",combatloss:0.4,bgId:3},{id:12,name:"\u6c49\u4e2d",x:209,y:200,color:3,countryname:"\u80e1\u5937",levelmax:80,characteristic:"\u666e\u901a",ishold:0,business:15E3,businessmax:6E4,trade:1E4,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u5415\u5e03",combatloss:0.7,bgId:3},
{id:13,name:"\u5929\u6c34",x:147,y:120,color:3,countryname:"\u80e1\u5937",levelmax:80,characteristic:"\u666e\u901a",ishold:0,business:1E4,businessmax:6E4,trade:15E3,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u5415\u5e03",combatloss:0.7,bgId:2},{id:14,name:"\u6c38\u5b89",x:280,y:534,color:3,countryname:"\u80e1\u5937",levelmax:100,characteristic:"\u666e\u901a",ishold:0,business:15E3,businessmax:6E4,trade:15E3,
trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u53f8\u9a6c\u61ff",combatloss:1,bgId:3},{id:15,name:"\u4f1a\u7a3d",x:752,y:372,color:4,countryname:"\u5357\u86ee",levelmax:40,characteristic:"\u666e\u901a",ishold:0,business:1E4,businessmax:6E4,trade:1E4,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u674e\u65af",combatloss:0.3,
bgId:1},{id:16,name:"\u5efa\u4e1a",x:861,y:492,color:4,countryname:"\u5357\u86ee",levelmax:60,characteristic:"\u666e\u901a",ishold:0,business:1E4,businessmax:6E4,trade:1E4,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u8427\u4f55",combatloss:0.4,bgId:1},{id:17,name:"\u67f4\u6851",x:761,y:449,color:4,countryname:"\u5357\u86ee",levelmax:60,characteristic:"\u666e\u901a",ishold:0,business:1E4,businessmax:6E4,trade:1E4,
trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u8427\u4f55",combatloss:0.4,bgId:1},{id:18,name:"\u957f\u6c99",x:521,y:522,color:4,countryname:"\u5357\u86ee",levelmax:80,characteristic:"\u666e\u901a",ishold:0,business:15E3,businessmax:6E4,trade:1E4,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u5415\u5e03",combatloss:0.7,bgId:1},
{id:19,name:"\u6b66\u9675",x:679,y:497,color:4,countryname:"\u5357\u86ee",levelmax:80,characteristic:"\u666e\u901a",ishold:0,business:1E4,businessmax:6E4,trade:15E3,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:1E4,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u5415\u5e03",combatloss:0.7,bgId:1},{id:20,name:"\u6c5f\u590f",x:589,y:459,color:4,countryname:"\u5357\u86ee",levelmax:100,characteristic:"\u666e\u901a",ishold:0,business:15E3,businessmax:6E4,trade:15E3,
trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:15E3,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u53f8\u9a6c\u61ff",combatloss:1,bgId:1},{id:21,name:"\u5bff\u6625",x:626,y:367,color:2,countryname:"\u4e89\u593a",levelmax:100,characteristic:"\u77ff\u4e1a\u4e2d\u5fc3",ishold:1,business:15E3,businessmax:6E4,trade:1E4,trademax:3E4,mineral:1E4,mineralmax:6E4,agriculture:15E3,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u53f8\u9a6c\u61ff",
combatloss:1,bgId:1},{id:22,name:"\u4e0b\u90b3",x:690,y:290,color:2,countryname:"\u4e89\u593a",levelmax:100,characteristic:"\u8d38\u6613\u4e2d\u5fc3",ishold:1,business:15E3,businessmax:6E4,trade:1E4,trademax:6E4,mineral:1E4,mineralmax:3E4,agriculture:15E3,agriculturemax:6E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u53f8\u9a6c\u61ff",combatloss:1,bgId:1},{id:23,name:"\u6c5d\u5357",x:302,y:433,color:3,countryname:"\u4e89\u593a",levelmax:100,characteristic:"\u519c\u4e1a\u4e2d\u5fc3",
ishold:1,business:1E4,businessmax:6E4,trade:15E3,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:15E3,agriculturemax:6E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u53f8\u9a6c\u61ff",combatloss:1,bgId:1},{id:24,name:"\u5b9b\u57ce",x:421,y:402,color:3,countryname:"\u4e89\u593a",levelmax:100,characteristic:"\u77ff\u4e1a\u4e2d\u5fc3",ishold:1,business:1E4,businessmax:6E4,trade:15E3,trademax:3E4,mineral:1E4,mineralmax:3E4,agriculture:15E3,agriculturemax:3E4,military:1E4,militarymax:3E4,
moveconditiondes:"\u6253\u8d25\u53f8\u9a6c\u61ff",combatloss:1,bgId:1},{id:25,name:"\u6c5f\u9675",x:528,y:378,color:4,countryname:"\u4e89\u593a",levelmax:100,characteristic:"\u519c\u4e1a\u4e2d\u5fc3",ishold:1,business:1E4,businessmax:6E4,trade:1E4,trademax:3E4,mineral:15E3,mineralmax:3E4,agriculture:15E3,agriculturemax:6E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u53f8\u9a6c\u61ff",combatloss:1,bgId:3},{id:26,name:"\u8944\u9633",x:402,y:490,color:4,countryname:"\u4e89\u593a",levelmax:100,
characteristic:"\u8d38\u6613\u4e2d\u5fc3",ishold:1,business:1E4,businessmax:6E4,trade:1E4,trademax:6E4,mineral:15E3,mineralmax:3E4,agriculture:15E3,agriculturemax:3E4,military:1E4,militarymax:3E4,moveconditiondes:"\u6253\u8d25\u53f8\u9a6c\u61ff",combatloss:1,bgId:1}]});puremvc.define({name:"app.data.AreaVO",parent:app.data.BaseVO,constructor:function(){}},{countryId:null,townList:null,page:null,maxPageNum:null,protectTime:null});puremvc.define({name:"app.data.TownVO",parent:app.data.BaseVO,constructor:function(){}},{id:null,flag:null,rid:null,userName:null,level:null,masterId:null,masterName:null,slaveIds:null,slaveNames:null,status:null,protectTime:null,note:null});puremvc.define({name:"app.data.AreaData"},{},{area1:[{x:34,y:113},{x:115,y:90},{x:189,y:115},{x:110,y:150},{x:40,y:178},{x:280,y:60},{x:350,y:95},{x:297,y:150},{x:218,y:179}],area2:[{x:110,y:91},{x:220,y:60},{x:34,y:109},{x:182,y:118},{x:283,y:110},{x:78,y:165},{x:178,y:185},{x:267,y:180},{x:357,y:176}],area3:[{x:180,y:60},{x:280,y:60},{x:350,y:90},{x:87,y:105},{x:189,y:120},{x:280,y:131},{x:116,y:164},{x:228,y:185},{x:360,y:166}]});puremvc.define({name:"app.data.ChatMessageVO",parent:app.data.BaseVO,constructor:function(b){this.update(b)}},{id:0,group:0,rid:0,name:"",type:0,msg:null,sendTime:0,targetId:12,targetName:null});puremvc.define({name:"app.data.NpcEventVO",parent:app.data.BaseVO,constructor:function(b){var c=app.data.DataBase.getInstance().getNPCEvent(b);this.id=b;this.person=c.person;this.name=app.data.DataBase.getInstance().getInpectRoleName(this.person);this.content=c.content;this.chooseNum1=c.chooseNum1;this.choose1=c.choose1;this.chooseNum2=c.chooseNum2;this.choose2=c.choose2}},{id:null,person:null,name:null,content:null,chooseNum1:null,choose1:null,chooseNum2:null,choose2:null});puremvc.define({name:"app.data.CampaignVO",parent:app.data.BaseVO,constructor:function(){}},{id:null,name:null,desc:null,time:null,rankList:null,userPoint:null,userReward:null,canGetReward:null});puremvc.define({name:"app.data.TaskMainVO",parent:app.data.BaseVO,constructor:function(b){this.update(b)}},{taskId:0,status:1,name:"",con:"",reward:null});puremvc.define({name:"app.data.TaskDayVO",parent:app.data.BaseVO,constructor:function(b){this.update(b);this.getReward(b.rewards)}},{tid:0,name:"",con:"",difficulty:0,progress:0,progressTotal:0,status:1,finishNum:0,finishTotal:0,freshNum:0,freshTotal:0,lotteryPrice:10,finishPrice:10,freshPrice:10,rewards:null,lotteryNum:0,lotteryNumCon:6,getReward:function(b){this.rewards=[];for(var c=b.length,e=0;e<c;e++)this.rewards.push(app.data.DataBase.getInstance().getRewardInfo(b[e]))}});puremvc.define({name:"app.data.AchievementVO",parent:app.data.BaseVO,constructor:function(b){this.update(b);this.getAchInfo(b.achivement);this.getDetail(b.detail)}},{mapId:0,score:0,process:0,AchDetail:null,AchInfoNum:null,AchInfoLevel:null,getDetail:function(b){this.AchDetail=[];for(var c=b.length,e=0;e<c;e++){var f={};f.id=b[e].id;f.score=b[e].score;f.status=b[e].status;f.reward=app.data.DataBase.getInstance().getRewardInfo(b[e].reward[0]);this.AchDetail.push(f)}},getRewardName:function(b){for(var c in this.data.SysConfRewardType)if(this.data.SysConfRewardType[c].id==
b)return this.data.SysConfRewardType[c].name;return null},getAchInfo:function(b){if(null!=b)for(var c=b.length,e=0;e<c;e++)51==b[e].targetType?this.addInfoLevel(b[e]):this.addInfoNum(b[e])},addInfoNum:function(b){if(!this.AchInfoNum)this.AchInfoNum=[];var c={};c.status=b.status;var e=app.data.DataBase.getInstance().getArmyInfo(this.mapId,b.id).name.split("\uff08",2);c.name=e[0];c.picId=app.data.DataBase.getInstance().getArmyInfo(this.mapId,b.id).picId;c.schedule=b.schedule;c.targetValue=b.targetValue;
if(2==c.status)c.schedule=c.targetValue;this.AchInfoNum.push(c)},addInfoLevel:function(b){if(!this.AchInfoLevel)this.AchInfoLevel=[];var c={};c.status=b.status;var e=app.data.DataBase.getInstance().getArmyInfo(this.mapId,b.id).name.split("\uff08",2);c.name=e[0];c.level=this.getLevel(b.targetValue);this.AchInfoLevel.push(c)},getLevel:function(b){return"SSS,SS,S,A,B,C,D,E,F".split(",")[b-1]},getAchivement:function(b){for(var c=0;c<this.achivement.length;c++)if(this.achivement[c].id==b)return this.achivement[c];
return null}});puremvc.define({name:"app.data.MailVO",parent:app.data.BaseVO},{sendName:null,sendTitle:null,sendContent:null});puremvc.define({name:"app.data.CampaignData"},{},{conf:[{id:1,name:"\u8d22\u6e90\u5e7f\u8fdb",desc:"\u5728\u6d3b\u52a8\u65f6\u95f4\u5185\u83b7\u5f97\u7684\u94f6\u4e24\u5c06\u4f1a\u6298\u7b97\u4e3a\u79ef\u5206\uff0c\u79ef\u5206\u8fbe\u52305000\u5206\u65f6\uff0c\u5373\u53ef\u4ee5\u9886\u53d6\u5956\u52b1\uff0c\u79ef\u5206\u8d8a\u591a\uff0c\u6392\u540d\u8d8a\u9ad8\uff0c\u5956\u52b1\u7684\u94f6\u4e24\u8d8a\u591a\u3002"},{id:2,name:"\u540d\u5c06\u4f20\u8bf4",desc:"\u5728\u6d3b\u52a8\u65f6\u95f4\u5185\u6b66\u5c06\u63d0\u5347\u7684\u7b49\u7ea7\u5c06\u4f1a\u6298\u7b97\u4e3a\u79ef\u5206\uff0c\u79ef\u5206\u8fbe\u523050\u5206\u65f6\uff0c\u5373\u53ef\u4ee5\u9886\u53d6\u5956\u52b1\uff0c\u79ef\u5206\u8d8a\u591a\uff0c\u6392\u540d\u8d8a\u9ad8\uff0c\u5956\u52b1\u7684\u94f6\u4e24\u8d8a\u591a\u3002"},
{id:3,name:"\u5e73\u5b9a\u4e2d\u539f",desc:"\u5728\u6d3b\u52a8\u65f6\u95f4\u5185\u83b7\u5f97\u7684\u6218\u529f\u5c06\u4f1a\u6298\u7b97\u4e3a\u79ef\u5206\uff0c\u79ef\u5206\u8fbe\u5230100\u5206\u65f6\uff0c\u5373\u53ef\u4ee5\u9886\u53d6\u5956\u52b1\uff0c\u79ef\u5206\u8d8a\u591a\uff0c\u6392\u540d\u8d8a\u9ad8\uff0c\u5956\u52b1\u7684\u94f6\u4e24\u8d8a\u591a\u3002"},{id:4,name:"\u98ce\u8c03\u96e8\u987a",desc:"\u5728\u6d3b\u52a8\u65f6\u95f4\u5185\u83b7\u5f97\u7684\u7cae\u98df\u5c06\u4f1a\u6298\u7b97\u4e3a\u79ef\u5206\uff0c\u79ef\u5206\u8fbe\u52301000\u5206\u65f6\uff0c\u5373\u53ef\u4ee5\u9886\u53d6\u5956\u52b1\uff0c\u79ef\u5206\u8d8a\u591a\uff0c\u6392\u540d\u8d8a\u9ad8\uff0c\u5956\u52b1\u7684\u94f6\u4e24\u8d8a\u591a\u3002"},
{id:5,name:"\u540d\u626c\u5929\u4e0b",desc:"\u5728\u6d3b\u52a8\u65f6\u95f4\u5185\u83b7\u5f97\u7684\u5a01\u671b\u5c06\u4f1a\u6298\u7b97\u4e3a\u79ef\u5206\uff0c\u79ef\u5206\u8fbe\u5230100\u5206\u65f6\uff0c\u5373\u53ef\u4ee5\u9886\u53d6\u5956\u52b1\uff0c\u79ef\u5206\u8d8a\u591a\uff0c\u6392\u540d\u8d8a\u9ad8\uff0c\u5956\u52b1\u7684\u94f6\u4e24\u8d8a\u591a\u3002"},{id:6,name:"\u4e89\u9738\u56db\u65b9",desc:"\u5728\u6d3b\u52a8\u65f6\u95f4\u5185\u6210\u529f\u653b\u51fb\u654c\u4eba\u7684\u6b21\u6570\u5c06\u4f1a\u6298\u7b97\u4e3a\u79ef\u5206\uff0c\u79ef\u5206\u8fbe\u52305\u5206\u65f6\uff0c\u5373\u53ef\u4ee5\u9886\u53d6\u5956\u52b1\uff0c\u79ef\u5206\u8d8a\u591a\uff0c\u6392\u540d\u8d8a\u9ad8\uff0c\u5956\u52b1\u7684\u94f6\u4e24\u8d8a\u591a\u3002"}]});puremvc.define({name:"app.data.PlayerColorData"},{},{data:[{id:1,name:"\u5f31\u4e0d\u7981\u98ce",color:"#FFFFFF"},{id:2,name:"\u51f6\u795e\u6076\u715e",color:"#33CCFF"},{id:3,name:"\u7a77\u51f6\u6781\u6076",color:"#66FF33"},{id:4,name:"\u7f6a\u5927\u6076\u6781",color:"#FFFF00"},{id:5,name:"\u5341\u6076\u4e0d\u8d66",color:"#FF5226"},{id:6,name:"\u5929\u7406\u96be\u5bb9",color:"#9859FF"}]});puremvc.define({name:"app.data.GroupResearchVO",parent:app.data.BaseVO,constructor:function(b){this.update(b)}},{id:0,maxSchedule:0,name:"",rank:0,schedule:0});puremvc.define({name:"app.data.GroupVO",parent:app.data.BaseVO,constructor:function(b){this.update(b)}},{id:0,name:"",level:0,teamNum:0,groupNum:0,colonel:"",colonelId:null,country:"",rank:0,declaration:"",announcement:""});puremvc.define({name:"app.data.SmallGameData"},{},{data:[{id:1,hp:1,rewardType:1,rewardValue:15,speed:5},{id:2,hp:1,rewardType:2,rewardValue:3,speed:5},{id:3,hp:2,rewardType:1,rewardValue:25,speed:4},{id:4,hp:2,rewardType:2,rewardValue:6,speed:4},{id:5,hp:3,rewardType:1,rewardValue:50,speed:3},{id:6,hp:4,rewardType:3,rewardValue:1,speed:2}]});puremvc.define({name:"app.view.base.BaseUIForm",parent:EventDispatcher,constructor:function(b,c,e){EventDispatcher.call(this);b&&this._init(b,c,e)}},{view:null,data:null,_init:function(b,c,e){this.container=document.createElement("div");"string"==typeof b?this.container.innerHTML=b:this.container.appendChild(b);this.view=this.container.getElementsByTagName("div")[0];if(c)null==e&&(e=0.6),this.mask=app.view.ViewUtils.createMask("#000",e),this.container.insertBefore(this.mask,this.view);this.container.style.position=
"absolute";this.view.style.position="absolute";app.GameData.UIFormDiv.appendChild(this.container);this._scaleView(this.view)},changeView:function(){this._scaleView(this.view);if(this.mask)this.mask.style.width=app.GameData.gameCanvas.width+"px",this.mask.style.height=app.GameData.gameCanvas.height+"px"},_scaleView:function(b){var c=b.clientWidth,e=b.clientHeight,f=app.GameData.gameCanvas.width,g=app.GameData.gameCanvas.height,h=f/480;268*h>g?(h=g/268,c=480>c?0.5*(480*h-c*h):0,e=0.5*(g-e*h)):(c=0.5*
(f-c*h),e=268>e?0.5*(268*h-e*h):0);b.style["-webkit-transform-origin"]="0 0";b.style["-webkit-transform"]="scale("+h+")";b.style.left=c+"px";b.style.top=e+"px"},setData:function(b){this.data=b},depose:function(){this.removeAllEventListeners();null!=this.mask&&(this.mask[app.Event.MOUSE_UP]=null,this.mask[app.Event.ONCLICK]=null,this.mask[app.Event.MOUSE_DOWN]=null);this.container.parentNode&&this.container.parentNode.removeChild(this.container);this.data=this.container=this.view=null},setPosition:function(b,
c){this.view.style.left=b+"px";this.view.style.top=c+"px"},setVisible:function(b){this.container.style.display=b?null:"none"}},{});puremvc.define({name:"app.view.base.ScrollView",constructor:function(b,c,e,f,g,h,j){var k=this;if(null==h)h=app.GameData.gameCanvas;this.target=h;var l={zooming:!1,bouncing:!1},m;for(m in j)l[m]=j[m];this.scroller=new Scroller(b,l);this.scroller.setDimensions(c,e,f,g);this.scroller.setPosition(0,0);Touch.isSupported()?(this.tochStartHandler=function(b){k.scroller.doTouchStart(b.touches,b.timeStamp);b.preventDefault()},h.addEventListener("touchstart",this.tochStartHandler,!1),this.touchMoveHandler=
function(b){k.scroller.doTouchMove(b.touches,b.timeStamp,b.scale)},document.addEventListener("touchmove",this.touchMoveHandler,!1),this.touchEndHandler=function(b){k.scroller.doTouchEnd(b.timeStamp)},document.addEventListener("touchend",this.touchEndHandler,!1),document.addEventListener("touchcancel",this.touchEndHandler,!1)):(this.mousedown=!1,this.mouseDownHandler=function(b){k.scroller.doTouchStart([{pageX:b.pageX,pageY:b.pageY}],b.timeStamp);k.mousedown=!0},h.addEventListener("mousedown",this.mouseDownHandler),
this.mouseMoveHandler=function(b){if(k.mousedown)k.scroller.doTouchMove([{pageX:b.pageX,pageY:b.pageY}],b.timeStamp),k.mousedown=!0},document.addEventListener("mousemove",this.mouseMoveHandler),this.mouseUpHandler=function(b){if(k.mousedown)k.scroller.doTouchEnd(b.timeStamp),k.mousedown=!1},document.addEventListener("mouseup",this.mouseUpHandler))}},{scroller:null,update:function(b,c,e,f){this.scroller.setDimensions(b,c,e,f);this.scroller.setPosition(0,0)},depose:function(){Touch.isSupported()?(this.target.removeEventListener("touchstart",
this.tochStartHandler,!1),document.removeEventListener("touchmove",this.touchMoveHandler,!1),document.removeEventListener("touchend",this.touchEndHandler,!1),document.removeEventListener("touchcancel",this.touchEndHandler,!1),this.touchEndHandler=this.touchMoveHandler=this.tochStartHandler=this.target=null):(this.target.removeEventListener("mousedown",this.mouseDownHandler),document.removeEventListener("mousemove",this.mouseMoveHandler),document.removeEventListener("mouseup",this.mouseUpHandler),
this.mouseUpHandler=this.mouseMoveHandler=this.mouseDownHandler=this.target=null)}},{});puremvc.define({name:"app.view.base.TabBar",constructor:function(b,c){this.ul=b;this.tabs=[];this.onChange=c;this.current=-1}},{appendTab:function(b){var c=document.createElement("li"),b=this._createBar(b);c.appendChild(b);this.ul.appendChild(c);this.tabs.push(b);var e=this,f=this.tabs.length-1;b.addEventListener(Touch.isSupported()?"touchstart":"click",function(b){if(e.current!=f){e.current=f;e.setTab(f);if(e.onChange)e.onChange(f);b.preventDefault()}},!1)},_createBar:function(b){var c=document.createElement("input");
c.setAttribute("type","button");c.setAttribute("value",b);c.style.border="none";c.style.width="71px";c.style.height="32px";c.className="tab_out";return c},clear:function(){this.ul.innerHTML="";this.tabs=[];this.current=-1},setTab:function(b){for(var c=0;c<this.tabs.length;c++)this.tabs[c].className=c==b?"tab_over":"tab_out"}});puremvc.define({name:"app.view.base.ViewStack",constructor:function(b){this.domDiv=b;this.current=-1;this.contents=[]}},{appendView:function(b){var c=document.createElement("div");"string"==typeof b?c.innerHTML=b:c.appendChild(b);this.domDiv.appendChild(c);this.contents.push(c);return c},clear:function(){this.domDiv.innerHTML="";this.conetens=[];this.current=-1},setView:function(b){if(b<this.contents.length&&b!=this.current)for(var c=0;c<this.contents.length;c++)this.contents[c].style.display=b==
c?"block":"none"}});puremvc.define({name:"app.view.base.TabContentView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0);this.container.style.display="none";b=this.view.querySelector("#tab_ul");this.tabBar=new app.view.base.TabBar(b,ClassUtils.delegate(this,this.tabChange));this.viewStack=new app.view.base.ViewStack(this.view.querySelector("#tab_content"));var c=this;this.view.querySelector("#tab_close").addEventListener(app.Event.CLICK,function(b){c.depose();b.stopPropagation();
b.stopImmediatePropagation()});this.title=this.view.querySelector("#tab_title");this.bottom=this.view.querySelector("#tab_bottom")}},{title:null,append:function(b,c){this.tabBar&&(this.tabBar.appendTab(b),this.viewStack.appendView(c))},show:function(b){try{"block"!=this.container.style.display&&(this.container.style.display="block"),this.tabBar.setTab(b),this.tabChange(b)}catch(c){}},tabChange:function(b){this.viewStack.setView(b)}});puremvc.define({name:"app.view.base.ScrollContainer",constructor:function(b,c,e,f,g,h,j,k,l){var m,o=0,q=0;j||(j=5);k||(k=0);l?(o=l.height,q=l.width):q=o=47;this.list=document.createElement("div");this.list.id=h;b.appendChild(this.list);!j&&0!=j&&(j=5);for(var h=f?Math.ceil(c.length/g):Math.ceil(c.length/2),l=document.createDocumentFragment(),p=0,r=0;r<c.length;r++){var u=this.getPos(p,g,2);this.createNew(l,p,k,"url("+c[r].img+")",q,o,e,u[0],u[1],u[2],g,j);p++}for(;5>p;)l.appendChild(empleItem),p++;
this.list.appendChild(l);var v=this,c=function(b,c,e){v.list.style.WebkitTransform="translate3d("+-b+"px,"+-c+"px,0) scale("+e+")"},e=this.list.getBoundingClientRect();f?(f=h*o+(h-1)*j,m=new Scroller(c,{scrollingX:!1}),m.setPosition(e.left+b.clientLeft,e.top+b.clientTop),m.setDimensions(b.clientWidth,b.clientHeight,this.list.offsetWidth,this.list.offsetHeight+f)):(f=8>=h?0:(h-8)*(j+q),m=new Scroller(c,{scrollingY:!1}),m.setPosition(e.left+b.clientLeft,e.top+b.clientTop),m.setDimensions(b.clientWidth,
b.clientHeight,this.list.offsetWidth+f,this.list.offsetHeight));var t=!1;"ontouchstart"in window?(b.addEventListener("touchstart",function(b){b.target.tagName.match(/input|textarea|select/i)||(b.preventDefault(),m.doTouchStart(b.touches,b.timeStamp))},!1),document.addEventListener("touchmove",function(b){m.doTouchMove(b.touches,b.timeStamp)},!1),document.addEventListener("touchend",function(b){m.doTouchEnd(b.timeStamp)},!1)):(t=!1,b.addEventListener("mousedown",function(b){b.target.tagName.match(/input|textarea|select/i)||
(b.preventDefault(),m.doTouchStart([{pageX:b.pageX,pageY:b.pageY}],b.timeStamp),t=!0)},!1),document.addEventListener("mousemove",function(b){t&&(m.doTouchMove([{pageX:b.pageX,pageY:b.pageY}],b.timeStamp),t=!0)},!1),document.addEventListener("mouseup",function(b){t&&(m.doTouchEnd(b.timeStamp),t=!1)},!1))},createNew:function(b,c,e,f,g,h,j,k,l,m,o,q){var p=document.createElement("div");p.style.position="absolute";0==e?(p.idx=c,p.style.width=g+"px",p.style.height=h+"px",p.style["background-image"]=f,
p.addEventListener(app.Event.CLICK,j)):1==e?(p.innerHTML="\u4e3a\u4e86\u4f53\u9a8c\u6700\u597d\u7684\u6e38\u620f\u6548\u679c\uff0c\u8bf7\u65cb\u8f6c\u60a8\u7684\u624b\u6301\u8bbe\u5907.",p.height=20):5==e&&app.trace(e);p.style.left=(k*o+m)*(g+q)+"px";p.style.top=(l-1)*(h+q)+"px";p.style.left=nowx;p.style.top=nowy;b.appendChild(p)},getPos:function(b,c,e){var f=b%c,b=Math.ceil(b/c);return[Math.floor(b/e),0==b%2?2:1,f]}},{scroller:null,list:null,updateScroll:function(b,c){var e=c.type,f=c.data;if("remove"==
e)for(e=0;e<this.list.childNodes.length;e++){if(e==this.list.childNodes.length-1){this.list.removeChild(this.list.childNodes[e]);break}e>=b&&(this.list.childNodes[e].style["background-image"]=this.list.childNodes[e+1].style["background-image"])}else if("add"==e){var g=app.GameData.imageSrc,e=document.createElement("div");e.style.position="absolute";e.style.width="47px";e.style.height="47px";e.style["background-image"]="url("+g+"items/"+f.tid+".jpg)";if($("c0")){g=$("c0").childNodes.length;e.idx=g;
f=$("c0").childNodes[g-1];if(0!=g%8)e.style.left=Number(f.style.left.slice(0,-2))+52+"px",e.style.top=f.style.top;else if(0==g%8)if(f=g/8,0==f%2)e.style.left=416*(f/2)+"px",e.style.top="0px";else if(0!=f%2)e.style.left=416*((f-1)/2)+"px",e.style.top="52px";$("c0").appendChild(e)}}}},{});puremvc.define({name:"app.view.AnimateCanvas",constructor:function(b,c){this.canvas=document.createElement("canvas");this.canvas.width=c.frames.width;this.canvas.height=c.frames.height;this.stage=new Stage(this.canvas);c.images=[b];this.movie=new BitmapAnimation(new SpriteSheet(c));this.data=c;this.stage.addChild(this.movie);Ticker.addListener(this.stage)}},{depose:function(){Ticker.removeListener(this.stage);if(this.canvas&&this.stage)this.stage.removeAllChildren(),this.stage=null,this.canvas.parentNode&&
this.canvas.parentNode.removeChild(this.canvas),this.canvas=null},play:function(){this.movie.gotoAndPlay(0)},stop:function(){this.movie.gotoAndStop(0)},clone:function(){return new app.view.AnimateCanvas(this.data.images[0],this.data)},show:function(b){this.canvas.style.display=b?"block":"none"}},{createIcon:function(b,c,e,f){e=e||0;f=f||0;b=new app.view.AnimateCanvas(b.getContent(c),b.getContent(c+"_data"));b.canvas.style.position="absolute";b.canvas.style.left=e+"px";b.canvas.style.top=f+"px";return b}});puremvc.define({name:"app.view.scene.HomeSceneView",parent:EventDispatcher,constructor:function(b,c){EventDispatcher.call(this);this.init(b,c)}},{_loader:null,_builds:null,init:function(b,c){this.data=c;var e=app.GameData.gameStage;this.scene=new Container;this._loader=b;var f=new Bitmap(b.getContent("homeBg"));this.w=f.image.width;this.h=f.image.height;this.scene.addChild(f);this._builds=[];for(var f=this.data.length,g=0;g<f;g++)this._builds[g]=this._createHouse(b.getContent(this.data[g].id),this.data[g]);
e.addChild(this.scene);var h=this;this.scrollView=new app.view.base.ScrollView(function(b,c){h.scene.x=-b;h.scene.y=-c;e.update()},app.GameData.gameCanvas.width,app.GameData.gameCanvas.height,this.w,this.h);this.scrollView.scroller.scrollTo(434,40,!1,1);e.update()},changeView:function(){this.scrollView&&this.scrollView.scroller.setDimensions(app.GameData.gameCanvas.width,app.GameData.gameCanvas.height,this.w,this.h)},moveTo:function(b,c){this.scrollView.scroller.scrollTo(b,c,!1,1)},_createMovie:function(b,
c,e,f,g){var h=b.getContent(c+"_data"),e=e||0,f=f||0;if(g&&0<g.length){h.images=[];for(c=0;c<g.length;c++)h.images.push(b.getContent(g[c]))}else h.images=[b.getContent(c)];b=new BitmapAnimation(new SpriteSheet(h));b.x=e;b.y=f;b.gotoAndPlay(1);return b},_createHouse:function(b,c){app.trace(c.name);var e=new Container,f=new Bitmap(b);e.addChild(f);e.bid=c.id;var g=c.y,h=c.id,j=this;e.x=c.x;e.y=g;e.onPress=function(b){b.target.onClick=function(c){b.stageX==c.stageX&&b.stageY==c.stageY&&j.dispatchEvent({type:app.view.scene.HomeSceneView.SELECT_CONSTRUCT,
target:this,data:h});c.target.onClick=null}};e.visible=c.visible;if(c.id==app.data.HomeBuildingData.DRILL_GROUND)this.drill_ground=e;g=this._createTip(c.name);g.x=0.5*f.image.width;g.y=0.5*f.image.height-25;e.addChild(g);e.tip=g;this.scene.addChild(e);return e},update:function(b){if(b){for(var c=0;c<this.scene.children.length;c++)if(null!=this.scene.children[c].bid&&this.scene.children[c].bid==b.id)this.scene.children[c].visible=b.visible;app.GameData.gameStage.update()}},updateLevel:function(b,c){for(var e=
0;e<this.scene.children.length;e++)if(null!=this.scene.children[e].bid&&this.scene.children[e].bid==b)if(b==app.data.HomeBuildingData.SMALL_GAME)this.scene.children[e].tip.title.text="\u5b88\u57ce";else if(b==app.data.HomeBuildingData.ARMYGROUP)this.scene.children[e].tip.title.text="\u519b\u56e2";else if(b==app.data.HomeBuildingData.HALL)this.drill_ground.visible=this.drill_ground&&1>=c?!1:!0;app.GameData.gameStage.update()},_createTip:function(b){b=new Text(b);b.color="#FFFFFF";b.font="12px";b.textBaseline=
"top";b.textAlign="center";var c=new Bitmap(this._loader.getContent("building_tip"));c.x=0.5*-c.image.width;c.y=-2;var e=new Container;e.addChild(c);e.addChild(b);e.title=b;return e},depose:function(){this.scrollView.depose();for(var b=0;b<this._builds.length;b++);app.GameData.gameStage.removeAllChildren()}},{SELECT_CONSTRUCT:"selectConstruct"});puremvc.define({name:"app.view.scene.BattleFieldSceneView",parent:EventDispatcher,constructor:function(b,c,e){EventDispatcher.call(this);this.loader=b;this.init(c,e)}},{offset_Left:0,offset_Right:270,offset_Top:90,CELL_W:70,CELL_H:55,leftPos:[[186,136],[174,179],[158,227],[133,136],[120,179],[100,227],[82,136],[60,179],[42,227]],rightPos:[[284,136],[290,179],[305,227],[335,136],[350,179],[366,227],[390,136],[410,179],[420,227]],init:function(b,c){var e,f;this.stage=app.GameData.gameStage;this.scene=
new Container;var g=new Bitmap(this.loader.getContent(c));e=g.image.width;f=g.image.height;this.scene.addChild(g);var g=new Container,h=new Bitmap(this.loader.getContent("title")),j=new Text(b.attackerName+" Lv"+b.attackerLevel),k=new Text(b.defenserName+" Lv"+b.defenserLevel);j.color=k.color="#dfd9c2";j.textBaseline=k.textBaseline="top";j.textAlign="right";k.textAlign="left";j.y=28;k.y=28;j.x=145;k.x=213;g.addChild(h);g.addChild(j);g.addChild(k);g.x=0.5*(app.GameData.gameCanvas.width-h.image.width);
g.y=1;h=app.GameData.gameCanvas;this.scene.scaleX=h.width/e;this.scene.scaleY=h.height/f;Ticker.setFPS(10);Ticker.addListener(this);this.stage.addChild(this.scene);this.stage.addChild(g);this.stage.update()},tick:function(){this.stage.update()},depose:function(){this.clear();document.removeEventListener(app.Event.MOUSE_UP,this.mouseMove);this.mouseMove=null;Ticker.removeListener(this);this.stage.removeAllChildren();this.stage.update();this.stage=null},addTroop:function(b){var b=new app.view.battle.BaseTroop(b,
ClassUtils.delegate(this,this.onSelectTroop),ClassUtils.delegate(this,this.onReleaseTroop)),c=b.troopInfo.position,e=b.troopInfo.isAttack?this.leftPos:this.rightPos;b.setPosition(e[c-1][0],e[c-1][1]);return b},onSelectTroop:function(b,c,e){this.dispatchEvent({type:app.view.scene.BattleFieldSceneView.SELECT_TROOP,target:this,data:{target:b,x:c,y:e}})},onReleaseTroop:function(){this.dispatchEvent({type:app.view.scene.BattleFieldSceneView.DESELECT_TROOP,target:this})},showHp:function(b,c,e){var f=b.getPosition();
app.view.battle.NumberMovie.showMovie(f.x,f.y,c,this.scene,e);this.updateHp(b,c)},updateHp:function(b,c){0>c?b.defence(function(){b.reduceHp(-c)}):b.increaseHp(c)},showSkill:function(b,c){var e=this.troops[b.pos];if(e){var f=app.data.DataBase.getInstance().getSkillInfo(b.skill);try{var g=this.loader.getContent(f.effectId+"_data");g.images=[this.loader.getContent(f.effectId)];app.view.battle.SkillMovie.showSkill(e,g,this.scene,c)}catch(h){app.trace("showSkill error, image<"+f.effectId+"> "+f.name+
"  "+h.message),c&&c()}}},showActText:function(b,c){var e=this.troops[b.pos];if(e){var f=this.loader.getContent("fontbg");e.addSkillText(c,f)}},showSkillText:function(b){if(0<b.skill){var c=this.troops[b.pos];if(c){var b=app.data.DataBase.getInstance().getSkillInfo(b.skill),e=this.loader.getContent("fontbg");c.addSkillText(b.name,e)}}},updateBuffer:function(b){var c=this.troops[b.pos];if(c){try{if(b.bufferDel&&0<b.bufferDel.length)for(var e in b.bufferDel)c.reduceBuffer(b.bufferDel[e])}catch(f){app.trace("reduce buffer lose, "+
f.message)}if(b.bufferAdd&&0<b.bufferAdd.length){e=b.bufferAdd.length;for(var g=0;g<e;g++){var h=app.data.DataBase.getInstance().getBufferInfo(b.bufferAdd[g]);try{var j=this.loader.getContent(h.effectId+"_data");j.images=[this.loader.getContent(h.effectId)];c.addBuffer(b.bufferAdd[g],j,this.scene)}catch(k){app.trace("add buffer lose, image '["+h.effectId+"]"+h.name+"', "+k.message)}}}}},updateMorale:function(b){if(b.morale){var c=this.troops[b.pos];if(c){c.troopInfo.morale+=b.morale;if(100<=c.troopInfo.morale){b=
this.loader.getContent("morale_a_data");b.images=[this.loader.getContent("morale_a")];var e=this.loader.getContent("morale_b_data");e.images=[this.loader.getContent("morale_b")];c.showMorale(b,e)}else c.removeMorale();c.updateMorale()}}},isAlive:function(b){var c=this.troops[b.pos];if(!c)return null;if(0<c.troopInfo.hp)return!0;c.depose();this.troops[b.pos]=null;return!1},clear:function(){for(var b=this.troops.length,c=0;c<b;c++)null!=this.troops[c]&&this.troops[c].depose();this.troops=null},setFormation:function(b){this.troops=
[];for(var c=0;c<b.length;c++){var e=b[c],f=new app.data.TroopVO;f.position=9<e.pos?e.pos-9:e.pos;f.name=e.name;f.hp=e.hp;f.maxHp=e.maxHp;f.isAttack=10>e.pos;f.morale=e.morale;var f=this.addTroop(f),g=toFix(e.soldierId,3),h=this.loader.getContent("soldier_"+g),g=this.loader.getContent("soldier_"+g+"_data");g.images=[h];f.createTroop(g);this.scene.addChild(f.troop);f.standUp();this.troops[e.pos]=f}}},{SELECT_TROOP:"selectTroop",DESELECT_TROOP:"deSelectTroop"});puremvc.define({name:"app.view.scene.BattleMapView",parent:EventDispatcher,constructor:function(b,c,e,f){EventDispatcher.call(this);this.loader=c;this.data=b;this.showTip=e;this.btnCJ=f}},{drawStory:function(){var b=this.loader.getContent("map_story_1"),c=new Bitmap(b),e=new Container;e.addChild(c);c=app.GameData.gameCanvas.width/b.width;b=app.GameData.gameCanvas.height/b.height;e.scaleX=c;e.scaleY=b;app.GameData.gameStage.addChild(e);var f=this.data.map.conf.des,f=f.split("r").join("\r"),f=new Text(f,
"bold 16px Aria","#ffffff");f.shadow=new Shadow("#000",1,1,"1");f.lineHeight=30;f.lineWidth=30;f.x=70*c;f.y=90*b;app.GameData.gameStage.addChild(f);f=new Text("\u70b9\u51fb\u5c4f\u5e55\u7ee7\u7eed...","bold 14px Aria","#ffffff");f.shadow=new Shadow("#000",1,1,"1");f.x=0.5*(app.GameData.gameCanvas.width-120);f.y=app.GameData.gameCanvas.height-50;app.GameData.gameStage.addChild(f);var g=this;e.onClick=function(){app.GameData.gameStage.removeAllChildren();app.GameData.gameStage.update();g.dispatchEvent({type:app.view.scene.BattleMapView.SHOW_MENU_BAR,
target:g});g.drawMap()};app.GameData.gameStage.update()},drawMap:function(){this.init();this.showMenu(this.btnCJ);if(this.showTip){var b=this.data.map.conf.name,b=b.substr(0,4)+" - "+b.substr(4,4)+" "+this.data.map.complete+"%";app.view.Tooltip.getInstance().show(b)}this.getLocalTime();this.showCDYear();this.showCDTime()},creatMask:function(){var b=new Graphics;b.beginFill("#FF6600");b.drawRoundRect(0,0,app.GameData.gameCanvas.width,app.GameData.gameCanvas.height,1);this.maskBox=new Shape(b);this.maskBox.alpha=
0.01;this.maskBox.onClick=function(){}},btnValid:function(b){b?app.GameData.gameStage.addChild(this.maskBox):app.GameData.gameStage.removeChild(this.maskBox);app.GameData.gameStage.update()},init:function(){var b=app.GameData.gameStage,c=this.loader.getContent("map_"+this.data.map.id),e=new Bitmap(c),f=new Container;f.addChild(e);e=app.GameData.gameCanvas.height/c.height;f.scaleX=app.GameData.gameCanvas.width/c.width;f.scaleY=e;for(var c=this.data.map.groupList.length,g=this,h,j=0,k=0;k<c;k++){var l=
null,e=this.data.map.groupList[k];!0==e.passed?l=this.creatGroup(e):1!=e.barrierType?(0==j?h=l=this.creatGroup(e,!0):1==j&&(l=this.creatGroup(e,!1)),j++):!0==e.prevGroupPassed&&(l=this.creatGroup(e,!1));if(l)l.x=e.conf.xpos,l.y=e.conf.ypos,l.gVo=e,l.onClick=function(){g.dispatchEvent({type:app.view.scene.BattleMapView.SELECT_ARMYGROUP,target:g,data:this.gVo})},l!=h&&f.addChild(l)}h&&f.addChild(h);Ticker.setFPS(16);this.setTicker(!0);b.addChild(f);b.update()},creatGroup:function(b,c){var e=new Container,
f=this.loader.getContent("map_army"+b.conf.picId),g=new Bitmap(f),h=b.conf.picId,h=!1==b.passed?this.loader.getContent("map_qi"+h):this.loader.getContent("map_qi"+h+"_r"),h=new Bitmap(h);h.x=f.width/2-8;h.y=2;var j,k;if(!0==c)k=this.loader.getContent("map_selecterJson"),k.images=[this.loader.getContent("map_selecter")],j=new BitmapAnimation(new SpriteSheet(k)),j.x=(f.width-k.frames.width)/2,j.y=(f.height-k.frames.height)/2,j.gotoAndPlay("run"),e.addChild(j),k=this.loader.getContent("pointer_data"),
k.images=[this.loader.getContent("pointer")],j=new BitmapAnimation(new SpriteSheet(k)),j.x=(f.width-k.frames.width)/2,j.y=-34,j.gotoAndPlay(1);e.addChild(g);e.addChild(h);if(1==b.barrierType)k=this.loader.getContent("map_json9"),k.images=[this.loader.getContent("map_png9")],mc=new BitmapAnimation(new SpriteSheet(k)),mc.x=0,mc.y=0,mc.gotoAndPlay(1),e.addChild(mc);j&&e.addChild(j);return e},showMenu:function(){var b=app.GameData.gameStage,c=this,e=new Container;if(this.isHaveMap(this.data.map.id-1)){var f=
new Bitmap(this.loader.getContent("preBtn"));f.x=3;f.y=8;f.onClick=function(){c.dispatchEvent({type:app.view.scene.BattleMapView.NEXT_MAP,target:c,data:{id:c.data.map.id-1}})};e.addChild(f)}f=new Bitmap(this.loader.getContent("map_img2"));f.x=40;f.onClick=function(){c.dispatchEvent({type:app.view.scene.BattleMapView.CHANGE_MAP,target:c})};var g=new Bitmap(this.loader.getContent("pageBg"));g.x=83;g.y=13;e.addChild(g);e.addChild(f);f=new Text(this.data.map.conf.name,"bold 12px Aria","#ffffff");f.shadow=
new Shadow("#000",1,1,"1");f.x=87;f.y=26;e.addChild(f);if(this.isHaveMap(this.data.map.id+1)){f=new Container;g=this.loader.getContent("mapRihtJson");g.images=[this.loader.getContent("mapRiht")];g=new BitmapAnimation(new SpriteSheet(g));g.gotoAndPlay(1);var h=new Bitmap(this.loader.getContent("nextBtn"));f.addChild(h);f.addChild(g);f.x=136;f.y=8;f.onClick=function(){c.dispatchEvent({type:app.view.scene.BattleMapView.NEXT_MAP,target:c,data:{id:c.data.map.id+1}})};e.addChild(f)}e.x=app.GameData.gameCanvas.width-
225;e.y=app.GameData.gameCanvas.height-45;b.addChild(e);this.cdTimeContainer=new Container;this.cdTimeTxt=new Text("","bold 12px Aria","#f39500");this.cdTimeTxt.shadow=new Shadow("#000",1,1,"1");this.cdTimeContainer.addChild(this.cdTimeTxt);this.timeTxt=new Text("","bold 12px Aria","#f39500");this.timeTxt.shadow=new Shadow("#000",1,1,"1");this.timeTxt.x=100;this.cdTimeContainer.addChild(this.timeTxt);this.cdTimeContainer.x=55;this.cdTimeContainer.y=app.GameData.gameCanvas.height-24;b.addChild(this.cdTimeContainer);
this.fightCdContainer=new Container;this.fightCdTxt=new Text("\u6218\u6597\u51b7\u5374 \u53ef\u6218\u6597","bold 12px Aria","#00fdfb");this.fightCdTxt.color="#01ff00";this.fightCdTxt.shadow=new Shadow("#000",1,1,"1");this.fightCdTxt.y=0;this.fightCdContainer.addChild(this.fightCdTxt);this.cdIco=new Bitmap(this.loader.getContent("map_ico1"));this.cdIco.x=120;this.cdIco.y=-14;this.cdIco.visible=!1;this.cdIco.onClick=function(){c.dispatchEvent({type:app.view.scene.BattleMapView.CLEAR_CD,target:c})};
this.fightCdContainer.addChild(this.cdIco);this.fightCdContainer.x=55;this.fightCdContainer.y=app.GameData.gameCanvas.height-40;b.addChild(this.fightCdContainer)},tick:function(){app.GameData.gameStage.update()},isHaveMap:function(b){if(0>=b)return!1;for(var c in this.data.mapList)if(b==this.data.mapList[c].id)return!0;return!1},showCDYear:function(){var b="\u7cbe\u82f1\u5237\u65b0 "+this.year+"\u5e74",b=b+["\u6625","\u590f","\u79cb","\u51ac"][this.season-1];this.cdTimeTxt.text=b},showCDTime:function(){this.timeTxt.text=
this.cdTime[this.timeType].name;this.time=parseInt((this.cdTime[this.timeType].time-this.gameInfo.time)/1E3);app.controller.TimeController.getInstance().addListener(this);this.step()},step:function(){this.time--;if(0>=this.time&&!1==this.over&&this.year==this.gameInfo.year)this.over=!0,this.cdTimeContainer.removeAllChildren(),app.GameData.gameStage.removeChild(this.cdTimeContainer),this.dispatchEvent({type:app.view.scene.BattleMapView.REFRESH_DATA,target:this,data:this.data.map});if(0<this.indicateVo.time.getTime())this.isFightCD=
!0,this.cdIco.visible=!0,this.fightCdTxt.text="\u6218\u6597\u51b7\u5374 "+this.indicateVo.time.toString(),this.fightCdTxt.color="#00fdfb";else if(!0==this.isFightCD)this.fightCdTxt.text="\u6218\u6597\u51b7\u5374 \u53ef\u6218\u6597",this.fightCdTxt.color="#01ff00",this.isFightCD=!1,this.cdIco.visible=!1},setData:function(b,c){this.indicateVo=c;this.gameInfo=b;this.year=this.gameInfo.year;this.season=this.gameInfo.season;var e=new Date(parseInt(this.gameInfo.time)),e=(new Date(e.getFullYear(),e.getMonth(),
e.getDate())).getTime();this.cdTime=[{name:"08:30",time:306E5+e},{name:"12:30",time:45E6+e},{name:"19:00",time:684E5+e},{name:"21:00",time:756E5+e}];this.isFightCD=this.over=!1;!0==this.data.map.isFirst&&null!=this.data.map.conf.des?(this.drawStory(),this.data.map.isFirst=!1):this.drawMap()},getLocalTime:function(){if(this.gameInfo.time<this.cdTime[0].time)this.timeType=0;else if(this.gameInfo.time<this.cdTime[1].time)this.timeType=1;else if(this.gameInfo.time<this.cdTime[2].time)this.timeType=2;
else if(this.gameInfo.time<this.cdTime[3].time)this.timeType=3;else if(this.timeType=0,this.year=this.gameInfo.year+1,this.season=this.gameInfo.season+1,5<=this.season)this.season=1},depose:function(){app.controller.TimeController.getInstance().removeListener(this);this.removeAllEventListeners();var b=app.GameData.gameStage;b.removeAllChildren();b.update();this.setTicker(!1)},setTicker:function(b){b?Ticker.addListener(this):Ticker.removeListener(this)}},{SELECT_ARMYGROUP:"BattleMapView_armyGroup",
CHANGE_MAP:"BattleMapView_changeMap",NEXT_MAP:"BattleMapView_nextMap",REFRESH_DATA:"BattleMapView_refreshData",CLEAR_CD:"BattleMapView_clearCD",SHOW_ACH:"BattleMapView_showAch",SHOW_MENU_BAR:"BattleMapView_showMenuBar"});puremvc.define({name:"app.view.scene.BattleMapViewPop",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0);this.init()}},{init:function(){var b=this;$("mapPop01").addEventListener(app.Event.CLICK,function(){b.dispatchEvent({type:app.view.scene.BattleMapViewPop.CLOSE,target:b})});this.titleHtml=$("mapPop02");this.armyBoxHtml=$("mapPop03");this.armyMsgHtml=$("mapPop04");this.spans=$("mapPop05").getElementsByTagName("span");this.index=0;this.selectBox=document.createElement("img");
this.selectBox.src="images/ui/xuan_02.png";this.selectBox.style.position="absolute";this.selectBox.style.display="none";this.selectBox.style.zIndex="1";this.strategyBtn=$("mapPop07");this.fightBtn=$("mapPop06");this.stormBtn=$("mapPop08");this.stormBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.sendEvent,app.view.scene.BattleMapViewPop.SHOW_STORM)},sendEvent:function(b,c){this.dispatchEvent({type:c,target:this,data:this.data.armyList[this.index]})},strategy:function(){this.dispatchEvent({type:app.view.scene.BattleMapViewPop.SHOW_STRATEGY,
target:this,data:this.data.armyList[this.index]})},startFight:function(){this.dispatchEvent({type:app.view.scene.BattleMapViewPop.START_FIGHT,target:this,data:this.data.armyList[this.index]})},showLayout:function(){this.armyBoxHtml.innerHTML="";for(var b=document.createDocumentFragment(),c,e,f,g=0;g<this.data.armyList.length;g++){f=this.data.armyList[g];c=document.createElement("div");c.className="zdfb_01";e=document.createElement("img");e.src="images/heros/hero_"+f.conf.picId+".gif";c.appendChild(e);
c[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handler,g);if(!0==f.passed)e=document.createElement("img"),e.src="images/ui/icon_win.png",e.style.position="absolute",e.style.left="34px",e.style.top="34px",e.style.zIndex=g+10,c.appendChild(e);b.appendChild(c);if(f.id==this.data.armyId)this.index=g}this.armyBoxHtml.appendChild(b);this.armyBoxHtml.style.left=0.5*(318-this.armyBoxHtml.clientWidth)+"px";this.armyBoxHtml.appendChild(this.selectBox);this.showArmyInfo()},handler:function(b,c){this.index=
c;this.showArmyInfo()},showArmyInfo:function(){this.selectBox.style.left=89*this.index+21+"px";this.selectBox.style.top="6px";this.selectBox.style.display="block";var b=this.data.armyList[this.index];this.armyMsgHtml.innerHTML=b.conf.startNPCMsg;this.titleHtml.innerHTML=b.conf.name+" Lv"+b.conf.level;this.spans[0].innerHTML=b.conf.feat;this.spans[1].innerHTML=-1==b.count||-1==b.conf.attackNum?"\u65e0":b.count+"/"+b.conf.attackNum;this.spans[2].innerHTML=""==b.reward?"\u65e0":b.reward;this.spans[2].className=
app.getStyle(b.quality);var c=b.getProbability();this.spans[3].innerHTML=""==c?"\u65e0":c;!1==b.attack?(this.btnState(this.fightBtn,!1),this.btnState(this.strategyBtn,!1)):(this.btnState(this.fightBtn,!0,this.startFight),this.btnState(this.strategyBtn,!0,this.strategy));!0==b.passed&&!1==b.attack?(this.stormBtn.style.display="inline",this.btnState(this.strategyBtn,!0,this.strategy)):this.stormBtn.style.display="none";if(2==b.conf.barrierType)this.stormBtn.style.display="none",this.strategyBtn.style.display=
"none"},btnState:function(b,c,e){c?(b[app.Event.ONCLICK]=ClassUtils.delegate(this,e),b.removeAttribute("disabled")):(b.disabled="disabled",b[app.Event.ONCLICK]=null)},setData:function(b){this.data=b;this.showLayout()}},{CLOSE:"BattleMapViewPop_close",SHOW_STRATEGY:"BattleMapViewPop_showStrategy",START_FIGHT:"BattleMapViewPop_startFight",SHOW_STORM:"BattleMapViewPop_startStorm"});puremvc.define({name:"app.view.scene.BattleMapChange",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0);this.init()}},{init:function(){$("mapChange01")[app.Event.ONCLICK]=ClassUtils.delegate(this,this.close);this.containerHtml=$("mapChange02");this.pageHtml=$("mapChange03")},close:function(){null!=this.scrollView&&this.scrollView.depose();this.dispatchEvent({type:app.view.scene.BattleMapChange.CLOSE,target:this})},showLayout:function(){this.containerHtml.innerHTML=
"";var b,c,e,f,g,h=this;c=document.createDocumentFragment();var j=4*this.pCount,k;for(b=0;b<j;b++){e=document.createElement("div");e.className="bMap01";e.style.left=113*b+28+"px";e.style.top="50px";f=this.data.mapList[b];if(null!=f){g=Math.floor(0.6*Number(f.complete));0>=g?g=1:60<g&&(g=60);k="images/heros/hero_"+f.conf.picId+".gif";var l="bMap03",m="";f.id==this.data.map.id&&(l="bMap03 fc10",m='<img src="images/ui/in4.png" style="position: absolute; top:-10px; left:0" />');g=m+'<div class="'+l+'" style="background:url('+
k+') top center no-repeat;">'+f.conf.name+'</div><div class="bMap04"><div style="width:'+g+'px;" class="bMap05"></div></div>';e.innerHTML=g;e[app.Event.ONMOUSE_DOWN]=ClassUtils.delegate(this,this.mouseDown,f);e[app.Event.ONMOVE]=ClassUtils.delegate(this,this.mouseMove);e[app.Event.ONMOUSE_UP]=ClassUtils.delegate(this,this.mouseUp)}else f=document.createElement("img"),f.src="images/ui/fight_dis.png",f.style.marginTop="8px",e.appendChild(f);c.appendChild(e)}e=451*this.pCount;this.containerHtml.appendChild(c);
this.containerHtml.style.width=e+"px";this.containerHtml.style.height="217px";j=function(b){var c=Math.floor(b/451)+1;0<c&&c<=h.pCount&&h.showPage(c);h.containerHtml.style["-webkit-transform"]="translateX("+-b+"px)"};c=document.createDocumentFragment();for(b=0;b<this.pCount;b++)f=document.createElement("li"),c.appendChild(f);this.pageHtml.appendChild(c);b=this.getCurrentPage();if(217<e){if(null==this.scrollView)this.scrollView=new app.view.base.ScrollView(j,451,217,e,217,this.containerHtml,{scrollingY:!1,
paging:!0,bouncing:!0});1<b&&this.scrollView.scroller.__publish(451*(b-1),0,1)}else this.showPage(1)},mouseMove:function(b){var c=0,c="mousemove"==b.type?b.clientX:b.targetTouches[0].pageX;this.distance=c-this.clientX},mouseDown:function(b,c){this.mapVo=c;this.distance=0;this.clientX="mousedown"==b.type?b.clientX:b.targetTouches[0].pageX},mouseUp:function(){if(0==this.distance&&null!=this.mapVo)this.mapVo.id==this.data.map.id?this.close():(this.dispatchEvent({type:app.view.scene.BattleMapChange.SELECT_MAP,
target:this,data:this.mapVo}),this.mapVo=null)},getCurrentPage:function(){for(var b=this.data.mapList.length,c=0;c<b;c++)if(this.data.mapList[c].id==this.data.map.id)return b=Math.ceil((c+1)/4),b=0==b?1:b;return 1},showPage:function(b){if(this.p!=b){var c;if(0!=this.p)c=this.pageHtml.childNodes[this.p-1],c.style.background="url(images/ui/dotbg.png)";this.p=b;c=this.pageHtml.childNodes[this.p-1];c.style.background="url(images/ui/dot.png)"}},setData:function(b){this.data=b;this.pCount=Math.ceil(this.data.mapList.length/
4);this.p=0;this.showLayout()}},{CLOSE:"BattleMapChange_close",SELECT_MAP:"BattleMapChange_select_map"});puremvc.define({name:"app.view.scene.BattleMapViewStrategy",parent:app.view.base.BaseUIForm,constructor:function(b,c){app.view.base.BaseUIForm.call(this,b,!0);this.data=c;this.init()}},{init:function(){var b=this;$("sMap01").addEventListener(app.Event.CLICK,function(){b.dispatchEvent({type:app.view.scene.BattleMapViewStrategy.CLOSE,target:b})});for(var c=document.createDocumentFragment(),e,f,g=0;5>g;g++)f=this.data.strategyList[g],e=document.createElement("li"),null!=f?(e.innerHTML=f.name+"   Lv"+
f.level,e[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handler,f.bid),e.style.background="url(images/ui/namebg.gif)"):(e.innerHTML="\u6682\u65e0\u8bb0\u5f55",e.style.background="url(images/ui/namebg2.gif)"),c.appendChild(e);$("sMap02").appendChild(c)},handler:function(b,c){this.dispatchEvent({type:app.view.scene.BattleMapViewStrategy.GO_SEE_STRATEGY,target:this,data:c})}},{CLOSE:"BattleMapViewStrategy_close",GO_SEE_STRATEGY:"BattleMapViewStrategy_seeStrategy"});puremvc.define({name:"app.view.scene.ResourceSceneView",parent:EventDispatcher,constructor:function(b){this.loader=b;EventDispatcher.call(this);app.controller.TimeController.getInstance().addListener(this)}},{resourceData:null,userData:null,setData:function(b,c,e){this.resourceData=b;this.userData=c;this.indicateVo=e;this.isFightCD=!1;this.init()},init:function(){var b,c;this.stage=app.GameData.gameStage;this.bigContainer=new Container;this.bgScene=new Container;this.resScene=new Container;this.effectScene=
new Container;this.controlScene=new Container;var e=this;c=new Bitmap(this.loader.getContent("pageBg"));c.x=app.GameData.gameCanvas.width-150;c.y=app.GameData.gameCanvas.height-35;this.controlScene.addChild(c);b=new Bitmap(this.loader.getContent("nextBtn"));b.x=c.x+50;b.y=c.y-5;this.controlScene.addChild(b);b.onClick=function(){e.resourceData.page<e.resourceData.maxPageNum&&(e.resourceData.page++,e.dispatchEvent({type:app.view.scene.ResourceSceneView.RES_UPDATE,target:this,data:e.resourceData.page}))};
b=new Bitmap(this.loader.getContent("preBtn"));b.x=c.x-25;b.y=c.y-5;this.controlScene.addChild(b);b.onClick=function(){1<e.resourceData.page&&(e.resourceData.page--,e.dispatchEvent({type:app.view.scene.ResourceSceneView.RES_UPDATE,target:this,data:e.resourceData.page}))};b=new Bitmap(this.loader.getContent("areaBtn"));b.x=app.GameData.gameCanvas.width-51;b.y=app.GameData.gameCanvas.height-138;this.controlScene.addChild(b);b.onClick=function(){e.dispatchEvent({type:app.view.scene.ResourceSceneView.GO_AREA,
target:this,data:e.resourceData.countryId})};this.areaTxt=new Text("","bold 12px Aria","#ffffff");this.areaTxt.shadow=new Shadow("#000",1,1,"1");this.areaTxt.x=c.x+16;this.areaTxt.y=c.y+12;this.controlScene.addChild(this.areaTxt);this.fightCdTxt=new Text("","12px Aria","");this.fightCdTxt.shadow=new Shadow("#000",0,0,"2");this.fightCdTxt.x=60;this.fightCdTxt.y=app.GameData.gameCanvas.height-45;this.controlScene.addChild(this.fightCdTxt);this.cdIco=new Bitmap(this.loader.getContent("map_ico1"));this.cdIco.x=
this.fightCdTxt.x+105;this.cdIco.y=this.fightCdTxt.y-15;this.cdIco.visible=!1;this.cdIco.onClick=function(){e.dispatchEvent({type:app.view.scene.ResourceSceneView.CLEAR_CD,target:e})};this.controlScene.addChild(this.cdIco);this.stealTxt=new Text("\u63a0\u593a\u6b21\u6570:"+this.userData.stealIndicate.num+"/"+this.userData.stealIndicate.maxNum+" \u53ef\u63a0\u593a","12px Aria","#01ff00");this.stealTxt.shadow=new Shadow("#000",0,0,"2");this.stealTxt.x=60;this.stealTxt.y=app.GameData.gameCanvas.height-
30;this.controlScene.addChild(this.stealTxt);this.show();this.bigContainer.addChild(this.bgScene);this.bigContainer.addChild(this.resScene);this.bigContainer.addChild(this.effectScene);this.bigContainer.scaleX=app.GameData.gameCanvas.width/this.bg.width;this.bigContainer.scaleY=app.GameData.gameCanvas.height/this.bg.height;this.stage.addChild(this.bigContainer);this.stage.addChild(this.controlScene);this.stage.update();Ticker.setFPS(16);Ticker.addListener(this.stage)},show:function(){this.showIndicateTime();
this.areaTxt.text=this.resourceData.page+"/"+this.resourceData.maxPageNum;var b,c;this.bgScene.removeAllChildren();this.resScene.removeAllChildren();this.effectScene.removeAllChildren();this.bg=this.resourceData.type==app.view.scene.ResourceSceneView.RES_TYPE_SILVER?this.loader.getContent("resourceBg_silver"):this.loader.getContent("resourceBg_farm");this.bgScene.addChild(new Bitmap(this.bg));b=this.resourceData.resList;c=app.view.scene.ResourceSceneView.ONE_PAGE_NUM;for(var e=0;e<c;e++)this._createResource(b[e]);
this.stage.update()},_createResource:function(b){var c,e=b.type,f=b.iconId,g=b.userId;e==app.view.scene.ResourceSceneView.RES_TYPE_SILVER?c=1==f?new Bitmap(this.loader.getContent("resource_silver1")):2==f?new Bitmap(this.loader.getContent("resource_silver2")):new Bitmap(this.loader.getContent("resource_silver3")):e==app.view.scene.ResourceSceneView.RES_TYPE_FARM&&(c=1==f?new Bitmap(this.loader.getContent("resource_farm1")):2==f?new Bitmap(this.loader.getContent("resource_farm2")):new Bitmap(this.loader.getContent("resource_farm3")));
c.x=b.posX;c.y=b.posY;this.resScene.addChild(c);if(g)e=new Text(b.flag,"12px Arial","#000"),f=new Bitmap(this.loader.getContent("flag")),f.x=c.x+25,f.y=c.y-10,e.x=f.x+4,e.y=f.y+15,this.resScene.addChild(f),this.resScene.addChild(e),e=new Text(b.userName,"12px Arial","#fff000"),e.shadow=new Shadow("#000",0,0,"2"),e.x=c.x+18,e.y=c.y+45,this.resScene.addChild(e);g==this.userData.roleId&&this.drawPointer(c);!0==b.isDouble&&this.drawDouble(c);var h=this;c.onClick=function(){h.dispatchEvent({type:app.view.scene.ResourceSceneView.SELECT_RESOURCE,
target:this,data:b})}},drawPointer:function(b){var c=this.loader.getContent("resPointerSprite"),c=new SpriteSheet({images:[c],animations:{all:[0,14]},frames:{height:35,regX:0,count:15,regY:0,width:22}}),c=new BitmapAnimation(c);c.x=b.x+25;c.y=b.y-40;this.effectScene.addChild(c);c.gotoAndPlay(1)},drawDouble:function(b){var c=this.loader.getContent("resDoubleSprite"),c=new SpriteSheet({images:[c],animations:{all:[0,16]},frames:{height:41,regX:0,count:17,regY:0,width:45}}),c=new BitmapAnimation(c);c.x=
b.x;c.y=b.y;this.effectScene.addChild(c);c.gotoAndPlay(0)},drawSteal:function(){var b=this,c=this.loader.getContent("resSteal"),c=new SpriteSheet({images:[c],animations:{all:[0,9]},frames:{count:10,regY:0,height:116,regX:0,width:175}});this.stealEff=new BitmapAnimation(c);this.stealEff.x=app.GameData.gameCanvas.width/2-87;this.stealEff.y=app.GameData.gameCanvas.height/2-58;this.controlScene.addChild(this.stealEff);this.stealEff.gotoAndPlay(0);this.stealEff.onAnimationEnd=function(){b.controlScene.removeChild(b.stealEff)}},
depose:function(){app.controller.TimeController.getInstance().removeListener(this);Ticker.removeListener(this.stage);this.stage.removeAllChildren();this.stage.update()},step:function(){this.showIndicateTime()},showIndicateTime:function(){this.stealCd=this.userData.stealIndicate.time.getTime();0<this.stealCd?(this.stealTxt.text="\u63a0\u593a\u6b21\u6570:"+this.userData.stealIndicate.num+"/"+this.userData.stealIndicate.maxNum+" "+app.data.TimeVO.formatTime(this.stealCd),this.stealTxt.color="#00fdfb"):
(this.stealTxt.text="\u63a0\u593a\u6b21\u6570:"+this.userData.stealIndicate.num+"/"+this.userData.stealIndicate.maxNum+" \u53ef\u63a0\u593a",this.stealTxt.color="#01ff00");if(0<this.indicateVo.time.getTime())this.isFightCD=!0,this.cdIco.visible=!0,this.fightCdTxt.text="\u6218\u6597\u51b7\u5374 "+this.indicateVo.time.toString(),this.fightCdTxt.color="#00fdfb";else if(this.fightCdTxt.text="\u6218\u6597\u51b7\u5374 \u53ef\u6218\u6597",this.fightCdTxt.color="#01ff00",!0==this.isFightCD)this.isFightCD=
!1,this.cdIco.visible=!1}},{SELECT_RESOURCE:"selectResource",RES_TYPE_SILVER:1,RES_TYPE_FARM:2,ONE_PAGE_NUM:10,RES_UPDATE:"res_update",GO_AREA:"go_area",CLEAR_CD:"clearCd"});puremvc.define({name:"app.view.scene.WorldMapView",parent:EventDispatcher,constructor:function(b){EventDispatcher.call(this);this.loader=b;this.init()}},{developColdownTimeId:11,imgInColddownTimeId:13,i:0,init:function(){this.stage=app.GameData.gameStage;this.scene=new Container;this.cdScene=new Container;this.noClickScene=new Container;this.bmp=new Bitmap(this.loader.getContent("worldBg"));this.scene.addChild(this.bmp);var b=this;this.scrollView=new app.view.base.ScrollView(function(c,e){b.scene.x=
-c;b.scene.y=-e},app.GameData.gameCanvas.width,app.GameData.gameCanvas.height,this.bmp.image.width,this.bmp.image.height);this.scrollView.scroller.scrollTo(160,100,!1,1);Ticker.setFPS(16)},draw:function(){this.drawBattleCityAnimation();this.drawMoveCityAnimation();this.drawCities();this.drawAnimation();this.drawNoClick();this.drawCd();this.stage.addChild(this.scene);this.stage.addChild(this.noClickScene);this.stage.addChild(this.cdScene);Ticker.addListener(this.stage);this.setTicker(!0)},drawAnimation:function(){var b=
this.loader.getContent("pointer_data");b.images=[this.loader.getContent("pointer")];this.icon=new BitmapAnimation(new SpriteSheet(b));this.icon.x=this.mainCityData[0]+24;this.icon.y=this.mainCityData[1]-25;this.scene.addChild(this.icon);this.icon.gotoAndPlay(0)},drawBattleCityAnimation:function(){if(0!=this.battleCityData.length)for(var b=0;b<this.battleCityData.length;b++){var c=new Bitmap(this.loader.getContent("cityDevelop"));c.x=this.battleCityData[b].x+4;c.y=this.battleCityData[b].y+12;this.scene.addChild(c)}},
drawMoveCityAnimation:function(){if(0!=this.moveCityData.length){var b=this.loader.getContent("city_selecter_data");b.images=[this.loader.getContent("city_selecter")];for(var c=0;c<this.moveCityData.length;c++){var e=new BitmapAnimation(new SpriteSheet(b));e.x=this.moveCityData[c].x-8;e.y=this.moveCityData[c].y-15;this.scene.addChild(e);e.gotoAndPlay(0)}}},drawCities:function(){for(var b=this.citysData.length,c=0;c<b;c++)this._createCity(this.loader.getContent("city_"+this.citysData[c].color),this.citysData[c])},
_createCity:function(b,c){var e=new Container,f=new Bitmap(b);e.addChild(f);e.id=c.id;var g=c.y,h=c.id,j=c.name;e.x=c.x;e.y=g;var k=this;e.onPress=function(b){b.target.onClick=function(c){b.stageX==c.stageX&&b.stageY==c.stageY&&k.dispatchEvent({type:app.view.scene.WorldMapView.SELECT_CONSTRUCT,target:k,data:h});c.target.onClick=null}};if(j)g=this._createTip(j),g.x=0.5*f.image.width-5,g.y=0.5*f.image.height+8,e.addChild(g),e.tip=g;this.scene.addChild(e)},_createTip:function(b){var c=new Container,
b=new Text(b);b.color="#FFFFFF";b.font="12px";b.textBaseline="top";b.textAlign="center";b.shadow=new Shadow("#000",1,1,"1");var e=new Bitmap(this.loader.getContent("building_tip"));e.x=0.5*-e.image.width;e.y=-1;c.addChild(e);c.addChild(b);c.title=b;return c},drawCd:function(){this.developCdTime=this.indicateProxy.getIndicateDataByType(this.developColdownTimeId).time.toString();this.moveCdTime=this.indicateProxy.getIndicateDataByType(this.imgInColddownTimeId).time.toString();this.moveCdText=new Text("\u8fc1\u79fb\u51b7\u5374 "+
this.moveCdTime);this.developCdText=new Text("\u6295\u8d44\u51b7\u5374 "+this.developCdTime);this.developCdText.color=this.moveCdText.color="#00fdfb";this.developCdText.font=this.moveCdText.font="12px Aria";this.moveCdText.shadow=new Shadow("#000",0,0,"2");this.developCdText.shadow=new Shadow("#000",0,0,"2");this.moveCdText.x=this.developCdText.x=60;this.moveCdText.y=app.GameData.gameCanvas.height-50;this.developCdText.y=app.GameData.gameCanvas.height-36;if(0==this.indicateProxy.getIndicateDataByType(this.imgInColddownTimeId).time.getTime())this.moveCdText.visible=
!1;if(0==this.indicateProxy.getIndicateDataByType(this.developColdownTimeId).time.getTime())this.developCdText.visible=!1;this.cdScene.addChild(this.moveCdText);this.cdScene.addChild(this.developCdText);this.stage.update()},drawNoClick:function(){var b=new Graphics;b.setStrokeStyle(1);b.beginFill(Graphics.getRGB(255,255,255));b.drawCircle(0,0,30);b=new Shape(b);b.alpha=1;this.noClickScene.addChild(b);this.noClickScene.alpha=0.01;this.noClickScene.x=app.GameData.gameCanvas.width-60;this.noClickScene.y=
30;this.noClickScene.onPress=function(){};this.stage.update()},updateDrawCd:function(){this.developCdTime=this.indicateProxy.getIndicateDataByType(this.developColdownTimeId).time.toString();this.moveCdTime=this.indicateProxy.getIndicateDataByType(this.imgInColddownTimeId).time.toString();this.moveCdText.visible=0==this.indicateProxy.getIndicateDataByType(this.imgInColddownTimeId).time.getTime()?!1:!0;this.developCdText.visible=0==this.indicateProxy.getIndicateDataByType(this.developColdownTimeId).time.getTime()?
!1:!0;this.moveCdText.text="\u8fc1\u79fb\u51b7\u5374 "+this.moveCdTime;this.developCdText.text="\u6295\u8d44\u51b7\u5374 "+this.developCdTime},setData:function(b,c,e,f,g){this.citysData=b;this.moveCityData=c;this.mainCityData=e;this.battleCityData=f;this.indicateProxy=g},setTicker:function(b){b?Ticker.addListener(this):Ticker.removeListener(this)},tick:function(){this.updateDrawCd();this.stage.update()},moveTo:function(b,c){this.scrollView.scroller.scrollTo(b,c,!1,1)},depose:function(){this.removeAllEventListeners();
this.stage.removeAllChildren();this.stage.update();this.setTicker(!1)}},{SELECT_CONSTRUCT:"selectConstruct"});puremvc.define({name:"app.view.scene.WorldDialogView",parent:app.view.base.BaseUIForm,constructor:function(b,c){app.view.base.BaseUIForm.call(this,b,!0);this.cityId=c;this.title=this.view.querySelector("#world_dlg_title");this.closeBtn=this.view.querySelector("#world_dlg_close");this.spans=document.getElementById("cityData").getElementsByTagName("span");this.inputArr=document.getElementById("worldDialogInputBtn").getElementsByTagName("input");this.canvas=this.view.querySelector("#developCanvas");
var e=this;this.closeBtn[app.Event.ONCLICK]=function(){e.dispatchEvent({type:app.view.scene.WorldDialogView.CLOSE,target:e})};this.inputArr[0][app.Event.ONCLICK]=function(){e.dispatchEvent({type:app.view.scene.WorldDialogView.getIn,target:e,data:c})};this.inputArr[1][app.Event.ONCLICK]=function(){e.dispatchEvent({type:app.view.scene.WorldDialogView.imgIn,target:e,data:c})}}},{isShowDevelopAnimation:!0,setDialogView:function(b,c,e,f,g){this.title.innerHTML=b.name;this.spans[0].innerHTML=c.countryname?
"<font color='red'>"+c.countryname+"</font>":b.countryname;this.spans[1].innerHTML=b.characteristic;this.spans[2].innerHTML=b.levelmax<e&&100>e?"<font color='red'>"+b.levelmax+"</font>":b.levelmax;this.spans[3].innerHTML=100*b.combatloss;this.spans[4].innerHTML=b.moveconditiondes;this.spans[5].innerHTML=1==c.doorState?"\u5f00\u653e\u4e2d":"<font color='red'>\u5173\u95ed\u4e2d</font>";this.spans[7].innerHTML=b.businessmax;this.spans[9].innerHTML=b.trademax;this.spans[11].innerHTML=b.mineralmax;this.spans[13].innerHTML=
b.agriculturemax;this.spans[15].innerHTML=b.militarymax;this.updateDialogView(b,c,f,g)},updateDialogView:function(b,c,e,f){this.spans[6].innerHTML=c.business;this.spans[8].innerHTML=c.trade;this.spans[10].innerHTML=c.mining;this.spans[12].innerHTML=c.agriculture;this.spans[14].innerHTML=c.military;if(!c.inState)this.inputArr[0].disabled="disabled";if(!c.imgState||0!=f)this.inputArr[1].disabled="disabled",this.inputArr[1][app.Event.ONCLICK]=null;if(!c.developState||0!=e)this.isShowDevelopAnimation=
!1,this.inputArr[2].disabled="disabled";this.isShowDevelopAnimation?this.drawDevelopAnimation():(this.stopDevelopAnimation(),this.canvas.parentNode[app.Event.ONCLICK]=null)},drawDevelopAnimation:function(){this.stage=new Stage(this.canvas);this.obj=app.GameData.GameResource.getContent("uieff_10_data");this.obj.images=[app.GameData.GameResource.getContent("uieff_10")];this.movie=new BitmapAnimation(new SpriteSheet(this.obj));this.movie.scaleX=this.stage.canvas.width/this.obj.frames.width;this.movie.scaleY=
this.stage.canvas.height/this.obj.frames.height;this.movie.gotoAndPlay(0);this.stage.addChild(this.movie);var b=this;this.canvas.parentNode[app.Event.ONCLICK]=function(){b.dispatchEvent({type:app.view.scene.WorldDialogView.develop,target:b,data:b.cityId})};Ticker.addListener(this.stage);Ticker.setFPS(16)},stopDevelopAnimation:function(){this.stage&&(Ticker.removeListener(this.stage),this.stage.clear())}},{CLOSE:"WorldDialog_Close",OPERATE:"WorldDialog_Operate",getIn:"WorldDialog_getIn",imgIn:"WorldDialog_imgIn",
develop:"WorldDialog_develop"});puremvc.define({name:"app.view.scene.DevelopDialog",parent:app.view.base.BaseUIForm,constructor:function(b,c,e){app.view.base.BaseUIForm.call(this,b,!0);this.closeBtn=this.view.querySelector("#develop_dlg_close");this.inputArr=document.getElementById("developInputBtn").getElementsByTagName("input");this.selectItemArr_01=document.getElementById("selectBox_01").getElementsByClassName("selectBox_Item");this.selectItemArr_02=document.getElementById("selectBox_02").getElementsByClassName("selectBox_Item");
this.selectDiv_01=$("selectDiv_01");this.selectDiv_02=$("selectDiv_02");this.selectBox_01=$("selectBox_01");this.selectBox_02=$("selectBox_02");this.devCoin=$("dev_Coin");this.pageNumber_01="\u5546\u4e1a";this.pageNumber_02="500";this.showCoin(c,e);var f=this;selectDiv_01_ClickHandler=function(b){"selectDiv_hide"==b.target.className&&"selectBox_01_hide"==f.selectBox_01.className?(b.target.className="selectDiv_show",f.selectDiv_02.className="selectDiv_hide",f.selectBox_01.className="selectBox_01_show",
f.selectBox_02.className="selectBox_02_hide"):(b.target.className="selectDiv_hide",f.selectBox_01.className="selectBox_01_hide")};selectDiv_02_ClickHandler=function(b){"selectDiv_hide"==b.target.className&&"selectBox_02_hide"==f.selectBox_02.className?(b.target.className="selectDiv_show",f.selectBox_02.className="selectBox_02_show",f.selectDiv_01className="selectDiv_hide",f.selectBox_01.className="selectBox_01_hide"):(b.target.className="selectDiv_hide",f.selectBox_02.className="selectBox_02_hide")};
this.selectDiv_01.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,selectDiv_01_ClickHandler));this.selectDiv_02.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,selectDiv_02_ClickHandler));selectItem_01_ClickHandler=function(b){var h=f.selectDiv_01.innerText;f.pageNumber_01=f.selectDiv_01.innerText=b.target.innerText;f.selectDiv_01.className="selectDiv_hide";f.selectBox_01.className="selectBox_01_hide";b.target.innerText=h;f.showCoin(c,e)};selectItem_02_ClickHandler=function(b){var h=
f.selectDiv_02.innerText;f.pageNumber_02=f.selectDiv_02.innerText=b.target.innerText;f.selectDiv_02.className="selectDiv_hide";f.selectBox_02.className="selectBox_02_hide";b.target.innerText=h;f.showCoin(c,e)};for(b=0;b<this.selectItemArr_01.length;b++)this.selectItemArr_01[b].addEventListener(app.Event.CLICK,ClassUtils.delegate(this,selectItem_01_ClickHandler));for(b=0;b<this.selectItemArr_02.length;b++)this.selectItemArr_02[b].addEventListener(app.Event.CLICK,ClassUtils.delegate(this,selectItem_02_ClickHandler));
cancel=function(){f.dispatchEvent({type:app.view.scene.DevelopDialog.CANCEL,target:f})};close=function(){f.dispatchEvent({type:app.view.scene.DevelopDialog.CLOSE,target:f})};this.closeBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,close));this.inputArr[1].addEventListener(app.Event.CLICK,ClassUtils.delegate(this,cancel));ok=function(){var b,c;switch(this.pageNumber_01){case "\u5546\u4e1a":b=1;break;case "\u8d38\u6613":b=2;break;case "\u77ff\u573a":b=3;break;case "\u519c\u4e1a":b=4;
break;case "\u519b\u4e8b":b=5;break;default:b=1}switch(this.pageNumber_02){case "500":c=500;break;case "1000":c=1E3;break;case "2000":c=2E3;break;default:c=500}var e={};e.type=b;e.lidu=c;f.dispatchEvent({type:app.view.scene.DevelopDialog.QUEREN,target:f,data:e})};this.inputArr[0].addEventListener(app.Event.CLICK,ClassUtils.delegate(this,ok))}},{showCoin:function(b,c){var e,f;switch(this.pageNumber_01){case "\u5546\u4e1a":e=c.business/b.business;break;case "\u8d38\u6613":e=c.trade/b.trade;break;case "\u77ff\u573a":e=
c.mining/b.mineral;break;case "\u519c\u4e1a":e=c.agriculture/c.agriculture;break;case "\u519b\u4e8b":e=c.military/b.military;break;default:e=c.trade/b.trade}switch(this.pageNumber_02){case "500":f=5E3;break;case "1000":f=1E4;break;case "2000":f=2E4;break;default:f=1E4}this.devCoin.innerHTML=Math.round(100*e)/100*f}},{LEVEL_UP:"DevelopDialog_LevelUp",CLOSE:"DevelopDialog_Close",CANCEL:"DevelopDialog_CANCEL",QUEREN:"DevelopDialog_QUEREN"});puremvc.define({name:"app.view.scene.AreaSceneView",parent:EventDispatcher,constructor:function(b,c,e,f,g,h){EventDispatcher.call(this);this.loader=b;this.userData=f;this.indicateVo=g;this.hallLv=h;this.init(c,e);app.controller.TimeController.getInstance().addListener(this)}},{areaData:null,worldInfo:null,init:function(b,c){this.areaData=b;var e,f;this.stage=app.GameData.gameStage;this.bigContainer=new Container;this.bgScene=new Container;this.areaScene=new Container;this.worldInfo=c.getCityDataByID(this.areaData.countryId);
1==this.worldInfo.bgId?(f=this.loader.getContent("areaBg1"),this.areaBg=new Bitmap(f),this.conf=app.data.AreaData.area1):2==this.worldInfo.bgId?(f=this.loader.getContent("areaBg2"),this.areaBg=new Bitmap(f),this.conf=app.data.AreaData.area2):(f=this.loader.getContent("areaBg3"),this.areaBg=new Bitmap(f),this.conf=app.data.AreaData.area3);this.controlScene=new Container;var g=this;this.pageBg=new Bitmap(this.loader.getContent("pageBg"));this.pageBg.x=app.GameData.gameCanvas.width-180;this.pageBg.y=
app.GameData.gameCanvas.height-35;this.controlScene.addChild(this.pageBg);this.nextBtn=new Bitmap(this.loader.getContent("nextBtn"));this.controlScene.addChild(this.nextBtn);this.nextBtn.onClick=function(){g.areaData.page<g.areaData.maxPageNum&&(g.areaData.page++,g.dispatchEvent({type:app.view.scene.AreaSceneView.LOAD_AREA_DATA,target:this,data:g.areaData.page}))};this.preBtn=new Bitmap(this.loader.getContent("preBtn"));this.preBtn.x=this.pageBg.x-26;this.preBtn.y=this.pageBg.y-5;this.controlScene.addChild(this.preBtn);
this.preBtn.onClick=function(){1<g.areaData.page&&(g.areaData.page--,g.dispatchEvent({type:app.view.scene.AreaSceneView.LOAD_AREA_DATA,target:this,data:g.areaData.page}))};if(this.hallLv>=app.data.HomeBuildingData.limit[28])e=new Bitmap(this.loader.getContent("resBtn")),e.x=app.GameData.gameCanvas.width-51,e.y=app.GameData.gameCanvas.height-138,this.controlScene.addChild(e),e.onClick=function(){g.dispatchEvent({type:app.view.scene.AreaSceneView.GO_RES_SCENE,target:this,data:g.areaData.countryId})};
this.fightCdTxt=new Text("","12px Aria","");this.fightCdTxt.shadow=new Shadow("#000",0,0,"2");this.fightCdTxt.x=60;this.fightCdTxt.y=app.GameData.gameCanvas.height-45;this.controlScene.addChild(this.fightCdTxt);this.cdIco=new Bitmap(this.loader.getContent("map_ico1"));this.cdIco.x=this.fightCdTxt.x+105;this.cdIco.y=this.fightCdTxt.y-15;this.cdIco.visible=!1;this.cdIco.onClick=function(){g.dispatchEvent({type:app.view.scene.ResourceSceneView.CLEAR_CD,target:g})};this.controlScene.addChild(this.cdIco);
this.protectTxt=new Text("","12px Aria","#01ff00");this.protectTxt.shadow=new Shadow("#000",0,0,"2");this.protectTxt.x=60;this.protectTxt.y=app.GameData.gameCanvas.height-30;this.controlScene.addChild(this.protectTxt);this.effectScene=new Container;this.bigContainer.addChild(this.bgScene);this.bigContainer.scaleX=app.GameData.gameCanvas.width/f.width;this.bigContainer.scaleY=app.GameData.gameCanvas.height/f.height;this.stage.addChild(this.bigContainer);this.stage.addChild(this.areaScene);this.stage.addChild(this.effectScene);
this.stage.addChild(this.controlScene);this.stage.update();Ticker.setFPS(16);Ticker.addListener(this.stage);this.show()},show:function(){this.showIndicateTime();var b=this.worldInfo.name+" "+this.areaData.page+"/"+this.areaData.maxPageNum;this.controlScene.removeChild(this.areaTxt);this.areaTxt=new Text(b,"bold 12px Aria","#ffffff");this.areaTxt.shadow=new Shadow("#000",1,1,"1");this.areaTxt.x=this.pageBg.x+18;this.areaTxt.y=this.pageBg.y+12;this.controlScene.addChild(this.areaTxt);this.nextBtn.x=
this.areaTxt.x+7*b.length+20;this.nextBtn.y=this.preBtn.y;this.pageBg.scaleX=(this.nextBtn.x-this.preBtn.x)/57;this.bgScene.removeAllChildren();this.effectScene.removeAllChildren();this.areaScene.removeAllChildren();this.bgScene.addChild(this.areaBg);for(var b=this.areaData.townList.length,c=0;c<b;c++)this._createArea(this.areaData.townList[c]);this.stage.update()},_createArea:function(b){var c,e;e=b.position;var f=b.rid;1==b.country||-1==b.country?c=new Bitmap(this.loader.getContent("town1")):2==
b.country?c=new Bitmap(this.loader.getContent("town2")):3==b.country?c=new Bitmap(this.loader.getContent("town3")):4==b.country&&(c=new Bitmap(this.loader.getContent("town4")));c.x=this.conf[e-1].x*this.bigContainer.scaleX;c.y=this.conf[e-1].y*this.bigContainer.scaleY;this.areaScene.addChild(c);if(0<b.protectTime.getTime())e=new Bitmap(this.loader.getContent("dunpai")),e.x=c.x,e.y=c.y+30,this.areaScene.addChild(e);if(f){e=new Text(b.flag,"12px Arial","#000");var g=new Bitmap(this.loader.getContent("flag"));
g.x=c.x+3;g.y=c.y+5;e.x=g.x+4;e.y=g.y+15;this.areaScene.addChild(g);this.areaScene.addChild(e);e=this.getColorByID(b.status);e=new Text(b.userName,"12px Arial",e.color);e.shadow=new Shadow("#000",0,0,"2");e.x=c.x+20;e.y=c.y+45;this.areaScene.addChild(e)}f==this.userData.roleId&&this.drawPointer(c);var h=this;c.onPress=function(){h.dispatchEvent({type:app.view.scene.AreaSceneView.SELECT_TOWN,target:this,data:b})};return c},getColorByID:function(b){var c=app.data.PlayerColorData.data,e,f,g;f=c.length;
for(e=0;e<f;e++)if(g=c[e],g.id==b)return g},drawPointer:function(b){var c=this.loader.getContent("areaPointerSprite"),c=new SpriteSheet({images:[c],animations:{all:[0,14]},frames:{height:35,regX:0,count:15,regY:0,width:22}}),c=new BitmapAnimation(c);c.x=b.x+20;c.y=b.y-25;this.effectScene.addChild(c);c.gotoAndPlay(1)},step:function(){this.showIndicateTime()},showIndicateTime:function(){if(0<this.indicateVo.time.getTime())this.isFightCD=!0,this.cdIco.visible=!0,this.fightCdTxt.text="\u6218\u6597\u51b7\u5374 "+
this.indicateVo.time.toString(),this.fightCdTxt.color="#00fdfb";else if(this.fightCdTxt.text="\u6218\u6597\u51b7\u5374 \u53ef\u6218\u6597",this.fightCdTxt.color="#01ff00",!0==this.isFightCD)this.isFightCD=!1,this.cdIco.visible=!1;0<this.areaData.protectTime.getTime()?(this.protectTxt.text="\u4fdd\u62a4\u65f6\u95f4 "+this.areaData.protectTime.toString(),this.protectTxt.color="#00fdfb"):(this.protectTxt.text="\u5f53\u524d\u4e0d\u5728\u4fdd\u62a4\u72b6\u6001",this.protectTxt.color="#01ff00")},depose:function(){app.controller.TimeController.getInstance().removeListener(this);
Ticker.removeListener(this.stage);this.stage.removeAllChildren();this.stage.update()}},{SELECT_TOWN:"selectTown",ONE_PAGE_NUM:9,LOAD_AREA_DATA:"load_area_data",GO_RES_SCENE:"go_res_scene",GO_WORLD_SCENE:"go_world_scene",CLEAR_CD:"clearCd"});puremvc.define({name:"app.view.scene.SmallGameSceneView",parent:EventDispatcher,constructor:function(b,c,e,f,g){EventDispatcher.call(this);this.loader=b;this.data=c;this.addExp=7200*e;this.hallLev=f;this.picId=g;this.init()}},{money:0,feat:0,warToken:0,addExp:0,attackNum:null,gameStatus:!1,overInt:null,enemyInt:null,enemyList:null,init:function(){this.initInterface()},initInterface:function(){var b,c;this.stage=app.GameData.gameStage;this.stage.removeAllChildren();this.bigContainer=new Container;
this.bgScene=new Container;b=this.loader.getContent("gameBg");this.bg=new Bitmap(b);this.bgScene.addChild(this.bg);c=this.loader.getContent("heroBg");c=new Bitmap(c);c.x=3;c.y=3;this.bgScene.addChild(c);c=this.loader.getContent("chuizi");c=new Bitmap(c);c.x=7;c.y=60;this.bgScene.addChild(c);c=this.loader.getContent("heroImg"+this.picId);c=new Bitmap(c);c.x=7;c.y=6;this.bgScene.addChild(c);c=app.data.DataBase.getInstance().getHeroInfo(this.data.heroId).name;c=new Text(c,"12px Arial","#ffffff");c.shadow=
new Shadow("#000",0,0,"2");c.x=60;c.y=18;this.bgScene.addChild(c);this.countTxt=new Text("","12px Arial","#ffffff");this.countTxt.shadow=new Shadow("#000",0,0,"2");this.countTxt.x=60;this.countTxt.y=38;this.bgScene.addChild(this.countTxt);this.attackNumTxt=new Text("","12px Arial","#ffffff");this.attackNumTxt.shadow=new Shadow("#000",0,0,"2");this.attackNumTxt.x=38;this.attackNumTxt.y=105;this.bgScene.addChild(this.attackNumTxt);this.menuBg=new Bitmap(this.loader.getContent("menuBg"));this.menuBg.x=
37;this.menuBg.y=85;this.bgScene.addChild(this.menuBg);this.gameOverTxt=new Text("","12px Arial","#01ff00");this.gameOverTxt.shadow=new Shadow("#000",0,0,"2");this.gameOverTxt.x=190;this.gameOverTxt.y=120;this.bgScene.addChild(this.gameOverTxt);this.statisticTxt=new Text("","12px Arial","#01ff00");this.statisticTxt.shadow=new Shadow("#000",0,0,"2");this.statisticTxt.x=80;this.statisticTxt.y=150;this.bgScene.addChild(this.statisticTxt);this.levelCueTxt=new Text("","12px Arial","#ff0000");this.levelCueTxt.shadow=
new Shadow("#000",0,0,"2");this.levelCueTxt.x=110;this.levelCueTxt.y=170;this.bgScene.addChild(this.levelCueTxt);var e=this;if(0<this.data.count)this.startBtn=new Bitmap(this.loader.getContent("startBtn")),this.startBtn.x=185,this.startBtn.y=120,this.bgScene.addChild(this.startBtn),this.startBtnTxt=new Text("\u5f00\u59cb\u5b88\u57ce","12px Arial","#fffb88"),this.startBtnTxt.shadow=new Shadow("#000",0,0,"2"),this.startBtnTxt.x=this.startBtn.x+30,this.startBtnTxt.y=this.startBtn.y+20,this.bgScene.addChild(this.startBtnTxt),
this.startBtn.onClick=function(){e.startGame()};this.closeBtn=new Bitmap(this.loader.getContent("closeBtn"));this.closeBtn.x=415;this.closeBtn.y=244;this.bgScene.addChild(this.closeBtn);this.closeBtnTxt=new Text("\u9000    \u51fa","12px Arial","#fffb88");this.closeBtnTxt.shadow=new Shadow("#000",0,0,"2");this.closeBtnTxt.x=this.closeBtn.x+12;this.closeBtnTxt.y=this.closeBtn.y+15;this.bgScene.addChild(this.closeBtnTxt);this.closeBtn.onClick=function(){e.dispatchEvent({type:app.view.scene.SmallGameSceneView.CLOSE})};
this.helpBtn=new Bitmap(this.loader.getContent("closeBtn"));this.helpBtn.x=350;this.helpBtn.y=244;this.bgScene.addChild(this.helpBtn);this.helpBtnTxt=new Text("\u6e38\u620f\u8bf4\u660e","12px Arial","#fffb88");this.helpBtnTxt.shadow=new Shadow("#000",0,0,"2");this.helpBtnTxt.x=this.helpBtn.x+6;this.helpBtnTxt.y=this.helpBtn.y+15;this.bgScene.addChild(this.helpBtnTxt);this.helpBtn.onClick=function(){e.dispatchEvent({type:app.view.scene.SmallGameSceneView.SHOW_HELP})};this.gameScene=new Container;this.bigContainer.addChild(this.bgScene);
this.bigContainer.addChild(this.gameScene);this.bigContainer.scaleX=app.GameData.gameCanvas.width/b.width;this.bigContainer.scaleY=app.GameData.gameCanvas.height/b.height;this.stage.addChild(this.bigContainer);this.initGameData();this.stage.update()},initGameData:function(){this.statisticTxt.visible=!1;this.levelCueTxt.visible=!1;this.warToken=this.feat=this.money=0;this.attackNum=app.view.scene.SmallGameSceneView.ATTACK_MAX_NUM;this.countTxt.text="\u4eca\u5929\u5269\u4f59\u6b21\u6570"+this.data.count;
this.attackNumTxt.text=""+this.attackNum;0<this.data.count?(this.gameOverTxt.text="\u6e38   \u620f   \u7ed3   \u675f",this.gameOverTxt.visible=!1):(this.gameOverTxt.text="\u4eca\u5929\u5b88\u57ce\u6b21\u6570\u5df2\u7528\u5b8c",this.gameOverTxt.visible=!0)},reSetGameData:function(){this.warToken=this.feat=this.money=0;this.attackNum=app.view.scene.SmallGameSceneView.ATTACK_MAX_NUM;this.countTxt.text="\u4eca\u5929\u5269\u4f59\u6b21\u6570"+this.data.count;this.attackNumTxt.text=""+this.attackNum},startGame:function(){this.enemyList=
[];this.reSetGameData();this.startBtn.visible=!1;this.startBtnTxt.visible=!1;this.helpBtn.visible=!1;this.helpBtnTxt.visible=!1;this.menuBg.visible=!1;var b=this;this.gameStatus=!0;if(null!=this.data.enemyList)this.enemyNum=this.data.enemyList.length,this.enemyInt=setInterval(function(){b.createEnemy()},1E3);this.bg.onPress=function(){b.mouseClickHandle(1)};Ticker.setFPS(16);this.setTicker(!0)},mouseClickHandle:function(b){if(!0==this.gameStatus){if(0<this.attackNum){this.attackNum-=b;if(0>this.attackNum)this.attackNum=
0;this.attackNumTxt.text=this.attackNum}0==this.attackNum&&this.gameOver()}},createEnemy:function(){if(0==this.enemyNum)clearInterval(this.enemyInt);else{var b,c,e;e=this;this.enemyNum--;c=this.getEnemyInfo(this.data.enemyList[this.enemyNum]);b=new app.view.smallGame.Enemy(c,this.loader);this.enemyList.push(b);this.gameScene.addChild(b.container);b.container.onPress=function(){0<b.hp&&e.killEnemy(b)}}},addHitPointer:function(b){this.gameScene.addChild(new app.view.smallGame.HitBitmapAnimation(b,this.loader,
this.gameScene))},tick:function(){this.enemyMove();this.stage.update()},enemyMove:function(){var b,c,e,f;e=this.gameScene.getNumChildren();for(b=0;b<e;b++)if((f=this.enemyList[b])&&f.container&&0<f.hp)c=f.container,c.x+=f.xSpeed,c.y+=f.ySpeed,c.y<=f.topY&&(this.enemyList.splice(b,1),this.gameScene.removeChild(c),this.mouseClickHandle(f.enemyConf.hp))},killEnemy:function(b){this.addHitPointer(b);this.mouseClickHandle(1);b.beAttack();0==b.hp&&(1==b.enemyConf.rewardType?this.money+=b.enemyConf.rewardValue*
this.hallLev:2==b.enemyConf.rewardType?this.feat+=b.enemyConf.rewardValue*this.hallLev:3==b.enemyConf.rewardType&&(this.warToken+=b.enemyConf.rewardValue),b.bitmapAnimation.dead(b,this.gameScene,this.enemyList))},getEnemyInfo:function(b){var c,e,f;e=app.data.SmallGameData.data.length;for(c=0;c<e;c++)if(f=app.data.SmallGameData.data[c],f.id==b)return f},gameOver:function(){this.statisticTxt.text="\u83b7\u5f97\u94f6\u5e01:"+this.money+"  \u83b7\u5f97\u6218\u529f:"+this.feat+"  \u83b7\u5f97\u519b\u4ee4:"+
this.warToken+"  \u83b7\u5f97\u7ecf\u9a8c"+this.addExp;this.data.heroLevel==this.hallLev&&(this.levelCueTxt.text+="\u6b66\u5c06\u7b49\u7ea7\u65e0\u6cd5\u8d85\u8fc7\u4e3b\u57ce\u7b49\u7ea7\uff0c\u65e0\u6cd5\u83b7\u5f97\u66f4\u591a\u7684\u7ecf\u9a8c");this.gameOverTxt.visible=!0;this.statisticTxt.visible=!0;this.levelCueTxt.visible=!0;this.menuBg.visible=!0;this.gameStatus=!1;this.enemyInt&&clearInterval(this.enemyInt);this.gameScene.removeAllChildren();this.dispatchEvent({type:app.view.scene.SmallGameSceneView.OVER,
target:this,data:[this.money,this.feat,this.warToken]});var b=this;this.overInt=setTimeout(function(){0<b.data.count?(b.startBtn.visible=!0,b.startBtnTxt.visible=!0,b.helpBtn.visible=!0,b.helpBtnTxt.visible=!0,b.gameOverTxt.visible=!1,b.statisticTxt.visible=!1,b.levelCueTxt.visible=!1):b.gameOverTxt.text="\u4eca\u5929\u5b88\u57ce\u6b21\u6570\u5df2\u7ecf\u7528\u5b8c"},3E3)},depose:function(){this.overInt&&clearTimeout(this.overInt);this.enemyInt&&clearInterval(this.enemyInt);this.setTicker(!1);this.stage.removeAllChildren();
this.stage.update()},setTicker:function(b){b?Ticker.addListener(this):Ticker.removeListener(this)}},{START:"SmallGame_Start",OVER:"SmallGame_Over",CLOSE:"SmallGame_Close",ATTACK_MAX_NUM:40,SHOW_HELP:"SmallGame_ShowHelp"});puremvc.define({name:"app.view.warfare.WarQueue",parent:Container,constructor:function(b,c){Container.call(this);this._init(b,c)}},{_init:function(b,c){this._data=b;this.army=c;this.army.regX=0.5*c.image.width;this.army.regY=0.5*c.image.height;this.addChild(this.army);this._title=this._createTitle(b.name,"#ffffff");this.addChild(this._title)},_createTitle:function(b,c){var e=new Text(b);e.color=c;e.textBaseline="bottom";e.textAlign="center";e.shadow=new Shadow("#000",1,1,2);return e}});puremvc.define({name:"app.view.warfare.WarfareView",parent:EventDispatcher,constructor:function(b,c){EventDispatcher.call(this);this._rowPosition=[70,140,210];this._attackPos=140;this._defencePos=310;this.loader=b;this.init(c);this.createAllTroop();this.startRounds()}},{_data:null,_rowPosition:null,_attackPos:0,_defencePos:0,_rounds:null,_roundsComplete:null,onResult:null,onComplete:null,init:function(b){this._data=b;this._scene=new Container;b=new Bitmap(this.loader.getContent("war_bg"));this._scene.addChild(b);
this._scene.addChild(this.createTitle(this._data.header));this.queues=new app.view.warfare.Queues(this.loader,this._data,this._scene);var c=app.GameData.gameStage;this._scene.scaleX=c.canvas.width/b.image.width;this._scene.scaleY=c.canvas.height/b.image.height;c.addChild(this._scene);Ticker.addListener(c)},createTitle:function(b){var c=new Container,e=new Bitmap(this.loader.getContent("title")),f=new Text(b.attackerName,"12px \u5b8b\u4f53"),b=new Text(b.defenserName,"12px \u5b8b\u4f53");f.color=b.color=
"#dfd9c2";f.textBaseline=b.textBaseline="top";f.textAlign="right";b.textAlign="left";f.y=b.y=28;f.x=145;b.x=213;c.addChild(e);c.addChild(f);c.addChild(b);c.x=0.5*(app.GameData.gameCanvas.width-e.image.width);c.y=1;return c},depose:function(){this.clear();this.onComplete=this.onResult=this._data=null;if(this._rounds){for(var b=0;b<this._rounds.length;b++)for(var c=0;c<this._rounds[b].length;c++)this._rounds[b][c].depose();this._rounds=null}},clear:function(){app.GameData.gameStage.removeAllChildren();
Ticker.removeListener(app.GameData.gameStage)},replay:function(){this.clear();this.init(this._data);this.createAllTroop();this.startRounds()},createMovie:function(b,c){var e=this.loader.getContent(b+"_data");e.images=[this.loader.getContent(b)];var f=new BitmapAnimation(new SpriteSheet(e));if(c)f.regX=0.5*e.frames.width,f.regY=0.5*e.frames.height;return f},getTroop:function(b,c){for(var e=c?this.attackers:this.defenders,f,g=0;g<e.length;g++)if(e[g].data.pos==b){f=e[g];break}return f},createAllTroop:function(){var b=
this._data.header.attackers,c,e,f;this.attackers=[];f=b.length;for(c=0;c<f;c++)e=new app.view.warfare.WarTroop(this.loader,b[c],!0),e.arrived=!1,this.attackers.push(e);this.defenders=[];b=this._data.header.defensers;f=b.length;for(c=0;c<f;c++)e=new app.view.warfare.WarTroop(this.loader,b[c],!1),e.arrived=!1,this.defenders.push(e)},startRounds:function(){this._rounds=[];this._roundsComplete=[];for(var b=this._data.record,c,e=0;e<b.length;e++){c=[];for(var f=0;f<b[e].length;f++)c[f]=this.warCreate(b[e][f],
ClassUtils.delegate(this,this.nextRound,e),e);this._rounds.push(c);this._roundsComplete.push(!1)}for(e=0;e<this._rounds.length;e++)this.nextRound(null,null,e);this.queues.show()},nextRound:function(b,c,e){if(null!=b)this.onResult(b,c);if(0<this._rounds[e].length)b=this._rounds[e].shift(),c=b.attacker,e=b.defender,c&&!c.parent&&(this._scene.addChild(c),this.queues.startFight(c.data.pos,!0)),e&&!e.parent&&(this._scene.addChild(e),this.queues.startFight(e.data.pos,!1)),this.queues.show(),b.move();else{this._roundsComplete[e]=
!0;for(b=0;b<this._roundsComplete.length;b++)if(!this._roundsComplete[b])return;app.trace("all complete!!!");if(this.onComplete)this.onComplete(this._data)}},warCreate:function(b,c,e){var f=this.createMovie("fight"),g=this.createMovie("winner",!0),h=this.createMovie("throw"),j=this.getTroop(b.attackerPos,!0);if(!j.arrived)j.x=this._attackPos,j.y=this._rowPosition[e],j.standup();var k=this.getTroop(b.defenserPos,!1);if(!k.arrived)k.x=this._defencePos,k.y=this._rowPosition[e],j.standup();e=new app.controller.WarfareController(j,
k,f,g,h);e.data=b;e.handler=c;return e}},{});puremvc.define({name:"app.view.warfare.WarTroop",parent:Container,constructor:function(b,c,e){Container.call(this);this._init(b,c,e)}},{_cellWidth:22,_cellHeight:20,_speed:2,arrived:!1,_attackPos:185,_defencePos:255,_init:function(b,c,e){this._isAttack=e;this._loader=b;this._soldiers=[];this.data=c;this._createFighter(c.fighters,e)},_createFighter:function(b,c){var e,f;for(e=1;10>e;e++)this._getPosition(e);app.trace("------------------");for(f in b)e=app.view.warfare.WarTroop.createSolider(this._loader,
b[f],c),f=this._getPosition(parseInt(f),c),e.x=f.col*this._cellWidth,e.y=f.row*this._cellHeight,this.addChild(e),this._soldiers.push(e);this.addChild(this._createTitle(this.data.name,"#ffffff"))},_createTitle:function(b,c){var e=new Text(b);e.x=25;e.y=25;e.color=c;e.textBaseline="bottom";e.textAlign="center";e.shadow=new Shadow("#000",1,1,2);return e},move:function(){for(var b=0;b<this._soldiers.length;b++)this._soldiers[b].gotoAndPlay("move")},standup:function(){for(var b=0;b<this._soldiers.length;b++)this._soldiers[b].gotoAndStop("stop")},
cheer:function(){for(var b=0;b<this._soldiers.length;b++)this._soldiers[b].gotoAndPlay("cheer")},_getPosition:function(b,c){var e=Math.ceil(b/3)-1;c&&(e=2-e);return{row:(b-1)%3,col:e}},checkArrived:function(){if(this._isAttack){if(this.x>this._attackPos)this.x=this._attackPos,this.arrived=!0,this.standup()}else if(this.x<this._defencePos)this.x=this._defencePos,this.arrived=!0,this.standup()}},{createSolider:function(b,c,e){var f;f=1==c||2==c?"soldier1":"soldier"+c;c=b.getContent(f+"_data");c.images=
[b.getContent(f)];b=new BitmapAnimation(new SpriteSheet(c));b.regX=0.5*c.frames.width;b.regY=0.5*c.frames.height;b.scaleX=b.scaleY=0.3;if(e)b.scaleX=-b.scaleX;b.gotoAndStop(0);return b}});puremvc.define({name:"app.view.warfare.Queues",constructor:function(b,c,e){this.loader=b;this._data=c;this._scene=e;this.createQueue();this.show()}},{createQueue:function(){var b,c,e;this._attackerHeads=[];e=this._data.header.attackers.length;for(c=0;c<e;c++)b=new Bitmap(this.loader.getContent("army_a")),this.rowHeight1=b.image.height+3,this._attackerHeads[c]=new app.view.warfare.WarQueue(this._data.header.attackers[c],b);this._defenserHeads=[];e=this._data.header.defensers.length;for(c=0;c<e;c++)b=
new Bitmap(this.loader.getContent("army_d")),this.rowHeight2=b.image.height+3,this._defenserHeads[c]=new app.view.warfare.WarQueue(this._data.header.defensers[c],b)},show:function(){var b,c,e;c=Math.min(8,this._attackerHeads.length);for(b=0;b<c;b++)e=b%4,this._attackerHeads[b].x=30+(3<b?40:0),this._attackerHeads[b].y=70+e*this.rowHeight1+(3<b?20:0),this._attackerHeads[b].parent||this._scene.addChild(this._attackerHeads[b]);c=Math.min(8,this._defenserHeads.length);for(b=0;b<c;b++)e=b%4,this._defenserHeads[b].x=
420+(3<b?40:0),this._defenserHeads[b].y=70+e*this.rowHeight2+(3<b?20:0),this._defenserHeads[b].parent||this._scene.addChild(this._defenserHeads[b])},startFight:function(b,c){for(var e=c?this._attackerHeads:this._defenserHeads,f=e.length,g,h=0;h<f;h++)if(e[h]._data.pos==b){g=e.splice(h,1)[0];g.parent&&g.parent.removeChild(g);break}return g}},{});puremvc.define({name:"app.view.ViewUtils"},{},{createMask:function(b,c){var c=c||0,e={position:"absolute",left:"0px",top:"0px"};e["background-color"]=b||"#000";e.width=app.GameData.gameCanvas.width+"px";e.height=app.GameData.gameCanvas.height+"px";0<c?e.opacity=c:e["background-color"]="none";e.overflow="hidden";var f=document.createElement("div"),g;for(g in e)f.style[g]=e[g];return f},scaleView:function(b){var c=app.GameData.gameCanvas.height,e=app.GameData.gameCanvas.width/480;268*e>c&&(e=c/268);
b.style["-webkit-transform-origin"]="0 0";b.style["-webkit-transform"]="scale("+e+")";return e}});puremvc.define({name:"app.view.Alert"},{btns:null,init:function(){var b=document.createElement("div");b.innerHTML=app.view.Alert.TemplateHtml;return b.querySelector("#msgbox")},setData:function(b,c,e,f){var g=b.querySelector("#msg_btns");this.btns=[];b.querySelector("#message").innerHTML=c;e||(e=["\u786e \u5b9a"]);for(var c=function(b,c){f&&f(c);f=null;this.close();for(var e=0;e<this.btns.length;e++)this.btns[e][app.Event.ONCLICK]=null;this.btns=null},h=0;h<e.length;h++)b=document.createElement("input"),
b.className="btn",b.setAttribute("type","button"),0<h&&b.setAttribute("style","margin-left:40px"),b.setAttribute("value",e[h]),b[app.Event.ONCLICK]=ClassUtils.delegate(this,c,h),g.appendChild(b),this.btns.push(b)},show:function(b,c,e){this.close();var f=this.init(this.templateHtml);this.setData(f,b,c,e);this.dialog=new app.view.base.BaseUIForm(f,!0)},close:function(){if(this.dialog)this.dialog.depose(),this.dialog=null}},{TemplateHtml:'<div id="msgbox" style=" position:absolute;color:#FFD986; background:url(images/ui/msgboxbg.gif) no-repeat; width:295px; height:116px"><div id="message" style="text-align:center;padding:15px 6px 0 6px; height:60px"></div><div id="msg_btns" style="text-align:center;"></div></div>',
_instance:null,getInstance:function(){var b=app.view.Alert;if(null==b._instance)b._instance=new b;return b._instance},show:function(b,c,e){var f=new app.view.Alert,g=f.init(app.view.Alert);f.setData(g,b,c,e);f.dialog=new app.view.base.BaseUIForm(g,!0)}});puremvc.define({name:"app.view.Tooltip"},{show:function(b,c,e,f){this.close();f=document.createElement("div");f.style.width="313px";f.style["text-align"]="center";f.style.background="url(images/ui/popubg_04.png) center top repeat-y";f.style.lineHeight="24px";f.className="fc4";f.innerHTML=b;this.dialog=new app.view.base.BaseUIForm(f,!1);void 0!=c&&(this.dialog.view.style.left=c+"px");void 0!=e&&(this.dialog.view.style.top=e+"px");this.time=setTimeout("app.view.Tooltip.getInstance().close()",2E3)},
close:function(){if(this.dialog)this.dialog.depose(),this.dialog=null,clearTimeout(this.time)}},{TemplateHtml:"",_instance:null,getInstance:function(){var b=app.view.Tooltip;if(null==b._instance)b._instance=new b;return b._instance}});puremvc.define({name:"app.view.battle.BaseTroop",constructor:function(b,c,e){this.troopInfo=b;this.unitCount=Math.ceil(this.troopInfo.maxHp/app.view.battle.BaseTroop.SOLDIERS_COUNT);this.__init();this.onPress=c;this.onRelease=e}},{onPress:null,onRelease:null,size:45,unitCount:0,scale:0.8,troopInfo:null,soldier:null,soldiers:null,buffers:null,__init:function(){this.troop=new Container;this.troop.regX=0.5*this.size;this.troop.regY=0.5*this.size;var b=this;this.troop.onClick=function(c){if(b.onPress)b.onPress(b,
c.stageX,c.stageY)};this.soldiers=[];this.buffers=[]},__createSoldier:function(b,c){var e=b.clone();e.scaleY=e.data.scale?e.data.scale:this.scale;e.scaleX=this.troopInfo.isAttack?-e.scaleY:e.scaleY;var f=this.__getPosition(c);e.x=f.x;e.y=f.y;this.troop.addChild(e);e.standUp();return e},__getPosition:function(b){var c={},e=this.size;switch(b){case 0:c.x=0.5*(e/3);c.y=e/3;break;case 1:c.x=2.5*(e/3);c.y=e/3;break;case 2:c.x=1.5*(e/3);c.y=2*(e/3);break;case 3:c.x=0.5*(e/3)+(this.troopInfo.isAttack?5:
-5);c.y=e;break;case 4:c.x=2.5*(e/3)+(this.troopInfo.isAttack?5:-5),c.y=e}return c},createTroop:function(b){var c=Math.ceil(this.troopInfo.hp/this.unitCount);this.soldier=new app.view.battle.Soldier(b);for(b=0;b<c;b++)this.soldiers[b]=this.__createSoldier(this.soldier,2);0<c&&this.setFlag()},getCenter:function(){var b=0.5*this.size;return{x:b,y:b}},setPosition:function(b,c){this.troop.x=b;this.troop.y=c},getPosition:function(){return{x:this.troop.x,y:this.troop.y}},reduceHp:function(b){this.troopInfo.hp-=
b;if(0>this.troopInfo.hp)this.troopInfo.hp=0;this.troop.visible=0<this.troopInfo.hp;this.updateHpBar()},increaseHp:function(b){this.troopInfo.hp+=b;if(this.troopInfo.hp>this.troopInfo.maxHp)this.troopInfo.hp=this.troopInfo.maxHp;this.updateHpBar()},updateHpBar:function(){var b=0.01;0<this.troopInfo.hp?(b=this.troopInfo.hp/this.troopInfo.maxHp,b=1<b?1:b):b=0.01;this.hpBar.scaleX=b},updateMorale:function(){var b=0.01;0<this.troopInfo.morale?(b=this.troopInfo.morale/100,b=1<b?1:b):b=0.01;this.powerBar.scaleX=
b},attack:function(b){for(var c=this.soldiers,e=0;e<c.length;e++)c[e].attack&&c[e].attack(0==e?b:null)},defence:function(b){for(var c=this.soldiers,e=0;e<c.length;e++)c[e].defence&&c[e].defence(0==e?b:null)},addBuffer:function(b,c,e){0<this.buffers.length&&this.buffers[this.buffers.length-1].bufferVisible(!1);this.buffers.push(app.view.battle.SkillMovie.showBuffer(this,b,c,e))},reduceBuffer:function(b){for(var c=0;c<this.buffers.length;c++)if(this.buffers[c].bufferId==b){this.buffers[c].clearBuffer();
this.buffers.splice(c,1);break}0<this.buffers.length&&this.buffers[this.buffers.length-1].bufferVisible(!0)},showMorale:function(b,c){if(!this.moraleBuffer)this.moraleBuffer=app.view.battle.SkillMovie.showMorale(this,b,c)},removeMorale:function(){this.moraleBuffer&&this.moraleBuffer.clearMorale();this.moraleBuffer=null},standUp:function(){for(var b=this.soldiers,c=0;c<b.length;c++)b[c].standUp&&b[c].standUp()},setFlag:function(){var b=new Text(this.troopInfo.name);b.shadow=new Shadow("#000",0,0,"2");
b.color="#FFFFFF";b.textBaseline="top";b.textAlign="center";b.font="11px";b.x=20;b.y=-2;var c=new Container;c.addChild(b);c.y=-36;b=new Graphics;b.setStrokeStyle(0.4);b.beginStroke(Graphics.getRGB(0,0,0));b.drawRoundRect(0,0,40,2,0);b=new Shape(b);b.y=12;c.addChild(b);b=new Graphics;b.beginFill(Graphics.getRGB(255,0,0));b.drawRoundRect(0,0,40,2,0);b=new Shape(b);b.y=12;b.scaleX=1;this.hpBar=b;c.addChild(b);b=new Graphics;b.setStrokeStyle(0.4);b.beginStroke(Graphics.getRGB(0,0,0));b.drawRoundRect(0,
0,40,2,0);b=new Shape(b);b.y=16;c.addChild(b);b=new Graphics;b.beginFill(Graphics.getRGB(255,255,0));b.drawRoundRect(0,0,40,2,0);b=new Shape(b);b.y=16;b.scaleX=0.01;this.powerBar=b;c.addChild(b);this.troop.addChild(c)},addSkillText:function(b,c){this.removeSkillText();var e=new Bitmap(c),f=new Text(b);f.color="#FFFFFF";f.textBaseline="top";f.textAlign="center";f.x=0.5*c.width;f.y=4;this.skillText=new Container;this.skillText.addChild(e);this.skillText.addChild(f);this.troop.addChild(this.skillText);
var g=this;setTimeout(function(){g.removeSkillText(g.skillText)},1E3)},removeSkillText:function(b){try{if(!b)b=this.skillText;if(b&&(this.troop.removeChild(b),b==this.skillText))this.skillText=null}catch(c){}},depose:function(){this.removeMorale();this.troop.parent.removeChild(this.troop);this.soldiers=[];this.buffers=[];this.troop.onClick=null;this.troopInfo=this.onSelect=this.troop=this.troop.onPress=null}},{SOLDIERS_COUNT:1});puremvc.define({name:"app.view.battle.Soldier",parent:BitmapAnimation,constructor:function(b){this.data=b;BitmapAnimation.call(this,new SpriteSheet(b))}},{animationEnd:null,onAnimationEnd:function(b){b.standUp();b.animationEnd&&b.animationEnd();b.animationEnd=null},attack:function(b){this.gotoAndPlay("attack");this.animationEnd=b},defence:function(b){this.gotoAndPlay("beattack");this.animationEnd=b},standUp:function(){this.gotoAndStop(0)},clone:function(){return new app.view.battle.Soldier(this.data)}},
{});puremvc.define({name:"app.view.battle.NumberMovie",constructor:function(b){this.container=b;this.view=new Container}},{container:null,view:null,create:function(b){try{for(var c=app.view.battle.NumberMovie._SOURCE,e=app.view.battle.NumberMovie.CELL_WIDTH,f=app.view.battle.NumberMovie.CELL_HEIGHT,g=(0<=b?"+":"-")+Math.abs(b).toString(),b=0<=b?0:f,h="-,+,1,2,3,4,5,6,7,8,9,0".split(","),j=0;j<g.length;j++){var k=h.indexOf(g.charAt(j)),l={};l.width=e;l.height=f;l.x=k*e;l.y=b;var m=new Sprite(c,l);m.x=
j*e;m.y=0;this.view.addChild(m)}this.view.regX=0.5*g.length*e;this.view.regY=0.5*f}catch(o){app.trace(o)}},play:function(b,c,e,f){var g=this,f=f||0.8;Tween.get(this.view,{loop:!1}).to({scaleX:0.1,scaleY:0.1,x:b,y:c,alpha:0}).to({scaleX:f,scaleY:f,x:b,y:c-10,alpha:1},400,Ease.get(1)).to({y:c-60,alpha:0},400,Ease.get(-1)).wait(200).call(function(){null!=g.container&&g.container.removeChild(g.view);g.container=null;g.view=null;null!=e&&e()},null,this);this.view.alpha=0;this.container.addChild(this.view)}},
{_SOURCE:null,CELL_WIDTH:19,CELL_HEIGHT:31,setBitmapSource:function(b){app.view.battle.NumberMovie._SOURCE=b},showMovie:function(b,c,e,f,g,h){f=new app.view.battle.NumberMovie(f);f.create(e);f.play(b,c,g,h);return f.view}});puremvc.define({name:"app.view.battle.SkillMovie",constructor:function(b){this.container=b}},{container:null,skillMovie:null,createSkill:function(b,c,e){var f=new BitmapAnimation(new SpriteSheet(c)),g=b.getPosition();f.x=g.x;f.y=g.y;if(null!=c.scale)f.scaleX=f.scaleY=c.scale;if(!b.troopInfo.isAttack)f.scaleX=-f.scaleX;var h=this;f.onAnimationEnd=function(b){b.gotoAndStop(0);f.onAnimationEnd=null;null!=h.container&&h.container.removeChild(f);h.container=null;null!=e&&e()};this.container.addChild(f);
f.gotoAndPlay(0);this.skillMovie=f},bufferId:0,bufferMovie:null,createBuffer:function(b,c){this.clearBuffer();this.bufferId=b;this.bufferMovie=new BitmapAnimation(new SpriteSheet(c));this.bufferMovie.x=22;this.bufferMovie.y=0;if(null!=c.scale)this.bufferMovie.scaleX=this.bufferMovie.scaleY=c.scale;this.container.addChild(this.bufferMovie);this.bufferMovie.gotoAndPlay(1)},cloneImage:function(){if(this.bufferMovie){var b=SpriteSheetUtils.extractFrame(this.bufferMovie.spriteSheet,0);return new Bitmap(b)}return null},
bufferVisible:function(b){if(this.bufferMovie)this.bufferMovie.visible=b},clearBuffer:function(){null!=this.container&&this.bufferMovie&&this.container.removeChild(this.bufferMovie);this.bufferId=0;this.bufferMovie=null},createMorale:function(b,c,e,f){this.moraleA=new BitmapAnimation(new SpriteSheet(b));this.moraleB=new BitmapAnimation(new SpriteSheet(c));this.container.addChild(this.moraleA);this.container.addChildAt(this.moraleB,0);this.moraleA.x=this.moraleB.x=e||0;this.moraleA.y=this.moraleB.y=
f||0;this.moraleA.gotoAndPlay(1);this.moraleB.gotoAndPlay(1)},clearMorale:function(){this.moraleA&&this.container.removeChild(this.moraleA);this.moraleB&&this.container.removeChild(this.moraleB);this.moraleB=this.moraleA=null}},{NO_EFFECT:!1,showSkill:function(b,c,e,f){e=new app.view.battle.SkillMovie(e);e.createSkill(b,c,f);e.skillMovie.visible=!app.view.battle.SkillMovie.NO_EFFECT;return e},showBuffer:function(b,c,e){b=new app.view.battle.SkillMovie(b.troop);b.createBuffer(c,e);return b},showMorale:function(b,
c,e){var f=new app.view.battle.SkillMovie(b.troop),b=b.getCenter();f.createMorale(c,e,b.x,b.y);return f},setEffectVisible:function(b){app.view.battle.SkillMovie.NO_EFFECT=b}});puremvc.define({name:"app.view.building.CommonBuildDialog",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0);this.title=this.view.querySelector("#dlg_title");this.descript=this.view.querySelector("#dlg_description");b=this.view.querySelector("#building_img");b.width=170;b.height=100;this.stage=new Stage(b);var c=this,b=this.view.querySelector("#levelup_btn");b.addEventListener(app.Event.CLICK,function(){c.dispatchEvent({type:app.view.building.CommonBuildDialog.LEVEL_UP,
target:c})});b=this.view.querySelector("#dlg_close");b.addEventListener(app.Event.CLICK,function(){c.dispatchEvent({type:app.view.building.CommonBuildDialog.CLOSE,target:c})});this.levelupBtns=this.container.querySelector("#levelup_btns");this.levelup_prop=this.container.querySelector("#levelup_prop")}},{setData:function(b){app.view.base.BaseUIForm.prototype.setData.call(this,b);this.title.innerHTML=b.name;this.setBuildingImage(b.content)},showBtns:function(b){this.levelupBtns.innerHTML="";for(var c,
e=b.length,f=document.createDocumentFragment(),g,h=0;h<e;h++)c=document.createElement("input"),c.type="button",c.className="btn",c.style["float"]="left",c.style.marginTop="10px",g=0==(h+1)%2?40:25,c.style.marginLeft=g+"px",c.setAttribute("value",b[h]),c[app.Event.ONCLICK]=ClassUtils.delegate(this,this.operateHandler,h),f.appendChild(c);this.levelupBtns.appendChild(f)},setBuildingImage:function(b){if(this.stage)this.stage.removeAllChildren(),this.building=new Bitmap(b),this.building.x=0.5*(this.stage.canvas.width-
b.width),this.building.y=0.5*(this.stage.canvas.height-b.height),this.stage.addChild(this.building),Ticker.setFPS(20),Ticker.addListener(this.stage)},setFlag:function(b){var c=b.getContent("levelup_data");c.images=[b.getContent("levelup")];b=new BitmapAnimation(new SpriteSheet(c));b.regX=0.5*c.frames.width;b.regY=c.frames.height;b.x=0.5*this.stage.canvas.width;b.y=this.stage.canvas.height;b.onAnimationEnd=function(b){b.gotoAndStop(0);b.visible=!1};this.stage.addChild(b);this.flagMovie=b},showLevelUP:function(){this.flagMovie.visible=
!0;this.flagMovie.gotoAndPlay(1)},updateBuildInfo:function(b,c){var e;e=this.levelup_prop.getElementsByTagName("span");e[0].innerHTML=b.needMoney;e[1].innerHTML=app.data.TimeVO.formatTime(1E3*b.needTime);e=this.descript.getElementsByTagName("span");e[0].innerHTML=this.data.name+"("+b.level+"\u7ea7)";e[1].innerHTML=this.data.descript.toString();this.buttonsStr=c.join(",");this.showBtns(c)},operateHandler:function(b,c){this.dispatchEvent({type:app.view.building.CommonBuildDialog.OPERATE,target:this,
data:c})},depose:function(){this.removeAllEventListeners();app.GameData.UIFormDiv.removeChild(this.container);this.stage.removeAllChildren();Ticker.removeListener(this.stage);this.flagMovie=this.building=this.stage=null}},{LEVEL_UP:"Build_LevelUp",CLOSE:"Build_Close",OPERATE:"Build_Operate"});puremvc.define({name:"app.view.building.HallContentView",parent:app.view.base.TabContentView,constructor:function(b,c,e,f){app.view.base.TabContentView.call(this,b.getContent("tabContent"));this.level=c;this.init(b,e,f);app.controller.TimeController.getInstance().addListener(this)}},{userData:null,officialData:null,init:function(b,c,e){this.append("\u5b98\u804c",b.getContent("official"));this.append("\u5c5e\u81e3",b.getContent("liegeman"));if(!c)this.tabBar.tabs[1].style.display="none",this.tabBar.tabs[1].parentNode.style.display=
"none";if(!e)this.tabBar.tabs[0].style.display="none";this.setEvents()},setEvents:function(){if(null!=this.viewStack.contents[0])this.obtainBtn=this.viewStack.contents[0].querySelector("#obtain_btn"),this.obtainBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.obtainHandler),this.promotionBtn=this.viewStack.contents[0].querySelector("#promotion_btn"),this.promotionBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.promotionHandler);if(null!=this.viewStack.contents[1])this.kickBtn=this.viewStack.contents[1].querySelector("#kick_btn"),
this.kickBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.kickLiegeman),this.refresh_btn=this.viewStack.contents[1].querySelector("#refresh_btn"),this.refresh_btn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.refreshLiegeman)},setData:function(b){this.userData=b;var c=this.bottom.getElementsByTagName("span");c[0].innerHTML="\u91d1\u5e01\uff1a"+b.goldCoin;c[0].className="fc1";c[1].innerHTML="\u94f6\u5e01\uff1a"+b.silverCoin+"/"+b.maxSilverCoin;this.title.innerHTML="\u4e3b\u57ce("+this.level+
"\u7ea7)";this.officialData&&this.setOfficialData(this.officialData,b.prestige)},obtainHandler:function(b){b.target.disabled||this.dispatchEvent({type:app.view.building.HallContentView.GET_PAY,target:this})},promotionHandler:function(b){b.target.disabled||this.dispatchEvent({type:app.view.building.HallContentView.EXCHANGE_PRESTIGE,target:this})},kickLiegeman:function(){try{var b=this.liegemanData[this.selectLiegemanIndex];event.target.disabled||this.dispatchEvent({type:app.view.building.HallContentView.KICK_LIEGEMAN,
target:this,data:b.liegemanId})}catch(c){app.trace(c.message)}},refreshLiegeman:function(){this.dispatchEvent({type:app.view.building.HallContentView.REFRESH_LIEGEMAN,target:this})},step:function(){if(null!=this.officialData)this.prestigeTime.innerHTML=this.officialData.needTime.toString()},setOfficialData:function(b,c){this.officialData=b;var e=app.data.DataBase.getInstance().getOfficialByPrestige(c),f=this.viewStack.contents[0].querySelector("#op_panel"),f=f.getElementsByTagName("span");f[0].innerHTML=
null!=e?e.name:"\u65e0";f[1].innerHTML=this.userData.prestige;f[2].innerHTML=null!=e?e.salary:"";this.obtainBtn.disabled=null!=e?!b.canGet:!1;this.promotionBtn.disabled=0<b.needTime.getTime();f=this.viewStack.contents[0].querySelector("#bottom_panel1");f=f.getElementsByTagName("span");e=null!=e?e.level:0;e=app.data.DataBase.getInstance().getOfficialInfo(e+1);if(null!=e)f[0].innerHTML=e.name,f[1].innerHTML=e.value,f[2].innerHTML=app.data.DataBase.getInstance().getOfficialDescript(e,this.userData.country);
f=this.viewStack.contents[0].querySelector("#bottom_panel2");f=f.getElementsByTagName("span");f[0].innerHTML=b.needFeat;f[1].innerHTML=b.obtainPrestige;f[2].innerHTML=b.needTime.toString();this.prestigeTime=f[2]},setLiegemanData:function(b,c){this.liegemanData=b.slice();this.liegemanFlag=$("liegeman_flag");null!=this.liegemanFlag&&(this.liegemanFlag.style.visibility="hidden");this.liegemanDiv=[];var e=this.viewStack.contents[1].querySelector("#liegemans");e.innerHTML="";for(var f=document.createDocumentFragment(),
g=this,h=function(b){b=g.liegemanDiv.indexOf(b.currentTarget);0<=b&&g.showLiegeman(b)},j=0;j<b.length;j++)this.liegemanDiv[j]=document.createElement("div"),this.liegemanDiv[j].className="zcImg_01",this.liegemanDiv[j].innerHTML=b[j].name,this.liegemanDiv[j].addEventListener(app.Event.CLICK,h),f.appendChild(this.liegemanDiv[j]);e.appendChild(f);this.viewStack.contents[1].querySelector("#liegeman_num").innerHTML="\u5c5e\u81e3\u4fe1\u606f\uff08"+b.length+"/"+(null!=c?c.liegemanNum:0)+"\uff09";this.kickBtn.disabled=
!(this.liegemanData&&0<this.liegemanData.length);this.showLiegeman(0)},showLiegeman:function(b){for(var c=this.viewStack.contents[1].querySelector("#top_panel").getElementsByTagName("span"),e=0;e<c.length;e++)c[e].innerHTML="";this.selectLiegemanIndex=null;try{this.liegemanDiv[b].appendChild(this.liegemanFlag);this.liegemanFlag.style.visibility="visible";var f=this.liegemanData[b];c[0].innerHTML=f.name+"("+f.level+"\u7ea7)";c[1].innerHTML=f.handInCoin;var g=app.data.DataBase.getInstance().getOfficialInfo(f.post);
c[2].innerHTML=null!=g?g.name:"\u65e0";c[3].innerHTML=f.handInTime;c[4].innerHTML=null!=f.group?f.group:"\u65e0";c[5].innerHTML=null!=f.area?f.area:"";this.selectLiegemanIndex=b}catch(h){this.selectLiegemanIndex=null}},depose:function(){this.dispatchEvent({type:app.view.building.HallContentView.CLOSE,target:this});this.obtainBtn[app.Event.ONCLICK]=null;this.promotionBtn[app.Event.ONCLICK]=null;this.kickBtn=this.promotionBtn=this.obtainBtn=this.kickBtn[app.Event.ONCLICK]=null;app.view.base.BaseUIForm.prototype.depose.call(this);
app.controller.TimeController.getInstance().removeListener(this)}},{GET_PAY:"getPay",EXCHANGE_PRESTIGE:"exchangePrestige",KICK_LIEGEMAN:"kickLiegeman",REFRESH_LIEGEMAN:"refreshLiegeman",CLOSE:"close"});puremvc.define({name:"app.view.building.DrillGroundView",parent:app.view.base.TabContentView,constructor:function(b,c){app.view.base.TabContentView.call(this,b.getContent("tabContent"));this.init(b,c)}},{init:function(b,c){this.append("\u8bad\u7ec3",b.getContent("dg_train"));this.append("\u62db\u52df",b.getContent("dg_recruit"));c&&this.append("\u5f81\u5175",b.getContent("barracks"))},setData:function(b,c,e,f,g,h){this.herosData=b;this.buildLv=c;this.talksVo=e;this.formation=f;this.barracksProxy=
g;this.freeSoldiersTimer=h;this.title.innerHTML="\u6821\u573a("+c+"\u7ea7)"},tabChange:function(b){app.view.base.TabContentView.prototype.tabChange.call(this,b);if(null!=this.herosData)switch(b){case 0:if(null==this.herosTrain)this.herosTrain=new app.view.building.DrillGroundTrain(this.herosData,ClassUtils.delegate(this,this.sendEvent)),app.controller.TimeController.getInstance().addListener(this.herosTrain);break;case 1:if(null==this.herosRecruit)this.herosRecruit=new app.view.building.DrillGroundRecruit(this.herosData,
ClassUtils.delegate(this,this.sendEvent)),this.herosRecruit.setData(this.talksVo);break;case 2:if(null==this.barracksView)this.barracksView=new app.view.building.BarracksView(ClassUtils.delegate(this,this.sendEvent)),this.barracksView.setData(this.barracksProxy,this.userInfo,this.freeSoldiersTimer)}},updateInfo:function(){null!=this.herosTrain&&this.herosTrain.layout();this.updateBarrack()},updateBarrack:function(){null!=this.barracksView&&this.barracksView.setData(this.barracksProxy,this.userInfo,
this.freeSoldiersTimer)},heroListUpdate:function(){null!=this.herosRecruit&&this.herosRecruit.layout();null!=this.herosTrain&&this.herosTrain.layout()},formationChange:function(){null!=this.herosFormation&&this.herosFormation.refresh()},talksChange:function(b){null!=this.herosRecruit&&this.herosRecruit.setData(b)},showUserInfo:function(b){this.userInfo=b;var c=this.bottom.getElementsByTagName("span");c[0].innerHTML="\u91d1\u5e01\uff1a"+b.goldCoin;c[0].className="fc1";c[1].innerHTML="\u94f6\u5e01\uff1a"+
b.silverCoin+"/"+b.maxSilverCoin},sendEvent:function(b){this.dispatchEvent(b)},depose:function(b){void 0==b&&(b=!1);if(null!=this.herosFormation&&!1==b&&!0==this.herosFormation.isFChange){var c=this,b=this.herosFormation.fData.formation[this.herosFormation.fIndex];app.view.Alert.getInstance().show("["+b.conf.name+"] \u4e2d\u7684\u6b66\u5c06\u6709\u8c03\u6574\uff0c\u662f\u5426\u9700\u8981\u4fdd\u5b58\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==b?c.herosFormation.saveFormation():c.herosFormation.isFChange=
!1;c.depose(!0)})}else null!=this.herosTrain&&app.controller.TimeController.getInstance().removeListener(this.herosTrain),this.dispatchEvent({type:app.view.building.DrillGroundView.CLOSE,target:this}),null!=this.herosTrain&&null!=this.herosTrain.scrollView&&this.herosTrain.scrollView.depose(),null!=this.herosRecruit&&null!=this.herosRecruit.scrollView&&this.herosRecruit.scrollView.depose(),null!=this.barracksView&&this.barracksView.depose(),this.barracksView=this.herosRecruit=this.herosTrain=null,
app.view.base.TabContentView.prototype.depose.call(this)}},{CLOSE:"DrillGroundView_close"});puremvc.define({name:"app.view.building.DrillGroundHeros",constructor:function(b,c,e){this.herosData=b;this.callFunc=c;this.canvas=e;this.init();this.layout();this.index=0;this.showHeroInfo()}},{init:function(){$("tab_bottom").style.display="none";this.heroList=$("heroList");this.currHero=$("currHero").getElementsByClassName("dg_s2")[0];this.currHero.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.changeMaster));this.heroAttrib=$("hero_att");this.box1=$("sBox1");this.box2=$("sBox2");
this.setSoldierBtn=$("setSoldierBtn");this.setSoldierBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.setDefault));this.divs1=this.box1.getElementsByTagName("span");this.box1.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.showSoldier,0));this.divs2=this.box2.getElementsByTagName("span");this.box2.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.showSoldier,1));this.spans=$("sBox3").getElementsByTagName("span");$("noJobBtn")[app.Event.ONCLICK]=ClassUtils.delegate(this,
this.noJob);this.transferBtn=$("transferBtn");this.reBuildBtn=$("reBuildBtn");this.reBuildBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.reBuild);var b=this;this.newBirthBtn=$("newBirthBtn");this.newBirthBtn[app.Event.ONCLICK]=function(){b.callFunc({type:app.view.building.DrillGroundHeros.NEWBIRTH,target:b,data:b.selectHero})};this.moveBarImg=$("dg_heros01")},setBtn:function(b){var c=this;if(0==this.selectHero.newBirth)20<=b?(this.transferBtn.style.display="inline",this.canvas.parentNode.style.display=
"inline",this.canvas.parentNode[app.Event.ONCLICK]=function(){c.transfer()},this.reBuildBtn.style.display="inline"):(this.transferBtn.style.display="none",this.canvas.parentNode.style.display="none",this.reBuildBtn.style.display="none");this.newBirthBtn.style.display=60<=b?"inline":"none"},changeMaster:function(){this.selectHero.id!=this.herosData.commander&&this.callFunc({type:app.view.building.DrillGroundHeros.CHANGE_MASTER,target:this,data:this.selectHero})},reBuild:function(){this.callFunc({type:app.view.building.DrillGroundHeros.REBUILD,
target:this,data:this.selectHero})},layout:function(){var b,c,e;this.heroList.innerHTML="";b=this.herosData.onJobList.length;e=document.createDocumentFragment();for(var f="",g=0;g<b;g++)c=document.createElement("li"),f=this.herosData.onJobList[g].id==this.herosData.commander?"<img style='margin-left: 29px; margin-top: 29px;'  src='images/ui/ico_15.png' />":"",c.innerHTML='<div class="dg_s2" style="background:url(images/heros/hero_'+this.herosData.onJobList[g].conf.pic+'.gif) no-repeat;"><div style="width: 47px; height: 47px;">'+
f+'</div></div><div class="fc5 dg_s1">'+this.herosData.onJobList[g].conf.name+"</div>",c.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.handler,g)),e.appendChild(c);this.heroList.appendChild(e);this.heroList.style.position="absolute";this.heroList.style.width="50px";this.h=61*b;this.heroList.style.height=this.h+"px";var h=this;b=function(b,c){h.heroList.style["-webkit-transform"]="translateY("+-c+"px)";189<h.h&&(h.moveBarImg.style["-webkit-transform"]="translateY("+153*(c/(h.h-189))+
"px)")};if(189<this.h)this.moveBarImg.style.display="inline",null==this.scrollView?this.scrollView=new app.view.base.ScrollView(b,50,189,50,this.h,this.heroList):(b(0,0,1),this.upScrollView());else if(this.moveBarImg.style.display="none",null!=this.scrollView)this.scrollView.depose(),this.scrollView=null,this.heroList.style["-webkit-transform"]="translateY(0px)";if(null==this.herosData.onJobList[this.index])this.index=this.herosData.onJobList.length-1;this.showHeroInfo()},upScrollView:function(){null!=
this.scrollView&&(this.scrollView.scroller.setDimensions(50,189,50,this.h),this.scrollView.scroller.setPosition(0,0))},noJob:function(){1<this.herosData.onJobList.length?this.callFunc({type:app.view.building.DrillGroundHeros.NOJOB,target:this,data:this.selectHero}):app.view.Alert.getInstance().show("\u6700\u540e\u4e00\u540d\u6b66\u5c06\u4e0d\u80fd\u89e3\u8058")},hideTabBottom:function(){$("tab_bottom").style.display="none"},transfer:function(){this.callFunc({type:app.view.building.DrillGroundHeros.TRANSFER,
target:this,data:this.selectHero})},setDefault:function(){this.callFunc({type:app.view.building.DrillGroundHeros.SETDEFAULT,target:this,data:{hid:this.selectHero.id,sid:this.selectSoldier}})},handler:function(b,c){this.index=c;this.showHeroInfo()},showHeroInfo:function(){if(null!=this.tagDiv)this.tagDiv[1].style.background="none";this.tagDiv=this.heroList.getElementsByTagName("li")[this.index].getElementsByTagName("div");this.tagDiv[1].style.background="url(images/ui/xuan_02.png) no-repeat";this.selectHero=
this.herosData.onJobList[this.index];var b,c;c=this.selectHero;b=c.id==this.herosData.commander?"<img style='margin-left: 29px; margin-top: 29px;' src='images/ui/ico_15.png' />":"<img style='margin-left: 29px; margin-top: 29px;' src='images/ui/ico_16.png' />";this.currHero.style.background="url(images/heros/hero_"+c.conf.pic+".gif) no-repeat";this.currHero.innerHTML=b;var e=this.heroAttrib.getElementsByTagName("li");b=e[0].getElementsByTagName("span");b[0].innerHTML=c.conf.name;b=e[1].getElementsByTagName("span");
b[0].innerHTML=c.level;b=e[2].getElementsByTagName("span");b[0].innerHTML=c.conf.careerName;b=e[3].getElementsByTagName("span");b[0].innerHTML=Math.round(Number(c.conf.lead)+c.newBirth*Number(c.conf.leadGrow));b[1].innerHTML=c.conf.leadGrow.toFixed(1);b=e[4].getElementsByTagName("span");b[0].innerHTML=c.hp;b=e[5].getElementsByTagName("span");b[0].innerHTML=Math.round(Number(c.conf.intelligence)+c.newBirth*Number(c.conf.intelligenceGrow));b[1].innerHTML=c.conf.intelligenceGrow.toFixed(1);b=e[6].getElementsByTagName("span");
b[0].innerHTML=c.conf.troopsGrow;b=e[7].getElementsByTagName("span");b[0].innerHTML=Math.round(Number(c.conf.courage)+c.newBirth*Number(c.conf.courageGrow));b[1].innerHTML=c.conf.courageGrow.toFixed(1);b=$("hero_jn");b.innerHTML=c.conf.skillName;b=$("hero_jn2");b.innerHTML=c.conf.desc;this.setBtn(c.level);this.showSoldierList()},showSoldierList:function(){this.showSoldier(null,this.selectHero.soldier[0].id==this.selectHero.defaultSoldier?0:1);this.divs1[0].innerHTML=this.selectHero.soldier[0].conf.name;
this.divs2[0].innerHTML=this.selectHero.soldier[1].conf.name;20<=this.selectHero.level&&2>this.selectHero.soldier[0].conf.level||40<=this.selectHero.level&&3>this.selectHero.soldier[0].conf.level?null==this.movie&&this.drawDevelopAnimation():this.stopDevelopAnimation()},showSoldier:function(b,c){this.selectSoldier=this.selectHero.soldier[c].id;null!=b&&app.view.Tooltip.getInstance().show(this.selectHero.soldier[c].conf.description);0==c?(this.box1.style.background="url(images/ui/xuan_01.png) no-repeat",
this.box2.style.background="none"):(this.box1.style.background="none",this.box2.style.background="url(images/ui/xuan_01.png) no-repeat");var e=this.box1.getElementsByTagName("img");e[0].src="images/bin/bin_"+this.selectHero.soldier[0].id+".gif";e=this.box2.getElementsByTagName("img");e[0].src="images/bin/bin_"+this.selectHero.soldier[1].id+".gif";this.setSoldierBtn.style.display=this.selectHero.soldier[c].id==this.selectHero.defaultSoldier?"none":"block";this.spans[0].innerHTML="\u5175\u79cd\u7c7b\u578b\uff1a"+
app.numberToCN(this.selectHero.soldier[c].conf.level)+"\u9636"+this.selectHero.soldier[c].conf.typeName;this.spans[1].innerHTML=this.selectHero.soldier[c].attackStr+" ("+this.selectHero.soldier[c].conf.attack.toFixed(2)+")";this.spans[1].className=this.getFontColor(this.selectHero.soldier[c].attackStr);this.spans[2].innerHTML=this.selectHero.soldier[c].defenseStr+" ("+this.selectHero.soldier[c].conf.defense.toFixed(2)+")";this.spans[2].className=this.getFontColor(this.selectHero.soldier[c].defenseStr);
this.spans[3].innerHTML=this.selectHero.soldier[c].battleAttackStr+" ("+this.selectHero.soldier[c].conf.battleAttack.toFixed(2)+")";this.spans[3].className=this.getFontColor(this.selectHero.soldier[c].battleAttackStr);this.spans[4].innerHTML=this.selectHero.soldier[c].battleDefenseStr+" ("+this.selectHero.soldier[c].conf.battleDefense.toFixed(2)+")";this.spans[4].className=this.getFontColor(this.selectHero.soldier[c].battleDefenseStr);this.spans[5].innerHTML=this.selectHero.soldier[c].strategyAttackStr+
" ("+this.selectHero.soldier[c].conf.strategyAttack.toFixed(2)+")";this.spans[5].className=this.getFontColor(this.selectHero.soldier[c].strategyAttackStr);this.spans[6].innerHTML=this.selectHero.soldier[c].strategyDefenseStr+" ("+this.selectHero.soldier[c].conf.strategyDefense.toFixed(2)+")";this.spans[6].className=this.getFontColor(this.selectHero.soldier[c].strategyDefenseStr)},update:function(){this.showSoldierList();this.showHeroInfo()},getFontColor:function(b){switch(b){case "S":return"fc9";
case "A":return"fc2";case "B":return"fc10";case "C":return"fc1";case "D":return"fc11";default:return"fc7"}},drawDevelopAnimation:function(){this.stage=new Stage(this.canvas);this.obj=app.GameData.GameResource.getContent("uieff_10_data");this.obj.images=[app.GameData.GameResource.getContent("uieff_10")];this.movie=new BitmapAnimation(new SpriteSheet(this.obj));this.movie.scaleX=this.stage.canvas.width/this.obj.frames.width;this.movie.scaleY=this.stage.canvas.height/this.obj.frames.height;this.stage.addChild(this.movie);
this.movie.gotoAndPlay(0);Ticker.addListener(this.stage);Ticker.setFPS(16)},stopDevelopAnimation:function(){if(this.stage)this.movie=null,Ticker.removeListener(this.stage),this.stage.clear()}},{NOJOB:"nojob",TRANSFER:"transfer",SETDEFAULT:"setDefault",REBUILD:"reBuild",NEWBIRTH:"newBirth",CHANGE_MASTER:"change_master"});puremvc.define({name:"app.view.building.DrillGroundHeroRebuild",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0);this.init()}},{init:function(){var b=this;$("hero_rebuild_close").addEventListener(app.Event.CLICK,function(){b.dispatchEvent({type:app.view.building.DrillGroundHeroRebuild.CLOSE,target:b})});this.reBuildBtn=$("reBuildBtn1");this.reBuildBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.reBuildSoldier);this.changeBtn=$("changeBtn");this.changeBtn[app.Event.ONCLICK]=
ClassUtils.delegate(this,this.changeSoldier);this.reBox3=$("reBox3");this.reBox4=$("reBox4");this.reInfo2=$("reInfo2")},reBuildSoldier:function(){this.dispatchEvent({type:app.view.building.DrillGroundHeroRebuild.REBUILDSOLDIER,target:this,data:this.heroVo})},changeSoldier:function(){this.dispatchEvent({type:app.view.building.DrillGroundHeroRebuild.CHANGESOLDIER,target:this,data:this.heroVo})},showLayout:function(){if(!(null==this.heroVo||void 0==this.heroVo))null!=this.heroVo&&null!=this.heroVo.soldier&&
this.showList($("reBox1"),$("reBox2"),$("reInfo1"),this.heroVo.soldier),null!=this.heroVo.reSoldier?(this.showList(this.reBox3,this.reBox4,this.reInfo2,this.heroVo.reSoldier),this.changeBtn.removeAttribute("disabled"),this.changeBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.changeSoldier),this.reInfo2.style.display="block"):(this.reBox3.innerHTML="",this.reBox3.style.background="none",this.reBox3[app.Event.ONCLICK]=null,this.reBox4.innerHTML="",this.reBox4.style.background="none",this.reBox4[app.Event.ONCLICK]=
null,this.reInfo2.style.display="none",this.changeBtn.disabled="disabled",this.changeBtn[app.Event.ONCLICK]=null)},showList:function(b,c,e,f){e=e.getElementsByTagName("span");b.innerHTML='<img src="images/bin/bin_'+f[0].id+'.gif" /><span style="display: block;">'+f[0].conf.name+"</span>";c.innerHTML='<img src="images/bin/bin_'+f[1].id+'.gif" /><span style="display: block;">'+f[1].conf.name+"</span>";b[app.Event.ONCLICK]=ClassUtils.delegate(this,this.showSoldier,0,e,b,c,f);c[app.Event.ONCLICK]=ClassUtils.delegate(this,
this.showSoldier,1,e,b,c,f);this.showSoldier(null,f[0].id==this.heroVo.defaultSoldier?0:1,e,b,c,f)},showSoldier:function(b,c,e,f,g,h){0==c?(f.style.background="url(images/ui/xuan_01.png) no-repeat",g.style.background="none"):(f.style.background="none",g.style.background="url(images/ui/xuan_01.png) no-repeat");null!=b&&app.view.Tooltip.getInstance().show(h[c].conf.description);e[0].innerHTML="\u5175\u79cd\u7c7b\u578b\uff1a"+app.numberToCN(h[c].conf.level)+"\u9636"+h[c].conf.typeName;e[1].innerHTML=
h[c].attackStr+" ("+h[c].conf.attack.toFixed(2)+")";e[1].className=this.getFontColor(h[c].attackStr);e[2].innerHTML=h[c].defenseStr+" ("+h[c].conf.defense.toFixed(2)+")";e[2].className=this.getFontColor(h[c].defenseStr);e[3].innerHTML=h[c].battleAttackStr+" ("+h[c].conf.battleAttack.toFixed(2)+")";e[3].className=this.getFontColor(h[c].battleAttackStr);e[4].innerHTML=h[c].battleDefenseStr+" ("+h[c].conf.battleDefense.toFixed(2)+")";e[4].className=this.getFontColor(h[c].battleDefenseStr);e[5].innerHTML=
h[c].strategyAttackStr+" ("+h[c].conf.strategyAttack.toFixed(2)+")";e[5].className=this.getFontColor(h[c].strategyAttackStr);e[6].innerHTML=h[c].strategyDefenseStr+" ("+h[c].conf.strategyDefense.toFixed(2)+")";e[6].className=this.getFontColor(h[c].strategyDefenseStr)},setData:function(b,c){this.heroVo=b;this.needMoney=c;this.showLayout()},getFontColor:function(b){switch(b){case "S":return"fc9";case "A":return"fc2";case "B":return"fc10";case "C":return"fc1";case "D":return"fc11";default:return"fc7"}}},
{CHANGESOLDIER:"change_soldier",REBUILDSOLDIER:"rebuild_soldier",CLOSE:"rebuild_close"});puremvc.define({name:"app.view.building.DrillGroundHeroNewBirth",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0);this.init()}},{init:function(){var b=this,c=function(){b.depose()};$("hero_rebuild_close").addEventListener(app.Event.CLICK,c);$("newBirth04").addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.newBirth));$("cancelBtn").addEventListener(app.Event.CLICK,c)},newBirth:function(){var b=this,c=function(c){0==c&&(b.dispatchEvent({type:app.view.building.DrillGroundHeroNewBirth.NEWBIRTH,
target:b,data:b.heroVo}),b.depose())};this.heroVo.level<this.needLv?app.view.Tooltip.getInstance().show("\u6b66\u5c06\u7b49\u7ea7\u4e0d\u591f"):app.view.Alert.getInstance().show("\u786e\u5b9e\u8981\u8f6c\u751f\u6b66\u5c06 <span class='fc2'>["+this.heroVo.conf.name+"]</span> \u5417\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],c)},showLayout:function(){$("newBirth01").innerHTML='<img src="images/heros/hero_'+this.heroVo.conf.pic+'.gif" /><span style=" display:block">'+this.heroVo.conf.name+"</span>";var b=
$("newBirth02").getElementsByTagName("span");b[0].innerHTML=this.heroVo.level;b[1].innerHTML=Math.round(this.heroVo.conf.lead+this.heroVo.newBirth*this.heroVo.conf.leadGrow);b[2].innerHTML=this.heroVo.conf.leadGrow.toFixed(1);b[3].innerHTML=Math.round(this.heroVo.conf.intelligence+this.heroVo.newBirth*this.heroVo.conf.intelligenceGrow);b[4].innerHTML=this.heroVo.conf.intelligenceGrow.toFixed(1);b[5].innerHTML=Math.round(this.heroVo.conf.courage+this.heroVo.newBirth*this.heroVo.conf.courageGrow);b[6].innerHTML=
this.heroVo.conf.courageGrow.toFixed(1);b=$("newBirth03").getElementsByTagName("span");b[0].innerHTML=this.heroVo.newBirth;b[1].innerHTML=this.needLv;b[1].className=this.needLv>this.heroVo.level?"fc9":"fc2"},setData:function(b){this.heroVo=b;this.needLv=60+5*this.heroVo.newBirth;this.showLayout()}},{NEWBIRTH:"newBirth_hero"});puremvc.define({name:"app.view.building.DrillGroundTrain",constructor:function(b,c){this.herosData=b;this.callFunc=c;this.init();this.layout()}},{init:function(){this.placeHtml=$("train01");this.scrollView=null;this.leftBtn=$("train02");this.rightBtn=$("train03");this.isTrain=!1},layout:function(){this.isTrain=!1;var b,c,e,f,g,h;this.placeHtml.innerHTML="";this.divList=null;this.divList=[];b=this.herosData.trainQueue+1;e=document.createDocumentFragment();for(var j=0;j<b;j++)c=document.createElement("div"),
c.className="dtrain1",c.style.left=80*j+"px",f=document.createElement("span"),f.style.height="16px",f.style.paddingTop="2px",g=document.createElement("div"),c.appendChild(f),c.appendChild(g),h=this.herosData.trainHeros[j],j<this.herosData.trainQueue?(j<this.herosData.trainCount&&null!=this.herosData.trainHeros[j]?(f.innerHTML=h.conf.name,f=document.createElement("span"),f.innerHTML=h.level+"\u7ea7",f.style.marginTop="-2px",c.appendChild(f),g.style.background="url(images/heros/hero_"+h.conf.pic+".gif)",
g=document.createElement("div"),g.className="fc6",c.appendChild(g),this.isTrain=!0,this.divList.push(g)):g.style.background="url(images/ui/iconBg_04.gif)",g=!1):(g.style.background="url(images/ui/lock.gif)",f=document.createElement("span"),f.innerHTML=2==this.herosData.trainQueue?"\u514d\u8d39\u5f00\u542f":50*(this.herosData.trainQueue-2)+"\u91d1\u5e01",f.style.marginTop="-2px",f.className="fc1",c.appendChild(f),g=!0),c[app.Event.ONMOUSE_DOWN]=ClassUtils.delegate(this,this.mouseDown,h,g),c[app.Event.ONMOVE]=
ClassUtils.delegate(this,this.mouseMove,h,g),c[app.Event.ONMOUSE_UP]=ClassUtils.delegate(this,this.mouseUp,h,g),e.appendChild(c);this.placeHtml.appendChild(e);var k=80*b;this.placeHtml.style.width=k+"px";this.placeHtml.style.height="130px";this.placeHtml.style.position="absolute";if(4<b){var l=this;b=function(b){l.placeHtml.style["-webkit-transform"]="translateX("+-b+"px)";0>=b?(l.leftBtn.style.visibility="hidden",l.rightBtn.style.visibility="visible"):b>=k-320?(l.leftBtn.style.visibility="visible",
l.rightBtn.style.visibility="hidden"):(l.leftBtn.style.visibility="visible",l.rightBtn.style.visibility="visible")};null==this.scrollView?(this.scrollView=new app.view.base.ScrollView(b,320,130,k,130,this.placeHtml,{scrollingY:!1}),this.leftBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.showPage,"left"),this.rightBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.showPage,"right")):(this.scrollView.scroller.setDimensions(320,130,k,130),b())}else this.leftBtn.style.visibility="hidden",this.rightBtn.style.visibility=
"hidden";this.step()},step:function(){if(!0==this.isTrain)for(var b=this.herosData.trainHeros.length,c,e=0;e<b;e++)if(c=this.herosData.trainHeros[e],null!=c.train){if(this.divList[e].innerHTML=c.train.time.toString(),0>=c.train.time.getTime())c.train=null,this.layout(),this.callFunc({type:app.view.building.DrillGroundTrain.AUTO_OVER_TRAIN,target:this,data:c})}else this.divList[e].innerHTML=""},mouseDown:function(b,c,e){this.heroVo=c;this.locked=e;this.distance=0;this.clientX="mousedown"==b.type?b.clientX:
b.targetTouches[0].pageX},mouseMove:function(b){var c=0,c="mousemove"==b.type?b.clientX:b.targetTouches[0].pageX;this.distance=c-this.clientX},mouseUp:function(){0==this.distance&&this.handler(this.heroVo,this.locked)},showPage:function(b,c){var e;"left"==c?(e=this.scrollView.scroller.getValues().left-80,this.scrollView.scroller.scrollTo(e)):"right"==c&&(e=this.scrollView.scroller.getValues().left+80,this.scrollView.scroller.scrollTo(e))},handler:function(b,c){!0==c?this.callFunc({type:app.view.building.DrillGroundTrain.ADD_LOCATION,
target:this}):this.callFunc({type:app.view.building.DrillGroundTrain.START_TRAIN,target:this,data:b})}},{START_TRAIN:"DG_start_train",ADD_LOCATION:"add_location",AUTO_OVER_TRAIN:"auto_over_train"});puremvc.define({name:"app.view.building.DrillGroundTrainPop",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0);this.init()}},{init:function(){var b=this,c=function(){b.dispatchEvent({type:app.view.building.DrillGroundTrainPop.CLOSE,target:b})};$("trainPop01").addEventListener(app.Event.CLICK,c);$("trainPop08").addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.startTrain));$("trainPop02").addEventListener(app.Event.CLICK,c);this.trainList=
$("train_list");this.trainList.style.display="none";this.trainHerosList=$("train_list01");this.trainWay=$("train_way");this.trainWay.style.display="none";this.trainInfo=$("train_info");this.trainInfo.style.display="none";this.index=0;this.selectIco1=$("trainPop05");this.selectIco2=$("trainPop06");this.moneySpan=$("trainPop07").getElementsByTagName("span");this.money3=this.money2=this.money1=0;this.value={}},startTrain:function(){this.money1>this.user.silverCoin?app.view.Alert.getInstance().show("\u60a8\u7684\u94f6\u5e01\u4e0d\u591f\uff0c\u4e0d\u80fd\u8bad\u7ec3\u3002"):
(this.value.gold=this.money2+this.money3,this.dispatchEvent({type:app.view.building.DrillGroundTrainPop.START_TRAIN,target:this,data:this.value}),this.dispatchEvent({type:app.view.building.DrillGroundTrainPop.CLOSE,target:this}))},showLayout:function(){this.closeHerosList();this.trainWay.style.display="block";var b=$("trainPop3"),c=$("trainPop4"),e=this.data.timeConf,f=this.data.trainConf,g=document.createDocumentFragment(),h,j,k;for(j=0;j<e.length;j++){h=document.createElement("li");h.innerHTML=
e[j][0]+"\u5c0f\u65f6";h[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handler,j,h,"time");if(2<j&&(0>=this.user.vip||4==j&&5>this.user.vip))h.style.background="url(images/ui/btnbg_05.png)",h[app.Event.ONCLICK]=null;g.appendChild(h);0==j&&(k=h)}b.appendChild(g);this.handler(null,0,k,"time");g=document.createDocumentFragment();for(j=0;j<f.length;j++){h=document.createElement("li");h.innerHTML=f[j][0];h[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handler,j,h,"type");if(2<j&&(2>this.user.vip||
4==j&&6>this.user.vip))h.style.background="url(images/ui/btnbg_05.png)",h[app.Event.ONCLICK]=null;g.appendChild(h);0==j&&(k=h)}c.appendChild(g);this.handler(null,0,k,"type")},handler:function(b,c,e,f){if("time"==f)this.selectIco1.style.left=e.offsetLeft+55+"px",this.selectIco1.style.top=e.offsetTop+6+"px",this.money1=this.data.timeConf[c][1],this.money2=this.data.timeConf[c][2],this.value.time=c+1;else if("type"==f)this.selectIco2.style.left=e.offsetLeft+55+"px",this.selectIco2.style.top=e.offsetTop+
6+"px",this.money3=this.data.trainConf[c][1],this.value.type=c+1;this.moneySpan[0].innerHTML="\u82b1\u8d39\u94f6\u5e01\uff1a"+this.money1;this.moneySpan[1].innerHTML="\u82b1\u8d39\u91d1\u5e01\uff1a"+(this.money2+this.money3)},setData:function(b,c,e){this.heroVo=b;this.data=c;this.user=e;null!=this.heroVo?this.showInfo():this.showHerosList()},showHerosList:function(){this.trainList.style.display="block";this.trainHerosList.innerHTML="";var b=document.createDocumentFragment(),c,e,f,g,h,j;e=this.data.onJobList.length;
var k=0;for(c=0;c<e;c++)if(f=this.data.onJobList[c],null==f.train)g=document.createElement("div"),g.className="train_heroList",j=document.createElement("div"),j.className="train_heroListDiv",g.appendChild(j),h='<img src="images/heros/hero_'+f.conf.pic+'.gif" /><span style="display: block; width: 47px; text-align: center;">'+f.conf.name+"</span>",j.innerHTML=h,j[app.Event.ONCLICK]=ClassUtils.delegate(this,this.clickHeroDiv,f),h='<li>\u7b49\u7ea7\uff1a<span class="fc10">'+f.level+"\u7ea7</span></li><li>\u5175\u529b\uff1a"+
f.hp+"</li><li>\u7ecf\u9a8c\uff1a"+f.exp+"/"+f.maxExp+"</li>",f=document.createElement("ul"),f.innerHTML=h,g.appendChild(f),b.appendChild(g),k++;this.trainHerosList.appendChild(b);this.trainHerosList.style.width="350px";var l=92*k;this.trainHerosList.style.height="px";if(2<k){this.moveBarImg=$("train_list03");var m=this;if(null==this.scrollView)this.scrollView=new app.view.base.ScrollView(function(b,c){m.trainHerosList.style["-webkit-transform"]="translateY("+-c+"px)";184<l&&(m.moveBarImg.style["-webkit-transform"]=
"translateY("+158*(c/(l-184))+"px)")},350,184,350,l,this.trainHerosList,{scrollingX:!1})}else if($("train_list02").style.display="none",0==k)this.trainHerosList.innerHTML="<div style='text-align: center;margin-top:50px;'>\u6ca1\u6709\u53ef\u4ee5\u8bad\u7ec3\u7684\u6b66\u5c06\uff01</div>"},showInfo:function(){app.controller.TimeController.getInstance().addListener(this);this.trainInfo.style.display="block";this.train_info01=$("train_info01");this.trainPopTitle=$("trainPopTitle");this.train_info02=
$("train_info02");this.train_info02.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.sendEvent,app.view.building.DrillGroundTrainPop.OVER_TRAIN,this.heroVo));this.infoSpans=this.train_info01.getElementsByTagName("span");this.layoutInfo();this.step()},layoutInfo:function(){this.infoSpans[0].innerHTML=this.data.timeConf[this.heroVo.train.hour-1][0]+"\u5c0f\u65f6";this.infoSpans[1].innerHTML=this.data.trainConf[this.heroVo.train.type-1][0];this.infoSpans[2].innerHTML=this.data.timeConf[this.heroVo.train.hour-
1][1];this.infoSpans[3].innerHTML=this.data.trainConf[this.heroVo.train.type-1][1]+this.data.timeConf[this.heroVo.train.hour-1][2];this.infoSpans[4].innerHTML=this.heroVo.exp+"/"+this.heroVo.maxExp;this.trainPopTitle.innerHTML=this.heroVo.conf.name+" "+this.heroVo.level+"\u7ea7"},step:function(){if(null!=this.heroVo.train){if(this.infoSpans[5].innerHTML=this.heroVo.train.time.toString(),0==this.heroVo.train.time.getTime())this.heroVo.train=null,this.dispatchEvent({type:app.view.building.DrillGroundTrainPop.AUTO_OVER_TRAIN,
target:this,data:this.heroVo})}else this.infoSpans[5].innerHTML="--";this.showIndicateTime()},clickHeroDiv:function(b,c){this.value.hid=c.id;this.value.hvo=c;this.showLayout()},closeHerosList:function(){if(null!=this.scrollView)this.scrollView.depose(),this.scrollView=null;this.trainList.style.display="none"},closeTrainInfo:function(){if(null!=this.train_info01)app.controller.TimeController.getInstance().removeListener(this),this.train_info01=null;this.trainInfo.style.display="none"},setInfo:function(b,
c,e){this.buildLv=b;this.indicate=c;this.userVo=e;this.train_info03=$("train_info03");this.quickenBar=$("train_info05");this.quickenBar.style.marginLeft="10px";this.quickenBar.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.sendEvent,app.view.building.DrillGroundTrainPop.CLEAR_TRAIN_CD,this.indicate));$("train_info04").addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.sendEvent,app.view.building.DrillGroundTrainPop.QUICKEN_TRAIN,this.heroVo));this.showQuicken()},sendEvent:function(b,
c,e){this.dispatchEvent({type:c,target:this,data:e})},showQuicken:function(){var b=this.train_info03.getElementsByTagName("span");b[0].innerHTML=100*this.buildLv;b[1].innerHTML=this.userVo.feat;b[2].innerHTML=12E3*this.buildLv;this.quickenTime=b[3];this.showIndicateTime()},refresh:function(){null!=this.train_info01&&(this.showQuicken(),this.layoutInfo())},showIndicateTime:function(){if(null!=this.indicate)0<this.indicate.time.getTime()?(this.quickenBar.style.display="inline",this.quickenTime.innerHTML=
this.indicate.time.toString(),this.quickenTime.className=!0==this.indicate.full?"fc6":"fc4"):(this.quickenBar.style.display="none",this.quickenTime.innerHTML="")},depose:function(){this.closeHerosList();this.closeTrainInfo();app.view.base.BaseUIForm.prototype.depose.call(this)}},{CLOSE:"pop_train_close",START_TRAIN:"pop_start_train",OVER_TRAIN:"pop_overTrain",AUTO_OVER_TRAIN:"auto_overTrain",QUICKEN_TRAIN:"quicken_train",CLEAR_TRAIN_CD:"cancel_train_cd"});puremvc.define({name:"app.view.building.DrillGroundRecruit",constructor:function(b,c){this.herosData=b;this.callFunc=c;this.init();this.layout()}},{init:function(){this.heroList_html=$("recruit01");this.scrollView=null;var b=this;$("recruit04")[app.Event.ONCLICK]=function(){b.callFunc({type:app.view.building.DrillGroundRecruit.START_TALKS,target:b})};$("recruit05")[app.Event.ONCLICK]=ClassUtils.delegate(this,this.seekOther);this.leftBtn=$("recruit06");this.rightBtn=$("recruit07");this.herosCount=
$("recruit08");this.p=1},seekOther:function(){var b=this;app.view.Alert.getInstance().show("\u53e6\u5bfb\u4ed6\u4eba\u9700\u8981\u82b1\u8d39<span class='fc2'>"+this.talkVo.goldCoin+"\u91d1\u5e01</span>\u3002<br />\u662f\u5426\u786e\u5b9a\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(c){0==c&&b.callFunc({type:app.view.building.DrillGroundRecruit.START_SEEK,target:b})})},layout:function(){var b,c,e,f,g,h;this.heroList_html.innerHTML="";this.pCount=Math.ceil(this.herosData.noJobList.length/5);if(0==
this.pCount)this.pCount=1;c=document.createDocumentFragment();for(var j=0;j<5*this.pCount;j++)b=document.createElement("div"),b.className="dtrain1",b.style.left=80*j+"px",e=document.createElement("span"),e.style.height="18px",e.style.marginTop="3px",g=document.createElement("div"),f=document.createElement("span"),h=this.herosData.noJobList[j],null!=h?(e.innerHTML=h.conf.name,f.innerHTML=h.level+"\u7ea7",f.style.marginTop="-2px",g.style.background="url(images/heros/hero_"+h.conf.pic+".gif)",b[app.Event.ONMOUSE_DOWN]=
ClassUtils.delegate(this,this.mouseDown,j),b[app.Event.ONMOVE]=ClassUtils.delegate(this,this.mouseMove,j),b[app.Event.ONMOUSE_UP]=ClassUtils.delegate(this,this.mouseUp,j)):g.style.background="url(images/ui/iconBg_04.gif)",b.appendChild(e),b.appendChild(g),b.appendChild(f),c.appendChild(b);this.heroList_html.appendChild(c);this.w=400*this.pCount;this.heroList_html.style.width=this.w+"px";this.heroList_html.style.height="92px";this.heroList_html.style.position="absolute";if(1<this.pCount){var k=this;
b=function(b){k.heroList_html.style["-webkit-transform"]="translateX("+-b+"px)";0>=b?(k.leftBtn.style.visibility="hidden",k.rightBtn.style.visibility="visible"):b>=k.w-400?(k.leftBtn.style.visibility="visible",k.rightBtn.style.visibility="hidden"):(k.leftBtn.style.visibility="visible",k.rightBtn.style.visibility="visible");b=Math.floor(b/400)+1;0<b&&b<=k.pCount&&k.showPageCount(b)};if(null==this.scrollView)this.scrollView=new app.view.base.ScrollView(b,400,92,this.w,92,this.heroList_html,{scrollingY:!1,
paging:!0,bouncing:!0}),this.leftBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.showPage,"left"),this.rightBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.showPage,"right");else{if(this.p>this.pCount)this.p=this.pCount;this.scrollView.scroller.setDimensions(400,92,this.w,92);1<this.p&&this.scrollView.scroller.scrollTo(400*(this.p-1))}}else{this.leftBtn.style.visibility="hidden";this.rightBtn.style.visibility="hidden";if(null!=this.scrollView)this.scrollView.depose(),this.scrollView=null,
this.heroList_html.style["-webkit-transform"]="translateX(0px)";this.p=1}this.showPageCount(this.p)},showPageCount:function(b){this.p=b;this.herosCount.innerHTML="\u7b2c"+b+"\u9875\uff0c\u603b"+this.pCount+"\u9875"},mouseMove:function(b){var c=0,c="mousemove"==b.type?b.clientX:b.targetTouches[0].pageX;this.distance=c-this.clientX},mouseDown:function(b,c){this.index=c;this.distance=0;this.clientX="mousedown"==b.type?b.clientX:b.targetTouches[0].pageX},mouseUp:function(){0==this.distance&&this.callFunc({type:app.view.building.DrillGroundRecruit.RECRUIT_HEROINFO,
target:this,data:this.herosData.noJobList[this.index]})},showPage:function(b,c){var e;"left"==c?(e=this.scrollView.scroller.getValues().left-400,this.scrollView.scroller.scrollTo(e)):"right"==c&&(e=this.scrollView.scroller.getValues().left+400,this.scrollView.scroller.scrollTo(e))},setData:function(b){this.talkVo=b;if(null==this.recruit02)this.recruit02=$("recruit02");this.recruit02.getElementsByTagName("img")[0].src=0==this.talkVo.type?"images/ren/r_"+b.conf.person+".gif":"images/heros/hero_"+b.conf.pic+
".gif";this.recruit02.getElementsByTagName("p")[0].innerHTML=b.conf.name;$("recruit03").innerHTML="\u4f1a\u8c08\u6b21\u6570\uff1a"+b.count+"\u6b21"}},{RECRUIT_HEROINFO:"recruit_heroinfo",START_SEEK:"start_seek",START_TALKS:"start_talks"});puremvc.define({name:"app.view.building.DrillGroundRecruitPop",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0);this.init()}},{init:function(){var b=this,c=function(){b.depose()};$("recruitPop01").addEventListener(app.Event.CLICK,c);$("recruitPop06").addEventListener(app.Event.CLICK,function(){b.dispatchEvent({type:app.view.building.DrillGroundRecruitPop.START_RECRUIT,target:b,data:b.heroVo});b.depose()});$("recruitPop02").addEventListener(app.Event.CLICK,
c)},showLayout:function(){d=this.heroVo;$("recruitPop03").innerHTML='<img src="images/heros/hero_'+d.conf.pic+'.gif" /><span style=" display:block">'+d.conf.name+"</span>("+d.level+"\u7ea7)";var b=$("recruitPop04"),c=b.getElementsByTagName("li");a=c[0].getElementsByTagName("span");a[0].innerHTML=d.conf.careerName;a=c[1].getElementsByTagName("span");a[0].innerHTML=Math.floor(d.conf.lead+d.newBirth*d.conf.leadGrow);a[1].innerHTML=d.conf.leadGrow;a=c[2].getElementsByTagName("span");a[0].innerHTML=d.hp;
a=c[3].getElementsByTagName("span");a[0].innerHTML=Math.floor(d.conf.intelligence+d.newBirth*d.conf.intelligenceGrow);a[1].innerHTML=d.conf.intelligenceGrow;a=c[4].getElementsByTagName("span");a[0].innerHTML=d.conf.troopsGrow;a=c[5].getElementsByTagName("span");a[0].innerHTML=Math.floor(d.conf.courage+d.newBirth*d.conf.courageGrow);a[1].innerHTML=d.conf.courageGrow;a=c[6].getElementsByTagName("span");a[0].innerHTML=d.conf.skillName;a=b.getElementsByTagName("span");a[10].innerHTML=d.conf.desc;$("recruitPop05").innerHTML=
d.conf.recruitMoney},setData:function(b){this.heroVo=b;this.showLayout()}},{START_RECRUIT:"start_recruit"});puremvc.define({name:"app.view.building.DrillGroundTalkPop",parent:app.view.base.BaseUIForm,constructor:function(b,c){app.view.base.BaseUIForm.call(this,b,!0);this.init(c)}},{init:function(b){var c=this;$("talksPop03").addEventListener(app.Event.CLICK,function(){c.depose();null!=b&&b()});this.spans=$("talksPop02").getElementsByTagName("span")},showLayout:function(){var b=$("talksPop01");if(0==this.talksVo.prevType){this.spans[0].innerHTML="< "+this.talksVo.prevConf.name+" >";this.spans[1].innerHTML=
this.talksVo.prevConf.content;for(var c="",e=this.talksVo.reward,f=0;f<e.length;f++)c=10==e[f].tid?c+('<img src="images/items/i_'+e[f].id+'.jpg" style="margin-right:8px; float:left;" /><span style="margin-top:15px; float:left;" class="'+app.getStyle(e[f].qualityId)+'">'+e[f].name+'</span><span style="margin-top:15px; float:left;"> * '+e[f].value+"</span> "):c+(e[f].name+" x "+e[f].value+" ");this.spans[2].innerHTML=c;b.src="images/ren/r_"+this.talksVo.prevConf.person+".gif"}else this.spans[0].innerHTML=
"< "+this.talksVo.prevConf.name+" >",this.spans[1].innerHTML="\u7518\u613f\u4e3a\u60a8\u6548\u52b3\uff0c\u6210\u4e3a\u60a8\u7684\u5728\u91ce\u6b66\u5c06\u3002",b.src="images/heros/hero_"+this.talksVo.prevConf.pic+".gif"},setData:function(b){this.talksVo=b;this.showLayout()}},{});puremvc.define({name:"app.view.building.DrillGroundFormation",constructor:function(b){this.callFunc=b;this.init()}},{init:function(){this.herosList_html=$("formation01");this.fList_html=$("formation02");$("tab_bottom").style.display="none";this.fBox=[];for(var b,c=1;9>=c;c++)b=$("f_"+c),b.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.clickFormation,c)),this.fBox.push(b);this.spans=$("formation03").getElementsByTagName("li");this.defaultBtn=$("formation04");var e=this;this.defaultBtn.addEventListener(app.Event.CLICK,
function(){e.heroVo=null;e.callFunc({type:app.view.building.DrillGroundFormation.SETDEFAULT,target:e,data:e.fData.formation[e.fIndex].id})});this.fIndex=0;this.heroVo=null;this.prveId=0;this.moveBarImg=$("formation05");this.moveBarImg2=$("formation06");this.saveBtn=$("formation07");this.saveBtn.style.display="none";this.saveBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.saveFormation);this.isFChange=!1;this.fid=0;this.info=""},saveFormation:function(){if(!0==this.isFChange){for(var b=this.fData.formation[this.fIndex].id,
c=this.currFHeros.length,e="",f=0;f<c;f++)0<this.currFHeros[f]&&(e+=f+1+","+this.currFHeros[f]+";");this.fid=b;this.info=e;this.callFunc({type:app.view.building.DrillGroundFormation.SAVE,target:this,data:{fid:b,info:e}})}this.isFChange=!1},herosLayout:function(){this.herosList_html.innerHTML="";var b,c,e;e=document.createDocumentFragment();b=this.heros.length;for(var f=0;f<b;f++)c=document.createElement("div"),c.id="hero"+f,c.innerHTML='<div class="jcImg_s"></div><div class="fc5" style="text-align: center">'+
this.heros[f].conf.name+"</div>",c.style.background="url(images/heros/hero_"+this.heros[f].conf.pic+".gif) center top no-repeat",c.className="jcImg_01",c.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.clickHero,f,c)),e.appendChild(c);this.herosList_html.appendChild(e);this.herosList_html.style.position="absolute";this.herosList_html.style.width="108px";this.hh=this.herosList_html.clientHeight;this.herosList_html.style.height=this.hh+"px";var g=this;b=function(b,c){g.herosList_html.style["-webkit-transform"]=
"translateY("+-c+"px)";183<g.hh&&(g.moveBarImg.style["-webkit-transform"]="translateY("+147*(c/(g.hh-183))+"px)")};if(183<this.hh)this.moveBarImg.style.display="inline",null==this.scrollView?this.scrollView=new app.view.base.ScrollView(b,106,183,108,this.hh,this.herosList_html,{scrollingX:!1}):this.upScrollView();else if(this.moveBarImg.style.display="none",null!=this.scrollView)this.scrollView.depose(),this.scrollView=null,this.herosList_html.style["-webkit-transform"]="translateY(0px)"},upScrollView:function(){null!=
this.scrollView&&(this.scrollView.scroller.setDimensions(106,183,106,this.hh),this.scrollView.scroller.setPosition(0,0))},clickHero:function(b,c,e){if(null!=this.prevHero)this.prevHero.style.background="none";this.prevHero=e.getElementsByTagName("div")[0];this.prevHero.style.background="url(images/ui/xuan_02.png)";this.heroVo=this.heros[c];this.setBorder(!0)},clickFormation:function(b,c){var e=this.currFHeros[c-1];null!=this.heroVo&&-1!=e?(0==e?(this.delFormationHero(this.heroVo.id),this.currFHeros[c-
1]=this.heroVo.id,this.currFHerosPic[c-1]=this.heroVo.conf.pic):this.heroVo.id==e?(this.currFHeros[c-1]=0,this.currFHerosPic[c-1]=0):(this.delFormationHero(this.heroVo.id),this.currFHeros[c-1]=this.heroVo.id,this.currFHerosPic[c-1]=this.heroVo.conf.pic),this.checkChange(),this.refresh()):app.view.Tooltip.getInstance().show("\u8bf7\u5728\u53f3\u8fb9\u5217\u8868\u4e2d\u9009\u62e9\u6b66\u5c06\uff01")},checkChange:function(){var b=this.currFHeros.join(),c=this.fData.formation[this.fIndex].location.join();
this.isFChange=b!=c},delFormationHero:function(b){for(var c=this.currFHeros.length,e=0;e<c;e++)this.currFHeros[e]==b&&(this.currFHeros[e]=0,this.currFHerosPic[e]=0)},fLayout:function(){this.fList_html.innerHTML="";var b,c,e;e=document.createDocumentFragment();b=this.fData.formation.length;for(var f=0;f<b;f++)c=document.createElement("div"),c.style.background="url(images/tech/f_"+this.fData.formation[f].id+".gif) center center no-repeat",this.fData.formation[f].id==this.fData.defalut?(c.className=
"jcImg_s4",this.def_id=f):c.className="jcImg_s3",c.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.clickF,f)),e.appendChild(c);this.fList_html.appendChild(e);this.fList_html.style.position="absolute";this.fList_html.style.width="106px";this.h=this.fList_html.clientHeight;this.fList_html.style.height=this.h+"px";var g=this;if(159<this.h){if(this.moveBarImg2.style.display="inline",null==this.formationView)this.formationView=new app.view.base.ScrollView(function(b,c){g.fList_html.style["-webkit-transform"]=
"translateY("+-c+"px)";159<g.h&&(g.moveBarImg2.style["-webkit-transform"]="translateY("+123*(c/(g.h-159))+"px)")},106,159,106,this.h,this.fList_html,{scrollingX:!1})}else this.moveBarImg2.style.display="none"},clickF:function(b,c){if(null!=b&&!0==this.isFChange){var e=this;app.view.Alert.getInstance().show("["+this.fvo.conf.name+"] \u4e2d\u7684\u6b66\u5c06\u6709\u8c03\u6574\uff0c\u662f\u5426\u9700\u8981\u4fdd\u5b58\uff1f",["\u786e\u5b9a","\u53d6\u6d88"],function(b){0==b?e.saveFormation():(e.isFChange=
!1,e.clickF(null,c))})}else{if(this.fIndex!=c)this.fIndex=c,this.initFormationData(),this.showFormation();var f=this.fvo.conf.description;app.view.Tooltip.getInstance().show(this.fvo.conf.name+" : "+f.split(",")[0],void 0,242)}},showFormation:function(){if(null!=this.prveDiv)this.prveDiv.className=this.prveId==this.fData.defalut?"jcImg_s4":"jcImg_s3",this.prveId=0;this.prveDiv=this.fList_html.childNodes[this.fIndex];this.prveDiv.className="jcImg_s5";this.prveId=this.fvo.id;for(var b=this.currFHeros,
c,e=0,f=0;9>f;f++)-1==b[f]?c="url(images/ui/iconBg_02.png)":0==b[f]?c="url(images/ui/iconBg_01.png)":(c="url(images/heros/hero_"+this.currFHerosPic[f]+".gif)",e++),this.fBox[f].style.background=c+" center top no-repeat";this.spans[0].innerHTML=this.fvo.conf.name;this.spans[1].innerHTML="\u7b49\u7ea7 "+this.fvo.level;this.spans[2].innerHTML="\u63d0\u5347 "+this.fvo.increase;this.spans[3].innerHTML="\u6b66\u5c06 "+e;this.showStatus();this.showHeros(b);null!=this.prevHero&&this.setBorder(!0)},showStatus:function(){this.defaultBtn.style.display=
this.fData.defalut==this.fvo.id?"none":"block";this.saveBtn.style.display=!0!=this.isFChange?"none":"block"},showHeros:function(b){var c,e,f,g;f=this.herosList_html.childNodes.length;for(c=0;c<f;c++)g=this.herosList_html.childNodes[c].getElementsByTagName("div")[0],g.innerHTML="";f=this.heros.length;for(c=0;9>c;c++)if(-1!=b[c])for(e=0;e<f;e++)if(b[c]==this.heros[e].id)g=this.herosList_html.childNodes[e].getElementsByTagName("div")[0],g.innerHTML='<img src="images/ui/ico_18.png" style="display:inline" />'},
setBorder:function(b){for(var c=this.currFHeros,e,f=0;9>f;f++)e=this.fBox[f],0==c[f]&&!0==b?(e.style.width="45px",e.style.height="45px",e.style.border="solid 1px #5e563c",e.style.backgroundPosition="-1px -1px"):(e.style.border="none",e.style.width="47px",e.style.height="47px")},setData:function(b,c){this.heros=b.onJobList;this.fData=c;for(var e=this.fData.formation.length,f=0;f<e;f++)if(this.fData.formation[f].id==this.fData.defalut)this.fIndex=f;this.initFormationData();this.herosLayout();this.fLayout();
this.showFormation()},initFormationData:function(){this.currFHeros=[];this.currFHerosPic=[];this.fvo=this.fData.formation[this.fIndex];this.currFHeros=this.currFHeros.concat(this.fvo.location);this.currFHerosPic=this.currFHerosPic.concat(this.fvo.herosPic)},hideTabBottom:function(){$("tab_bottom").style.display="none"},refreshHeros:function(){this.prevHero=this.heroVo=null;this.herosLayout();this.initFormationData();this.checkChange();this.showFormation()},refresh:function(){this.fLayout();this.showFormation();
this.showStatus();this.setBorder(!1);if(null!=this.prevHero)this.setBorder(!0),this.prevHero.style.background="url(images/ui/xuan_02.png)"}},{UP:"hero_up",DOWN:"hero_down",SETDEFAULT:"set_default_formation",SAVE:"formation_save"});puremvc.define({name:"app.view.building.FarmView",parent:app.view.base.BaseUIForm,constructor:function(b,c){app.view.base.BaseUIForm.call(this,b,!0);app.controller.TimeController.getInstance().addListener(this);this.descript=this.view.querySelector("#dlg_description");this.fm_Count=this.view.querySelector("#fm_Count");this.fm_limitCount=this.view.querySelector("#fm_limitCount");this.farm_coolTime=this.view.querySelector("#farm_coolTime");this.cooling=c;this.step();var e=this.view.querySelector("#building_img");
e.width=170;e.height=100;this.stage=new Stage(e);var f=this,e=this.view.querySelector("#levelup_btn");e.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,function(){f.dispatchEvent({type:app.view.building.FarmView.LEVEL_UP,target:f})}));e=this.view.querySelector("#dlg_close");e.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,function(){app.controller.TimeController.getInstance().removeListener(this);f.stage&&(f.stage.removeAllChildren(),Ticker.removeListener(f.stage));f.dispatchEvent({type:app.view.building.FarmView.CLOSE,
target:f})}))}},{setData:function(b,c){app.view.base.BaseUIForm.prototype.setData.call(this,b);this.setBuildingImage(b.content);for(var e,f=b.buttons.length,g=this.container.querySelector("#levelup_btns").getElementsByTagName("input"),h=0;h<f;h++)e=g[h],e.style.display=c[h]?"block":"none",e.setAttribute("value",b.buttons[h]),e.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.operateHandler,h))},operateHandler:function(b,c){this.dispatchEvent({type:app.view.building.FarmView.OPERATE,
target:this,data:c})},updateFarmInfo:function(b){var c=this.container.querySelector("#levelup_prop").getElementsByTagName("span");c[0].innerHTML=b.needMoney;c[1].innerHTML=app.data.TimeVO.formatTime(1E3*b.needTime);c=this.descript.getElementsByTagName("span");c[0].innerHTML=this.data.name+"("+b.level+"\u7ea7)";c[1].innerHTML=this.data.descript.toString()},updateGrainInfo:function(b){this.fm_Count.innerText=!isNaN(b.num)?" \u6536\u83b7\u6b21\u6570\uff1a"+b.num+"/"+b.maxNum:"";0==b.num&&this.updateShBtn()},
updateShBtn:function(){this.view.getElementsByClassName("btn")[1].disabled=!0},setBuildingImage:function(b){if(this.stage){this.stage.removeAllChildren();this.building=new Bitmap(b);var c=this.stage.canvas.width/b.width;c*b.height>this.stage.canvas.height&&(c=this.stage.canvas.height/b.height);this.building.scaleX=this.building.scaleY=c;this.building.x=0.5*(this.stage.canvas.width-b.width*c);this.building.y=0.5*(this.stage.canvas.height-b.height*c);this.stage.addChild(this.building);Ticker.setFPS(20);
Ticker.addListener(this.stage)}},setFlag:function(b){var c=b.getContent("levelup_data");c.images=[b.getContent("levelup")];b=new BitmapAnimation(new SpriteSheet(c));b.regX=0.5*c.frames.width;b.regY=c.frames.height;b.x=0.5*this.stage.canvas.width;b.y=this.stage.canvas.height;b.onAnimationEnd=function(b){b.gotoAndStop(1);b.visible=!1};this.stage.addChild(b);this.flagMovie=b},showLevelUP:function(){this.flagMovie.visible=!0;this.flagMovie.gotoAndPlay(1)},step:function(){this.farm_coolTime.innerHTML=
null!=this.cooling.time&&0<this.cooling.time.getTime()?"<label class='fc7'>\u51b7\u5374\u65f6\u95f4\uff1a</label>"+this.cooling.time:""}},{LEVEL_UP:"Farm_LevelUp",CLOSE:"Farm_Close",OPERATE:"Farm_Operate"});puremvc.define({name:"app.view.system.IndicateItem",constructor:function(b,c,e,f,g,h){this._normalMsg=b;this._timeMsg=c;this._coolMsg=e;this.status=0;this._data=f;this._props=g;this.view=document.createElement("div");this.view.className="timeline";this.view.style["background-image"]="url(images/ui/in"+(100==f.type?7:f.type)+".png)";this.line1=document.createElement("div");this.line1.className="timerect";this.view.appendChild(this.line1);this.valid=!1;this.t=app.proxy.IndicateProxy;if(this._data.type==
this.t.TYPE_3||this._data.type==this.t.TYPE_4||this._data.type==this.t.TYPE_5)this.valid=!0;else if(this._data.type==this.t.TYPE_9&&0<this._data.num)this.valid=!0;else if(this._data.type==this.t.TYPE_6&&0<this._data.num)this.valid=!0;else if(100==this._data.type)this.valid=!0;this.setBg();if(h)this.btn=new Image,this.btn.src=app.GameData.imageSrc+"ui/ico_01.gif",this.line2=document.createElement("div"),this.line2.className="timerect2",this.line2.appendChild(this.btn),this.view.appendChild(this.line2);
this.update()}},{update:function(){if(this._data.time&&0<this._data.time.getTime()){this.line1.innerHTML=this.templateMsg(this._timeMsg);this.line1.querySelector("span").className=this._data.full?"fc6":"fc4";if(1!=this.status&&this.btn)this.btn.style.visibility="visible";this.status=1}else if(null!=this._normalMsg)if(0>=this._data.num&&0<this._data.maxNum){this.line1.innerHTML=this.templateMsg(this._coolMsg);this.status=2;if(this.btn)this.btn.style.visibility="hidden";if(this._data.type!=this.t.TYPE_4)this.valid=
!1,this.setBg()}else if(this.line1.innerHTML=this.templateMsg(this._normalMsg),this.status=3,this.btn)this.btn.style.visibility="hidden"},setBg:function(){this.line1.style.background=this.valid?"url(images/ui/popubg_24.png) center center no-repeat":"url(images/ui/pointbg.png) center center no-repeat"},templateMsg:function(b){for(var c=0,e=this._props.length;c<e;)b=b.replace("#"+c,this._data[this._props[c]]),c++;return b},addEvent:function(b){var c=this;this.line1[app.Event.ONMOUSE_DOWN]=function(e){var f=
0;e.target[app.Event.ONMOVE]=function(){f=1};e.target[app.Event.ONMOUSE_UP]=function(){0==f&&b(0,c._data)}};this.btn&&(this.btn[app.Event.ONCLICK]=function(){b(1,c._data)})}});puremvc.define({name:"app.view.system.IndicateView",parent:EventDispatcher,constructor:function(b){EventDispatcher.call(this);var c=document.createElement("div");c.innerHTML=b;this.view=c.children[0];app.GameData.UIFormDiv.appendChild(this.view);this.list=this.view.querySelector("#indicate_list");this.view.style.position="absloute";this.items=[];var e=this;this.btn=this.view.querySelector("#c_btn");this.btn[app.Event.ONCLICK]=function(){"close"==e.btn.className?e.close(!0):e.open(!0)};this._scaleView(this.view);
this.close(!1);this.onSelect=ClassUtils.delegate(this,function(b,c){var e=app.view.system.IndicateView;this.dispatchEvent({type:0==b?e.ITEM_SELECT:e.CLEAR_TIME,target:this,data:c})});this.updateScroller()}},{updateScroller:function(){var b=this.view.querySelector("#in_container"),c=this.list;this.scroller?this.scroller.update(b.clientWidth,b.clientHeight,c.clientWidth,c.clientHeight):this.scroller=new app.view.base.ScrollView(function(b,f){c.style["-webkit-transform"]="translateY("+-f+"px)"},b.clientWidth,
b.clientHeight,c.clientWidth,c.clientHeight,c)},changeView:function(){this._scaleView(this.view)},_scaleView:function(b){this._scale=app.GameData.gameCanvas.height/268;b.style["-webkit-transform-origin"]="0 0";b.style["-webkit-transform"]="scale("+this._scale+")"},addItem:function(b){b.addEvent(this.onSelect);this.items.push(b);this.list.appendChild(b.view);this.updateScroller()},removeItem:function(b){var c=this.items.indexOf(b);0<=c&&(this.items.splice(c,1),this.list.removeChild(b.view),this.updateScroller())},
reSetScroll:function(){this.nowTop=this.scroller?this.scroller.scroller.getValues().top:0;this.scroller&&this.scroller.depose();this.list.innerHTML="";this.scroller=null},gotoPage:function(){this.scroller.scroller.__publish(0,Math.min(this.nowTop,this.scroller.scroller.getScrollMax().top),1)},setLocation:function(b,c){this.view.style.left=b;this.view.style.top=c},update:function(){for(var b=this.items.length,c=0;c<b;c++)this.items[c].update()},change:function(){for(var b=this.items.length,c=0;c<b;c++)this.items[c].change()},
close:function(b){b=b?"left 500ms linear":null;this.view.style["-webkit-transition"]=b;this.view.style["-moz-transition"]=b;this.view.style["-o-transition"]=b;this.view.style.left=-225*this._scale+"px";this.btn.className="open"},open:function(b){b=b?"left 0.5s linear":null;this.view.style["-webkit-transition"]=b;this.view.style["-moz-transition"]=b;this.view.style["-o-transition"]=b;this.view.style.left="0px";this.btn.className="close"},depose:function(){app.GameData.UIFormDiv.removeChild(this.view);
this.view=this.onSelect=null}},{ITEM_SELECT:"itemSelect",CLEAR_TIME:"clearTime"});puremvc.define({name:"app.view.system.ResourceControlView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("resourceControl"),!0);app.controller.TimeController.getInstance().addListener(this);this.init()}},{resourceData:null,canSteal:!1,canCapture:!1,init:function(){this.html_dlg_close=$("dlg_close");this.html_closeBtn=$("closeBtn");this.html_captureBtn=$("captureBtn");this.html_giveupBtn=$("giveupBtn");this.html_stealBtn=$("stealBtn");this.html_doubleBtn=
$("doubleBtn");this.html_patrolBtn=$("patrolBtn");this.html_dlg_title=$("dlg_title");this.html_outputLab=$("outputLab");this.html_infoLab=$("infoLab");this.html_ownerLab=$("ownerLab");this.html_captureTimeLab=$("captureTimeLab");this.html_protectTimeLab=$("protectTimeLab");this.html_dlg_close.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_closeBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_captureBtn.addEventListener(app.Event.CLICK,
ClassUtils.delegate(this,this.captureHandle));this.html_giveupBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.giveupHandle));this.html_stealBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.stealHandle));this.html_doubleBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.doubleHandle));this.html_patrolBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.patrolHandle))},setData:function(b,c,e,f){this.resourceData=b;this.userData=c;this.myCity=
e;this.targetCity=f;this.canCapture=this.resourceData.countryId==this.userData.cityId&&this.resourceData.userId!=this.userData.roleId?!0:!1;this.canSteal=0<this.userData.stealIndicate.num&&null!=this.resourceData.userId&&!0==this.resourceData.isDouble&&this.resourceData.countryId!=this.userData.cityId&&this.myCity&&this.targetCity&&this.myCity.levelmax==this.targetCity.levelmax&&this.myCity.color!=this.targetCity.color?!0:!1;this.layout()},layout:function(){this.html_dlg_title.innerHTML=this.resourceData.type==
app.view.scene.ResourceSceneView.RES_TYPE_SILVER?"\u94f6\u77ff":"\u519c\u7530";this.html_captureBtn.style.display=this.canCapture?"block":"none";this.resourceData.userId==this.userData.roleId?(this.html_giveupBtn.style.display="block",this.html_doubleBtn.style.display=!0==this.resourceData.canOpenDouble&&!1==this.resourceData.isDouble?"block":"none",this.html_patrolBtn.style.display=!0==this.resourceData.isDouble&&!1==this.resourceData.isPatrol?"block":"none"):(this.html_patrolBtn.style.display="none",
this.html_giveupBtn.style.display="none",this.html_doubleBtn.style.display="none");this.html_outputLab.innerHTML=this.resourceData.output;this.showIndicateTime();this.html_infoLab.innerHTML=this.resourceData.desc;this.resourceData.userName?(this.html_ownerLab.innerHTML=this.resourceData.userName+"(LV"+this.resourceData.level+")",this.html_ownerLab.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.playerInfo,this.resourceData.userId))):this.html_ownerLab.innerHTML="\u5730\u65b9\u52bf\u529bLV"+
this.targetCity.levelmax},step:function(){this.showIndicateTime()},showIndicateTime:function(){if(this.resourceData){if(this.resourceData.captureTime){var b=this.resourceData.captureTime.getTime();0<b?(this.html_doubleBtn.style.display=!0==this.resourceData.canOpenDouble&&!1==this.resourceData.isDouble&&102E5<=b?"block":"none",this.html_captureTimeLab.innerHTML=app.data.TimeVO.formatTime(b)):(this.html_captureBtn.style.display=!0==this.canCapture?"block":"none",this.html_patrolBtn.style.display="none",
this.html_giveupBtn.style.display="none",this.html_captureTimeLab.innerHTML="&nbsp;",this.html_ownerLab.innerHTML="&nbsp;",this.html_protectTimeLab.innerHTML="&nbsp;")}else this.html_patrolBtn.style.display="none",this.html_giveupBtn.style.display="none",this.html_captureTimeLab.innerHTML="&nbsp;";this.resourceData.protectTime?(b=this.resourceData.protectTime.getTime(),0<b?(this.html_stealBtn.style.display="none",this.html_protectTimeLab.innerHTML=app.data.TimeVO.formatTime(b)):(this.html_stealBtn.style.display=
this.canSteal?"block":"none",this.html_protectTimeLab.innerHTML="&nbsp;")):(this.html_stealBtn.style.display=this.canSteal?"block":"none",this.html_protectTimeLab.innerHTML="&nbsp;")}},playerInfo:function(b,c){this.dispatchEvent({type:app.view.system.ResourceControlView.SHOW_PLAYERINFO,target:this,data:c})},captureHandle:function(){this.dispatchEvent({type:app.view.system.ResourceControlView.CAPTURE,target:this,data:this.resourceData})},giveupHandle:function(){var b=this;app.view.Alert.getInstance().show("\u60a8\u786e\u5b9a\u8981\u653e\u5f03\u8d44\u6e90\u5417\uff1f",
["\u786e\u5b9a","\u53d6\u6d88"],function(c){0==c&&b.dispatchEvent({type:app.view.system.ResourceControlView.GIVE_UP,target:this,data:b.resourceData})})},stealHandle:function(){this.dispatchEvent({type:app.view.system.ResourceControlView.STEAL,target:this,data:this.resourceData})},doubleHandle:function(){this.dispatchEvent({type:app.view.system.ResourceControlView.DOUBLE_CONTROL,target:this,data:this.resourceData})},patrolHandle:function(){this.dispatchEvent({type:app.view.system.ResourceControlView.PATROL_CONTROL,
target:this,data:this.resourceData})},close:function(){this.dispatchEvent({type:app.view.system.ResourceControlView.CLOSE,target:this})},depose:function(){app.controller.TimeController.getInstance().removeListener(this);this.html_dlg_close.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_closeBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_captureBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.captureHandle));
this.html_giveupBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.giveupHandle));this.html_stealBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.stealHandle));this.html_doubleBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.doubleHandle));this.html_patrolBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.patrolHandle));app.view.base.BaseUIForm.prototype.depose.call(this)}},{CLOSE:"ResControl_close",CAPTURE:"ResControl_capture",
GIVE_UP:"ResControl_give_up",STEAL:"ResControl_steal",DOUBLE_CONTROL:"ResControl_double_control",PATROL_CONTROL:"ResControl_patrol_control",PATROL_CONTROL_GOLD:10,SHOW_PLAYERINFO:"ResControl_patrol_ShowPlayerInfo"});puremvc.define({name:"app.view.system.BattleResultView",parent:app.view.base.BaseUIForm,constructor:function(b,c){app.view.base.BaseUIForm.call(this,b,c)}},{setData:function(b){var c=",sss,ss,s,a,b,c,d,e,f".split(",");this.view.querySelector("#battle_rank").style["background-image"]="url(images/ui/font_"+c[b.result.rank]+".png)";var e=this.view.querySelector("#fresult_01"),f=b.header.attackerName,f=b.result.rank>=c.length-1?f+" \u8fdb\u653b\u5931\u8d25":b.result.rank==c.length-2?f+" \u5e73\u5c40":
f+" \u83b7\u5f97\u80dc\u5229";e.innerHTML=f;c=this.view.querySelectorAll("#fresult_02>p>span");c[0].innerHTML=b.result.attackerLoss;c[1].innerHTML=b.result.defenserLoss;c[2].style.display="none";e=this.view.querySelector("#spoils");e.style.display="none";if((b=b.result.rewards)&&0<b.length)for(f=0;f<b.length;f++)if(10==b[f].tid){var g=app.data.DataBase.getInstance().getItemInfo(b[f].id);e.style.display="block";e.querySelector("#spoils_img").src=app.GameData.imageSrc+"items/i_"+b[f].id+".jpg";var h=
e.querySelector("#spoils_title");h.innerHTML=g.name;h.className=app.getStyle(g.qualityId);e.style.display="block"}else c[2].innerHTML=app.data.DataBase.getInstance().getRewardName(b[f].tid)+"\uff1a"+b[f].value,c[2].style.display="block";this.replayBtn=$("replayBtn");this.replayBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent,"replay");this.exitBtn=$("exitBtn");this.exitBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent,"exit")},handleEvent:function(b,c){var e=app.view.system.BattleResultView;
"replay"==c?this.dispatchEvent({type:e.REPLAY,target:this}):"exit"==c&&this.dispatchEvent({type:e.EXIT,target:this})},depose:function(){this.exitBtn=this.exitBtn[app.Event.ONCLICK]=null;this.replayBtn=this.replayBtn[app.Event.ONCLICK]=null;app.view.base.BaseUIForm.prototype.depose.call(this)}},{REPLAY:"replay",EXIT:"exit"});puremvc.define({name:"app.view.system.AreaControlView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("areaControl"),!0);app.controller.TimeController.getInstance().addListener(this);this.init()}},{countryId:null,canAttack:!1,canConquer:!1,canTrade:!1,canMail:!1,init:function(){this.html_dlg_close=$("dlg_close");this.html_enterBtn=$("enterBtn");this.html_slayerBtn=$("slayerBtn");this.html_noteBtn=$("noteBtn");this.html_townLogoBtn=$("townLogoBtn");
this.html_conquerBtn=$("conquerBtn");this.html_mailBtn=$("mailBtn");this.html_tradeBtn=$("tradeBtn");this.html_attackBtn=$("attackBtn");this.html_dlg_title=$("dlg_title");this.html_firstTit=$("firstTit");this.html_sceondTit=$("sceondTit");this.html_firstLab=$("firstLab");this.html_sceondLab=$("sceondLab");this.html_statusLab=$("statusLab");this.html_noteLab=$("noteLab");this.html_protectTimeLab=$("protectTimeLab");this.slayersMenu=$("slayersMenu");this.html_slayerListBtn=$("slayerListBtn");this.html_dlg_close.addEventListener(app.Event.CLICK,
ClassUtils.delegate(this,this.close));this.html_enterBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.enterHandle));this.html_slayerBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.slayerHandle));this.html_noteBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.noteHandle));this.html_townLogoBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.townLogoHandle));this.html_conquerBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,
this.conquerHandle));this.html_mailBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.mailHandle));this.html_tradeBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.tradeHandle));this.html_attackBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.attackHandle))},setData:function(b,c,e,f,g,h){this.countryId=g;this.townData=b;this.userData=c;this.myLevel=h;if(e&&f)if(this.html_dlg_title.innerHTML="["+this.getCountryNameById(this.townData.country)+"]"+this.townData.userName+
"LV"+this.townData.level,e.color==f.color)if(this.townData.rid!=this.userData.roleId?(this.canMail=!0,this.canTrade=this.myLevel>=app.data.HomeBuildingData.limit[8]?!0:!1):this.canTrade=this.canMail=!1,this.canConquer=25<=this.myLevel&&this.countryId==this.userData.cityId&&this.townData.rid!=this.userData.roleId&&this.userData.roleId!=this.townData.masterId?!0:!1,this.html_firstTit.innerHTML="\u4e3b\u516c",this.html_sceondTit.innerHTML="\u5c5e\u81e3",this.townData.masterId&&this.townData.masterName?
(this.html_firstLab.innerHTML=this.townData.masterName,this.html_firstLab.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.showPlayerInfo,this.townData.masterId))):this.html_firstLab.innerHTML="&nbsp;",this.townData.slaveIds&&this.townData.slaveNames&&0<this.townData.slaveIds.length&&0<this.townData.slaveNames.length){b=this.townData.slaveNames[0];4<b.length&&(b=b.substr(0,4)+"...");this.html_sceondLab.innerHTML=b;this.html_slayerListBtn.style.display="none";c=this.townData.slaveIds.length;
if(1<c){this.html_sceondLab.style.border="1px solid #454233";this.html_sceondLab.style.backgroundColor="#1A1E1F";f=document.createDocumentFragment();for(e=0;e<c;e++)if(b=this.townData.slaveNames[e],4<b.length&&(b=b.substr(0,4)+"..."),0<e)g=document.createElement("p"),g.style.width="82px",g.style.borderLeft="1px solid #454233",g.style.borderRight="1px solid #454233",g.style.borderBottom="1px solid #454233",g.innerHTML=b,g.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.showPlayerInfo,
this.townData.slaveIds[e])),f.appendChild(g);this.slayersMenu.appendChild(f);this.html_slayerListBtn.style.display="block";this.html_slayerListBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.showSlaveMenu))}this.html_sceondLab.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.showPlayerInfo,this.townData.slaveIds[0]))}else this.html_sceondLab.innerHTML="&nbsp;";else{if(20<=this.myLevel&&e.levelmax==f.levelmax)this.canAttack=!0;this.canConquer=this.canTrade=this.canMail=
!1;this.html_firstTit.innerHTML="\u6240\u5c5e\u56fd\u5bb6";this.html_sceondTit.innerHTML="\u56fd\u5bb6\u72b6\u6001";this.html_firstLab.innerHTML=this.getCountryNameById(this.townData.country);this.html_sceondLab.innerHTML="\u654c\u5bf9"}this.layout()},layout:function(){if(this.townData.status)this.html_statusLab.innerHTML=app.data.DataBase.getInstance().getMainCityDescription(this.townData.status),this.html_statusLab.style.color=this.getColorByID(this.townData.status).color;this.html_noteLab.innerHTML=
this.townData.note?this.townData.note:"&nbsp;";this.townData.rid==this.userData.roleId?(this.html_enterBtn.style.display="display",this.html_slayerBtn.style.display=this.myLevel>=app.data.HomeBuildingData.limit[1]?"display":"none",this.html_noteBtn.style.display="display",this.html_townLogoBtn.style.display="display"):(this.html_enterBtn.style.display="none",this.html_slayerBtn.style.display="none",this.html_noteBtn.style.display="none",this.html_townLogoBtn.style.display="none");this.showIndicateTime();
this.html_conquerBtn.style.display=this.canConquer?"block":"none";this.html_mailBtn.style.display=this.canMail?"block":"none";this.html_tradeBtn.style.display=this.canTrade?"block":"none"},step:function(){this.showIndicateTime()},showIndicateTime:function(){if(this.townData)if(this.townData.protectTime){var b=this.townData.protectTime.getTime();0<b?(this.html_protectTimeLab.innerHTML=app.data.TimeVO.formatTime(b),this.html_attackBtn.style.display="none"):(this.html_protectTimeLab.innerHTML="\u5f53\u524d\u53ef\u653b\u51fb",
this.html_attackBtn.style.display=!0==this.canAttack?"block":"none")}else this.html_protectTimeLab.innerHTML="\u5f53\u524d\u53ef\u653b\u51fb",this.html_attackBtn.style.display=!0==this.canAttack?"block":"none"},getColorByID:function(b){var c=app.data.PlayerColorData.data,e,f,g;f=c.length;for(e=0;e<f;e++)if(g=c[e],g.id==b)return g},conquerHandle:function(){this.dispatchEvent({type:app.view.system.AreaControlView.CONQUER,target:this,data:this.townData.rid})},mailHandle:function(){this.dispatchEvent({type:app.view.system.AreaControlView.MAIL,
target:this,data:{userName:this.townData.userName}})},tradeHandle:function(){this.dispatchEvent({type:app.view.system.AreaControlView.TRADE,target:this,data:this.townData})},attackHandle:function(){this.dispatchEvent({type:app.view.system.AreaControlView.ATTACK,target:this,data:this.townData.rid})},enterHandle:function(){this.dispatchEvent({type:app.view.system.AreaControlView.ENTER,target:this})},slayerHandle:function(){this.dispatchEvent({type:app.view.system.AreaControlView.SLAYER,target:this})},
noteHandle:function(){this.dispatchEvent({type:app.view.system.AreaControlView.MODIFY_NOTE,target:this,data:this.townData})},townLogoHandle:function(){this.dispatchEvent({type:app.view.system.AreaControlView.MODIFY_TOWNLOGO,target:this,data:this.townData})},showPlayerInfo:function(b,c){this.dispatchEvent({type:app.view.system.AreaControlView.SHOW_PLAYERINFO,target:this,data:c})},showSlaveMenu:function(){this.slayersMenu.style.display="block"==this.slayersMenu.style.display?"none":"block"},close:function(){this.dispatchEvent({type:app.view.system.AreaControlView.CLOSE,
target:this})},depose:function(){app.controller.TimeController.getInstance().removeListener(this);this.html_dlg_close.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_enterBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.enterHandle));this.html_slayerBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.slayerHandle));this.html_noteBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.noteHandle));this.html_townLogoBtn.removeEventListener(app.Event.CLICK,
ClassUtils.delegate(this,this.townLogoHandle));this.html_conquerBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.conquerHandle));this.html_mailBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.mailHandle));this.html_tradeBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.tradeHandle));this.html_attackBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.attackHandle));this.html_firstLab.removeEventListener(app.Event.CLICK,
ClassUtils.delegate(this,this.showPlayerInfo,this.townData.rid));this.html_slayerList&&this.html_slayerList.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.showSlaveMenu));app.view.base.BaseUIForm.prototype.depose.call(this)},getCountryNameById:function(b){var c="";return 2==b?"\u534e\u590f":3==b?"\u80e1\u5937":4==b?"\u5357\u86ee":"\u4e2d\u7acb"}},{CLOSE:"areaControl_close",ATTACK:"areaControl_attack",CONQUER:"areaControl_conquer",TRADE:"areaControl_trade",MAIL:"areaControl_mail",
ENTER:"areaControl_enter",SLAYER:"areaControl_slayer",MODIFY_NOTE:"areaControl_modify_note",MODIFY_TOWNLOGO:"areaControl_modify_townLogo",SHOW_PLAYERINFO:"areaControl_showPlayerInfo"});puremvc.define({name:"app.view.system.TradeControlView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("tradeControl"),!0);this.html_trade_close=$("trade_close");this.html_trade_title=$("trade_title");this.html_tradeContent=$("tradeContent");this.html_trade_close.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close))}},{townData:null,tradeData:null,setData:function(b){this.townData=b[0];this.tradeData=b[1];this.html_trade_title.innerHTML=
this.townData.userName;this.layout()},updateData:function(b){var c,e,f;e=this.tradeData.length;for(c=0;c<e;c++)if(f=this.tradeData[c],f.id==b.id)f.price=b.price,f.count=0;this.layout()},layout:function(){this.html_tradeContent.innerHTML='<div style="width:249px; height:24px; margin-bottom:6px;"><div class="tb_01">\u5546\u54c1\u540d\u79f0</div><div class="tb_02">\u5f53\u524d\u4ef7\u683c</div><div class="tb_01">\u5e93\u5b58\u6570\u91cf</div></div>';var b,c,e,f,g,h;if(this.tradeData&&0<this.tradeData.length){g=
document.createDocumentFragment();e=this.tradeData.length;for(c=0;c<e;c++)f=this.tradeData[c],b=document.createElement("div"),b.style.width="332px",b.style.height="24px",b.style.marginBottom="6px",h=document.createElement("input"),h.type="button",h.className="btn_red",h.value="\u51fa\u552e",0<f.count?(h.disabled=!1,h.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.sellHandler,[this.townData,f.id]))):(h.disabled=!0,h.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.sellHandler,
[this.townData,f.id]))),b.innerHTML='<div class="tb_03">'+f.name+'</div><div class="tb_04">'+f.price+'%</div><div class="tb_03">'+f.count+'</div><div class="tb_05"></div>',b.getElementsByTagName("div")[3].appendChild(h),g.appendChild(b);this.html_tradeContent.appendChild(g)}},sellHandler:function(b,c){this.dispatchEvent({type:app.view.system.TradeControlView.SELL,target:this,data:c})},close:function(){this.dispatchEvent({type:app.view.system.TradeControlView.CLOSE,target:this})},depose:function(){this.html_trade_close.removeEventListener(app.Event.CLICK,
ClassUtils.delegate(this,this.close));app.view.base.BaseUIForm.prototype.depose.call(this)}},{CLOSE:"tradeControl_close",SELL:"tradeControl_sell"});puremvc.define({name:"app.view.system.NoteControlView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("noteControl"),!0);this.html_note_close=$("note_close");this.html_note_close.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_modifyBtn=$("modifyBtn");this.html_modifyBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.modifyHandle));this.html_cancelBtn=$("cancelBtn");this.html_cancelBtn.addEventListener(app.Event.CLICK,
ClassUtils.delegate(this,this.close));this.html_note_title=$("note_title");this.html_note_title.innerHTML="\u4fee\u6539\u7559\u8a00";this.html_noteContent=$("noteContent");this.html_noteContent[app.Event.ONCLICK]=function(){this.focus()}}},{townData:null,setData:function(b){this.townData=b;this.layout()},layout:function(){this.html_noteContent.innerHTML=this.townData.note},modifyHandle:function(){var b=""+this.html_noteContent.value;28<b.length?app.view.Alert.getInstance().show("\u7559\u8a00\u6700\u591a\u53ef\u4ee5\u8f93\u516528\u4e2a\u5b57\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\u3002"):
(this.townData.note=b,this.dispatchEvent({type:app.view.system.NoteControlView.MODIFY,target:this,data:this.townData}))},close:function(){this.dispatchEvent({type:app.view.system.NoteControlView.CLOSE,target:this})},depose:function(){this.html_note_close.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_modifyBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.modifyHandle));this.html_cancelBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,
this.close));app.view.base.BaseUIForm.prototype.depose.call(this)}},{CLOSE:"noteControl_close",MODIFY:"noteControl_modify"});puremvc.define({name:"app.view.system.TownLogoControlView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("townLogoControl"),!0);$("townLogo_close").addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));$("modifyBtn").addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.modifyHandle));$("cancelBtn").addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));$("townLogo_title").innerHTML="\u4fee\u6539\u65d7\u53f7";
this.html_townLogoContent=$("townLogoContent");this.html_townLogoContent[app.Event.ONCLICK]=function(){this.focus()}}},{townData:null,setData:function(b){this.townData=b;this.layout()},layout:function(){this.html_townLogoContent.value=this.townData.flag},modifyHandle:function(){var b=""+this.html_townLogoContent.value;1<b.length?app.view.Alert.getInstance().show("\u65d7\u53f7\u53ea\u53ef\u4ee5\u8f93\u51651\u4e2a\u5b57\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165!"):null==b||""==b||" "==b?app.view.Alert.getInstance().show("\u65d7\u53f7\u4e0d\u80fd\u4e3a\u7a7a!"):
(this.townData.flag=b,this.dispatchEvent({type:app.view.system.TownLogoControlView.MODIFY,target:this,data:this.townData}))},close:function(){this.dispatchEvent({type:app.view.system.TownLogoControlView.CLOSE,target:this})},depose:function(){$("townLogo_close").removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));$("modifyBtn").removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.modifyHandle));$("cancelBtn").removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,
this.close));app.view.base.BaseUIForm.prototype.depose.call(this)}},{CLOSE:"townlogoControl_close",MODIFY:"townlogoControl_modify"});puremvc.define({name:"app.view.system.ChatView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0);this.init();this.selectPage(0);this.selectTarget(0)}},{page:-1,limitMsgNum:50,chatInput:null,chatSelect:null,chatList:null,chatMsg:null,targetIndex:0,privateRole:null,onPageSelect:null,minInterval:[20,10,10,3,3],chatInterval:[],init:function(){for(var b=this.view.querySelectorAll("#chat_tab>li"),c=function(b,c){this.selectPage(c)},e=0;e<b.length;e++)b[e][app.Event.ONCLICK]=
ClassUtils.delegate(this,c,e);var f=this;this.view.querySelector("#chat_close")[app.Event.ONCLICK]=function(){f.dispatchEvent({type:app.view.system.ChatView.CLOSE,target:f})};this.chatInput=this.view.querySelector("#chat_input");this.chatInput[app.Event.ONCLICK]=function(){this.focus()};this.view.querySelector("#chat_send")[app.Event.ONCLICK]=function(){var b=f.chatInput.value.trim();0<b.length?f.timeUp()?(b=f.getChatData(b),f.clearInput(),f.dispatchEvent({type:app.view.system.ChatView.SEND,target:f,
data:b}),f.updateInterval()):app.view.Tooltip.getInstance().show("\u53d1\u8a00\u7684\u65f6\u95f4\u95f4\u9694\u592a\u77ed\uff01"):app.view.Tooltip.getInstance().show("\u8bf7\u8f93\u5165\u60a8\u7684\u53d1\u8a00\u5185\u5bb9\uff01")};this.chatList=this.view.querySelector("#chat_list");this.chatSelect=this.view.querySelector("#chat_select");this.chatSelect[app.Event.ONCLICK]=function(){f.chatList.style.display="none"==f.chatList.style.display?"block":"none"};b=this.chatList.querySelectorAll("input");for(c=
0;c<b.length;c++)b[c][app.Event.ONCLICK]=ClassUtils.delegate(this,function(b,c){f.selectTarget(c);f.chatList.style.display="none"},c);this.chatMsg=this.view.querySelector("#chat_msgs");this.systemMsg=this.view.querySelector("#system_msgs");this.chatBar=this.view.querySelector("#chatBar")},timeUp:function(){var b=this.chatInterval[this.targetIndex];return b?0>=b.getTime():!0},updateInterval:function(){var b=this.chatInterval[this.targetIndex];b?b.setTime(this.minInterval[this.targetIndex]):this.chatInterval[this.targetIndex]=
new app.data.TimeVO(this.minInterval[this.targetIndex])},depose:function(){var b=this.view.querySelectorAll("#chat_tab>li"),c;for(c=0;c<b.length;c++)b[c][app.Event.ONCLICK]=null;b=this.chatList.querySelectorAll("input");for(c=0;c<b.length;c++)b[c][app.Event.ONCLICK]=null;this.view.querySelector("#chat_close")[app.Event.ONCLICK]=null;this.view.querySelector("#chat_send")[app.Event.ONCLICK]=null;null!=this.scrollView&&this.scrollView.depose();this.chatSelect[app.Event.ONCLICK]=null;app.view.base.BaseUIForm.prototype.depose.call(this);
this.chatList=this.chatSelect=this.chatInput=null},selectTarget:function(b,c){var e=this.chatList.querySelectorAll("input")[b];this.targetIndex=b;this.chatSelect.value=e.value;this.chatSelect.className=e.className;this.privateRole=null;4==b&&!c&&this.dispatchEvent({type:app.view.system.ChatView.SHOW_ROLE,target:this})},setPrivateRole:function(b){this.selectTarget(4,!0);this.privateRole=b;this.chatSelect.value=b.name;this.selectPage(4)},selectPage:function(b){if(b!=this.page){for(var c=this.view.querySelectorAll("#chat_tab>li"),
e=0;e<c.length;e++)0<=this.page&&e==this.page&&removeClass(c[e],"chartLiOn"),addClass(c[e],b==e?"chartLiOn":"chartLi");this.page=b;this.clearAll();if(this.onPageSelect)this.onPageSelect(this.page)}},clearAll:function(){this.chatMsg.innerHTML=""},clearInput:function(){this.chatInput.value=""},limitMessage:function(b){try{for(var c=this.chatMsg.querySelectorAll("p"),e=c.length-b;0<e;)this.chatMsg.removeChild(c[0]),e--}catch(f){console.log("\u5220\u9664\u804a\u5929\u8bb0\u5f55\u8282\u70b9\u51fa\u9519!")}},
limitSystemMessage:function(b){for(var c=this.chatMsg.querySelectorAll("p"),b=c.length-b;0<b;)this.chatMsg.removeChild(c[0]),b--},appendMsg:function(b){if(0==this.page||b.group==this.page)this.limitMessage(this.limitMsgNum-1),this.chatMsg.appendChild(this.createMsgLine(b.group,b.value));null!=this.scrollView?this.updateScroll():this.creatScroll()},creatScroll:function(){var b=this;this.h=this.chatMsg.clientHeight;var c;180<this.h?(null==this.scrollView?this.scrollView=new app.view.base.ScrollView(function(c,
f){b.chatMsg.style["-webkit-transform"]="translateY("+-f+"px)";180<b.h&&(b.chatBar.style["-webkit-transform"]="translateY("+130*(f/(b.h-180))+"px)")},458,180,458,this.h,this.chatMsg,{scrollingX:!1}):this.scrollView.scroller.setDimensions(458,180,458,this.h),this.chatBar.style.display="inline",this.updateScroll()):null!=this.chatBar&&(this.chatBar.style.display="none")},updateScroll:function(){if(null!=this.scrollView)this.h=this.chatMsg.clientHeight,this.scrollView.scroller.setDimensions(458,180,
458,this.h),this.scrollView.scroller.scrollTo(0,this.h-180)},replaceAllMsg:function(b){this.clearAll();for(var c=b.length,e=document.createDocumentFragment(),f=0;f<c;f++)(0==this.page||b[f].group==this.page)&&e.appendChild(this.createMsgLine(b[f].group,b[f].value));this.chatMsg.appendChild(e);this.creatScroll()},appendSystemMsg:function(b){if(5==b.group){var c=document.createElement("p");c.innerHTML="[\u516c\u544a]"+b.value;this.limitSystemMessage(4);this.systemMsg.appendChild(c)}},setNotice:function(b){null==
b&&(b="");this.systemMsg.innerHTML=b},createMsgLine:function(b,c){var e=document.createElement("p");e.innerHTML=c;e.className="g"+b;var f=this,g=e.querySelector("a");if(g)g.href="javascript:void(0);",g[app.Event.ONCLICK]=function(b){var c={};c.id=parseInt(b.target.id);c.name=b.target.name;f.dispatchEvent({type:app.view.system.ChatView.SET_ROLE,target:this,data:c})};return e},getChatData:function(b){var c={};c.group=this.targetIndex;c.type=0;c.content=b;if(4==this.targetIndex)c.to=this.privateRole.id;
return c}},{CLOSE:"close",SEND:"send",SHOW_ROLE:"showRole",SET_ROLE:"setRole"});puremvc.define({name:"app.view.system.NpcEventView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("npcEvent"),!0);$("dlg_close").addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close))}},{npcEventData:null,setData:function(b){this.npcEventData=new app.data.NpcEventVO(b);this.layout()},layout:function(){$("personImg").src="images/ren/r_"+this.npcEventData.person+".gif";$("personLab").innerHTML=this.npcEventData.name;$("contentLab").innerHTML=
this.npcEventData.content;$("choose1Lab").innerHTML=this.npcEventData.choose1;$("choose2Lab").innerHTML=this.npcEventData.choose2;$("choose1Lab").addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.selectAnswer,this.npcEventData.chooseNum1));$("choose2Lab").addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.selectAnswer,this.npcEventData.chooseNum2))},selectAnswer:function(b){this.dispatchEvent({type:app.view.system.NpcEventView.SELECT,target:this,data:b})},close:function(){this.dispatchEvent({type:app.view.system.NpcEventView.CLOSE,
target:this})},depose:function(){$("dlg_close").removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));$("choose1Lab").removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.selectAnswer,this.npcEventData.chooseNum1));$("choose2Lab").removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.selectAnswer,this.npcEventData.chooseNum2));app.view.base.BaseUIForm.prototype.depose.call(this)}},{CLOSE:"npcEvent_close",SELECT:"npcEvent_select"});puremvc.define({name:"app.view.system.CampaignView",constructor:function(b){this.callFunc=b;app.controller.TimeController.getInstance().addListener(this)}},{campaignData:null,init:function(){this.html_rankList=$("rankList");this.html_nameLab=$("nameLab");this.html_descLab=$("descLab");this.html_timeLab=$("timeLab");this.html_rewardLab=$("rewardLab");this.html_rewardBtn=$("rewardBtn");this.html_userScore=$("userScore")},setData:function(b){this.campaignData=b;this.init();this.layout()},layout:function(){if(this.campaignData){if(this.campaignData.rankList&&
0<this.campaignData.rankList.length){this.html_rankList.innerHTML="";var b,c,e,f,g,h;e=document.createDocumentFragment();f=document.createElement("tr");f.style.backgroundColor="#523c1a";f.innerHTML='<td width="34px" class="tb_border">\u540d\u6b21</td><td width="74px" class="tb_border">\u73a9\u5bb6\u540d\u79f0</td><td width="53px">\u79ef\u5206</td>';e.appendChild(f);c=this.campaignData.rankList.length;for(b=0;b<c;b++)g=this.campaignData.rankList[b],h=b+1,f=document.createElement("tr"),f.innerHTML=
'<td class="tb_border">'+h+'</td><td class="tb_border">'+g.name+"</td><td>"+g.score+"</td></tr>",e.appendChild(f);this.html_rankList.appendChild(e)}this.html_nameLab.innerHTML=this.campaignData.name;this.html_descLab.innerHTML=this.campaignData.desc;this.showCampaignTime();this.html_userScore.innerHTML="\u6211\u7684\u79ef\u5206:"+this.campaignData.score;this.html_rewardLab.innerHTML=this.campaignData.reward?"\u53ef\u83b7\u5956\u52b1:<span>"+this.campaignData.reward.value+app.data.DataBase.getInstance().getRewardName(this.campaignData.reward.tid)+
"</span>":"\u53ef\u83b7\u5956\u52b1:<span>\u672a\u8fbe\u6210</span>";!0==this.campaignData.canGetReward?(this.html_rewardBtn.disabled=!1,this.html_rewardBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.getReward))):this.html_rewardBtn.disabled=!0}},step:function(){this.showCampaignTime()},showCampaignTime:function(){if(this.campaignData&&this.campaignData.time)this.html_timeLab.innerHTML="\u6301\u7eed\u65f6\u95f4\uff1a<span>"+app.data.TimeVO.formatTime2(this.campaignData.time.getTime())+
"</span>"},getReward:function(){this.callFunc({type:app.view.system.CampaignView.GET_REWARD,target:this})},completeReward:function(){this.html_rewardBtn.disabled=!0;this.html_rewardBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.getReward))},depose:function(){this.html_rewardBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.getReward))}},{GET_REWARD:"CampaignView_getReward"});puremvc.define({name:"app.view.system.SignInView",constructor:function(b){this.callFunc=b;this.init()}},{signInData:null,activeData:null,setData:function(b){this.signInData=b;this.layout()},init:function(){this.activePointsLab_html=$("activePointsLab");this.activeRewardList_html=$("activeRewardList");this.signInDayLab_html=$("signInDayLab");this.signInlist_html=$("signInlist")},layout:function(){this.signInData&&(this.activeLayout(),this.signLayout())},activeLayout:function(){var b,c,e,f,g,h,j,k,
l;if(this.signInData.hasOwnProperty("score"))this.activePointsLab_html.innerHTML=this.signInData.score;this.activeRewardList_html.innerHTML="";e=document.createDocumentFragment();c=this.signInData.hasOwnProperty("detail")?this.signInData.detail.length:0;for(b=0;5>b;b++){k=20*(b+1);if(k<=this.signInData.score)for(var m=0;m<c;m++){if(f=this.signInData.detail[m],f.score==k)f.status==app.view.system.SignInView.ACTIVE_REWARD_STATUS_YES?(g="url(images/ui/notget.gif)",h="\u53ef\u9886\u53d6",j="#00ff00",
l=f.id):(g="url(images/ui/get.gif)",h="\u5df2\u9886\u53d6",j="#fffb88")}else g="url(images/ui/notget.gif)",h="\u9700"+20*(b+1)+"\u5206",j="#ffffff";f=document.createElement("div");f.className=3<=b?"hd_02":"hd_01";if(3==b)f.style.marginLeft="36px";f.style.backgroundImage=g;f.style.color=j;f.innerHTML=h;"\u53ef\u9886\u53d6"==h&&(f[app.Event.ONCLICK]=ClassUtils.delegate(this,this.getReward,l));e.appendChild(f)}this.activeBtn_html=$("activeBtn");this.activeBtn_html[app.Event.ONCLICK]=ClassUtils.delegate(this,
this.showActiveDetail);this.activeRewardList_html.appendChild(e)},signLayout:function(){var b,c,e,f,g,h;if(this.signInData.hasOwnProperty("signInDay")){this.signInDayLab_html.innerHTML=this.signInData.signInDay;this.signInlist_html.innerHTML="";b=document.createDocumentFragment();for(c=1;6>c;c++){e=document.createElement("div");c>this.signInData.signInDay?(f="url(images/ui/notget.gif)",g="\u8fde\u7eed"+c+"\u5929",h="#ffffff"):(f="url(images/ui/get.gif)",g="\u5df2\u9886\u53d6",h="#fffb88");e.className=
4<=c?"hd_02":"hd_01";if(4==c)e.style.marginLeft="36px";e.style.backgroundImage=f;e.style.color=h;e.innerHTML=g;b.appendChild(e)}c=$("signInBtn");this.signInlist_html.appendChild(b);this.signInBtn_html=c;!1==this.signInData.signInToday?(this.signInBtn_html.disabled=!1,this.signInBtn_html[app.Event.ONCLICK]=ClassUtils.delegate(this,this.signInHandle,this.signInData.signInDay+1)):(this.signInBtn_html.disabled=!0,this.signInBtn_html[app.Event.ONCLICK]=null)}},getReward:function(b,c){this.callFunc({type:app.view.system.SignInView.GET_ACTIVE_REWARD,
target:this,data:c})},showActiveDetail:function(){this.callFunc({type:app.view.system.SignInView.SHOW_ACTIVE_DIALOG,target:this})},signInHandle:function(){this.callFunc({type:app.view.system.SignInView.SIGN_IN,target:this})},depose:function(){this.activeBtn_html.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.showActiveDetail));this.signInBtn_html.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.signInHandle,this.signInData.signInDay+1))}},{SIGN_IN:"SignInView_signIn",
SHOW_ACTIVE_DIALOG:"SignInView_showActiveDialog",GET_ACTIVE_REWARD:"SignInView_getActiveReward",ACTIVE_REWARD_STATUS_NO:0,ACTIVE_REWARD_STATUS_YES:2,ACTIVE_REWARD_STATUS_GET:3});puremvc.define({name:"app.view.system.ActiveView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("active"),!0);this.init()}},{activeData:null,init:function(){this.html_active=$("activeList");this.html_active_close=$("active_close");this.html_active_container=$("active_container");this.moveBarImg=$("dg_active01");this.html_active_close.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close))},setData:function(b){this.activeData=
b;this.layout()},layout:function(){if(this.activeData){this.html_active.innerHTML="";var b,c,e,f,g,h;c=this.activeData.length;f=document.createDocumentFragment();for(b=0;b<c;b++)if(e=this.activeData[b],h=app.data.DataBase.getInstance().getTasksById(e.id))g=document.createElement("div"),g.className="tb_hyd",e=1==e.status?e.schedule:h.attr,g.style.color=e==h.attr?"#00ff00":"#ffffff",g.innerHTML='<div class="tb_hyd_01">'+h.title+'</div><div class="tb_hyd_02">'+h.reward.split(",")[1]+'</div><div class="tb_hyd_03"><span>'+
e+"</span>/<span>"+h.attr+"</span></div>",f.appendChild(g);this.html_active.appendChild(f);var j=this,k=this.html_active_container;this.scroller?this.scroller.update(k.clientWidth,k.clientHeight,j.html_active.clientWidth,j.html_active.clientHeight):this.scroller=new app.view.base.ScrollView(function(b,c){j.html_active.style["-webkit-transform"]="translateY("+-c+"px)";j.html_active.clientHeight>k.clientHeight&&(j.moveBarImg.style["-webkit-transform"]="translateY("+165*(c/(j.html_active.clientHeight-
k.clientHeight))+"px)")},k.clientWidth,k.clientHeight,j.html_active.clientWidth,j.html_active.clientHeight,j.html_active);this.moveBarImg.style.display=j.html_active.clientHeight<=k.clientHeight?"none":"inline"}},close:function(){this.dispatchEvent({type:app.view.system.ActiveView.CLOSE,target:this})},depose:function(){null!=this.scroller&&this.scroller.depose();this.html_active_close.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));app.view.base.BaseUIForm.prototype.depose.call(this)}},
{CLOSE:"Active_close"});puremvc.define({name:"app.view.system.MailView",parent:app.view.base.TabContentView,constructor:function(b){app.view.base.TabContentView.call(this,b.getContent("tabContent"));this.init(b)}},{mailData:null,tabId:null,init:function(b){this.tabId=0;this.append("\u5168\u90e8",b.getContent("mail"));this.append("\u73a9\u5bb6");this.append("\u7cfb\u7edf");this.append("\u6218\u62a5");this.title.innerHTML="\u90ae\u4ef6";$("tab_bottom").style.display="none";this.html_mail=$("mailList");this.html_delAllBtn=
$("delAllBtn");this.html_newMailBtn=$("newMailBtn");this.moveBarImg=$("dg_active01");this.mail_scrollBar=$("mail_scrollBar");this.mail_boder=$("mail_boder")},setData:function(b){this.mailData=b;this.show(this.tabId)},addData:function(b){if(b&&0<b.length){var c,e;e=b.length;for(c=0;c<e;c++)this.mailData.push(b[c]);this.layout(this.tabId)}},tabChange:function(b){b==app.view.system.MailView.MAIL_TYPE_ALL&&app.view.base.TabContentView.prototype.tabChange.call(this,b);this.tabId=b;this.layout()},append:function(b,
c){this.tabBar&&(this.tabBar.appendTab(b),c&&this.viewStack.appendView(c))},layout:function(){this.html_mail.innerHTML="";var b=this.getMailsByType(this.tabId);if(b&&0<b.length){this.mail_boder.style.background="none";this.mail_scrollBar.style.visibility="visible";var c,e,f,g,h,j,k,l;e=b.length;g=document.createDocumentFragment();for(c=0;c<e;c++)f=b[c],h=document.createElement("div"),h.className="content_box mailBox",0==f.readStatus?(j="images/ui/mail_01.gif",k="\u672a\u8bfb"):(j="images/ui/mail_02.gif",
k="\u5df2\u8bfb"),l=f.type==app.view.system.MailView.MAIL_TYPE_SYSTEM?"\u7cfb\u7edf":f.type==app.view.system.MailView.MAIL_TYPE_USER?f.userName:"\u6218\u62a5",h.innerHTML='<div class="content mailBox2"><div style="width:47px; height:47px;float:left;background:url('+j+');"><p style="margin-left:10px">'+k+'</p></div><div style="width:322px; height:30px; margin:8px 0px 9px 10px; line-height:16px; float:left;"><p>'+f.time+'</p><p class="fc4">['+l+"]"+f.title+'</p></div><div style="width:37px; height:35px; margin:6px 0px; float:left;"><img src="images/ui/chatclose_nor.png" width="37" height="35" /></div></div>',
h.getElementsByTagName("div")[2].addEventListener(app.Event.MOUSE_DOWN,ClassUtils.delegate(this,this.readMail,[f,c]),!1),h.getElementsByTagName("img")[0].addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.delMail,f),!0),g.appendChild(h);this.html_mail.appendChild(g);var m=this.html_mail,o=$("mail_container"),q=this;this.scroller?this.scroller.update(o.clientWidth,o.clientHeight,m.clientWidth,m.clientHeight):this.scroller=new app.view.base.ScrollView(function(b,c){m.style["-webkit-transform"]=
"translateY("+-c+"px)";m.clientHeight>o.clientHeight&&(q.moveBarImg.style["-webkit-transform"]="translateY("+137*(c/(m.clientHeight-o.clientHeight))+"px)")},o.clientWidth,o.clientHeight,m.clientWidth,m.clientHeight,m);this.moveBarImg.style.display=m.clientHeight<=o.clientHeight?"none":"inline"}else this.mail_scrollBar.style.visibility="hidden",this.html_mail.innerHTML='<p style="text-align:center; margin-top:80px;">\u6ca1\u6709\u90ae\u4ef6</p>',this.mail_boder.style.background="url(images/ui/popubg_11.png) no-repeat",
this.mail_boder.style.backgroundSize="422px 169px",this.mail_boder.style.backgroundPosition="79% 93%";this.html_delAllBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.delAllMail));this.html_newMailBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.newMail))},loadNextMail:function(b){this.dispatchEvent({type:app.view.system.MailView.LOAD_NEXT_MAIL_LIST,target:this,data:b})},getMailsByType:function(b){var c,e,f,g;if(this.mailData){e=[];f=this.mailData.length;if(b==
app.view.system.MailView.MAIL_TYPE_ALL)return this.mailData;for(c=0;c<f;c++)g=this.mailData[c],g.type==b&&e.push(g)}return e},readMail:function(b,c){var e=this,f=0;b.target[app.Event.ONMOVE]=function(){f=1};b.target[app.Event.ONMOUSE_UP]=function(){0==f&&e.dispatchEvent({type:app.view.system.MailView.READ,target:e,data:c})}},delMail:function(b,c){this.dispatchEvent({type:app.view.system.MailView.DEL,target:this,data:c})},delAllMail:function(){var b=this;this.mailData&&app.view.Alert.getInstance().show("\u786e\u5b9e\u8981\u5220\u9664\u6240\u6709\u7684\u90ae\u4ef6\u5417\uff1f",
["\u786e\u5b9a","\u53d6\u6d88"],function(c){0==c&&b.dispatchEvent({type:app.view.system.MailView.DEL_ALL,target:b,data:b.tabId})})},newMail:function(){this.dispatchEvent({type:app.view.system.MailView.NEW_MAIL,target:this})},depose:function(){this.html_delAllBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.delAllMail));this.html_newMailBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.newMail));this.dispatchEvent({type:app.view.system.MailView.CLOSE,target:this});
app.view.base.TabContentView.prototype.depose.call(this)}},{CLOSE:"MailView_close",READ:"MailView_read",DEL:"MailView_del",DEL_ALL:"MailView_delAll",NEW_MAIL:"MailView_newMail",MAIL_TYPE_ALL:0,MAIL_TYPE_USER:1,MAIL_TYPE_SYSTEM:2,MAIL_TYPE_BATTAL:3,LOAD_NEXT_MAIL_LIST:"MailView_loadNextMail"});puremvc.define({name:"app.view.system.CountryView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0);this.isOK=this.isRandom=!1;this.init()}},{init:function(){this.data=app.data.DataBase.getInstance().getAllCountrys();this.div=document.querySelectorAll("#countrys>div");for(var b=this,c=0;c<this.div.length;c++)this.div[c].style["background-image"]="url(images/area/city_"+this.data[c].id+".png)",this.div[c].innerHTML="<br/><br/>"+this.data[c].name+"&nbsp;",
this.div[c][app.Event.ONCLICK]=function(c){b.setCountry(c.currentTarget)};document.querySelector("#sel_btn")[app.Event.ONCLICK]=function(){b.dispatchEvent({type:app.view.system.CountryView.SELECT,target:b,data:b.selectData.id})}},setFlag:function(b,c){this.canvas=document.querySelector("#flag");this.canvas.width=c.frames.width;this.canvas.height=c.frames.height;this.stage=new Stage(this.canvas);c.images=[b];var e=new BitmapAnimation(new SpriteSheet(c));e.gotoAndPlay(1);this.stage.addChild(e);Ticker.setFPS(20);
Ticker.addListener(this.stage);this.setCountry(this.div[0])},setCountry:function(b){var c=this.div;switch(b){case c[0]:this.selectData=this.data[0];this.isRandom=!0;break;case c[1]:this.selectData=this.data[1];this.isRandom=!1;break;case c[2]:this.selectData=this.data[2];this.isRandom=!1;break;case c[3]:this.selectData=this.data[3],this.isRandom=!1}this.canvas.style.position="absolute";this.canvas.style.left=b.offsetLeft+0.5*b.clientWidth-0.5*this.canvas.width-3+"px";this.canvas.style.top=b.offsetTop+
0.5*b.clientHeight-this.canvas.height+3+"px"},showCompleteMsg:function(b){if(!0==this.isRandom){b--;this.canvas.style.display="none";for(var c=0;c<this.div.length;c++)this.div[c][app.Event.ONCLICK]=null,c!=b?this.div[c].style.display="none":(this.div[c].style.left="90px",this.div[c].style.top="54px");c=$("dlg_title");c.innerHTML="\u606d\u559c\u60a8\u52a0\u5165\u201c"+this.data[b].name+"\u201d\uff0c\u5929\u547d\u6240\u5f52\uff01";c.style.lineHeight="30px";this.isOK=!0}},depose:function(){Ticker.removeListener(this.stage);
this.stage.removeAllChildren();this.stage=null;app.view.base.BaseUIForm.prototype.depose.call(this)}},{SELECT:"Select"});puremvc.define({name:"app.view.system.MailInputView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("mailInput"),!0);this.html_mailSendClose=$("mailSendClose");this.html_mailSendClose.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_sendBtn=$("sendBtn");this.html_sendBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.sendMail));this.html_sendName=$("sendName");this.html_sendTitle=$("sendTitle");
this.html_sendContent=$("sendContent");this.html_sendName[app.Event.ONCLICK]=function(){this.focus()};this.html_sendTitle[app.Event.ONCLICK]=function(){this.focus()};this.html_sendContent[app.Event.ONCLICK]=function(){this.focus()}}},{mailSendData:null,setData:function(b){this.mailSendData=b;this.layout()},layout:function(){this.mailSendData?(this.html_sendName.value=this.mailSendData.hasOwnProperty("userName")?this.mailSendData.userName:"",this.html_sendTitle.value=this.mailSendData.hasOwnProperty("title")?
"\u56de\u590d:"+this.mailSendData.title:""):(this.html_sendName.value="",this.html_sendTitle.value="")},close:function(){this.dispatchEvent({type:app.view.system.MailInputView.CLOSE,target:this})},sendMail:function(){var b,c,e,f;b=this.html_sendName.value;c=this.html_sendTitle.value;e=this.html_sendContent.value;null==b||""==b?app.view.Alert.getInstance().show("\u6536\u4ef6\u4eba\u4e0d\u80fd\u4e3a\u7a7a!"):16<b.length?app.view.Alert.getInstance().show("\u6536\u4ef6\u4eba\u540d\u5b57\u4e0d\u80fd\u8d85\u8fc716\u4e2a\u5b57!"):
null==c||""==c?app.view.Alert.getInstance().show("\u90ae\u4ef6\u6807\u9898\u4e0d\u80fd\u4e3a\u7a7a!"):16<c.length?app.view.Alert.getInstance().show("\u90ae\u4ef6\u6807\u9898\u5b57\u6570\u4e0d\u80fd\u8d85\u8fc716\u4e2a\u5b57!"):null==e||""==e?app.view.Alert.getInstance().show("\u90ae\u4ef6\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a!"):150<e.length?app.view.Alert.getInstance().show("\u90ae\u4ef6\u5185\u5bb9\u5b57\u6570\u4e0d\u80fd\u8d85\u8fc7150\u4e2a\u5b57!"):(f=new app.data.MailVO,f.sendName=b,f.sendTitle=
c,f.sendContent=e,this.dispatchEvent({type:app.view.system.MailInputView.SEND_MAIL,target:this,data:f}))},depose:function(){this.html_mailSendClose.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_sendBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.returnMail,this.mailDetailData));app.view.base.BaseUIForm.prototype.depose.call(this)}},{CLOSE:"MailInputView_close",SEND_MAIL:"MailInputView_return"});puremvc.define({name:"app.view.system.MailDetailView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("mailDetail"),!0);this.init()}},{mailDetailData:null,init:function(){this.html_mailDetailClose=$("mailDetailClose");this.html_mailDetailClose.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_nameLab=$("nameLab");this.html_returnBtn=$("returnBtn");this.html_mailTitle=$("mailTitle");this.html_mailContent=$("mailContent1");
this.html_nextMailBtn=$("nextMailBtn");this.html_preMailBtn=$("preMailBtn");this.html_nextMailBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.nextMail));this.html_preMailBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.preMail))},setData:function(b,c){if(b)this.mailDetailData=b[0],this.idx=b[1],this.html_preMailBtn.style.visibility=0==this.idx?"hidden":"visible",this.html_nextMailBtn.style.visibility=this.idx>=c-1?"hidden":"visible",this.layout()},layout:function(){if(this.mailDetailData){this.html_mailContent.innerHTML=
"";var b=this.mailDetailData.content;if(this.mailDetailData.type==app.view.system.MailView.MAIL_TYPE_USER)this.html_nameLab.innerHTML=this.mailDetailData.userName,this.html_returnBtn.style.display="block",this.html_nameLab.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.loadPlayerInfo,this.mailDetailData.userId)),this.html_returnBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.returnMail,this.mailDetailData)),this.html_mailContent.innerHTML=b;else if(this.html_nameLab.innerHTML=
"\u7cfb\u7edf",this.html_returnBtn.style.display="none",this.mailDetailData.userId&&0!=this.mailDetailData.userId){var c;this.playerName=document.createElement("label");this.playerName.className="fc9";this.playerName.style.textDecoration="underline";this.playerName.innerHTML=this.mailDetailData.userName;b=b.split("*");c=document.createElement("label");c.innerHTML=b[0];this.html_mailContent.appendChild(c);this.html_mailContent.appendChild(this.playerName);c=document.createElement("label");c.innerHTML=
b[1];this.html_mailContent.appendChild(c);this.playerName.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.loadPlayerInfo,this.mailDetailData.userId))}else this.html_mailContent.innerHTML=b;this.html_mailTitle.innerHTML=this.mailDetailData.title;if(0!=this.mailDetailData.battleReportId)this.battleReport=document.createElement("label"),this.battleReport.className="fc4",this.battleReport.style.textDecoration="underline",this.battleReport.innerHTML="[\u6218\u62a5]",this.html_mailContent.appendChild(this.battleReport),
this.battleReport.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.playBattle,[this.mailDetailData.battleReportId,this.mailDetailData.bidType]))}},close:function(){this.dispatchEvent({type:app.view.system.MailDetailView.CLOSE,target:this})},returnMail:function(b,c){this.dispatchEvent({type:app.view.system.MailDetailView.RETURN_MAIL,target:this,data:c})},nextMail:function(){this.dispatchEvent({type:app.view.system.MailDetailView.NEXT_MAIL,target:this,data:this.idx})},preMail:function(){this.dispatchEvent({type:app.view.system.MailDetailView.PRE_MAIL,
target:this,data:this.idx})},playBattle:function(b,c){this.dispatchEvent({type:app.view.system.MailDetailView.PLAY_BATTLE,target:this,data:c})},loadPlayerInfo:function(b,c){this.dispatchEvent({type:app.view.system.MailDetailView.PLAYER_INFO,target:this,data:c})},depose:function(){this.html_mailDetailClose.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_returnBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.returnMail,this.mailDetailData));this.html_nextMailBtn.removeEventListener(app.Event.CLICK,
ClassUtils.delegate(this,this.nextMail));this.html_preMailBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.preMail));this.html_nameLab.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.loadPlayerInfo,this.mailDetailData.userId));this.battleReport&&this.battleReport.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.playBattle,[this.mailDetailData.bId,this.mailDetailData.bTypeId]));null!=this.playerName&&this.playerName.removeEventListener(app.Event.CLICK,
ClassUtils.delegate(this,this.loadPlayerInfo,this.mailDetailData.userId));app.view.base.BaseUIForm.prototype.depose.call(this)}},{CLOSE:"MailDetailView_close",RETURN_MAIL:"MailDetailView_return",NEXT_MAIL:"MailDetailView_next",PRE_MAIL:"MailDetailView_pre",PLAY_BATTLE:"MailDetailView_playBattle",PLAYER_INFO:"MailDetailView_playerInfo"});puremvc.define({name:"app.view.system.CityInfoView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0);this.init()}},{init:function(){this.showDiv=this.view.querySelectorAll("#info0>div");this.info1=this.view.querySelectorAll("#info1 span");this.info2=this.view.querySelectorAll("#info2 span");this.closeBtn=this.view.querySelector("#dlg_close");this.closeBtn.addEventListener(app.Event.CLICK,this)},handleEvent:function(b){switch(b.currentTarget){case this.closeBtn:this.dispatchEvent({type:app.view.system.CityInfoView.CLOSE,
target:this})}},update:function(b,c,e){this.info1[0].innerHTML=app.data.DataBase.getInstance().getHeroInfo(b.heroId).name;this.info1[1].innerHTML=b.silverCoin+"/"+b.maxSilverCoin;this.info1[2].innerHTML=b.grain+"/"+b.maxGrain;this.info1[3].innerHTML=b.troop+"/"+b.maxTroop;this.info2[0].innerHTML=b.name;this.info2[1].innerHTML=b.goldCoin;this.info2[2].innerHTML=b.feat;this.info2[3].innerHTML=b.prestige;this.showDiv[0].style["background-position"]="0px "+-37*(e-1)+"px";this.showDiv[1].innerHTML=c},
depose:function(){this.closeBtn.removeEventListener(app.Event.CLICK,this);this.showDiv=this.info2=this.info1=this.closeBtn=null;app.view.base.BaseUIForm.prototype.depose.call(this)}},{CLOSE:"CityInfo_Close"});puremvc.define({name:"app.view.system.PlayerInfoView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("playerInfo"),!0);this.init()}},{data:null,init:function(){this.html_playerInfo_close=$("playerInfo_close");this.html_playerInfo_name=$("playerInfo_name");this.html_playerInfo_level=$("playerInfo_level");this.html_playerInfo_office=$("playerInfo_office");this.html_playerInfo_corps=$("playerInfo_corps");this.html_playerInfo_area=$("playerInfo_area");
this.html_playerInfo_close.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close))},setData:function(b){this.data=b;this.layout()},layout:function(){this.html_playerInfo_name.innerHTML="";this.html_playerInfo_level.innerHTML="";this.html_playerInfo_office.innerHTML="";this.html_playerInfo_corps.innerHTML="";this.html_playerInfo_area.innerHTML="";if(this.data){this.html_playerInfo_name.innerHTML=this.data.name;this.html_playerInfo_level.innerHTML=this.data.rate;var b=app.data.DataBase.getInstance().getOfficialInfo(this.data.level);
this.html_playerInfo_office.innerHTML=b&&b.name?b.name:"\u65e0";b=this.data.armyGroup;5<b.length&&(b=b.substr(0,5)+"...");this.html_playerInfo_corps.innerHTML=b;this.html_playerInfo_area.innerHTML=this.getCityDataByID(this.data.city).name+this.data.block+"\u53f7\u533a\u57df"}},getCityDataByID:function(b){for(var c=app.data.WorldMapData.cities,e=0;e<c.length;e++)if(c[e].id==b)return c[e]},close:function(){this.dispatchEvent({type:app.view.system.PlayerInfoView.CLOSE,target:this})},depose:function(){this.html_playerInfo_close.removeEventListener(app.Event.CLICK,
ClassUtils.delegate(this,this.close));app.view.base.BaseUIForm.prototype.depose.call(this)}},{CLOSE:"playerInfo_close"});puremvc.define({name:"app.view.system.NewPlayerGuideView",parent:EventDispatcher,constructor:function(b){this.loader=b;EventDispatcher.call(this);this.init()}},{guideCanvas:null,guideData:null,guideDiv:null,guideScaleX:null,guideScaleY:null,arrowClick:!1,init:function(){this.body=document.getElementsByTagName("body")[0];this.guideDiv=document.createElement("div");this.guideDiv.id="guideDiv";this.guideDiv.style.width=app.GameData.gameCanvas.width+"px";this.guideDiv.style.height=app.GameData.gameCanvas.height+
"px";this.guideDiv.style.position="absolute";this.guideDiv.style.top="0px";this.guideDiv.style.left="0px";this.body.appendChild(this.guideDiv);this.guideCanvas=document.createElement("canvas");this.guideDiv.appendChild(this.guideCanvas);this.guideCanvas.style.position="absolute";this.guideCanvas.width=app.GameData.gameCanvas.width;this.guideCanvas.height=app.GameData.gameCanvas.height;this.stage=new Stage(this.guideCanvas);this.guideScaleX=this.guideCanvas.width/480;this.guideScaleY=this.guideCanvas.height/
268},setData:function(b,c,e,f){this.homeSceneView=c;this.worldSceneView=e;this.data=b;this.guideData=1==this.data.type?app.data.DataBase.getInstance().getGuideById(b.id):2==this.data.type?app.data.DataBase.getInstance().getGuideByBattleId(this.data.battleId):app.data.DataBase.getInstance().getGuideByLevelId(this.data.levelUpId);if(f)if(56==this.data.battleId)if(2==f.country)this.guideData.info="\u71d5\u4eac\u5df2\u7ecf\u53ef\u4ee5\u8fc1\u5165\uff0c\u8fc1\u5165\u540e\u73a9\u5bb6\u7b49\u7ea7\u4e0a\u9650\u53d8\u4e3a40\u7ea7",
this.guideData.infoPos="60,0";else if(3==f.country)this.guideData.info="\u4e91\u5357\u5df2\u7ecf\u53ef\u4ee5\u8fc1\u5165\uff0c\u8fc1\u5165\u540e\u73a9\u5bb6\u7b49\u7ea7\u4e0a\u9650\u53d8\u4e3a40\u7ea7",this.guideData.infoPos="0,50";else{if(4==f.country)this.guideData.info="\u4f1a\u7a3d\u5df2\u7ecf\u53ef\u4ee5\u8fc1\u5165\uff0c\u8fc1\u5165\u540e\u73a9\u5bb6\u7b49\u7ea7\u4e0a\u9650\u53d8\u4e3a40\u7ea7",this.guideData.infoPos="0,-80"}else if(61==this.data.battleId)if(2==f.country)this.guideData.info=
"\u90ba\u57ce\u548c\u5357\u76ae\u5df2\u7ecf\u53ef\u4ee5\u8fc1\u5165\uff0c\u8fc1\u5165\u540e\u73a9\u5bb6\u7b49\u7ea7\u4e0a\u9650\u53d8\u4e3a60\u7ea7",this.guideData.infoPos="-60,80";else if(3==f.country)this.guideData.info="\u57ce\u90fd\u548c\u6c74\u6881\u5df2\u7ecf\u53ef\u4ee5\u8fc1\u5165\uff0c\u8fc1\u5165\u540e\u73a9\u5bb6\u7b49\u7ea7\u4e0a\u9650\u53d8\u4e3a60\u7ea7",this.guideData.infoPos="0,80";else{if(4==f.country)this.guideData.info="\u5efa\u4e1a\u548c\u67f4\u6851\u5df2\u7ecf\u53ef\u4ee5\u8fc1\u5165\uff0c\u8fc1\u5165\u540e\u73a9\u5bb6\u7b49\u7ea7\u4e0a\u9650\u53d8\u4e3a60\u7ea7",
this.guideData.infoPos="0,-80"}else if(66==this.data.battleId)if(2==f.country)this.guideData.info="\u5317\u6d77\u548c\u897f\u4eac\u5df2\u7ecf\u53ef\u4ee5\u8fc1\u5165\uff0c\u8fc1\u5165\u540e\u73a9\u5bb6\u7b49\u7ea7\u4e0a\u9650\u53d8\u4e3a80\u7ea7",this.guideData.infoPos="60,80";else if(3==f.country)this.guideData.info="\u6c49\u4e2d\u548c\u5929\u6c34\u5df2\u7ecf\u53ef\u4ee5\u8fc1\u5165\uff0c\u8fc1\u5165\u540e\u73a9\u5bb6\u7b49\u7ea7\u4e0a\u9650\u53d8\u4e3a80\u7ea7",this.guideData.infoPos="0,80";else{if(4==
f.country)this.guideData.info="\u957f\u6c99\u548c\u6b66\u9675\u5df2\u7ecf\u53ef\u4ee5\u8fc1\u5165\uff0c\u8fc1\u5165\u540e\u73a9\u5bb6\u7b49\u7ea7\u4e0a\u9650\u53d8\u4e3a80\u7ea7",this.guideData.infoPos="-60,80"}else if(71==this.data.battleId)if(2==f.country)this.guideData.info="\u8bb8\u660c\u5df2\u7ecf\u53ef\u4ee5\u8fc1\u5165\uff0c\u8fc1\u5165\u540e\u73a9\u5bb6\u7b49\u7ea7\u4e0a\u9650\u53d8\u4e3a100\u7ea7",this.guideData.infoPos="60,0";else if(3==f.country)this.guideData.info="\u6c38\u5b89\u5df2\u7ecf\u53ef\u4ee5\u8fc1\u5165\uff0c\u8fc1\u5165\u540e\u73a9\u5bb6\u7b49\u7ea7\u4e0a\u9650\u53d8\u4e3a100\u7ea7",
this.guideData.infoPos="-60,0";else if(4==f.country)this.guideData.info="\u6c5f\u590f\u5df2\u7ecf\u53ef\u4ee5\u8fc1\u5165\uff0c\u8fc1\u5165\u540e\u73a9\u5bb6\u7b49\u7ea7\u4e0a\u9650\u53d8\u4e3a100\u7ea7",this.guideData.infoPos="-60,0";this.guideData&&this.layout()},layout:function(){this.stage.removeAllChildren();this.commonBox&&this.guideDiv.removeChild(this.commonBox);this.cancelBtn&&this.guideDiv.removeChild(this.cancelBtn);var b=this;if(this.guideData.infoPos){var c;c=this.guideData.infoPos.split(",");
this.commonBox=document.createElement("div");this.commonBox.id="commonBox";this.commonBox.style.position="absolute";this.commonBox.style.width="293px";this.commonBox.style.height="120px";this.commonBox.style.background="url(images/ui/xinshouzhiyin.png) no-repeat";this.commonBox.style.top=0.5*(app.GameData.gameCanvas.height-93)+parseInt(c[0])+"px";this.commonBox.style.left=0.5*(app.GameData.gameCanvas.width-291)+parseInt(c[1])+"px";c=this.data.heroId;this.commonBox.innerHTML='<div style="width:245px; height:66px;margin-left: 20px;margin-top: 24px;background:url('+
("images/heros/hero_"+app.data.DataBase.getInstance().getHeroInfo(c).pic+".gif")+') left center no-repeat;"><p style="width:192px;height: 60px;margin-left: 55px; font-size: 12px">'+this.guideData.info+'</p><p id="nextCueTxt" class="fc2" style="text-align: right;">\u3010\u70b9\u51fb\u5c4f\u5e55\u4e0b\u4e00\u6b65\u3011</p></div>';this.guideDiv.appendChild(this.commonBox);document.getElementById("nextCueTxt").style.display=this.guideData.arrowPos?"none":"block";if(0==this.guideData.canSkip)this.cancelBtn=
document.createElement("input"),this.cancelBtn.id="cancelBtn",this.cancelBtn.type="button",this.cancelBtn.className="minBtn",this.cancelBtn.style.backgroundImage="url(images/ui/btn_10.png)",this.cancelBtn.value="\u8df3\u8fc7",this.cancelBtn.style.position="absolute",this.cancelBtn.style.marginTop="5px",this.cancelBtn.style.marginLeft="330px",this.cancelBtn[app.Event.ONCLICK]=function(){b.cancelStep()},this.guideDiv.appendChild(this.cancelBtn)}var e,f,g,h,j,k,l,m;if(this.guideData.cuePos){h=this.guideData.cuePos.split(";");
g=h.length;for(f=0;f<g;f++)j=h[f].split(","),e=new Shape,this.guideData.arrowPos?e.graphics.beginStroke("#ff0000"):e.graphics.beginStroke("#fff000"),e.graphics.setStrokeStyle(3),c=parseInt(j[0]),k=parseInt(j[1]),l=parseInt(j[2]),m=parseInt(j[3]),j=parseInt(j[4]),0==j?(c*=this.guideScaleX,k*=this.guideScaleY,l*=this.guideScaleX,m*=this.guideScaleY):1==j?c=this.guideCanvas.width-c:2==j?this.homeSceneView&&(c+=this.homeSceneView.scene.x,k+=this.homeSceneView.scene.y):4==j?k=this.guideCanvas.height-k:
5==j?this.worldSceneView&&(c+=this.worldSceneView.scene.x,k+=this.worldSceneView.scene.y):6==j&&(c=this.guideCanvas.width-c,k=this.guideCanvas.height-k),e.graphics.rect(c,k,l,m),this.stage.addChild(e)}if(this.guideData.arrowPos)f=this.guideData.arrowPos.split(","),e=new Shape,e.graphics.beginFill("#FFFFFF"),c=parseInt(f[0]),k=parseInt(f[1]),l=parseInt(f[2]),m=parseInt(f[3]),j=parseInt(f[4]),0==j?(c*=this.guideScaleX,k*=this.guideScaleY,l*=this.guideScaleX,m*=this.guideScaleY):1==j?c=this.guideCanvas.width-
c:2==j?this.homeSceneView&&(c+=this.homeSceneView.scene.x,k+=this.homeSceneView.scene.y):4==j?k=this.guideCanvas.height-k:5==j?this.worldSceneView&&(c+=this.worldSceneView.scene.x,k+=this.worldSceneView.scene.y):6==j&&(c=this.guideCanvas.width-c,k=this.guideCanvas.height-k),e.graphics.rect(c,k,l,m),e.alpha=0.1,this.stage.addChild(e),f=new Bitmap(this.loader.getContent("jiantou")),79<k?(f.x=c+0.5*l-19,f.y=k-79):(f.setTransform(null,null,null,null,180,null,null,null,null),f.x=c+l+19-0.5*l,f.y=k+79+
m),this.stage.addChild(f),e.onPress=function(){b.arrowClick=!0;b.dispatchEvent({type:app.view.system.NewPlayerGuideView.NEXT,target:this,data:b.guideData})};this.guideDiv[app.Event.ONMOUSE_DOWN]=function(c){if("cancelBtn"!=c.target.id)null==b.guideData.arrowPos&&!1==b.arrowClick?b.dispatchEvent({type:app.view.system.NewPlayerGuideView.NEXT,target:this,data:b.guideData}):b.arrowClick=!1};this.guideDiv[app.Event.ONMOVE]=null;this.stage.update()},setTicker:function(b){b?Ticker.addListener(this):Ticker.removeListener(this)},
viewVisble:function(b){this.guideDiv.style.display=!0==b?"block":"none"},cancelStep:function(){this.dispatchEvent({type:app.view.system.NewPlayerGuideView.CLOSE,target:this})},depose:function(){this.body.removeChild(this.guideDiv);this.setTicker(!1);this.stage.removeAllChildren();this.stage.update()}},{CLOSE:"NewPlayerGuide_close",NEXT:"NewPlayerGuide_next"});puremvc.define({name:"app.view.system.Menu",constructor:function(b,c,e,f){this.handler=f;this.loader=e;this.init(b,c)}},{init:function(b,c){this.depose();this.container=document.createElement("div");this.container.style.position="absolute";this.container.style.display="block";this.container.style["pointer-events"]="auto";for(var e=this,f=0;f<b.length;f++){var g=document.createElement("div");g.className="topMenuBtn";g[app.Event.ONCLICK]=ClassUtils.delegate(this,function(c,f){e.handler(b[f]);c.stopPropagation();
this.handler=null},f);g.innerHTML=b[f];0<c[f]&&g.appendChild(this.smallMenuShow(f));this.container.appendChild(g)}return this.container},smallMenuShow:function(b){this["smallShow"+b]&&this["smallShow"+b].depose();this["smallShow"+b]=null;y=30*b-2;x=-2;this["smallShow"+b]=app.view.AnimateCanvas.createIcon(this.loader,"uieff_10",x,y);this["smallShow"+b].play();return this["smallShow"+b].canvas},depose:function(){if(this.container){var b=this.container.querySelectorAll("div");if(b&&0<b.length)for(var c=
0;c<b.length;c++)b[c][app.Event.ONCLICK]=null,this["smallShow"+c]&&(this["smallShow"+c].depose(),this["smallShow"+c]=null);this.container.parentNode&&this.container.parentNode.removeChild(this.container);this.container=null}}},{});puremvc.define({name:"app.view.system.RankView",parent:app.view.base.TabContentView,constructor:function(b){app.view.base.TabContentView.call(this,b.getContent("tabContent"));this.init(b)}},{rankData:null,idx:0,init:function(b){this.append("\u653b\u51fb\u503c",b.getContent("rankTab"));this.append("\u7b49\u7ea7");this.title.innerHTML="\u6392\u884c";$("tab_bottom").style.display="none";this.rankTit_html=$("rankTit");this.rankList1_html=$("rankList1");this.infoLab_html=$("infoLab");this.html_rank_container=
$("rank_container");this.moveBarImg=$("dg_active01")},setData:function(b){this.rankData=b},append:function(b,c){this.tabBar&&(this.tabBar.appendTab(b),c&&this.viewStack.appendView(c))},layout:function(){if(this.rankData){var b,c,e,f,g,h;this.rankList1_html.innerHTML="";this.rankTit_html.innerHTML="";if(0==this.idx)if(this.infoLab_html.innerHTML="\u51fb\u8d25\u654c\u56fd\u7684\u6b21\u6570\u8d8a\u591a\uff0c\u5219\u653b\u51fb\u503c\u8d8a\u9ad8",this.rankData.hasOwnProperty("attack")&&0<this.rankData.attack.length){e=
document.createDocumentFragment();f=document.createElement("tr");f.style.backgroundColor="#523c1a";f.innerHTML='<td width="53px" class="tb_border">\u540d\u6b21</td><td width="100px" class="tb_border">\u540d\u79f0</td><td width="64px" class="tb_border">\u56fd\u5bb6</td><td width="97px" class="fc4">\u653b\u51fb\u503c</td>';e.appendChild(f);this.rankTit_html.appendChild(e);e=document.createDocumentFragment();c=this.rankData.attack.length;for(b=0;b<c;b++)g=this.rankData.attack[b],h=b+1,f=document.createElement("tr"),
f.style.color=3>=h?"#fffb88":"#ffffff",f.innerHTML='<td width="53px" class="tb_border">'+h+'</td><td width="100px" class="tb_border" style="text-decoration:underline">'+g.name+'</td><td width="64px" class="tb_border">'+g.country+'</td><td width="97px">'+g.value+"</td>",f.getElementsByTagName("td")[1].addEventListener(app.Event.MOUSE_DOWN,ClassUtils.delegate(this,this.playerInfo,g.rid)),e.appendChild(f);this.rankList1_html.appendChild(e)}else this.rankList1_html.innerHTML="\u6392\u884c\u699c\u6b63\u5728\u7edf\u8ba1\u4e2d\uff0c\u8bf7\u7a0d\u540e\u67e5\u770b";
else if(1==this.idx)if(this.infoLab_html.innerHTML="\u73a9\u5bb6\u7b49\u7ea7\u8d8a\u9ad8\uff0c\u6392\u540d\u8d8a\u9ad8",this.rankData.hasOwnProperty("level")&&0<this.rankData.level.length){e=document.createDocumentFragment();f=document.createElement("tr");f.style.backgroundColor="#523c1a";f.innerHTML='<td width="93px" class="tb_border">\u540d\u6b21</td><td width="100px" class="tb_border">\u540d\u79f0</td><td width="64px" class="tb_border">\u56fd\u5bb6</td><td width="97px" class="fc4">\u7b49\u7ea7</td>';
e.appendChild(f);this.rankTit_html.appendChild(e);e=document.createDocumentFragment();c=this.rankData.level.length;for(b=0;b<c;b++)g=this.rankData.level[b],h=b+1,f=document.createElement("tr"),f.style.color=3>=h?"#fffb88":"#ffffff",f.innerHTML='<td width="93px" class="tb_border">'+h+'</td><td width="100px" class="tb_border" style="text-decoration:underline">'+g.name+'</td><td width="64px" class="tb_border">'+g.country+'</td><td width="97px">'+g.value+"</td>",f.getElementsByTagName("td")[1].addEventListener(app.Event.MOUSE_DOWN,
ClassUtils.delegate(this,this.playerInfo,g.rid)),e.appendChild(f);this.rankList1_html.appendChild(e)}else this.rankList1_html.innerHTML="\u6392\u884c\u699c\u6b63\u5728\u7edf\u8ba1\u4e2d\uff0c\u8bf7\u7a0d\u540e\u67e5\u770b";else if(this.infoLab_html.innerHTML="\u81ea\u52a8\u8bb0\u5f55\u73a9\u5bb6\u51fa\u6218\u65f6\u7684\u5386\u53f2\u6700\u9ad8\u6218\u529b",this.rankData.hasOwnProperty("power")&&0<this.rankData.power.length){e=document.createDocumentFragment();f=document.createElement("tr");f.style.backgroundColor=
"#1e1e1c";f.innerHTML='<td width="93px" class="tb_border">\u540d\u6b21</td><td width="100px" class="tb_border">\u540d\u79f0</td><td width="64px" class="tb_border">\u56fd\u5bb6</td><td width="97px" class="fc4">\u6218\u529b</td>';e.appendChild(f);this.rankTit_html.appendChild(e);e=document.createDocumentFragment();c=this.rankData.power.length;for(b=0;b<c;b++)g=this.rankData.power[b],h=b+1,f=document.createElement("tr"),f.style.color=3>=h?"#fffb88":"#ffffff",f.innerHTML='<td width="93px" class="tb_border">'+
h+'</td><td width="100px" class="tb_border" style="text-decoration:underline">'+g.name+'</td><td width="64px" class="tb_border">'+g.country+'</td><td width="97px">'+g.value+"</td>",f.getElementsByTagName("td")[1].addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.playerInfo,g.rid)),e.appendChild(f);this.rankList1_html.appendChild(e)}else this.rankList1_html.innerHTML="\u6392\u884c\u699c\u6b63\u5728\u7edf\u8ba1\u4e2d\uff0c\u8bf7\u7a0d\u540e\u67e5\u770b";if(""!=this.rankList1_html.innerHTML){var j=
this,k=this.html_rank_container;this.moveBarImg.style.display=j.rankList1_html.clientHeight<=k.clientHeight?"none":"inline";this.scroller?this.scroller.update(k.clientWidth,k.clientHeight,j.rankList1_html.clientWidth,j.rankList1_html.clientHeight):this.scroller=new app.view.base.ScrollView(function(b,c){j.rankList1_html.style["-webkit-transform"]="translateY("+-c+"px)";j.rankList1_html.clientHeight>k.clientHeight&&(j.moveBarImg.style["-webkit-transform"]="translateY("+150*(c/(j.rankList1_html.clientHeight-
k.clientHeight))+"px)")},k.clientWidth,k.clientHeight,j.rankList1_html.clientWidth,j.rankList1_html.clientHeight,j.rankList1_html)}}},playerInfo:function(b,c){var e=this,f=0;b.target[app.Event.ONMOVE]=function(){f=1};b.target[app.Event.ONMOUSE_UP]=function(){0==f&&e.dispatchEvent({type:app.view.system.RankView.SHOW_PLAYERINFO,target:this,data:c})}},tabChange:function(b){app.view.base.TabContentView.prototype.tabChange.call(this,0);this.idx=b;this.layout()},depose:function(){this.dispatchEvent({type:app.view.system.RankView.CLOSE,
target:this});app.view.base.TabContentView.prototype.depose.call(this)}},{CLOSE:"RankView_close",SHOW_PLAYERINFO:"RankView_showPlayerInfo"});puremvc.define({name:"app.view.system.BattleStatusView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!1);this.stages=[];this.liArr=this.view.querySelectorAll("#status>li");b=this.liArr[3].querySelectorAll("canvas");for(i=0;i<b.length;i++)this.stages[i]=new Stage(b[i]),Ticker.addListener(this.stages[i])}},{setData:function(b){var c=b.troopInfo;this.liArr[0].innerHTML="<span>"+c.name+"</span>";var e=this.liArr[1].querySelector("div");e.innerHTML=c.hp+
"/"+c.maxHp;this.setTripSize(e,c.hp/c.maxHp);e=this.liArr[2].querySelector("div");e.innerHTML=c.morale;this.setTripSize(e,c.morale/100);this.updateBuffers(b.buffers)},setTripSize:function(b,c){b.style["background-size"]=100*(1<c?1:c)+"% 100%"},updateBuffers:function(b){if(b){var c;for(c=0;c<this.stages.length;c++)this.stages[c].removeAllChildren();for(c=0;c<b.length;c++){var e=b[c].cloneImage();e.scaleX=this.stages[c].canvas.width/e.image.width;e.scaleY=this.stages[c].canvas.height/e.image.height;
this.stages[c].addChild(e);this.stages[c].update()}}},depose:function(){for(var b=0;b<this.stages.length;b++)this.stages[b].removeAllChildren(),Ticker.removeListener(this.stages[b]);this.stages=null;app.view.base.BaseUIForm.prototype.depose.call(this)}});puremvc.define({name:"app.view.system.WarfareResultView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!1)}},{selfID:null,setData:function(b){var c=this.view.querySelector("#fresult_01"),e=b.header.attackerName,e=b.result?e+"\u83b7\u5f97\u80dc\u5229":e+"\u8fdb\u653b\u5931\u8d25";c.innerHTML=e;c=this.view.querySelectorAll("#result_btns>input");c[0].addEventListener(app.Event.CLICK,this);c[1].addEventListener(app.Event.CLICK,this);if(e=b.rewards[this.selfID])if(c=
this.view.querySelectorAll("#fresult_02>p>span"),b=this.getReward(e,14),c[0].innerHTML=b?b.value:0,b=this.getReward(e,5),c[1].innerHTML=b?b.value:0,c=this.view.querySelector("#spoils"),c.style.display="none",(b=this.getReward(e,10))&&0<e.length)e=app.data.DataBase.getInstance().getItemInfo(b.id),c.style.display="block",c.querySelector("#spoils_img").src=app.GameData.imageSrc+"items/i_"+b.id+".jpg",b=c.querySelector("#spoils_title"),b.innerHTML=e.name,b.className=this.getFontColor(e.qualityId),c.style.display=
"block"},getReward:function(b,c){for(var e=0;e<b.length;e++)if(b[e].tid==c)return b[e]},getFontColor:function(b){return"fc7,fc12,fc4,fc1,fc9,fc3".split(",")[b-1]},handleEvent:function(b){var c=this.view.querySelectorAll("#result_btns>input"),e=app.view.system.BattleResultView;b.target==c[0]?this.dispatchEvent({type:e.REPLAY,target:this}):b.target==c[1]&&this.dispatchEvent({type:e.EXIT,target:this})},depose:function(){var b=this.view.querySelectorAll("#result_btns>input");b[0].removeEventListener(app.Event.CLICK,
this);b[1].removeEventListener(app.Event.CLICK,this);app.view.base.BaseUIForm.prototype.depose.call(this)}},{REPLAY:"replay",EXIT:"exit"});puremvc.define({name:"app.view.system.SmallGameHelpView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0);this.init()}},{init:function(){this.html_sgHelpClose=$("sgHelpClose");this.html_sgHelpClose.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close))},close:function(){this.dispatchEvent({type:app.view.system.SmallGameHelpView.CLOSE,target:this})},depose:function(){this.html_sgHelpClose.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,
this.close));app.view.base.BaseUIForm.prototype.depose.call(this)}},{CLOSE:"SmallGameHelp_close"});puremvc.define({name:"app.view.system.HelpView",parent:app.view.base.BaseUIForm,constructor:function(){app.view.base.BaseUIForm.call(this,app.GameData.GameResource.getContent("help"),!0);this.init()}},{init:function(){this.closeBtn=$("help_close");this.help_moveBtn1=$("help_moveBtn1");this.help_moveBtn2=$("help_moveBtn2");this.help_scroll1=$("help_scroll1");this.closeBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.sendEvent,app.view.system.HelpView.CLOSE);this.help_list=this.view.getElementsByTagName("ul")[0].getElementsByTagName("li");
this.help_content=this.view.getElementsByTagName("ul")[1].getElementsByTagName("li");var b=this,c=[95,192,95,this.help_scroll1.offsetHeight];this.scroller&&this.scroller.depose();this.scroller=null;this.scroller=new app.view.base.ScrollView(function(e,g){b.help_scroll1.style["-webkit-transform"]="translateY("+-g+"px)";b.help_moveBtn1.style["-webkit-transform"]="translateY("+156*(g/(c[3]-c[1]))+"px)"},c[0],c[1],c[2],c[3],this.help_scroll1);this.showItem(null,0);for(var e=0;e<this.help_list.length;e++)this.help_list[e][app.Event.ONCLICK]=
ClassUtils.delegate(this,this.showItem,e)},showItem:function(b,c){for(var e=0;e<this.help_content.length;e++)this.help_content[e].style.display=e==c?"block":"none";var f=this,g=[305,192,305,this.help_content[c].offsetHeight];this.help_moveBtn2.style.visibility=g[3]>g[1]?"visible":"hidden";this.scroller2&&this.scroller2.depose();this.scroller2=null;this.scroller2=new app.view.base.ScrollView(function(b,e){f.help_content[c].style["-webkit-transform"]="translateY("+-e+"px)";g[3]>g[1]&&(f.help_moveBtn2.style["-webkit-transform"]=
"translateY("+156*(e/(g[3]-g[1]))+"px)")},g[0],g[1],g[2],g[3],this.help_content[c])},sendEvent:function(b,c){this.dispatchEvent({type:c,target:this})}},{CLOSE:"help_close"});puremvc.define({name:"app.view.building.StrategyView",parent:app.view.base.TabContentView,constructor:function(b,c){app.view.base.TabContentView.call(this,b.getContent("tabContent"));app.controller.TimeController.getInstance().addListener(this);this.init(b,c)}},{init:function(b){this.append("\u79d1\u6280",b.getContent("strategy1"));this.append("\u9635\u6cd5",b.getContent("strategy2"));for(b=1;b<=this.viewStack.contents.length;b++)this["strategyList_html"+b]=$("strategyList"+b),this["html_levelUpBtn"+
b]=$("levelUpBtn"+b),this["html_strategyName"+b]=$("strategyName"+b),this["html_strategyLev"+b]=$("strategyLev"+b),this["html_strategyReq"+b]=$("strategyReq"+b),this["html_strategyContribution"+b]=$("strategyContribution"+b),this["html_strategyTime"+b]=$("strategyTime"+b),this["html_strategyDesc"+b]=$("strategyDesc"+b),this["html_strategyCd_btn"+b]=$("strategyCd_btn"+b),this["html_cdLab"+b]=$("cdLab"+b),this["html_strategyCd_btn"+b].addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.clearCd)),
this["html_levelUpBtn"+b].addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.levelUpHandler))},clearCd:function(){this.dispatchEvent({type:app.view.building.StrategyView.CLEAR_CD,target:this})},step:function(){this.showIndicateTime()},setData:function(b,c,e){this.strategyData=b;this.idx=e;this.buildLv=c;this.title.innerHTML="\u7b56\u7565\u5e9c("+c+"\u7ea7)";this.tradeIndex=this.formationIndex=this.technologyIndex=null},layout:function(){for(var b,c,e,f,g,h,j=this.idx+1,k=0;k<this.viewStack.contents.length;k++)this.viewStack.contents[k].style.display=
k==this.idx?"block":"none";this["strategyList_html"+j].innerHTML="";this["html_strategyName"+j].innerHTML="";this["html_strategyLev"+j].innerHTML="";this["html_strategyReq"+j].innerHTML="";this["html_strategyContribution"+j].innerHTML="";this["html_strategyTime"+j].innerHTML="";this["html_strategyDesc"+j].innerHTML="";h=0==this.idx?this.strategyData.technologys:1==this.idx?this.strategyData.formations:this.strategyData.trade;this.showIndicateTime();if(h&&0<h.length){b=h.length;e=document.createDocumentFragment();
for(k=0;k<b;k++)g=h[k],f=this.buildLv>=g.conf.minLevel?"images/tech/f_"+g.id+".gif":"images/tech/fk_"+g.id+".gif",c=document.createElement("li"),c.innerHTML=' <div class="qmImg_01"><div class="qmImg_02" style="background-image:url('+f+' )"><img src="images/ui/xuan_02.png" width="47" height="47" style="display:none" /></div></div>',this.buildLv>=g.conf.minLevel&&c.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.clickHandler,k)),e.appendChild(c);this["strategyList_html"+j].appendChild(e);
0==this.idx?this.technologyIndex?this.itemSelect(this.technologyIndex):(this.technologyIndex=0,this.itemSelect(0)):1==this.idx?this.formationIndex?this.itemSelect(this.formationIndex):(this.formationIndex=0,this.itemSelect(0)):this.tradeIndex?this.itemSelect(this.tradeIndex):(this.tradeIndex=0,this.itemSelect(0))}},showIndicateTime:function(){var b=this.idx+1;if(!this.strategyData||!this.strategyData.hasOwnProperty("cdTime")||!this.strategyData.cdTime||!this.strategyData.cdTime.time)this["html_strategyCd_btn"+
b].style.visibility="hidden",this["html_cdLab"+b].innerHTML="";else{var c=this.strategyData.cdTime.time.getTime();0<c?(this["html_strategyCd_btn"+b].style.visibility="visible",this["html_cdLab"+b].innerHTML=this.strategyData.cdTime.time.toString(),this["html_strategyCd_btn"+b].disabled=0>=c):(this["html_strategyCd_btn"+b].style.visibility="hidden",this["html_cdLab"+b].innerHTML="")}},clickHandler:function(b,c){if(0==this.idx){if(this.technologyIndex!=c)this.technologyIndex=c,this.itemSelect(c)}else if(1==
this.idx){if(this.formationIndex!=c)this.formationIndex=c,this.itemSelect(c)}else if(this.tradeIndex!=c)this.tradeIndex=c,this.itemSelect(c)},itemSelect:function(b){var c,e,f;f=0==this.idx?this.strategyData.technologys[b]:1==this.idx?this.strategyData.formations[b]:this.strategyData.trade[b];var g=this.idx+1;c=this["strategyList_html"+g].getElementsByTagName("li");for(var h=0;h<c.length;h++)h==b?(e=c[h].getElementsByTagName("img"),e[0].style.display=this.buildLv>=f.conf.minLevel?"inline":"none"):
(e=c[h].getElementsByTagName("img"),e[0].style.display="none");this.buildLv>=f.conf.minLevel?(this.selectedStrategy=f,this.loadStraInfo(),this["html_levelUpBtn"+g].style.display="block"):this["html_levelUpBtn"+g].style.display="none"},loadStraInfo:function(){var b=this.idx+1;if(this.selectedStrategy&&(this["html_strategyName"+b].innerHTML=this.selectedStrategy.conf.name,this["html_strategyLev"+b].innerHTML=this.selectedStrategy.level,this.reqLevel=(this.selectedStrategy.level+1)*this.selectedStrategy.conf.intervalLevel,
this["html_strategyReq"+b].className=this.buildLv>=this.reqLevel?"none":"fc9",this["html_strategyReq"+b].innerHTML="\u9650\u5236\u7b56\u7565\u5e9c"+this.reqLevel+"\u7ea7",this.reqContribution=(this.selectedStrategy.level+1)*this.selectedStrategy.conf.contribution,this["html_strategyContribution"+b].innerHTML=this.reqContribution+"\u6218\u529f",this["html_strategyTime"+b].innerHTML=app.data.TimeVO.formatTime(6E4*(this.selectedStrategy.level+1)),this["html_strategyDesc"+b].innerHTML=this.selectedStrategy.conf.description,
this.strategyData.cdTime))this["html_cdLab"+b].className=!0==this.strategyData.cdTime.full?"fc6":"fc4"},updateStraInfo:function(){this.showIndicateTime();this.selectedStrategy=0==this.idx?this.strategyData.technologys[this.technologyIndex]:1==this.idx?this.strategyData.formations[this.formationIndex]:this.strategyData.trade[this.tradeIndex];this.loadStraInfo()},levelUpHandler:function(){this.dispatchEvent({type:app.view.building.StrategyView.LEVEL_UP,target:this,data:this.selectedStrategy})},showUserInfo:function(b){this.userData=
b;var c=this.bottom.getElementsByTagName("span");c[0].innerHTML="\u91d1\u5e01\uff1a"+b.goldCoin;c[0].className="fc1";c[1].innerHTML="\u6218\u529f\uff1a"+b.feat},tabChange:function(b){app.view.base.TabContentView.prototype.tabChange.call(this,0);this.idx=b;this.layout()},depose:function(){this.dispatchEvent({type:app.view.building.StrategyView.CLOSE});for(var b=1;b<=this.viewStack.contents.length;b++)this["html_strategyCd_btn"+b].removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.clearCd)),
this["html_levelUpBtn"+b].removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.levelUpHandler));app.controller.TimeController.getInstance().removeListener(this);app.view.base.TabContentView.prototype.depose.call(this);this.strategyData=null}},{LEVEL_UP:"StrategyView_levelUp",CLEAR_CD:"StrategyView_clearCD",CLOSE:"StrategyView_close"});puremvc.define({name:"app.view.building.FolkHouseView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("folkHouse"),!0);b=this.view.querySelector("#building_img");b.width=170;b.height=100;this.stage=new Stage(b);this.init()}},{init:function(){this.html_dlg_title=$("dlg_title");this.html_dlg_title.innerHTML="\u6c11\u5c45";this.html_patroBtn=$("patroBtn");this.html_patroBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.showPatrol));
this.html_levelup_btn=$("levelup_btn");this.html_levelup_btn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.levelUpHandler));this.html_dlg_close=$("dlg_close");this.html_dlg_close.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_build_title=$("build_title");this.html_build_info=$("build_info");this.html_build_cue=$("build_cue");this.html_needMoney=$("needMoney");this.html_needTime=$("needTime")},setData:function(b,c,e,f){this.info=f;this.buildData=b;
this.userData=e;this.hallLev=c;this.setBuildingImage(this.info.content);this.layout()},layout:function(){this.html_patroBtn.style.display=45<=this.hallLev?"block":"none";this.html_build_title.innerHTML=this.info.name+"("+this.buildData.level+"\u7ea7)";this.html_build_info.innerHTML=this.info.descript[0];this.html_needMoney.innerHTML=this.buildData.needMoney;this.html_needTime.innerHTML=app.data.TimeVO.formatTime(1E3*this.buildData.needTime)},close:function(){this.dispatchEvent({type:app.view.building.FolkHouseView.CLOSE,
target:this})},levelUpHandler:function(){this.dispatchEvent({type:app.view.building.FolkHouseView.LEVEL_UP,target:this,data:this.buildData})},updateInfo:function(b){this.buildData=b;this.layout()},setBuildingImage:function(b){if(this.stage)this.stage.removeAllChildren(),this.building=new Bitmap(b),this.building.x=0.5*(this.stage.canvas.width-b.width),this.building.y=0.5*(this.stage.canvas.height-b.height),this.stage.addChild(this.building),Ticker.setFPS(20),Ticker.addListener(this.stage)},setFlag:function(b){var c=
b.getContent("levelup_data");c.images=[b.getContent("levelup")];b=new BitmapAnimation(new SpriteSheet(c));b.regX=0.5*c.frames.width;b.regY=c.frames.height;b.x=0.5*this.stage.canvas.width-10;b.y=this.stage.canvas.height;b.onAnimationEnd=function(b){b.gotoAndStop(1);b.visible=!1};this.stage.addChild(b);this.flagMovie=b},showLevelUP:function(){this.flagMovie.visible=!0;this.flagMovie.gotoAndPlay(1)},showPatrol:function(){this.dispatchEvent({type:app.view.building.FolkHouseView.SHOW_PATROL,target:this})},
depose:function(){this.stage&&Ticker.removeListener(this.stage);this.html_levelup_btn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.levelUpHandler));this.html_dlg_close.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_patroBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.showPatrol));app.view.base.BaseUIForm.prototype.depose.call(this)}},{NAME:"FolkHouseView",LEVEL_UP:"FolkHouse_levelUp",CLOSE:"FolkHouse_close",SHOW_PATROL:"FolkHouse_show_patrol"});puremvc.define({name:"app.view.building.AppointAccView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0);var c=this;$("appointAcc_close")[app.Event.ONCLICK]=function(){c.dispatchEvent({type:app.view.building.AppointAccView.CLOSE,target:c})}}},{acc:null,setData:function(b){this.acc=[];this.acc=b;this.init()},init:function(){var b=$("appointAcc0"),c=b.innerHTML="",e,f;f=document.createDocumentFragment();for(var g=0;g<this.acc.length;g++)e=document.createElement("div"),
c=this.acc[g].n>=this.acc[g].c?"fc4":"fc9",c='<div class="wpJg_02" text-align="center"><img src="images/items/i_'+this.acc[g].conId+'.jpg" width="47" height="47" /><p class="fc5" style="text-align:center;">'+this.acc[g].name+'</p></div><p style="height:28px; text-align:center;" class="'+c+'">'+this.acc[g].n+"/"+this.acc[g].c+"</p>",e.innerHTML=c,e.className="wpJg_01",this.acc[g].n>=this.acc[g].c&&(e[app.Event.ONCLICK]=ClassUtils.delegate(this,this.appointGet,this.acc[g])),f.appendChild(e);b.appendChild(f)},
appointGet:function(b,c){this.dispatchEvent({type:app.view.building.AppointAccView.GET,target:this,data:c})}},{GET:"appoint_getItem",CLOSE:"appointAcc_close"});puremvc.define({name:"app.view.building.MarketContentView",constructor:function(b){this.callFunc=b;this.init()}},{init:function(){this.canMove=!1},setDiabaleView:function(b){$("reduce_0"+b).style.backgroundImage="url(images/ui/ico_08.gif)";$("plus_0"+b).style.backgroundImage="url(images/ui/ico_10.gif)";$("add_0"+b).style.backgroundImage="url(images/ui/ico_12.gif)";$("mBtn_0"+b).style.backgroundImage="url(images/ui/btnbg_02.png)";$("mBtn_0"+b).style.color="#b2b0ad";$("minBtn_0"+b).style.backgroundImage=
"url(images/ui/btn_10.png)";$("maxBtn_0"+b).style.backgroundImage="url(images/ui/btn_10.png)"},setAbleView:function(b){$("reduce_0"+b).style.backgroundImage="url(images/ui/ico_07.gif)";$("plus_0"+b).style.backgroundImage="url(images/ui/ico_09.gif)";$("add_0"+b).style.backgroundImage="url(images/ui/ico_11.gif)";$("mBtn_0"+b).style.backgroundImage="url(images/ui/btnbg_01.png)";$("mBtn_0"+b).style.color="#eaca67";$("minBtn_0"+b).style.backgroundImage="url(images/ui/btn_09.png)";$("maxBtn_0"+b).style.backgroundImage=
"url(images/ui/btn_09.png)"},setInEvents:function(){$("add_01")[app.Event.ONMOUSE_DOWN]=this.handlerFun_01;$("minBtn_01")[app.Event.ONCLICK]=this.handlerFun_02;$("maxBtn_01")[app.Event.ONCLICK]=this.handlerFun_03;$("reduce_01")[app.Event.ONCLICK]=this.handlerFun_04;$("plus_01")[app.Event.ONCLICK]=this.handlerFun_05;$("content_01")[app.Event.ONMOVE]=this.handlerFun_06;$("content_01")[app.Event.ONMOUSE_UP]=this.handlerFun_07;$("mBtn_01")[app.Event.ONCLICK]=this.handlerFun_08},setOutEvents:function(){$("add_02")[app.Event.ONMOUSE_DOWN]=
this.handlerFun_09;$("minBtn_02")[app.Event.ONCLICK]=this.handlerFun_10;$("maxBtn_02")[app.Event.ONCLICK]=this.handlerFun_11;$("reduce_02")[app.Event.ONCLICK]=this.handlerFun_12;$("plus_02")[app.Event.ONCLICK]=this.handlerFun_13;$("content_02")[app.Event.ONMOVE]=this.handlerFun_14;$("content_02")[app.Event.ONMOUSE_UP]=this.handlerFun_07;$("mBtn_02")[app.Event.ONCLICK]=this.handlerFun_15},setHeiEvents:function(){$("add_03")[app.Event.ONMOUSE_DOWN]=this.handlerFun_16;$("minBtn_03")[app.Event.ONCLICK]=
this.handlerFun_17;$("maxBtn_03")[app.Event.ONCLICK]=this.handlerFun_18;$("reduce_03")[app.Event.ONCLICK]=this.handlerFun_19;$("plus_03")[app.Event.ONCLICK]=this.handlerFun_20;$("content_03")[app.Event.ONMOVE]=this.handlerFun_21;$("content_03")[app.Event.ONMOUSE_UP]=this.handlerFun_07;$("mBtn_03")[app.Event.ONCLICK]=this.handlerFun_22},removeEvents:function(b){$("add_0"+b)[app.Event.ONMOUSE_DOWN]=null;$("minBtn_0"+b)[app.Event.ONCLICK]=null;$("maxBtn_0"+b)[app.Event.ONCLICK]=null;$("reduce_0"+b)[app.Event.ONCLICK]=
null;$("plus_0"+b)[app.Event.ONCLICK]=null;$("content_0"+b)[app.Event.ONMOVE]=null;$("content_0"+b)[app.Event.ONMOUSE_UP]=null;$("mBtn_0"+b)[app.Event.ONCLICK]=null},handler:function(b,c){this.canMove=!0;this.tx=$(c).offsetLeft;this.dx=null!=b.clientX?b.clientX:b.touches[0].pageX},handler_01:function(b,c,e,f,g,h,j,k,l){if(this.canMove){var c=$(c),e=document.getElementById(e),m=66,b=null!=b.clientX?b.clientX:b.touches[0].pageX;66<=m&&249>=m&&(m=this.tx+b-this.dx);249<m&&(m=249);66>m&&(m=66);c.style.left=
m+"px";e.style.width=m-66+"px";2==j?$(f).innerHTML=Math.round((l-k)*(m-66)/183):h.maxTrade-h.traded>=l-k&&0==j?$(f).innerHTML=Math.round((l-k)*(m-66)/183):$(f).innerHTML=1==j&&h.traded+k<=h.maxTrade?Math.round(k*(m-66)/183):Math.round((h.maxTrade-h.traded)*(m-66)/183);if(0==j||1==j)$(g).innerHTML=Math.round($(f).innerHTML*h.rate/100);else if(2==j)$(g).innerHTML=Math.round(2*$(f).innerHTML*h.rate/100)}},handler_02:function(){this.canMove=!1},handler_03:function(b,c,e,f,g){$(c).style.left="66px";$(e).style.width=
0;$(f).innerHTML=0;$(g).innerHTML=0},handler_04:function(b,c,e,f,g,h,j,k,l){$(c).style.left="249px";$(e).style.width="215px";2==j?$(f).innerHTML=l-k:h.maxTrade-h.traded>=l-k&&0==j?$(f).innerHTML=l-k:$(f).innerHTML=1==j&&h.traded+k<=h.maxTrade?k:h.maxTrade-h.traded;if(0==j||1==j)$(g).innerHTML=Math.round($(f).innerHTML*h.rate/100);else if(2==j)$(g).innerHTML=Math.round(2*$(f).innerHTML*h.rate/100)},handler_05:function(b,c,e,f,g,h,j,k,l){b=parseInt($(c).style.left.slice(0,-2));71<=b?($(c).style.left=
b-5+"px",$(e).style.width=b-66+"px",2==j?$(f).innerHTML=Math.round((l-k)*(b-71)/183):h.maxTrade-h.traded>=l-k&&0==j?$(f).innerHTML=Math.round((l-k)*(b-71)/183):$(f).innerHTML=1==j&&h.traded+k<=h.maxTrade?Math.round(k*(b-71)/183):Math.round((h.maxTrade-h.traded)*(b-71)/183)):($(f).innerHTML=0,$(c).style.left="66px",$(e).style.width=0);if(0==j||1==j)$(g).innerHTML=Math.round($(f).innerHTML*h.rate/100);else if(2==j)$(g).innerHTML=Math.round(2*$(f).innerHTML*h.rate/100)},handler_06:function(b,c,e,f,g,
h,j,k,l){b=parseInt($(c).style.left.slice(0,-2));244>=b?($(c).style.left=b+5+"px",$(e).style.width=b-61+"px",2==j?$(f).innerHTML=Math.round((l-k)*(b-61)/183):h.maxTrade-h.traded>=l-k&&0==j?$(f).innerHTML=Math.round((l-k)*(b-61)/183):$(f).innerHTML=1==j&&h.traded+k<=h.maxTrade?Math.round(k*(b-61)/183):Math.round((h.maxTrade-h.traded)*(b-61)/183)):(2==j?$(f).innerHTML=l-k:h.maxTrade-h.traded>=l-k&&0==j?$(f).innerHTML=l-k:$(f).innerHTML=1==j&&h.traded+k<=h.maxTrade?k:h.maxTrade-h.traded,$(c).style.left=
"249px",$(e).style.width="215px");if(0==j||1==j)$(g).innerHTML=Math.round($(f).innerHTML*h.rate/100);else if(2==j)$(g).innerHTML=Math.round(2*$(f).innerHTML*h.rate/100)},tradeBtn:function(b,c){var e={},f=0;if(0==c)f=$("lab_06").innerHTML;else if(1==c)f=$("lab_08").innerHTML;else if(2==c)f=$("lab_10").innerHTML;e.foodCount=parseInt(f);e.tradeType=c;this.callFunc({type:app.view.building.MarketContentView.Trade,target:this,data:e})},setData:function(b,c){this.marketData=b;this.userInfo=c;this.grainData=
this.userInfo.grain;this.maxGrainData=this.userInfo.maxGrain;this.handlerList();this.updateView()},handlerList:function(){this.handlerFun_01=ClassUtils.delegate(this,this.handler,"add_01");this.handlerFun_02=ClassUtils.delegate(this,this.handler_03,"add_01","pro_01","lab_06","lab_07");this.handlerFun_03=ClassUtils.delegate(this,this.handler_04,"add_01","pro_01","lab_06","lab_07",this.marketData,0,this.grainData,this.maxGrainData);this.handlerFun_04=ClassUtils.delegate(this,this.handler_05,"add_01",
"pro_01","lab_06","lab_07",this.marketData,0,this.grainData,this.maxGrainData);this.handlerFun_05=ClassUtils.delegate(this,this.handler_06,"add_01","pro_01","lab_06","lab_07",this.marketData,0,this.grainData,this.maxGrainData);this.handlerFun_06=ClassUtils.delegate(this,this.handler_01,"add_01","pro_01","lab_06","lab_07",this.marketData,0,this.grainData,this.maxGrainData);this.handlerFun_07=ClassUtils.delegate(this,this.handler_02);this.handlerFun_08=ClassUtils.delegate(this,this.tradeBtn,0);this.handlerFun_09=
ClassUtils.delegate(this,this.handler,"add_02");this.handlerFun_10=ClassUtils.delegate(this,this.handler_03,"add_02","pro_02","lab_08","lab_09");this.handlerFun_11=ClassUtils.delegate(this,this.handler_04,"add_02","pro_02","lab_08","lab_09",this.marketData,1,this.grainData,this.maxGrainData);this.handlerFun_12=ClassUtils.delegate(this,this.handler_05,"add_02","pro_02","lab_08","lab_09",this.marketData,1,this.grainData,this.maxGrainData);this.handlerFun_13=ClassUtils.delegate(this,this.handler_06,
"add_02","pro_02","lab_08","lab_09",this.marketData,1,this.grainData,this.maxGrainData);this.handlerFun_14=ClassUtils.delegate(this,this.handler_01,"add_02","pro_02","lab_08","lab_09",this.marketData,1,this.grainData,this.maxGrainData);this.handlerFun_15=ClassUtils.delegate(this,this.tradeBtn,1);this.handlerFun_16=ClassUtils.delegate(this,this.handler,"add_03");this.handlerFun_17=ClassUtils.delegate(this,this.handler_03,"add_03","pro_03","lab_10","lab_10");this.handlerFun_18=ClassUtils.delegate(this,
this.handler_04,"add_03","pro_03","lab_10","lab_11",this.marketData,2,this.grainData,this.maxGrainData);this.handlerFun_19=ClassUtils.delegate(this,this.handler_05,"add_03","pro_03","lab_10","lab_11",this.marketData,2,this.grainData,this.maxGrainData);this.handlerFun_20=ClassUtils.delegate(this,this.handler_06,"add_03","pro_03","lab_10","lab_11",this.marketData,2,this.grainData,this.maxGrainData);this.handlerFun_21=ClassUtils.delegate(this,this.handler_01,"add_03","pro_03","lab_10","lab_11",this.marketData,
2,this.grainData,this.maxGrainData);this.handlerFun_22=ClassUtils.delegate(this,this.tradeBtn,2)},updateView:function(){var b=this.marketData,c=this.userInfo;$("lab_01").innerHTML=b.rate/100;$("lab_01").className=$("lab_02").className=1==b.up?"fc4":"fc9";$("lab_02").innerHTML=1==b.up?"(\u4e0a\u5347\u4e2d)":"(\u4e0b\u964d\u4e2d)";$("lab_03").innerHTML=2*b.rate/100;$("lab_04").innerHTML=b.traded;$("lab_05").innerHTML=b.maxTrade;c.grain<c.maxGrain?(this.setAbleView(3),this.setHeiEvents(),b.traded<b.maxTrade?
(this.setAbleView(1),this.setInEvents(),0==c.grain?(this.setDiabaleView(2),this.removeEvents(2)):(this.setAbleView(2),this.setOutEvents())):(this.setDiabaleView(1),this.setDiabaleView(2),this.removeEvents(1),this.removeEvents(2))):(this.setDiabaleView(3),this.removeEvents(3),this.setDiabaleView(1),this.removeEvents(1),b.traded<b.maxTrade?(this.setAbleView(2),this.setOutEvents()):(this.setDiabaleView(2),this.removeEvents(2)))},depose:function(){this.callFunc({type:app.view.building.MarketContentView.CLOSE,
target:this});app.view.base.BaseUIForm.prototype.depose.call(this)}},{CLOSE:"MarketContentView_CLOSE",Trade:"Trade"});puremvc.define({name:"app.view.building.TradingCompView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("tradingComp"),!0);b=this.view.querySelector("#building_img");b.width=170;b.height=100;this.stage=new Stage(b);this.init()}},{init:function(){this.html_dlg_title=$("dlg_title");this.html_dlg_title.innerHTML="\u5546\u884c";this.html_productBtn=$("productBtn");this.html_productBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.productDetail));
this.html_levelup_btn=$("levelup_btn");this.html_levelup_btn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.levelUpHandler));this.html_dlg_close=$("dlg_close");this.html_dlg_close.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_build_title=$("build_title");this.html_build_info=$("build_info");this.html_build_cue=$("build_cue");this.html_needMoney=$("needMoney");this.html_needTime=$("needTime")},setData:function(b,c,e){this.info=b;this.buildData=c;this.userData=
e;this.setBuildingImage(this.info.content);this.layout()},layout:function(){this.html_build_title.innerHTML=this.info.name+"("+this.buildData.level+"\u7ea7)";this.html_build_info.innerHTML=this.info.descript[0];this.html_build_cue.innerHTML=this.info.descript[1];this.html_needMoney.innerHTML=this.buildData.needMoney;this.html_needTime.innerHTML=app.data.TimeVO.formatTime(1E3*this.buildData.needTime)},close:function(){this.dispatchEvent({type:app.view.building.TradingCompView.CLOSE,target:this})},
levelUpHandler:function(){this.dispatchEvent({type:app.view.building.TradingCompView.LEVEL_UP,target:this,data:this.buildData})},updateInfo:function(b){this.buildData=b;this.layout()},setBuildingImage:function(b){if(this.stage){this.stage.removeAllChildren();this.building=new Bitmap(b);var c=this.stage.canvas.width/b.width;c*b.height>this.stage.canvas.height&&(c=this.stage.canvas.height/b.height);this.building.scaleX=this.building.scaleY=c;this.building.x=0.5*(this.stage.canvas.width-b.width*c);this.building.y=
0.5*(this.stage.canvas.height-b.height*c);this.stage.addChild(this.building);Ticker.setFPS(20);Ticker.addListener(this.stage)}},setFlag:function(b){var c=b.getContent("levelup_data");c.images=[b.getContent("levelup")];b=new BitmapAnimation(new SpriteSheet(c));b.regX=0.5*c.frames.width;b.regY=c.frames.height;b.x=0.5*this.stage.canvas.width-10;b.y=this.stage.canvas.height;b.onAnimationEnd=function(b){b.gotoAndStop(1);b.visible=!1};this.stage.addChild(b);this.flagMovie=b},showLevelUP:function(){this.flagMovie.visible=
!0;this.flagMovie.gotoAndPlay(1)},productDetail:function(){this.dispatchEvent({type:app.view.building.TradingCompView.SHOW_DETAIL,target:this,data:this.buildData.level})},depose:function(){this.stage&&Ticker.removeListener(this.stage);this.html_levelup_btn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.levelUpHandler));this.html_dlg_close.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_productBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,
this.productDetail));app.view.base.BaseUIForm.prototype.depose.call(this)}},{LEVEL_UP:"TradingCompView_levelUp",CLOSE:"TradingCompView_close",SHOW_DETAIL:"TradingCompView_show_detail"});puremvc.define({name:"app.view.building.WorkShopView",constructor:function(b){app.controller.TimeController.getInstance().addListener(this);this.callFunc=b;this.init()}},{workShopData:null,hallLev:null,critChxB:0,selectedIndex:null,selectedGood:null,init:function(){this.html_goodsList=$("goodsList");this.html_money=$("tab_bottom");this.html_forceCdBtn=$("forceCdBtn");this.html_forceProBtn=$("forceProBtn");this.html_sellBtn=$("sellBtn");this.html_proBtn=$("proBtn");this.html_critBtn=$("critBtn");this.html_remainProduceNum=
$("remainProduceNum");this.htnl_forceGoldNeeded=$("forceGoldNeeded");this.html_coolTime=$("coolTime");this.html_critBtn=$("critBtn");this.html_forceCdBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.forceCdHandler));this.html_forceProBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.forceProHandler));this.html_sellBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.sellHandler));this.html_proBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,
this.proHandler));this.html_critBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.critHandler))},setData:function(b,c){this.workShopData=b;this.coolTime=c;this.layout()},layout:function(){this.workShopData&&(this.updateGoodList(),this.updateSelectInfo())},updateGoodList:function(){if(this.workShopData.goods){this.html_goodsList.innerHTML="";var b,c,e,f,g,h;f=document.createDocumentFragment();b=this.workShopData.goods.length;for(e=0;e<b;e++){c=new app.data.WorkShopGoodsVO(this.workShopData.goods[e]);
g=document.createElement("div");g.id=c.id;g.className="content_box";g.style.width="127px";g.style.height="91px";g.style.marginRight="9px";g.style["float"]="left";if(0==e||1==e)g.style.marginBottom="9px";h="images/workshop/product_"+c.id+".gif";g.innerHTML='<div class="content" style="width:115px; height:83px;"><div style="width:115px; height:52px;"><div style="width:47px; height:47px;float:left; margin-right:3px;background-image:url('+h+' )"> </div><p class="fc4">'+c.name+"</p><p>\u6570\u91cf:"+c.stock+
'</p></div><p>\u54c1\u8d28:<label class="fc10" style="margin-left: 5px">'+c.quality+'</label><label style="margin-left: 5px">('+c.qualityExp+"/"+2*c.quality+")</label></p><p>\u5356\u51fa\u4ef7\u683c:"+c.value+"</p></div></div>";g.getElementsByTagName("div")[2].addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.clickHandler,e));f.appendChild(g)}this.html_goodsList.appendChild(f)}this.itemSelect()},updateSelectInfo:function(){this.html_remainProduceNum.innerHTML="\u751f\u4ea7\u6b21\u6570:"+
this.workShopData.remainProduceNum;if(0==this.workShopData.remainProduceNum)this.html_proBtn.disabled=!0;this.showIndicateTime();this.htnl_forceGoldNeeded.innerHTML="\u5f3a\u5236\u751f\u4ea7:"+this.workShopData.forceGoldNeeded;if(this.coolTime)this.html_coolTime.className=!0==this.coolTime.full?"fc6":"fc4"},showIndicateTime:function(){null!=this.coolTime?0<this.coolTime.time.getTime()?(this.html_coolTime.innerHTML=this.coolTime.time.toString(),this.html_forceCdBtn.style.display="block"):(this.html_coolTime.innerHTML=
"",this.html_forceCdBtn.style.display="none",this.coolTime.full=!1):(this.html_coolTime.innerHTML="",this.html_forceCdBtn.style.display="none")},step:function(){this.showIndicateTime()},clickHandler:function(b,c){this.workShopData.selectedIdx=c;this.itemSelect()},itemSelect:function(){this.selectedGood=this.workShopData.goods[this.workShopData.selectedIdx];var b,c;b=this.html_goodsList.getElementsByTagName("div");for(c=0;c<b.length;c++)if(0==(c+1)%4)b[c].innerHTML=(c+1)/4-1==this.workShopData.selectedIdx?
'<img id="selectedFrame" src="images/ui/xuan_02.png" width="47" height="47" style="display:inline;" />':""},critHandler:function(){this.critChxB?(this.html_critBtn.style.backgroundPosition="0 0",this.critChxB=0):(this.html_critBtn.style.backgroundPosition="0 -18px",this.critChxB=1)},forceCdHandler:function(){this.callFunc({type:app.view.building.WorkShopView.FORCE_CD,target:this,data:this.coolTime})},forceProHandler:function(){this.callFunc({type:app.view.building.WorkShopView.FORCE_PRODUCT,target:this,
data:[this.selectedGood,this.critChxB]})},sellHandler:function(){this.callFunc({type:app.view.building.WorkShopView.SELL,target:this,data:this.selectedGood})},proHandler:function(){this.selectedGood&&this.callFunc({type:app.view.building.WorkShopView.PRODUCT,target:this,data:[this.selectedGood,this.critChxB]})},updateGoodInfo:function(b){var c;c=document.getElementById(b.id);c.getElementsByTagName("p")[1].innerHTML="\u6570\u91cf:"+b.stock;c.getElementsByTagName("p")[2].innerHTML='\u54c1\u8d28<label class="fc10" style="margin-left: 5px">'+
b.quality+'</label><label style="margin-left: 5px">('+b.qualityExp+"/"+2*b.quality+")</label>";c.getElementsByTagName("p")[3].innerHTML="\u5356\u51fa\u4ef7\u683c:"+b.value;this.updateSelectInfo()},depose:function(){app.controller.TimeController.getInstance().removeListener(this);this.html_forceCdBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.forceCdHandler));this.html_forceProBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.forceProHandler));this.html_sellBtn.removeEventListener(app.Event.CLICK,
ClassUtils.delegate(this,this.sellHandler));this.html_proBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.proHandler));this.buildData=null}},{FORCE_CD:"WorkShopView_Force_cd",FORCE_PRODUCT:"WorkShopView_Force_product",SELL:"WorkShopView_Sell",PRODUCT:"WorkShopView_Product",CRIT_GOLD:1});puremvc.define({name:"app.view.building.BarracksView",constructor:function(b){app.controller.TimeController.getInstance().addListener(this);this.callFunc=b;this.init()}},{coolingTime:null,freeTimes:null,changeUnit:null,foodExpense:null,freeMax:null,troop:null,maxTroop:null,nowGrain:null,currentBuy:null,needTroop:null,recruitTroop:null,dragArea:183,dragLeft:66,currentLeft:0,dragInitBuy:0,currentDrag:!1,depose:function(){app.controller.TimeController.getInstance().removeListener(this)},step:function(){this.baracksTime.innerHTML=
null!=this.coolingTime&&0<this.coolingTime.time.getTime()?'\u51b7\u5374\u65f6\u95f4\uff1a<label class="'+(this.coolingTime.full?"fc6":"fc4")+'">'+this.coolingTime.time.toString()+"</label>":"";this.BarracksFreeGetBtn.disabled=this.canGetFree()?!1:"disabled"},init:function(){this.DragBtn=$("BarracksDragBtn");this.getSpan=$("barracksGetSpan");this.freeSpan=$("barracksFreeSpan");this.buyArea=$("BarracksBuy");this.baracksTime=$("baracksTime");this.BarracksFreeGetBtn=$("BarracksFreeGetBtn");this.BarracksGetBtn=
$("BarracksGetBtn");this.BarracksMinBtn=$("BarracksMinBtn");this.BarracksMaxBtn=$("BarracksMaxBtn");this.BarracksAddBtn=$("BarracksAddBtn");this.BarracksLessBtn=$("BarracksLessBtn");this.BarracksFreeGetBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.getFree);this.BarracksGetBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.getSoldiers);this.BarracksMinBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.goAppointNum,0);this.BarracksMaxBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.goAppointNum,
1);this.BarracksAddBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.goAppointNum,2);this.BarracksLessBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.goAppointNum,3);this.DragBtn&&this.DragBtn.addEventListener(app.Event.MOUSE_DOWN,ClassUtils.delegate(this,this.starDrag));$("barrackview").addEventListener(app.Event.MOVE,ClassUtils.delegate(this,this.nowDrag));$("barrackview").addEventListener(app.Event.MOUSE_UP,ClassUtils.delegate(this,this.stopDrag))},goAppointNum:function(b,c){0==c?this.setCuerrentBuy(0):
1==c?this.setCuerrentBuy(this.recruitTroop):2==c?this.setCuerrentBuy(this.currentBuy+this.changeUnit):this.setCuerrentBuy(this.currentBuy-this.changeUnit)},getFree:function(){!1==this.BarracksFreeGetBtn.disabled&&(this.coolingTime.full?this.callFunc({type:app.view.building.BarracksView.SHOWMSG,data:'<label class="fc9">\u52df\u96c6\u4e49\u5175\u51b7\u5374\u4e2d!<label>'}):this.canGetFree()?this.callFunc({type:app.view.building.BarracksView.GETFREE,target:this}):this.callFunc({type:app.view.building.BarracksView.SHOWMSG,
data:'<label class="fc9">\u51b7\u5374\u4e2d\u6216\u65e0\u987b\u5f81\u5175!<label>'}))},canGetFree:function(){return 0<this.needTroop},getSoldiers:function(){0>=this.nowGrain?app.view.Alert.getInstance().show('<label class="fc9">\u7cae\u98df\u4e0d\u8db3\uff0c\u65e0\u6cd5\u8fdb\u884c\u5f81\u5175!<label>'):0>=this.needTroop?this.callFunc({type:app.view.building.BarracksView.SHOWMSG,data:'<label class="fc9">\u60a8\u7684\u5175\u529b\u5df2\u6ee1\uff0c\u4e0d\u9700\u8981\u8fdb\u884c\u5f81\u5175!<label>'}):
0<this.currentBuy&&this.currentBuy<=this.recruitTroop&&this.callFunc({type:app.view.building.BarracksView.GET,target:this,data:{n:this.currentBuy}})},setData:function(b,c,e){this.freeMax=b.freeMax;this.coolingTime=e;this.freeTimes=e.num;this.troop=c.troop;this.nowGrain=c.grain;this.maxTroop=c.maxTroop;this.foodExpense=b.foodExpense;this.needTroop=this.maxTroop-this.troop;this.recruitTroop=Math.min(this.needTroop,Math.floor(100*this.nowGrain/this.foodExpense));this.changeUnit=b.changeUnit;this.currentBuy=
0;this.showCon()},showCon:function(){var b,c;b=this.freeSpan.getElementsByTagName("span");c=[this.freeMax,this.freeTimes];for(var e=0;e<c.length;e++)b[e].innerHTML=c[e];this.showNowBarracks()},starDrag:function(b){this.currentDrag=!0;this.currentLeft=null!=b.clientX?b.clientX:b.touches[0].pageX;this.dragInitBuy=this.currentBuy},stopDrag:function(){this.currentDrag=!1},nowDrag:function(b){this.currentDrag&&this.setCuerrentBuy(this.dragInitBuy+Math.floor(((null!=b.clientX?b.clientX:b.touches[0].pageX)-
this.currentLeft)*this.recruitTroop/this.dragArea))},setCuerrentBuy:function(b){this.currentBuy=b;if(this.currentBuy>this.recruitTroop)this.currentBuy=this.recruitTroop;if(0>this.currentBuy)this.currentBuy=0;this.showNowBarracks()},showNowBarracks:function(){var b,c;b=this.getSpan.getElementsByTagName("span");c=[this.currentBuy,this.needTroop,Math.ceil(this.foodExpense*this.currentBuy/100),this.nowGrain];var e=0<this.recruitTroop?this.currentBuy*this.dragArea/this.recruitTroop:0;this.DragBtn.style.left=
this.dragLeft+e+"px";this.buyArea.style.width=e+"px";for(e=0;e<c.length;e++)b[e].innerHTML=c[e];this.BarracksFreeGetBtn.disabled=this.canGetFree()?!1:"disabled";this.DragBtn.childNodes[0].disabled=0<this.recruitTroop?!1:"disabled";this.BarracksAddBtn.disabled=this.BarracksMaxBtn.disabled=0<this.recruitTroop&&this.currentBuy<this.recruitTroop?!1:"disabled";this.BarracksLessBtn.disabled=this.BarracksMinBtn.disabled=0<this.currentBuy?!1:"disabled"}},{GET:"barracks_get",GETFREE:"barracks_getFree",SHOWMSG:"barracks_showMsg"});puremvc.define({name:"app.view.building.StoreRoomView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("storeRoom"),!0);b=this.view.querySelector("#building_img");b.width=170;b.height=100;this.stage=new Stage(b);this.init()}},{init:function(){this.html_dlg_title=$("dlg_title");this.html_dlg_title.innerHTML="\u5e93\u623f";this.html_grainTradeBtn=$("grainTradeBtn");this.html_grainTradeBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,
this.grainTrade));this.html_levelup_btn=$("levelup_btn");this.html_levelup_btn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.levelUpHandler));this.html_dlg_close=$("dlg_close");this.html_dlg_close.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_build_title=$("build_title");this.html_build_info=$("build_info");this.html_needMoney=$("needMoney");this.html_needTime=$("needTime")},setData:function(b,c){this.info=b;this.userData=c;this.setBuildingImage(this.info.content);
this.layout()},layout:function(){this.html_build_title.innerHTML=this.info.name+"("+this.buildData.level+"\u7ea7)";this.html_build_info.innerHTML=this.info.descript[0];this.html_needMoney.innerHTML=this.buildData.needMoney;this.html_needTime.innerHTML=app.data.TimeVO.formatTime(1E3*this.buildData.needTime)},close:function(){this.dispatchEvent({type:app.view.building.StoreRoomView.CLOSE,target:this})},levelUpHandler:function(){this.dispatchEvent({type:app.view.building.StoreRoomView.LEVEL_UP,target:this,
data:this.buildData})},updateInfo:function(b){this.buildData=b;this.layout()},setBuildingImage:function(b){if(this.stage&&b){this.stage.removeAllChildren();this.building=new Bitmap(b);var c=this.stage.canvas.width/b.width;c*b.height>this.stage.canvas.height&&(c=this.stage.canvas.height/b.height);this.building.scaleX=this.building.scaleY=c;this.building.x=0.5*(this.stage.canvas.width-b.width*c);this.building.y=0.5*(this.stage.canvas.height-b.height*c);this.stage.addChild(this.building);Ticker.setFPS(20);
Ticker.addListener(this.stage)}},setFlag:function(b){var c=b.getContent("levelup_data");c.images=[b.getContent("levelup")];b=new BitmapAnimation(new SpriteSheet(c));b.regX=0.5*c.frames.width;b.regY=c.frames.height;b.x=0.5*this.stage.canvas.width-10;b.y=this.stage.canvas.height;b.onAnimationEnd=function(b){b.gotoAndStop(1);b.visible=!1};this.stage.addChild(b);this.flagMovie=b},showLevelUP:function(){this.flagMovie.visible=!0;this.flagMovie.gotoAndPlay(1)},grainTrade:function(){this.dispatchEvent({type:app.view.building.StoreRoomView.SHOW_MARKET,
target:this,data:0})},depose:function(){this.stage&&Ticker.removeListener(this.stage);this.html_levelup_btn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.levelUpHandler));this.html_dlg_close.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_grainTradeBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.grainTrade));app.view.base.BaseUIForm.prototype.depose.call(this)}},{LEVEL_UP:"StoreRoom_levelUp",CLOSE:"StoreRoom_close",SHOW_MARKET:"StoreRoom_ShowMarket"});puremvc.define({name:"app.view.building.BankView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("bank"),!0);b=this.view.querySelector("#building_img");b.width=170;b.height=100;this.stage=new Stage(b);this.init()}},{init:function(){this.html_dlg_title=$("dlg_title");this.html_dlg_title.innerHTML="\u94f6\u884c";this.html_levelup_btn=$("levelup_btn");this.html_levelup_btn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.levelUpHandler));
this.html_dlg_close=$("dlg_close");this.html_dlg_close.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_build_title=$("build_title");this.html_build_info=$("build_info");this.html_needMoney=$("needMoney");this.html_needTime=$("needTime")},setData:function(b,c,e){this.info=b;this.buildData=c;this.userData=e;this.setBuildingImage(this.info.content);this.layout()},layout:function(){this.html_build_title.innerHTML=this.info.name+"("+this.buildData.level+"\u7ea7)";this.html_build_info.innerHTML=
this.info.descript[0];this.html_needMoney.innerHTML=this.buildData.needMoney;this.html_needTime.innerHTML=app.data.TimeVO.formatTime(1E3*this.buildData.needTime)},close:function(){this.dispatchEvent({type:app.view.building.BankView.CLOSE,target:this})},levelUpHandler:function(){this.dispatchEvent({type:app.view.building.BankView.LEVEL_UP,target:this,data:this.buildData})},updateInfo:function(b){this.buildData=b;this.layout()},setBuildingImage:function(b){if(this.stage){this.stage.removeAllChildren();
this.building=new Bitmap(b);var c=this.stage.canvas.width/b.width;c*b.height>this.stage.canvas.height&&(c=this.stage.canvas.height/b.height);this.building.scaleX=this.building.scaleY=c;this.building.x=0.5*(this.stage.canvas.width-b.width*c);this.building.y=0.5*(this.stage.canvas.height-b.height*c);this.stage.addChild(this.building);Ticker.setFPS(20);Ticker.addListener(this.stage)}},setFlag:function(b){var c=b.getContent("levelup_data");c.images=[b.getContent("levelup")];b=new BitmapAnimation(new SpriteSheet(c));
b.regX=0.5*c.frames.width;b.regY=c.frames.height;b.x=0.5*this.stage.canvas.width-10;b.y=this.stage.canvas.height;b.onAnimationEnd=function(b){b.gotoAndStop(1);b.visible=!1};this.stage.addChild(b);this.flagMovie=b},showLevelUP:function(){this.flagMovie.visible=!0;this.flagMovie.gotoAndPlay(1)},depose:function(){this.stage&&Ticker.removeListener(this.stage);this.html_levelup_btn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.levelUpHandler));this.html_dlg_close.removeEventListener(app.Event.CLICK,
ClassUtils.delegate(this,this.close));app.view.base.BaseUIForm.prototype.depose.call(this)}},{LEVEL_UP:"Bank_levelUp",CLOSE:"Bank_close"});puremvc.define({name:"app.view.building.EquipView",constructor:function(b){this.callFunc=b;this.init()}},{selectedHeroDivId:0,selectedHeroId:null,depose:function(){this.scrollView&&this.scrollView.depose();this.scrollView=null},init:function(){$("tab_bottom").style.display="none";this.heroListView=$("equipHeroList");this.equipBtnArr=$("equipBtnArr_01").getElementsByTagName("input");this.moveBtn=$("equip_moveBtn");this.equipBtnArr[0][app.Event.ONCLICK]=ClassUtils.delegate(this,this.unAllEquipHandler);
this.equipBtnArr[1][app.Event.ONCLICK]=ClassUtils.delegate(this,this.exchangeHeroBtnHandler);this.initEquipLayOut()},unAllEquipHandler:function(){this.callFunc({type:app.view.building.EquipView.UnAllEquip,target:this,data:this.selectedHeroId})},exchangeHeroBtnHandler:function(){this.callFunc({type:app.view.building.EquipView.ExhcangeHero,target:this,data:this.selectedHeroId})},setHeroListData:function(b,c){this.heroListData=b;this.formationData=c},setBagData:function(b){this.bagData=b},refreshFormation:function(b){this.formationData=
b;for(var b=document.getElementsByClassName("zbImg_01"),c=0;c<b.length;c++)b[c].childNodes[0].className=this.isInFormation(this.heroListData[c].id)?"job_on":"job_out"},heroListLayout:function(){this.heroListView.innerHTML="";var b,c,e,f;b=document.createDocumentFragment();c=this.heroListData.length;f=62*Math.ceil(c/3);this.heroListView.style.height=f+"px";this.moveBtn.style.visibility=0<62*Math.ceil(c/3)-186?"visible":"hidden";for(var g=0;g<c;g++){e=document.createElement("div");e.innerHTML='<div class="zhu_out"></div><div class="xuan_out"></div><p class="fc7"></p>';
e.className="zbImg_01";e.style.backgroundImage="url(images/heros/hero_"+this.heroListData[g].conf.pic+".gif)";e.childNodes[0].className=this.isInFormation(this.heroListData[g].id)?"job_on":"job_out";e.childNodes[2].innerHTML=this.heroListData[g].conf.name;e.childNodes[1].addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.heroClickHandler,g));if(g==this.selectedHeroDivId)e.childNodes[1].className="xuan_on",e.childNodes[2].className="fc2",$("hero_name").innerHTML=this.heroListData[g].conf.name,
$("hero_level").innerHTML="\u7b49\u7ea7:"+this.heroListData[g].level,this.selectedHeroId=this.heroListData[g].conf.id,this.heroEquipLayOut(this.selectedHeroId);b.appendChild(e)}this.heroListView.appendChild(b);var h=this,j=f-186;b=function(b,c){h.heroListView.style["-webkit-transform"]="translateY("+-c+"px)";0<j&&(h.moveBtn.style["-webkit-transform"]="translateY("+150*(c/j)+"px)")};null==this.scrollView?h.scrollView=new app.view.base.ScrollView(b,165,186,165,f,this.heroListView):(this.scrollView.scroller.setDimensions(165,
186,165,f),this.scrollView.scroller.setPosition(0,0))},initEquipLayOut:function(){for(var b=1;7>=b;b++)div=$("eq_"+b),div[app.Event.ONCLICK]=ClassUtils.delegate(this,this.equipLayOutHandler,b)},equipLayOutHandler:function(b,c){var e={};e.typeId=c;e.heroId=this.selectedHeroId;this.callFunc({type:app.view.building.EquipView.SelectEquip,target:this,data:e})},clearHeroEquipLayout:function(){for(var b,c=1;7>=c;c++)b=$("eq_"+c),b.style.backgroundImage=""},heroEquipLayOut:function(b){this.clearHeroEquipLayout();
var b=this.bagData.getHeroItem(b),c=b.length;if(0!=c)for(var e=0;e<c;e++){var f=b[e].conf.typeId;$("eq_"+f).style.backgroundImage="url(images/items/i_"+b[e].conId+".jpg)";var g=[];g.push(f);g.push(b[e])}},isInFormation:function(b){for(var c=!1,e=0;e<this.formationData.length;e++)if(b==this.formationData[e]){c=!0;break}return c},hideTabBottom:function(){$("tab_bottom").style.display="none"},heroClickHandler:function(b,c){for(var e=0;e<this.heroListData.length;e++){var f=this.heroListView.childNodes[e].childNodes[1],
g=this.heroListView.childNodes[e].childNodes[2];e==c?(f.className="xuan_on",g.className="fc2",$("hero_name").innerHTML=this.heroListData[e].conf.name,$("hero_level").innerHTML="\u7b49\u7ea7:"+this.heroListData[e].level,this.selectedHeroDivId=c,this.selectedHeroId=this.heroListData[c].id,this.heroEquipLayOut(this.selectedHeroId)):(f.className="xuan_out",g.className="fc7")}}},{SelectEquip:"equip_SelectEquip",ExhcangeHero:"equip_exhcangeHero",UnAllEquip:"equip_unAllEquip"});puremvc.define({name:"app.view.building.SelectEquipView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0);this.init()}},{selectedEquipDivId:0,selectEquipId:null,exchangeDataStyle:0,init:function(){var b=this;$("selectEq_dlg_close").addEventListener(app.Event.CLICK,function(){b.dispatchEvent({type:app.view.building.SelectEquipView.CLOSE,target:b})});this.selectEquipList=$("zbImg_list2");this.selectEquipBtn=$("selectEq_btn");this.moveBtn=$("selectEquip_moveBtn");
this.exchangeDataBtn=$("exchangeDataStyle").getElementsByTagName("input");var c=function(b,c){if(this.exchangeDataStyle!=c)this.exchangeDataStyle=c,this.equipLayOut()};this.exchangeDataBtn[0][app.Event.ONCLICK]=ClassUtils.delegate(this,c,0);this.exchangeDataBtn[1][app.Event.ONCLICK]=ClassUtils.delegate(this,c,1)},setData:function(b,c,e){this.bagProxy=b;this.heroProxy=c;this.typeId=e.typeId;this.heroId=e.heroId;this.heroEquip=this.bagProxy.getItemByHero(this.heroId,this.typeId);this.heroLevel=this.heroProxy.getHeroVO(this.heroId).level;
this.equipList=this.bagProxy.getItemsForEquip(this.heroId,this.typeId);this.allEquipList=this.bagProxy.storageList},equipLayOut:function(){this.selectEquipList.innerHTML="";var b,c,e,f;b=document.createDocumentFragment();if(0==this.exchangeDataStyle)this.equipData=this.equipList;else if(1==this.exchangeDataStyle)this.equipData=this.allEquipList;c=this.equipData.length;this.moveBtn.style.visibility=0<51*Math.ceil(c/3)-155?"visible":"hidden";if(0==c)this.cleanEquipInfoLayOut(),this.selectEquipBtn[app.Event.ONCLICK]=
null,0==this.exchangeDataStyle&&app.view.Tooltip.getInstance().show("\u6ca1\u6709\u8be5\u7c7b\u578b\u88c5\u5907\uff01"),1==this.exchangeDataStyle&&app.view.Tooltip.getInstance().show("\u6682\u65e0\u88c5\u5907\uff01");else{f=51*Math.ceil(c/3);this.selectEquipList.style.height=f+"px";for(var g=0;g<c;g++){e=document.createElement("div");e.className="zbImg_03";e.innerHTML='<div class="xuan_off"></div><div class="xuan_out"></div>';e.style.backgroundImage="url(images/items/i_"+this.equipData[g].conId+".jpg)";
e[app.Event.ONCLICK]=ClassUtils.delegate(this,this.equipItemClick,g);if(this.heroEquip)this.selectedEquipDivId=this.heroEquip.conf.typeId-1;if(0!=c)this.selectedEquipDivId=0;if(g==this.selectedEquipDivId)e.childNodes[1].className="xuan_on",this.selectEquipId=this.equipData[g].conId;if(this.heroEquip&&this.equipData[g].id==this.heroEquip.id)e.childNodes[0].className="xuan_use";b.appendChild(e)}this.selectEquipList.appendChild(b);this.moveBtnSpace=f-155;var h=this;b=function(b,c){h.selectEquipList.style["-webkit-transform"]=
"translateY("+-c+"px)";0<h.moveBtnSpace&&(h.moveBtn.style["-webkit-transform"]="translateY("+149*(c/h.moveBtnSpace)+"px)")};null==this.scrollView?this.scrollView=new app.view.base.ScrollView(b,168,155,this.selectEquipList.clientWidth,this.selectEquipList.clientHeight,this.selectEquipList):(this.scrollView.scroller.setDimensions(168,155,this.selectEquipList.clientWidth,this.selectEquipList.clientHeight),this.selectEquipList.style["-webkit-transform"]="translateY(0px)",this.moveBtn.style["-webkit-transform"]=
"translateY(0px)");this.equipInfoLayOut();this.equipBtnLayOut()}},equipInfoLayOut:function(){var b=$("equipItemImg"),c=$("equipItemInfo").getElementsByTagName("span"),e=this.equipData[this.selectedEquipDivId];b.style.backgroundImage="url(images/items/i_"+e.conId+".jpg)";c[0].innerHTML='<label class="'+app.getStyle(e.conf.qualityId)+'">'+e.conf.name+"</label>"+e.level+"\u7ea7";c[1].innerHTML=e.conf.useLevel>this.heroLevel?"<label class=fc9 >\u6b66\u5c06"+e.conf.useLevel+"\u7ea7</label>":"\u6b66\u5c06"+
e.conf.useLevel+"\u7ea7";c[2].innerHTML=e.getattrName()+"+<label class=fc10 >"+e.getAtt()+"</label>";c[3].innerHTML=e.getTroop();c[4].innerHTML=e.strike;c[5].innerHTML=e.fightBack;c[6].innerHTML=e.mitigate},cleanEquipInfoLayOut:function(){var b=$("equipItemImg"),c=$("equipItemInfo").getElementsByTagName("span");b.style.backgroundImage="none";for(b=0;b<c.length;b++)c[b].innerHTML=""},equipBtnLayOut:function(){this.selectEquipBtn[app.Event.CLICK]=null;0==this.selectedEquipDivId&&this.heroEquip&&0==
this.exchangeDataStyle?(this.selectEquipBtn.value="\u5378\u8f7d",this.selectEquipBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.equipUnloadHandler)):(this.selectEquipBtn.value="\u88c5\u5907",this.selectEquipBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.equipInstallHandler))},equipUnloadHandler:function(){var b={};b.heroId=this.heroId;b.equipmentId=this.equipData[0].id;this.dispatchEvent({type:app.view.building.SelectEquipView.unEquip,target:this,data:b})},equipInstallHandler:function(){var b=
{};b.heroId=this.heroId;b.equipmentId=this.equipData[this.selectedEquipDivId].id;this.dispatchEvent({type:app.view.building.SelectEquipView.onEquip,target:this,data:b})},equipItemClick:function(b,c){this.selectedEquipDivId=c;for(var e=this.equipData.length,f=this.selectEquipList.getElementsByClassName("zbImg_03"),c=0;c<e;c++)f[c].childNodes[1].className=c==this.selectedEquipDivId?"xuan_on":"xuan_out";this.equipInfoLayOut();this.equipBtnLayOut()}},{CLOSE:"SelectEquipView_close",unEquip:"SelectEquipView_unEquip",
onEquip:"SelectEquipView_onEquip"});puremvc.define({name:"app.view.building.SelectHeroView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0);this.init()}},{init:function(){var b=this;$("selectHero_dlg_close").addEventListener(app.Event.CLICK,function(){b.dispatchEvent({type:app.view.building.SelectHeroView.CLOSE,target:b})});this.selectHeroList=$("selectHeroList");this.moveBtn=$("selectHero_moveBtn")},setData:function(b,c){this.heroListData=b.data.onJobList;this.heroId=c},heroLayOut:function(){this.selectHeroList.innerHTML=
"";var b,c,e;b=document.createDocumentFragment();c=this.heroListData.length;if(!(1>=c)){this.selectHeroList.style.height=99*(c-1)+"px";this.moveBtn.style.visibility=0<99*(c-1)-198?"visible":"hidden";for(var f=0;f<c;f++)if(this.heroListData[f].id!=this.heroId){e=document.createElement("div");e.className="selectHero_01";e.innerHTML='<div class="selectHero_02"><div  class="selectHero_03"></div><div class="selectHero_04"><p>\u7b49\u7ea7\uff1a<span class="fc10"></span></p><p>\u7ecf\u9a8c\uff1a<span></span>/<span></span></p></div><div class="selectHero_05"><p>\u5175\u529b\uff1a<span></span></p></div> </div>';
e.getElementsByClassName("selectHero_03")[0].style.backgroundImage="url(images/heros/hero_"+this.heroListData[f].conf.pic+".gif)";e.getElementsByClassName("selectHero_03")[0].innerHTML=this.heroListData[f].conf.name;e.getElementsByClassName("selectHero_03")[0][app.Event.ONCLICK]=ClassUtils.delegate(this,this.heroItemClick,f);var g=e.getElementsByTagName("span");g[0].innerHTML=this.heroListData[f].level+"\u7ea7";g[1].innerHTML=this.heroListData[f].exp;g[2].innerHTML=this.heroListData[f].maxExp;g[3].innerHTML=
this.heroListData[f].hp;b.appendChild(e)}this.selectHeroList.appendChild(b);var h=this.selectHeroList.clientHeight-195,j=this;b=function(b,c){j.selectHeroList.style["-webkit-transform"]="translateY("+-c+"px)";0<h&&(j.moveBtn.style["-webkit-transform"]="translateY("+159*(c/h)+"px)")};null==this.scrollView?this.scrollView=new app.view.base.ScrollView(b,328,195,this.selectHeroList.clientWidth,this.selectHeroList.clientHeight,this.selectHeroList):(this.scrollView.scroller.setDimensions(328,195,this.selectHeroList.clientWidth,
this.selectHeroList.clientHeight),this.scrollView.scroller.setPosition(0,0))}},heroItemClick:function(b,c){this.selectedHeroId=this.heroListData[c].conf.id;if(this.heroId!=this.selectedHeroId){var e={};e.targetId=this.heroId;e.srcId=this.selectedHeroId;this.dispatchEvent({type:app.view.building.SelectHeroView.ExchangeHeroEquip,target:this,data:e})}}},{CLOSE:"SelectHeroView_close",ExchangeHeroEquip:"SelectHero_ExchangeHeroEquip"});puremvc.define({name:"app.view.building.PatrolView",parent:app.view.base.TabContentView,constructor:function(b){app.view.base.TabContentView.call(this,b.getContent("tabContent"));this.init(b)}},{patrolData:null,refreshStatus:!1,init:function(b){this.append("\u5de1\u67e5",b.getContent("patrol"));this.html_money=$("tab_bottom");this.html_area_refresh=$("area_refresh");this.html_place_refresh=$("place_refresh");this.html_human_refresh=$("human_refresh");this.html_patrolBtn=$("patrolBtn");this.html_areaImg=
$("areaImg");this.html_areaName=$("areaName");this.html_placeImg=$("placeImg");this.html_placeName=$("placeName");this.html_humanImg=$("humanImg");this.html_humanName=$("humanName");this.html_lab_count=$("lab_count");this.html_award=$("award");this.html_area_refresh.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.refreshHandler,app.view.building.PatrolView.PATROL_AREA));this.html_place_refresh.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.refreshHandler,app.view.building.PatrolView.PATROL_PLACE));
this.html_human_refresh.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.refreshHandler,app.view.building.PatrolView.PATROL_HUMAN));this.html_patrolBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.patrolHandler))},setData:function(b){this.title.innerHTML="\u6c11\u5c45";this.patrolData=b},layout:function(){this.html_areaImg.src="images/patrol/d_"+this.patrolData.areaId+".gif";this.html_areaName.innerHTML=this.patrolData.getName(app.view.building.PatrolView.PATROL_AREA,
this.patrolData.areaId);this.html_placeImg.src="images/patrol/l_"+this.patrolData.placeId+".gif";this.html_placeName.innerHTML=this.patrolData.getName(app.view.building.PatrolView.PATROL_PLACE,this.patrolData.placeId);this.html_humanImg.src="images/ren/r_"+this.patrolData.humanId+".gif";this.html_humanName.innerHTML=this.patrolData.getName(app.view.building.PatrolView.PATROL_HUMAN,this.patrolData.humanId);this.html_lab_count.innerHTML=this.patrolData.count+"/"+this.patrolData.total;this.html_patrolBtn.disabled=
0<this.patrolData.count?!1:!0;null==this.patrolData.equipId?(this.html_award.innerHTML="\u672a\u77e5",this.html_award.className="fc9"):(this.html_award.innerHTML=this.patrolData.getEquip(this.patrolData.equipId).name,this.html_award.className=app.getStyle(this.patrolData.getEquip(this.patrolData.equipId).qualityId))},patrolHandler:function(){!1==this.html_patrolBtn.disabled&&!1==this.refreshStatus&&this.dispatchEvent({type:app.view.building.PatrolView.PATROL,target:this})},refreshHandler:function(b,
c){this.dispatchEvent({type:app.view.building.PatrolView.REFRESH,target:this,data:c})},refreshUI:function(b){this.refreshStatus=!0;this.html_patrolBtn.disabled=!0;this.areaImginx=this.placeImginx=this.humanImginx=1;var c=this;this.refreshInt=setInterval(function(){c.refreshintDo(b)},50);this.refreshTime=setTimeout(function(){c.clearRefreshint()},1E3)},refreshintDo:function(b){this.html_award.innerHTML="\u672a\u77e5";if(b==app.view.building.PatrolView.PATROL_AREA){if(10<=this.areaImginx)this.areaImginx=
1;this.html_areaImg.src="images/patrol/d_"+this.areaImginx+".gif";this.html_areaName.innerHTML="\u672a\u77e5";this.areaImginx++}else if(b==app.view.building.PatrolView.PATROL_PLACE){if(10<=this.placeImginx)this.placeImginx=1;this.html_placeImg.src="images/patrol/l_"+this.placeImginx+".gif";this.html_placeName.innerHTML="\u672a\u77e5";this.placeImginx++}else if(b==app.view.building.PatrolView.PATROL_HUMAN){if(19<=this.humanImginx)this.humanImginx=1;this.html_humanImg.src="images/ren/r_"+this.humanImginx+
".gif";this.html_humanName.innerHTML="\u672a\u77e5";this.humanImginx++}else if(b==app.view.building.PatrolView.PATROL_ALL){if(10<=this.areaImginx)this.areaImginx=1;if(10<=this.placeImginx)this.placeImginx=1;if(19<=this.humanImginx)this.humanImginx=1;this.html_areaImg.src="images/patrol/d_"+this.areaImginx+".gif";this.html_areaName.innerHTML="\u672a\u77e5";this.html_placeImg.src="images/patrol/l_"+this.placeImginx+".gif";this.html_placeName.innerHTML="\u672a\u77e5";this.html_humanImg.src="images/ren/r_"+
this.humanImginx+".gif";this.html_humanName.innerHTML="\u672a\u77e5";this.areaImginx++;this.placeImginx++;this.humanImginx++}},clearRefreshint:function(){this.refreshStatus=!1;this.html_patrolBtn.disabled=!1;this.refreshInt&&clearInterval(this.refreshInt);this.layout()},depose:function(){this.dispatchEvent({type:app.view.building.PatrolView.CLOSE});this.refreshStatus=!1;this.refreshInt&&clearInterval(this.refreshInt);this.refreshTime&&clearTimeout(this.refreshTime);this.html_area_refresh.removeEventListener(app.Event.CLICK,
ClassUtils.delegate(this,this.refreshHandler,app.view.building.PatrolView.PATROL_AREA));this.html_place_refresh.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.refreshHandler,app.view.building.PatrolView.PATROL_PLACE));this.html_human_refresh.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.refreshHandler,app.view.building.PatrolView.PATROL_HUMAN));this.html_patrolBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.patrolHandler));app.view.base.BaseUIForm.prototype.depose.call(this)},
showUserInfo:function(b){this.userData=b;var c=this.html_money.getElementsByTagName("span");c[0].innerHTML="\u91d1\u5e01\uff1a"+b.goldCoin;c[0].className="fc1";c[1].innerHTML="\u94f6\u5e01\uff1a"+b.silverCoin},tabChange:function(b){app.view.base.TabContentView.prototype.tabChange.call(this,0);this.idx=b;this.layout()}},{NAME:"PatrolView",REFRESH:"PatrolView_refresh",CLOSE:"PatrolView_close",PATROL:"PatrolView_patrol",PATROL_AREA:1,PATROL_PLACE:2,PATROL_HUMAN:0,PATROL_ALL:3,REFRESH_MONEY:5E3});puremvc.define({name:"app.view.building.TaskFrameView",parent:app.view.base.TabContentView,constructor:function(b,c){app.view.base.TabContentView.call(this,b.getContent("tabContent"));this.init(b,c)}},{taskMainView:null,taskDayView:null,depose:function(){this.taskMainView&&this.taskMainView.depose();this.taskDayView&&this.taskDayView.depose();this.signInView&&this.signInView.depose();this.campaignView&&this.campaignView.depose();this.campaignView=this.signInView=this.taskDayView=this.taskMainView=
null;this.dispatchEvent({type:app.view.building.TaskFrameView.CLOSE,target:this});app.view.base.TabContentView.prototype.depose.call(this)},init:function(b,c){c[0]&&this.append("\u4e3b\u7ebf\u4efb\u52a1",b.getContent("taskMain"));c[1]&&this.append("\u6d3b\u8dc3\u5956\u52b1",b.getContent("signInTab"));c[2]&&this.append("\u6bcf\u65e5\u4efb\u52a1",b.getContent("taskDay"));c[3]&&this.append("\u5468\u6d3b\u52a8",b.getContent("campaignTab"));this.title.innerHTML="\u4efb\u52a1"},setData:function(b,c,e,f){this.taskMainProxy=
b;this.taskDayProxy=c;this.signInData=e;this.campaignData=f;this.layout()},tabChange:function(b){app.view.base.TabContentView.prototype.tabChange.call(this,b);if(void 0!=this.taskMainProxy)switch(b){case 0:this.taskMainView&&this.taskMainView.depose();this.taskMainView=new app.view.building.TaskMainView(this.taskMainProxy.taskMain,ClassUtils.delegate(this,this.sendEvent));break;case 1:if(null==this.signInView)this.signInView=new app.view.system.SignInView(ClassUtils.delegate(this,this.sendEvent));
this.dispatchEvent({type:app.view.building.TaskFrameView.LOADSIGNDATA,target:this});break;case 2:this.taskDayView&&this.taskDayView.depose();this.taskDayView=new app.view.building.TaskDayView(this.taskDayProxy.taskDay,ClassUtils.delegate(this,this.sendEvent));break;case 3:if(null==this.campaignView)this.campaignView=new app.view.system.CampaignView(ClassUtils.delegate(this,this.sendEvent));this.setComData(this.campaignData)}},setSignInData:function(b){this.signInView&&this.signInView.setData(b)},
activeLayout:function(){this.signInView&&this.signInView.activeLayout()},signLayout:function(){this.signInView&&this.signInView.signLayout()},setComData:function(b){this.campaignView&&this.campaignView.setData(b)},completeReward:function(){this.campaignView&&this.campaignView.completeReward()},sendEvent:function(b){this.dispatchEvent(b)},layout:function(){$("tab_bottom").style.visibility="hidden"}},{CLOSE:"TaskFrameView_close",LOADSIGNDATA:"TaskFrameView_LoadSignData"});puremvc.define({name:"app.view.building.TaskMainView",constructor:function(b,c){this.data=b;this.callFunc=c;this.init();this.layout();this.showTaskInfo({target:this.selItem})}},{taskMainGetBtn:null,taskList:null,selI:null,selItem:null,listScroller:null,init:function(){this.taskMainGetBtn=$("taskMainGetBtn");this.taskmain_name=$("taskmain_name");this.taskmain_con=$("taskmain_con");this.taskmain_reward=$("taskmain_reward");this.taskMainGetBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);
this.taskList=$("task_mainList");this.moveBarImg=$("p_tasklist")},layout:function(){var b,c;this.taskList.innerHTML="";b=this.data.length;c=34*(b+1);for(var e=0;e<b;e++){var f=document.createElement("div");f.idx=e;f.style.width="107px";f.style.lineHeight=f.style.height="31px";f[app.Event.ONCLICK]=ClassUtils.delegate(this,this.showTaskInfo);f.style.textAlign="center";f.style.marginTop="3px";f.innerHTML=this.data[e].name+"<div class="+(2==this.data[e].status?"jl_ico_on":"jl_ico_out")+"></div>";f.className=
"rwCHo_Out";if(!this.selItem)this.selItem=f;this.taskList.appendChild(f)}var g=this;this.dragSize=c;this.moveBarImg.style.visibility=190<c?"visible":"hidden";b=[107,190,107,c];if(this.listScroller)this.listScroller=null;this.listScroller=new app.view.base.ScrollView(function(b,c){g.taskList.style["-webkit-transform"]="translateY("+-c+"px)";190<g.dragSize&&(g.moveBarImg.style["-webkit-transform"]="translateY("+159*(c/(g.dragSize-190))+"px)")},b[0],b[1],b[2],b[3],this.taskList)},showTaskInfo:function(b){if(!b||
!isNaN(b.target.idx))this.selItem.className="rwCHo_Out",b?(this.selI=b.target.idx?b.target.idx:0,this.selItem=b.target,this.selItem.className="rwCHo_Over"):this.selI=0,b=this.data[this.selI],this.taskmain_name.innerHTML=b.name,this.taskmain_con.innerHTML=b.con,this.taskmain_reward.innerHTML=this.getReward(b.reward),this.taskMainGetBtn.style.visibility=2==b.status?"visible":"hidden"},getReward:function(b){var c,e;switch(b.tid){case 1:c="\u94f6\u5e01",e=b.value}return c+"x"+e},handleEvent:function(b){b.currentTarget==
this.taskMainGetBtn&&!isNaN(this.selI)&&2==this.data[this.selI].status&&this.callFunc({type:app.view.building.TaskMainView.TASKMAIN_GET,target:this,data:this.data[this.selI]})},depose:function(){this.taskMainGetBtn=this.taskMainGetBtn[app.Event.ONCLICK]=null;if(this.listScroller)this.listScroller.depose(),this.listScroller=null}},{TASKMAIN_GET:"getReward"});puremvc.define({name:"app.view.building.TaskDayView",constructor:function(b,c){this.data=b;this.callFunc=c;this.init();this.showTaskInfo()}},{taskFinishBtn:null,taskFreshBtn:null,init:function(){this.taskFinishBtn=$("taskFinishBtn");this.taskFreshBtn=$("taskFreshBtn");this.taskDtitle=$("taskDtitle");this.taskDcon=$("taskDcon");this.taskDdifficulty=$("taskDdifficulty");this.taskDprogess=$("taskDprogess");this.taskDnum=$("taskDnum");this.taskDfinishNum=$("taskDfinishNum");this.taskDfreeNum=$("taskDfreeNum");
this.taskDlottery=$("taskDlottery");this.taskFinishBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.taskFreshBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent)},showTaskInfo:function(){this.taskDtitle.innerHTML=this.data.name;for(var b="",c=0;c<this.data.difficulty;c++)b+='<img src="images/ui/star.png" width="15" height="14" />';this.taskDdifficulty.innerHTML=b;this.taskDcon.innerHTML=this.data.con;this.taskDprogess.innerHTML=this.data.progress+"/"+this.data.progressTotal;
b=this.data.finishTotal-this.data.finishNum;this.taskDnum.innerHTML=b;this.taskDnum.className=0>=b?"fc9":"fc4";this.taskDfinishNum.innerHTML=this.data.finishPrice;c=this.data.freshTotal-this.data.freshNum;this.taskDfreeNum.innerHTML=0>c?0:c;var e=this.taskDlottery.innerHTML="";if(2==this.data.status)for(c=0;6>c;c++)newDiv=document.createElement("div"),e='<img src="images/ui/notget.gif" width="47" height="47" />',newDiv.style.width="72px",newDiv.style["float"]="left",newDiv.style.textAlign="center",
newDiv.innerHTML=e,newDiv.idx=c,newDiv.addEventListener(app.Event.CLICK,this),this.taskDlottery.appendChild(newDiv);else for(c=0;6>c;c++)newDiv=document.createElement("div"),e='<img src="'+this.data.rewards[c].img+'" width="40" height="40" style="opacity:0.5"/><p align="center" class="'+this.data.rewards[c].itemClass+'">'+this.data.rewards[c].name+"x"+this.data.rewards[c].value+"</p>",newDiv.style.width="72px",newDiv.style.textAlign="center",newDiv.style["float"]="left",newDiv.innerHTML=e,this.taskDlottery.appendChild(newDiv);
this.taskFinishBtn.disabled=1==this.data.status&&0<b?!1:"disabled"},showItemInfo:function(b,c){app.view.Tooltip.getInstance().show(c,b.x,b.y)},handleEvent:function(b){b.currentTarget==this.taskFreshBtn?this.callFunc({type:app.view.building.TaskDayView.TASKDAY_FRESH}):b.currentTarget==this.taskFinishBtn?!1==this.taskFinishBtn.disabled&&this.callFunc({type:app.view.building.TaskDayView.TASKDAY_FINISH}):this.callFunc({type:app.view.building.TaskDayView.TASKDAY_LOTTERY,data:b.currentTarget.idx})},depose:function(){this.taskFinishBtn[app.Event.ONCLICK]=
null;this.taskFreshBtn=this.taskFinishBtn=this.taskFreshBtn[app.Event.ONCLICK]=null}},{TASKDAY_FINISH:"taskDay_finish",TASKDAY_FRESH:"taskDay_fresh",TASKDAY_LOTTERY:"taskDay_lottery"});puremvc.define({name:"app.view.building.TaskLotteryView",parent:app.view.base.BaseUIForm},{reward:null,setData:function(b,c,e){this.reward=b;this.data=c;this.list=e;this.init();this.showInfo()},init:function(){$("taskLottery_close")[app.Event.ONCLICK]=ClassUtils.delegate(this,this.sendEvent,app.view.building.TaskLotteryView.CLOSE)},showInfo:function(){$("taskDReward").innerHTML='<label class="'+this.reward.itemClass+'">'+this.reward.name+"x"+this.reward.value+"";var b=0>=this.data.lotteryNum?"\u60a8\u6ca1\u6709\u62bd\u5956\u673a\u4f1a\u4e86\uff01":
'\u7ee7\u7eed\u62bd\u5956\u5c06\u9700\u8981<label class="fc1">\u82b1\u8d39'+this.data.lotteryPrice+"\u91d1\u5e01</label>";$("taskDlotteryPrice").innerHTML='<label class="fc11">'+b+"</label>";taskLotteryMore=$("taskLotteryMore");for(var b=taskLotteryMore.innerHTML="",c=0;6>c;c++){var e=document.createElement("div");e.style.width="80px";e.style.height="60px";e.style["float"]="left";this.list[c]?(b='<img src="'+this.list[c].img+'" width="47" height="47" />',e.innerHTML=b):(b='<img src="images/ui/notget.gif" width="47" height="47" />',
e.innerHTML=b,0<this.data.lotteryNum&&(e[app.Event.ONCLICK]=ClassUtils.delegate(this,this.sendEvent,app.view.building.TaskLotteryView.MORELOTTERY,c)));taskLotteryMore.appendChild(e)}},sendEvent:function(b,c,e){this.dispatchEvent({type:c,data:e})}},{MORELOTTERY:"taskLottery_moreLottery",CLOSE:"taskLottery_close"});puremvc.define({name:"app.view.building.AchievementView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("achievement"),!0);this.init()}},{achievementInfoBtn:null,achievementInfo:null,copyList:null,copyDiv:null,getDiv:null,selI:null,selItem:null,setData:function(b){this.copyList=b;this.layout();this.getInfo({target:this.selItem})},init:function(){this.achievementInfoBtn=$("achievementInfoBtn");this.closebtn=$("achievement_close");this.achievementInfoBtn[app.Event.ONCLICK]=
ClassUtils.delegate(this,this.sendEvent,app.view.building.AchievementView.Achievement_Info);this.closebtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.sendEvent,app.view.building.AchievementView.CLOSE);this.copyDiv=$("achievement_copyList");this.getDiv=$("achievement_getList");this.moveBarImg=$("p_copylist");this.achievement_score=$("achievement_score")},layout:function(){var b,c;this.copyDiv.innerHTML="";b=this.copyList.length;c=34*(b+1);for(var e=0;e<b;e++){var f=document.createElement("div");
f.idx=this.copyList[e].id;f.style.width="107px";f.style.lineHeight=f.style.height="31px";f[app.Event.ONCLICK]=ClassUtils.delegate(this,this.getInfo);f.style.textAlign="center";f.style.marginTop="3px";f.innerHTML=this.copyList[e].name;f.className="rwCHo_Out";if(!this.selItem)this.selItem=f;this.copyDiv.appendChild(f)}var g=this;this.dragSize=c;b=[107,170,107,c];this.moveBarImg.style.visibility=c>b[1]?"visible":"hidden";this.scroller&&this.scroller.depose();this.scroller=null;this.scroller=new app.view.base.ScrollView(function(b,
c){g.copyDiv.style["-webkit-transform"]="translateY("+-c+"px)";170<g.dragSize&&(g.moveBarImg.style["-webkit-transform"]="translateY("+159*(c/(g.dragSize-170))+"px)")},b[0],b[1],b[2],b[3],this.copyDiv)},getInfo:function(b){if(!b||!isNaN(b.target.idx)){this.selItem.className="rwCHo_Out";this.selI=b.target.idx;if(b)this.selItem=b.target,this.selItem.className="rwCHo_Over";this.dispatchEvent({type:app.view.building.AchievementView.Achievement_RewardInfo,target:this,data:this.selI})}},showInfo:function(b){this.achievementInfo=
b;this.achievement_score.innerHTML=b.score;for(var c=this.getDiv.innerHTML="",e,f=0;f<b.AchDetail.length;f++){var g=b.AchDetail[f];e=document.createElement("div");var h=3==g.status?"jl2_ico_on":"jl2_ico_out",j=1==g.status?0.5:1,c="<p>",c=c+(g.score+"\u5206"),c=c+'</p><div class="jl_01" style="background-image: url(',c=c+g.reward.img,c=c+"); opacity: ",c=c+j,c=c+'; "><div class="',c=c+h,c=c+'"></div><p>',c=c+("x"+g.reward.value),c=c+"</p></div>";e.innerHTML=c;e.className="ach_itemDiv";2==g.status&&
(e[app.Event.ONCLICK]=ClassUtils.delegate(this,this.sendEvent,app.view.building.AchievementView.Achievement_get,g.id));this.getDiv.appendChild(e)}},sendEvent:function(b,c,e){this.dispatchEvent({type:c,target:this,data:{mapId:this.selI,param:e}})}},{Achievement_Info:"achievement_Info",CLOSE:"achievement_close",Achievement_RewardInfo:"achievement_RewardInfo",Achievement_get:"achievement_get"});puremvc.define({name:"app.view.building.AchievementInfoView",parent:app.view.base.BaseUIForm},{closeBtn:null,setData:function(b){this.data=b;this.init();this.showInfo()},init:function(){this.AchInfo_Num=$("AchInfo_Num");this.AchInfo_Level=$("AchInfo_Level");this.closeBtn=$("achievementInfo_close");this.process=$("copy_process");var b=this;this.closeBtn[app.Event.ONCLICK]=function(){b.dispatchEvent({type:app.view.building.AchievementInfoView.CLOSE,target:b})}},showInfo:function(){this.AchInfo_Num.innerHTML=
"";this.AchInfo_Level.innerHTML="";this.process.innerHTML=this.data.process+"%";var b,c;b=this.data.AchInfoNum.length;for(var e=0;e<b;e++){c=this.data.AchInfoNum[e];newDiv=document.createElement("div");newDiv.style.background="url(images/heros/hero_"+c.picId+".gif) center top no-repeat";newDiv.className="zsImg";var f='<p style=" margin-bottom:23px;color:white">5\u5206</p>',f=f+('<p style="text-align:center;color:white;text-shadow: 1px 1px 1px #000;">'+c.name+"</p>"),f=f+('<p style="text-align:center;color:white">\u51fb\u8d25'+
c.schedule+"/"+c.targetValue+"</p>");newDiv.innerHTML=f;this.AchInfo_Num.appendChild(newDiv)}b=this.data.AchInfoLevel.length;for(e=0;e<b;e++)c=this.data.AchInfoLevel[e],newDiv=document.createElement("div"),newDiv.className=2==c.status?"tz_on":"tz_out",f='<span class="tz_01">'+c.name+'</span><span class="tz_02 fc10">'+c.level+"</span>",newDiv.innerHTML=f,this.AchInfo_Level.appendChild(newDiv)}},{CLOSE:"AchievementInfo_close"});puremvc.define({name:"app.view.system.ArmyGroupFrameView",parent:app.view.base.TabContentView,constructor:function(b,c){app.view.base.TabContentView.call(this,b.getContent("tabContent"));this.init(b,c)}},{groupListView:null,ourGroupView:null,groupResearchView:null,groupAskListView:null,armyGroupProxy:null,armyGroupAskProxy:null,armyGroupListProxy:null,armyGroupResearchProxy:null,armyGroupTeamProxy:null,depose:function(){this.groupListView&&this.groupListView.depose();this.ourGroupView&&this.ourGroupView.depose();
this.groupResearchView&&this.groupResearchView.depose();this.groupAskListView&&this.groupAskListView.depose();this.dispatchEvent({type:app.view.system.ArmyGroupFrameView.CLOSE,target:this});app.view.base.TabContentView.prototype.depose.call(this)},init:function(b,c){this.append("\u4e16\u754c\u519b\u56e2",b.getContent("groupList"));if(1==c||4==c)this.append("\u519b\u56e2\u4fe1\u606f",b.getContent("groupTeam")),this.append("\u519b\u56e2\u79d1\u6280",b.getContent("groupResearch")),this.append("\u7533\u8bf7\u5217\u8868",
b.getContent("groupAsk"));this.title.innerHTML="\u519b\u56e2"},setData:function(b,c,e,f,g){this.armyGroupProxy=b;this.armyGroupAskProxy=c;this.armyGroupListProxy=e;this.armyGroupResearchProxy=f;this.armyGroupTeamProxy=g;this.layout()},tabChange:function(b){app.view.base.TabContentView.prototype.tabChange.call(this,b);if(void 0!=this.armyGroupListProxy)switch(b){case 0:this.groupListView&&this.groupListView.depose();this.groupListView=new app.view.system.ArmyGroupListView(this.armyGroupListProxy,this.armyGroupProxy,
ClassUtils.delegate(this,this.sendEvent));1==this.armyGroupListProxy.nowList?(this.groupListView.currentList=1,this.groupListView.reList(this.armyGroupListProxy.sList,this.armyGroupListProxy.slen,this.armyGroupListProxy.nowSPage)):(this.groupListView.currentList=0,this.groupListView.reList(this.armyGroupListProxy.list,this.armyGroupListProxy.len,this.armyGroupListProxy.nowPage));break;case 1:this.ourGroupView&&this.ourGroupView.depose();this.ourGroupView=new app.view.system.ArmyGroupOurView(this.armyGroupTeamProxy,
this.armyGroupListProxy,this.armyGroupProxy.pos,this.armyGroupProxy.status,ClassUtils.delegate(this,this.sendEvent));break;case 2:this.groupResearchView&&this.groupResearchView.depose();this.groupResearchView=new app.view.system.ArmyGroupResearchView(this.armyGroupResearchProxy,this.armyGroupListProxy.ourGroupInfo,ClassUtils.delegate(this,this.sendEvent));break;case 3:this.groupAskListView&&this.groupAskListView.depose(),this.groupAskListView=new app.view.system.ArmyGroupAskListView(this.armyGroupAskProxy,
this.armyGroupProxy.getPower(0,this.armyGroupProxy.pos),ClassUtils.delegate(this,this.sendEvent))}},refreshList:function(b){switch(b){case 0:if(this.groupListView)1==this.armyGroupListProxy.nowList?(this.groupListView.currentList=1,this.groupListView.reList(this.armyGroupListProxy.sList,this.armyGroupListProxy.slen,this.armyGroupListProxy.nowSPage)):(this.groupListView.currentList=0,this.groupListView.reList(this.armyGroupListProxy.list,this.armyGroupListProxy.len,this.armyGroupListProxy.nowPage));
break;case 1:this.ourGroupView&&this.ourGroupView.reList(this.armyGroupTeamProxy.list,this.armyGroupTeamProxy.len,this.armyGroupTeamProxy.nowPage);break;case 3:this.groupAskListView&&this.groupAskListView.reList(this.armyGroupAskProxy.list,this.armyGroupAskProxy.len,this.armyGroupAskProxy.nowPage)}},refreshInfo:function(b){switch(b){case 0:this.groupListView&&this.groupListView.showInfo();break;case 1:this.ourGroupView&&this.ourGroupView.showInfo();break;case 2:this.groupResearchView&&this.groupResearchView.showInfo();
break;case 3:this.groupAskListView&&this.groupAskListView.showInfo()}},setDefaultResearch:function(){this.groupResearchView&&this.groupResearchView.setDefault(this.armyGroupResearchProxy.defaultId)},sendEvent:function(b){this.dispatchEvent(b)},layout:function(){$("tab_bottom").style.visibility="hidden"}},{CLOSE:"ArmyGroupFrameView_close"});puremvc.define({name:"app.view.system.ArmyGroupListView",constructor:function(b,c,e){app.controller.TimeController.getInstance().addListener(this);this.selectDiv=document.createElement("div");this.selectDiv.style["background-image"]="url(images/ui/xuan_02.png)";this.selectDiv.style.position="absolute";this.selectDiv.style.width="47px";this.selectDiv.style.height="47px";this.selectDiv.id="selectDiv";this.callFunc=e;this.groupInfo=c;this.init();this.reList(b.list,b.len,b.nowPage);this.refreshUI();this.myGroup=
b.ourGroupInfo;this.proxyPage=b.pageNum/(this.pageCol*this.pageRow)}},{groupInfo:null,myGroup:null,currentList:0,list:null,listCount:null,listPage:null,pageCol:2,pageRow:3,itemWidth:47,itemHeight:47,itemIntervalW:3,itemIntervalH:2,proxyPage:null,startPage:null,pageNum:null,currentPage:1,lastSelect:null,listScroller:null,dragSize:null,init:function(){this.groupAfunBtn=$("groupAfunBtn");this.groupBfunBtn=$("groupBfunBtn");this.groupInput=$("groupInput");this.groupSearchBtn=$("groupSearchBtn");this.groupCancelBtn=
$("groupCancelBtn");this.pagePrev=$("groupPagePrevBtn");this.pageNext=$("groupPageNextBtn");this.groupSerarch=$("groupSerarch");this.pageDiv=$("groupPageNum");this.infoDiv=$("groupInfoDiv");this.listDiv=$("grouplistDiv");this.groupSearchDiv=$("groupSearchDiv");this.groupTimeDiv=$("groupTimeDiv");this.groupSelGroup=$("groupSelGroup");this.groupSerarch[app.Event.ONCLICK]=function(){this.focus()};this.groupAfunBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.groupBfunBtn[app.Event.ONCLICK]=
ClassUtils.delegate(this,this.handleEvent);this.groupSearchBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.groupCancelBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.pagePrev[app.Event.ONCLICK]=ClassUtils.delegate(this,this.pageBtn,0);this.pageNext[app.Event.ONCLICK]=ClassUtils.delegate(this,this.pageBtn,1)},step:function(){if(this.groupInfo&&(4==this.groupInfo.status||3==this.groupInfo.status)){if(null!=this.groupInfo.time)0>=this.groupInfo.time.getTime()?
(this.groupInfo.time=null,this.callFunc({type:app.view.system.ArmyGroupListView.REENTER})):this.groupTimeDiv.innerHTML=(4==this.groupInfo.status?"\u89e3\u6563\u51b7\u5374\uff1a":"\u9000\u51fa\u51b7\u5374\uff1a")+'<label class="fc6">'+this.groupInfo.time+"</label>"}else this.groupTimeDiv.innerHTML=""},refreshUI:function(){3==this.groupInfo.status?(this.groupTimeDiv.style.visibility="visible",this.groupSearchDiv.style.visibility="hidden",this.groupAfunBtn.style.visibility="hidden",this.groupBfunBtn.style.visibility=
"hidden"):4==this.groupInfo.status?(this.groupTimeDiv.style.visibility=8==this.groupInfo.pos?"visible":"hidden",this.groupSearchDiv.style.visibility="hidden",this.groupAfunBtn.style.visibility="hidden",this.groupBfunBtn.style.visibility=8==this.groupInfo.pos?"visible":"hidden",this.groupBfunBtn.value="\u53d6\u6d88\u89e3\u6563"):2==this.groupInfo.status?(this.groupTimeDiv.style.visibility="hidden",this.groupSearchDiv.style.visibility="hidden",this.groupAfunBtn.style.visibility="hidden",this.groupBfunBtn.style.visibility=
"visible",this.groupBfunBtn.value="\u53d6\u6d88\u7533\u8bf7"):1==this.groupInfo.status?(this.groupTimeDiv.style.visibility="hidden",this.groupSearchDiv.style.visibility="hidden",this.groupAfunBtn.style.visibility="hidden",this.groupBfunBtn.style.visibility=8==this.groupInfo.pos?"visible":"hidden",this.groupBfunBtn.value="\u4fee\u6539\u5ba3\u8a00"):(this.groupTimeDiv.style.visibility="hidden",this.groupSearchDiv.style.visibility="visible",this.groupSerarch.focus(),this.groupAfunBtn.style.visibility=
"visible",this.groupBfunBtn.style.visibility="visible",this.groupAfunBtn.value="\u52a0\u5165\u519b\u56e2",this.groupBfunBtn.value="\u6210\u7acb\u519b\u56e2")},gotoPage:function(b){if(0<b&&b<=this.listPage){var c=this.pageCol*this.pageRow*(b-1);this.listScroller.scroller.__publish(118*(b-1),0);this.showPage();this.showInfo(c)}},pageBtn:function(b,c){var e=0==c?this.currentPage-1:this.currentPage+1;0<e&&e<=this.listPage?this.gotoPage(e):this.loadNext(c)},getPage:function(){if(null!=this.listScroller)this.currentPage=
Math.ceil(this.listScroller.scroller.getValues().left/(this.pageCol*(this.itemWidth+this.itemIntervalW)-this.itemIntervalW)),this.showPage()},showPage:function(){if(this.currentPage>this.listPage)this.currentPage=this.listPage;if(0>=this.currentPage)this.currentPage=1;if(0>=this.pageNum)this.pageNum=1;this.pageDiv.innerHTML=this.currentPage+this.startPage+"/"+this.pageNum},loadNext:function(b){if(0==b&&1<this.startPage)this.currentPage=this.proxyPage,this.listScroller.scroller.__callback=null,this.callFunc({type:app.view.system.ArmyGroupListView.GROUP_LIST,
data:{type:b,l:this.currentList}});else if(1==b&&this.startPage+this.currentPage<this.pageNum)this.currentPage=1,this.listScroller.scroller.__callback=null,this.callFunc({type:app.view.system.ArmyGroupListView.GROUP_LIST,data:{type:b,l:this.currentList}})},reList:function(b,c,e){this.list=b;this.listCount=c;this.pageNum=Math.ceil(this.listCount/(this.pageCol*this.pageRow));this.listPage=Math.ceil(this.list.length/(this.pageCol*this.pageRow));this.startPage=(e-1)*this.proxyPage;this.listDiv.innerHTML=
"";var f,e=document.createDocumentFragment(),b=this.list.length;if(0>=b)this.pagePrev.style.visibility="hidden",this.pageNext.style.visibility="hidden",this.listDiv.innerHTML='<div style="margin-top:10px;margin-left: 10px;text-align: center;">\u6ca1\u6709\u53ef\u52a0\u5165\u7684\u961f\u4f0d!<br>\u60a8\u53ef\u4ee5\u9009\u62e9\u201c\u6210\u7acb\u961f\u4f0d\u201d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u961f\u4f0d\u3002</div>';else{this.pagePrev.style.visibility="visible";this.pageNext.style.visibility=
"visible";for(var g=0;g<b;g++)c=this.getPos(g),e.appendChild(this.createNew(g,this.list[g],ClassUtils.delegate(this,this.itemSelect),c[0],c[1]));this.listDiv.appendChild(e);f=this;b=[118,152];this.dragSize=b[0]*this.listPage;this.listDiv.style.width=this.dragSize+"px";this.listDiv.style.height=b[1]+"px";if(this.listScroller)this.listScroller.depose(),this.listScroller=null;this.listScroller=new app.view.base.ScrollView(function(b){f.getPage();f.listDiv.style["-webkit-transform"]="translateX("+-b+
"px)"},b[0],b[1],this.dragSize,b[1],this.listDiv,{scrollingY:!1,paging:!0,bouncing:!0});this.listScroller.scroller.activateDragToRefresh((this.listPage-1)*b[0]+5,function(){},function(){},function(){f.listScroller.scroller.finishDragToRefresh();f.loadNext(0<f.listScroller.scroller.getValues().left)});this.gotoPage(this.currentPage)}},getPos:function(b){var c=this.pageRow,e=this.pageCol,f=this.itemWidth,g=this.itemHeight,h=this.itemIntervalW,j=this.itemIntervalH,k;k=Math.floor(b/(c*e))+1;return[(f+
h)*e*(k-1)+b%e*(f+h),Math.floor((b-(k-1)*c*e)/e)*(g+j)]},createNew:function(b,c,e,f,g){var h=document.createElement("div");h.className="jtImg_01";h.itemI=b;h.itemId=c.id;h.style.width=this.itemWidth+"px";h.style.height=this.itemHeight+"px";h.style["background-image"]="url("+app.GameData.imageSrc+"group/"+this.getBg(c.level)+")";h[app.Event.ONCLICK]=e;h.style.textAlign="center";h.innerHTML='<div class="jtSelText" style="position: absolute;line-height:47px;font-size:16px;">'+c.name.substr(0,1)+"</div>";
h.style.left=f+"px";h.style.top=g+"px";return h},getBg:function(b){return 100==b?"junt5.gif":90<=b?"junt4.gif":80<=b?"junt3.gif":40<=b?"junt2.gif":"junt1.gif"},itemSelect:function(b){if(!b||!isNaN(b.currentTarget.itemI))this.lastSelect=b.currentTarget?!b?0:b.currentTarget.itemI:!b?0:b.touchs[0].currentTarget.itemI,this.showInfo(this.lastSelect)},showInfo:function(b){if(null!=b)this.lastSelect=b;var c;c=this.list[b];if(null!=c)b=this.infoDiv.getElementsByTagName("span"),this.groupSelGroup.style["background-image"]=
"url("+app.GameData.imageSrc+"group/"+this.getBg(c.level)+")",this.groupSelGroup.innerHTML='<div style="width:47px;height:47px;line-height:47px;font-size:16px;">'+c.name.substr(0,1)+"</div>",this.listDiv.childNodes[this.lastSelect].appendChild(this.selectDiv),b[0].innerHTML=c.name,b[1].innerHTML=c.level,b[2].innerHTML=c.teamNum+"/"+c.groupNum,b[3].innerHTML=c.colonel,b[4].innerHTML=this.getCountryNameById(c.country),b[5].innerHTML=c.rank,this.groupInput.value=c.declaration},handleEvent:function(b){var c;
if(b.currentTarget==this.groupCancelBtn)c=app.view.system.ArmyGroupListView.GROUP_CANCLESEARCH;else{if(b.currentTarget==this.groupSearchBtn){10<this.groupSerarch.value.length?(app.view.Alert.getInstance().show("\u8bf7\u8f93\u516510\u4e2a\u4ee5\u4e0b\u5b57\u7b26\uff01"),this.groupSerarch.value=""):(c=app.view.system.ArmyGroupListView.GROUP_SEARCH,this.callFunc({type:c,data:this.groupSerarch.value}));return}if(b.currentTarget==this.groupAfunBtn){if(0==this.groupInfo.status)c=app.view.system.ArmyGroupListView.GROUP_JOIN}else if(b.currentTarget==
this.groupBfunBtn)if(0==this.groupInfo.status)c=app.view.system.ArmyGroupListView.GROUP_CREATE;else if(1==this.groupInfo.status)c=app.view.system.ArmyGroupListView.GROUP_MANIFESTO;else if(2==this.groupInfo.status)c=app.view.system.ArmyGroupListView.GROUP_CANCLEJOIN;else if(4==this.groupInfo.status)c=app.view.system.ArmyGroupListView.CANCEL_DISMISS}this.callFunc({type:c,data:this.list[this.lastSelect]})},depose:function(){this.groupAfunBtn[app.Event.ONCLICK]=null;this.groupBfunBtn[app.Event.ONCLICK]=
null;this.groupSearchBtn[app.Event.ONCLICK]=null;this.groupCancelBtn=this.groupSearchBtn=this.groupBfunBtn=this.groupAfunBtn=this.groupCancelBtn[app.Event.ONCLICK]=null;this.listScroller&&this.listScroller.depose();this.listScroller=null;app.controller.TimeController.getInstance().removeListener(this)},getCountryNameById:function(b){var c="";return 2==b?"\u534e\u590f":3==b?"\u80e1\u5937":4==b?"\u5357\u86ee":"\u4e2d\u7acb"}},{GROUP_JOIN:"group_join",GROUP_SEARCH:"group_search",GROUP_CANCLESEARCH:"group_cancleSearch",
GROUP_CREATE:"group_create",GROUP_CANCLEJOIN:"group_cancleJoin",GROUP_MANIFESTO:"group_manifesto",REENTER:"group_reenter",CANCEL_DISMISS:"cancel_Dismiss",GROUP_LIST:"group_list"});puremvc.define({name:"app.view.system.ArmyGroupResearchView",parent:app.view.base.TabContentView,constructor:function(b,c,e){this.selectDiv=document.createElement("div");this.selectDiv.style["background-image"]="url(images/ui/xuan_02.png)";this.selectDiv.style.position="absolute";this.selectDiv.style.width="47px";this.selectDiv.style.height="47px";this.selectDiv.style["margin-left"]="6px";this.selectDiv.style["margin-top"]="6px";this.selectDiv.id="selectDiv";this.callFunc=e;this.defaultId=b.defaultId;
this.myGroup=c;this.init();this.reList(b.list,b.len,b.nowPage);this.proxyPage=b.pageNum/(this.pageCol*this.pageRow)}},{defaultId:null,myGroup:null,list:null,listCount:null,listPage:null,pageCol:4,pageRow:3,itemWidth:59,itemHeight:59,itemIntervalW:3,itemIntervalH:3,proxyPage:null,startPage:null,pageNum:null,currentPage:1,lastSelect:null,listScroller:null,dragSize:null,init:function(){this.groupResarchDefaultBtn=$("groupResarchDefaultBtn");this.groupResarchBtn=$("groupResarchBtn");this.listDiv=$("groupResarchListDiv");
this.pageDiv=$("groupResarchPageDiv");this.infoDiv=$("groupResarchInfoDiv");this.groupItemPic=$("groupItemPic");this.groupResarchDefaultBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.groupResarchBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent)},gotoPage:function(b){b<this.pageNum&&this.list.length>(b-1)*this.pageNum&&this.listScroller.scroller.setPosition((b-1)*this.pageCol*(this.itemWidth+this.itemIntervalW),0)},showPage:function(){if(null!=this.listScroller){this.currentPage=
Math.ceil(this.listScroller.scroller.getValues().left/(this.pageCol*(this.itemWidth+this.itemIntervalW)-this.itemIntervalW));if(this.currentPage>this.pageNum)this.currentPage=this.pageNum;if(0>=this.currentPage)this.currentPage=1;if(0>=this.pageNum)this.pageNum=1;this.pageDiv.innerHTML=this.currentPage+this.startPage-1+"/"+this.pageNum}},loadNext:function(b){if(0==b&&1<this.startPage)this.currentPage=this.proxyPage,this.callFunc({type:app.view.system.ArmyGroupResearchView.GROUP_RESEARCHLIST,data:b});
else if(1==b&&this.startPage+this.currentPage<=this.pageNum)this.currentPage=0,this.callFunc({type:app.view.system.ArmyGroupResearchView.GROUP_RESEARCHLIST,data:b})},reList:function(b,c,e){this.list=b;this.listCount=c;this.pageNum=Math.ceil(this.listCount/(this.pageCol*this.pageRow));this.listPage=Math.ceil(this.list.length/(this.pageCol*this.pageRow));this.startPage=e;this.listDiv.innerHTML="";var f,e=document.createDocumentFragment(),b=this.list.length;if(!(0>=b)){for(var g=0;g<b;g++)c=this.getPos(g),
e.appendChild(this.createNew(g,this.list[g],ClassUtils.delegate(this,this.itemSelect),c[0],c[1]));this.listDiv.appendChild(e);f=this;b=[244,150];this.dragSize=b[0]*this.listPage;this.listDiv.style.width=this.dragSize+"px";this.listDiv.style.height=b[1]+"px";null==this.listScroller?this.listScroller=new app.view.base.ScrollView(function(b){f.showPage();f.listDiv.style["-webkit-transform"]="translateX("+-b+"px)"},b[0],b[1],this.dragSize,b[1],this.listDiv,{scrollingY:!1,paging:!0,bouncing:!0}):this.listScroller.update(b[0],
b[1],this.dragSize,b[1]);this.listScroller.scroller.activateDragToRefresh((this.listPage-1)*b[0]+5,function(){},function(){},function(){f.listScroller.scroller.finishPullToRefresh();f.loadNext(0<f.listScroller.scroller.getValues().left)});if(null==this.lastSelect)this.lastSelect=(this.currentPage-1)*this.pageNum,this.showInfo(this.lastSelect);this.gotoPage(this.currentPage);this.showPage()}},getPos:function(b){var c=this.pageRow,e=this.pageCol,f=this.itemWidth,g=this.itemHeight,h=this.itemIntervalW,
j=this.itemIntervalH,k;k=Math.floor(b/(c*e))+1;return[(f+h)*e*(k-1)+b%e*(f+h),Math.floor((b-(k-1)*c*e)/e)*(g+j)]},createNew:function(b,c,e,f,g){var h=document.createElement("div");h.style.position="absolute";h.itemI=b;h.itemId=c.id;h.style.width=this.itemWidth+"px";h.style.height=this.itemHeight+"px";b=app.GameData.imageSrc;h.style["background-image"]="url("+b+"ui/iconBg_05.gif)";h[app.Event.ONCLICK]=e;h.innerHTML='<div style="margin-left: 6px;margin-top: 6px;float: left"><img style="" src="'+b+"group/j_"+
c.id+'.gif" width="47" height="47"></div>';h.style.left=f+"px";h.style.top=g+"px";return h},itemSelect:function(b){if(!b||!isNaN(b.currentTarget.itemI))this.lastSelect=b.currentTarget?!b?0:b.currentTarget.itemI:!b?0:b.touchs[0].currentTarget.itemI,this.showInfo(this.lastSelect)},showInfo:function(b){if(null!=b)this.lastSelect=b;var c,e;c=this.list[this.lastSelect];if(null!=c)this.groupItemPic.innerHTML=' <img  src="images/group/j_'+c.id+'.gif" width="47" height="47"/>',b=this.infoDiv.getElementsByTagName("span"),
this.listDiv.childNodes[this.lastSelect].appendChild(this.selectDiv),e=this.getInfo(c.id),b[0].innerHTML=e.name,b[1].innerHTML=c.rank,b[2].innerHTML=100<=c.rank?"\u5df2\u8fbe\u5230\u9876\u7ea7":"\u519b\u56e2\u7b49\u7ea7"+(c.rank+1)+"\u7ea7",b[3].innerHTML=c.schedule+"/"+c.maxSchedule,b[4].innerHTML=e.con,this.groupResarchDefaultBtn.style.visibility=c.id==this.defaultId?"hidden":"visible"},getInfo:function(b){var c={};c.name="\u519b\u56e2\u7b49\u7ea7,\u5f81\u7a0e,\u6218\u529f,\u8d44\u6e90\u4ea7\u91cf,\u5a01\u671b,\u8d38\u6613".split(",")[b-
1];c.con="\u63d0\u5347\u519b\u56e2\u7b49\u7ea7\u53ef\u4ee5\u63d0\u5347\u6210\u5458\u6570\u91cf,\u63d0\u5347\u519b\u56e2\u6210\u5458\u6bcf\u6b21\u5f81\u6536\u83b7\u5f97,\u63d0\u5347\u519b\u56e2\u6210\u5458\u6bcf\u6b21\u5f81\u6218\u83b7\u5f97\u6218\u529f,\u589e\u52a0\u5728\u6237\u90e8\u6536\u83b7\u65f6\u7684\u8d44\u6e90\u83b7\u5f97\u91cf,\u589e\u52a0\u5a01\u671b\u83b7\u5f97\u91cf,\u63d0\u9ad8\u901a\u5546\u65f6\u4e70\u5356\u5546\u54c1\u83b7\u5f97\u7684\u94f6\u5e01".split(",")[b-1];return c},handleEvent:function(b){var c;
if(b.currentTarget==this.groupResarchDefaultBtn)c=app.view.system.ArmyGroupResearchView.GROUP_RESEARCHSET;else if(b.currentTarget==this.groupResarchBtn)c=app.view.system.ArmyGroupResearchView.GROUP_RESEARCH;this.callFunc({type:c,data:this.list[this.lastSelect]})},depose:function(){this.groupResarchDefaultBtn[app.Event.ONCLICK]=null;this.groupResarchBtn=this.groupResarchDefaultBtn=this.groupResarchBtn[app.Event.ONCLICK]=null;this.listScroller&&this.listScroller.depose();this.listScroller=null},setDefault:function(b){this.defaultId=
b;this.showInfo(this.lastSelect)}},{GROUP_RESEARCH:"group_research",GROUP_RESEARCHSET:"group_researchSet",GROUP_RESEARCHLIST:"group_researchList"});puremvc.define({name:"app.view.system.ArmyGroupOurView",parent:app.view.base.TabContentView,constructor:function(b,c,e,f,g){this.callFunc=g;this.init();this.pos=e;this.status=f;this.reList(b.list,b.len,b.nowPage);this.reInfo(c.ourGroupInfo);this.proxyPage=b.pageNum/(this.pageCol*this.pageRow)}},{pos:null,myGroup:null,list:null,listCount:null,listPage:null,pageCol:4,pageRow:2,itemWidth:76,itemHeight:29,itemIntervalW:15,itemIntervalH:3,proxyPage:null,startPage:null,pageNum:null,currentPage:1,lastSelect:null,
listScroller:null,dragSize:null,init:function(){this.groupPromotionBtn=$("groupPromotionBtn");this.groupExitBtn=$("groupExitBtn");this.groupPubBtn=$("groupPubBtn");this.myGroupNum=$("myGroupNum");this.pagePrev=$("groupTeamPagePrevBtn");this.pageNext=$("groupTeamPageNextBtn");this.listDiv=$("groupTeamListDiv");this.pageDiv=$("groupTeamPageDiv");this.infoDiv=$("groupTeamInfoDiv");this.pubDiv=$("groupTeamPubDiv");this.groupMyGroup=$("groupMyGroup");this.groupPromotionBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,
this.handleEvent);this.groupPubBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.groupExitBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.pagePrev[app.Event.ONCLICK]=ClassUtils.delegate(this,this.pageBtn,0);this.pageNext[app.Event.ONCLICK]=ClassUtils.delegate(this,this.pageBtn,1)},gotoPage:function(b){if(0<b&&b<=this.listPage){var c=this.pageCol*this.pageRow*(b-1);this.listScroller.scroller.__publish(354*(b-1),0);this.showPage();this.showInfo(c)}},pageBtn:function(b,
c){var e=0==c?this.currentPage-1:this.currentPage+1;0<e&&e<=this.listPage?this.gotoPage(e):this.loadNext(c)},getPage:function(){if(null!=this.listScroller)this.currentPage=Math.ceil(this.listScroller.scroller.getValues().left/(this.pageCol*(this.itemWidth+this.itemIntervalW)-this.itemIntervalW)),this.showPage()},showPage:function(){if(this.currentPage>this.listPage)this.currentPage=this.listPage;if(0>=this.currentPage)this.currentPage=1;if(0>=this.pageNum)this.pageNum=1;this.pageDiv.innerHTML=this.currentPage+
this.startPage+"/"+this.pageNum},loadNext:function(b){if(0==b&&1<this.startPage)this.currentPage=this.proxyPage,this.listScroller.scroller.__callback=null,this.callFunc({type:app.view.system.ArmyGroupListView.GROUP_LIST,data:{type:b,l:this.currentList}});else if(1==b&&this.startPage+this.currentPage<this.pageNum)this.currentPage=1,this.listScroller.scroller.__callback=null,this.callFunc({type:app.view.system.ArmyGroupListView.GROUP_LIST,data:{type:b,l:this.currentList}})},reList:function(b,c,e){this.list=
b;this.listCount=c;this.pageNum=Math.ceil(this.listCount/(this.pageCol*this.pageRow));this.listPage=Math.ceil(this.list.length/(this.pageCol*this.pageRow));this.startPage=(e-1)*this.proxyPage;this.listDiv.innerHTML="";var f,e=document.createDocumentFragment(),b=this.list.length;if(!(0>=b)){for(var g=0;g<b;g++)c=this.getPos(g),e.appendChild(this.createNew(g,this.list[g],ClassUtils.delegate(this,this.itemSelect),c[0],c[1]));this.listDiv.appendChild(e);f=this;b=[368,64];this.dragSize=b[0]*this.listPage;
this.listDiv.style.width=this.dragSize+"px";this.listDiv.style.height=b[1]+"px";if(this.listScroller)this.listScroller.depose(),this.listScroller=null;this.listScroller=new app.view.base.ScrollView(function(b){f.getPage();f.listDiv.style["-webkit-transform"]="translateX("+-b+"px)"},b[0],b[1],this.dragSize,b[1],this.listDiv,{scrollingY:!1,paging:!0,bouncing:!0});this.listScroller.scroller.activateDragToRefresh((this.listPage-1)*b[0]+5,function(){},function(){},function(){f.listScroller.scroller.finishDragToRefresh();
f.loadNext(0<f.listScroller.scroller.getValues().left)});if(null==this.lastSelect)this.lastSelect=(this.currentPage-1)*this.pageNum;this.gotoPage(this.currentPage);if(this.myGroup)this.myGroupNum.innerHTML=this.listCount+"/"+this.myGroup.groupNum}},getPos:function(b){var c=this.pageRow,e=this.pageCol,f=this.itemWidth,g=this.itemHeight,h=this.itemIntervalW,j=this.itemIntervalH,k;k=Math.floor(b/(c*e))+1;return[(f+h)*e*(k-1)+b%e*(f+h),Math.floor((b-(k-1)*c*e)/e)*(g+j)]},createNew:function(b,c,e,f,g){e=
document.createElement("div");e.style.position="absolute";e.className="sqList_01";e.itemI=b;e.itemId=c.id;e.style.width=this.itemWidth+"px";e.style.height=this.itemHeight+"px";var h=this;e[app.Event.ONMOUSE_DOWN]=function(c){var e=0;c.target[app.Event.ONMOVE]=function(){e=1};c.target[app.Event.ONMOUSE_UP]=function(){0==e&&h.itemSelect(b)}};e.style.textAlign="center";e.innerHTML=c.name;e.style.left=f+"px";e.style.top=g+"px";return e},itemSelect:function(b){this.lastSelect=null==b?0:b;this.callFunc({type:app.view.system.ArmyGroupOurView.GROUP_TEAMINFO,
data:this.list[this.lastSelect]})},reInfo:function(b){this.myGroup=b;this.showInfo()},showInfo:function(){var b,c;c=this.myGroup;if(null!=c){b=this.infoDiv.getElementsByTagName("span");this.groupMyGroup.style["background-image"]="url("+app.GameData.imageSrc+"group/"+this.getBg(c.level)+")";this.groupMyGroup.innerHTML='<div style="width:47px;height:47px;line-height:47px;font-size:16px;">'+c.name.substr(0,1)+"</div>";b[0].innerHTML=c.name;b[1].innerHTML=c.level;b[2].innerHTML=c.colonel;if(this.listCount)this.myGroupNum.innerHTML=
this.listCount+"/"+this.myGroup.groupNum;this.pubDiv.innerHTML=c.announcement;this.groupPromotionBtn.style.visibility=8==this.pos?"hidden":"visible";this.groupExitBtn.style.visibility=8==this.pos&&4==this.status?"hidden":"visible"}},getBg:function(b){return 100==b?"junt5.gif":90<=b?"junt4.gif":80<=b?"junt3.gif":40<=b?"junt2.gif":"junt1.gif"},handleEvent:function(b){var c;if(b.currentTarget==this.groupPromotionBtn)c=app.view.system.ArmyGroupOurView.GROUP_PROMOTION;else if(b.currentTarget==this.groupExitBtn)c=
app.view.system.ArmyGroupOurView.GROUP_EXITGROUP;else if(b.currentTarget==this.groupPubBtn)c=app.view.system.ArmyGroupOurView.GROUP_TEAMNOTES;this.callFunc({type:c})},depose:function(){this.groupPromotionBtn[app.Event.ONCLICK]=null;this.groupExitBtn[app.Event.ONCLICK]=null;this.groupExitBtn=this.groupPubBtn=this.groupPromotionBtn=this.groupPubBtn[app.Event.ONCLICK]=null;this.listScroller&&this.listScroller.depose();this.listScroller=null}},{GROUP_PROMOTION:"group_Promotion",GROUP_EXITGROUP:"group_exitgroup",
GROUP_TEAMINFO:"group_teaminfo",GROUP_TEAMNOTES:"group_teamNotes",GROUP_TEAMLIST:"group_teamList"});puremvc.define({name:"app.view.system.ArmyGroupAskListView",parent:app.view.base.TabContentView,constructor:function(b,c,e){this.selectDiv=document.createElement("div");this.selectDiv.style["background-image"]="url(images/ui/ico_17.png)";this.selectDiv.style.position="absolute";this.selectDiv.style.width="26px";this.selectDiv.style.height="24px";this.selectDiv.style["margin-left"]="21px";this.selectDiv.style.top="2px";this.selectDiv.style.left="30px";this.selectDiv.id="selectDiv";this.callFunc=e;
this.power=c;this.init();this.reList(b.list,b.len,b.nowPage);this.proxyPage=b.pageNum/(this.pageCol*this.pageRow)}},{power:null,myGroup:null,list:null,listCount:null,listPage:null,pageCol:3,pageRow:4,itemWidth:76,itemHeight:29,itemIntervalW:10,itemIntervalH:8,proxyPage:null,startPage:null,pageNum:null,currentPage:1,lastSelect:null,listScroller:null,dragSize:null,init:function(){this.groupAgreeBtn=$("groupAgreeBtn");this.groupDisagreeBtn=$("groupDisagreeBtn");this.listDiv=$("groupAskListDiv");this.pageDiv=
$("groupAskPageDiv");this.infoDiv=$("groupAskInfoDiv");this.groupAgreeBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.groupDisagreeBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.groupAgreeBtn.disabled="disabled";this.groupDisagreeBtn.disabled="disabled"},gotoPage:function(b){if(0<b&&b<=this.listPage){var c=this.pageCol*this.pageRow*(b-1);this.listScroller.scroller.__publish(354*(b-1),0);this.showPage();this.showInfo(c)}},getPage:function(){if(null!=this.listScroller)this.currentPage=
Math.ceil(this.listScroller.scroller.getValues().left/(this.pageCol*(this.itemWidth+this.itemIntervalW)-this.itemIntervalW)),this.showPage()},showPage:function(){if(this.currentPage>this.listPage)this.currentPage=this.listPage;if(0>=this.currentPage)this.currentPage=1;if(0>=this.pageNum)this.pageNum=1;this.pageDiv.innerHTML=this.currentPage+this.startPage+"/"+this.pageNum},loadNext:function(b){if(0==b&&1<this.startPage)this.currentPage=this.proxyPage,this.listScroller.scroller.__callback=null,this.callFunc({type:app.view.system.ArmyGroupListView.GROUP_LIST,
data:{type:b,l:this.currentList}});else if(1==b&&this.startPage+this.currentPage<this.pageNum)this.currentPage=1,this.listScroller.scroller.__callback=null,this.callFunc({type:app.view.system.ArmyGroupListView.GROUP_LIST,data:{type:b,l:this.currentList}})},reList:function(b,c,e){this.list=b;this.listCount=c;this.pageNum=Math.ceil(this.listCount/(this.pageCol*this.pageRow));this.listPage=Math.ceil(this.list.length/(this.pageCol*this.pageRow));this.startPage=(e-1)*this.proxyPage;this.listDiv.innerHTML=
"";var f,e=document.createDocumentFragment(),b=this.list.length;if(0<b){for(var g=0;g<b;g++)c=this.getPos(g),e.appendChild(this.createNew(g,this.list[g],ClassUtils.delegate(this,this.itemSelect),c[0],c[1]));this.listDiv.appendChild(e);f=this;b=function(b){f.getPage();f.listDiv.style["-webkit-transform"]="translateX("+-b+"px)"};c=[264,148];this.dragSize=c[0]*this.listPage;this.listDiv.style.width=this.dragSize+"px";this.listDiv.style.height=c[1]+"px";if(this.listScroller)this.listScroller.depose(),
this.listScroller=null;this.listScroller=new app.view.base.ScrollView(b,c[0],c[1],this.dragSize,c[1],this.listDiv,{scrollingY:!1,paging:!0,bouncing:!0});b=(this.listPage-1)*c[0]+5;this.listScroller.scroller.activateDragToRefresh(b,function(){},function(){},function(){f.listScroller.scroller.finishDragToRefresh();f.loadNext(0<f.listScroller.scroller.getValues().left)})}this.gotoPage(this.currentPage)},getPos:function(b){var c=this.pageRow,e=this.pageCol,f=this.itemWidth,g=this.itemHeight,h=this.itemIntervalW,
j=this.itemIntervalH,k;k=Math.floor(b/(c*e))+1;return[(f+h)*e*(k-1)+b%e*(f+h),Math.floor((b-(k-1)*c*e)/e)*(g+j)]},createNew:function(b,c,e,f,g){var h=document.createElement("div");h.style.position="absolute";h.className="sqList_01";h.itemI=b;h.itemId=c.id;h.style.width=this.itemWidth+"px";h.style.height=this.itemHeight+"px";h[app.Event.ONCLICK]=e;h.style.textAlign="center";h.innerHTML=c.name;h.style.left=f+"px";h.style.top=g+"px";return h},itemSelect:function(b){if(!b||!isNaN(b.currentTarget.itemI))this.lastSelect=
b.currentTarget?!b?0:b.currentTarget.itemI:!b?0:b.touchs[0].currentTarget.itemI,this.showInfo(this.lastSelect)},showInfo:function(b){if(null!=b)this.lastSelect=b;var c;c=this.list[this.lastSelect];if(void 0==c)this.groupAgreeBtn.disabled="disabled",this.groupDisagreeBtn.disabled="disabled";else{b=this.infoDiv.getElementsByTagName("span");if(1==c.act)this.listDiv.childNodes[this.lastSelect].innerHTML='<label style="text-decoration:line-through">'+c.name+"</label>";this.listDiv.childNodes[this.lastSelect].appendChild(this.selectDiv);
b[0].innerHTML=c.name;b[1].innerHTML=c.level;b[2].innerHTML=c.address+"\u53f7\u533a\u57df";1==c.act||!this.power?(this.groupAgreeBtn.disabled="disabled",this.groupDisagreeBtn.disabled="disabled"):(this.groupAgreeBtn.disabled=!1,this.groupDisagreeBtn.disabled=!1)}},handleEvent:function(b){var c;if(b.currentTarget==this.groupAgreeBtn)c=app.view.system.ArmyGroupAskListView.GROUP_ASKAGREE;else if(b.currentTarget==this.groupDisagreeBtn)c=app.view.system.ArmyGroupAskListView.GROUP_ASKDISAGREE;this.callFunc({type:c,
data:this.list[this.lastSelect]})},depose:function(){this.groupAgreeBtn[app.Event.ONCLICK]=null;this.groupDisagreeBtn=this.groupAgreeBtn=this.groupDisagreeBtn[app.Event.ONCLICK]=null;this.listScroller&&this.listScroller.depose();this.listScroller=null}},{GROUP_ASKAGREE:"group_askagree",GROUP_ASKDISAGREE:"group_askDisagree",GROUP_ASKLIST:"group_askList"});puremvc.define({name:"app.view.system.GroupTeamInfoView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0)}},{info:null,firePower:!1,givePower:!1,setData:function(b,c,e){this.info=b;this.firePower=c;this.givePower=e;this.init();this.showInfo()},init:function(){this.groupTeam_fireBtn=$("groupTeam_fireBtn");this.groupTeam_assignBtn=$("groupTeam_assignBtn");this.groupTeam_cancleBtn=$("groupTeam_closeBtn");this.infoDiv=$("groupTeam_info");this.groupTeam_fireBtn[app.Event.ONCLICK]=
ClassUtils.delegate(this,this.handleEvent);this.groupTeam_assignBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.groupTeam_cancleBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent)},showInfo:function(){var b,c;c=this.infoDiv.getElementsByTagName("span");b=[this.info.name,this.info.level,this.info.donation,this.info.rank,this.getPos(this.info.pos),this.info.address+"\u53f7\u533a\u57df",0<this.info.time?"\u8be5\u597d\u53cb\u5df2\u7ecf"+this.info.time+"\u5929\u6ca1\u4e0a\u7ebf\u4e86\uff01":
""];for(var e=0;e<b.length;e++)c[e].innerHTML=b[e];this.groupTeam_fireBtn.disabled=this.firePower?!1:"disabled";this.groupTeam_assignBtn.disabled=this.givePower?!1:"disabled"},getPos:function(b){1>b&&(b=1);return"\u666e\u901a\u6210\u5458,\u4f0d\u957f,\u767e\u592b\u957f,\u5343\u592b\u957f,\u4e07\u592b\u957f,\u7763\u519b,\u526f\u519b\u56e2\u957f,\u519b\u56e2\u957f".split(",")[b-1]},handleEvent:function(b){this.dispatchEvent({type:b.currentTarget==this.groupTeam_fireBtn?app.view.system.GroupTeamInfoView.FIRE:
b.currentTarget==this.groupTeam_assignBtn?app.view.system.GroupTeamInfoView.ASSIGN:app.view.system.GroupTeamInfoView.CLOSE,data:this.info.id})}},{CLOSE:"GroupTeamInfoView_close",FIRE:"GroupTeamInfoView_fire",ASSIGN:"GroupTeamInfoView_assign"});puremvc.define({name:"app.view.system.GroupDonationView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0)}},{id:0,myMoney:0,dYet:0,dMax:0,dMoney:0,dStep:200,dNum:0,setData:function(b,c,e,f){this.myMoney=b;this.dYet=0<=e-c?e-c:0;this.dMax=e;this.id=f;this.dMoney=Math.min(this.myMoney,c);this.init();this.showInfo()},init:function(){this.groupDonation_okBtn=$("groupDonation_okBtn");this.groupDonation_addBtn=$("groupDonation_addBtn");this.groupDonation_lessBtn=
$("groupDonation_lessBtn");this.groupDonation_maxBtn=$("groupDonation_maxBtn");this.groupDonation_num=$("groupDonation_num");this.nowDonation_txt=$("nowDonation_txt");this.nowMyMoney_txt=$("nowMyMoney_txt");this.groupDonation_addBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.getNum,0);this.groupDonation_lessBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.getNum,1);this.groupDonation_maxBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.getNum,2);this.groupDonation_okBtn[app.Event.ONCLICK]=
ClassUtils.delegate(this,this.handleEvent);$("groupDonation_close")[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);$("groupDonation_cancleBtn")[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent)},getNum:function(b,c){if(0==c)this.dNum+=this.dStep;else if(1==c)this.dNum-=this.dStep;else if(2==c)this.dNum=this.dMax;if(this.dNum>this.dMoney)this.dNum=this.dMoney;if(0>this.dNum)this.dNum=0;this.showInfo()},showInfo:function(){this.groupDonation_num.innerHTML=this.dNum;this.nowDonation_txt.innerHTML=
this.dYet+"/"+this.dMax;this.nowMyMoney_txt.innerHTML=this.myMoney;this.groupDonation_addBtn.disabled=this.groupDonation_maxBtn.disabled=0<this.dMoney&&this.dNum<this.dMoney?!1:"disabled";this.groupDonation_lessBtn.disabled=0<this.dNum?!1:"disabled"},handleEvent:function(b){b.currentTarget==this.groupDonation_okBtn?0>=this.dNum?(b=app.view.system.GroupDonationView.SHOWMSG,this.dispatchEvent({type:b,data:"\u8bf7\u8f93\u5165\u6350\u732e\u6570\u91cf!"})):(b=app.view.system.GroupDonationView.OK,this.dispatchEvent({type:b,
data:{id:this.id,num:this.dNum}})):(b=app.view.system.GroupDonationView.CANCLE,this.dispatchEvent({type:b}))}},{OK:"GroupDonationView_ok",CANCLE:"GroupDonationView_cancle"});puremvc.define({name:"app.view.system.GroupInputView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0)}},{title:"\u6807\u9898",explain:"\u63d0\u793a",cLen:0,defaultCon:"",setData:function(b,c,e){this.title=b;this.cLen=c;this.defaultCon=void 0!=e?e:"";this.explain="\u8bf7\u8f93\u5165"+this.title;0<this.cLen&&(this.explain+="("+this.cLen+"\u4e2a\u6587\u5b57\u4ee5\u5185)");this.init()},init:function(){this.groupInput_okBtn=$("groupInput_okBtn");this.groupInput_con=
$("groupInput_con");$("groupInput_close")[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);$("groupInput_cancleBtn")[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.groupInput_okBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.groupInput_con[app.Event.ONCLICK]=function(){this.focus()};$("groupInput_title").innerHTML=this.title;$("groupInput_explain").innerHTML=this.explain;this.groupInput_con.value=this.defaultCon},getByteLen:function(b){for(var c=
0,e=0;e<b.length;e++)c=null!=b[e].match(/[^\x00-\xff]/ig)?c+2:c+1;return c},handleEvent:function(b){if(b.currentTarget==this.groupInput_okBtn){var c=""+this.groupInput_con.value;this.getByteLen(c)>2*this.cLen?(b=app.view.system.GroupInputView.SHOWMSG,this.dispatchEvent({type:b,data:"\u4e0d\u80fd\u8d85\u8fc7"+this.cLen+"\u4e2a\u6c49\u5b57!"})):(b=app.view.system.GroupInputView.OK,this.dispatchEvent({type:b,data:{con:c}}))}else b=app.view.system.GroupInputView.CANCLE,this.dispatchEvent({type:b})}},
{OK:"GroupInputView_ok",SHOWMSG:"GroupInputView_SHOWMSG",CANCLE:"GroupInputView_cancle"});puremvc.define({name:"app.view.system.GiftView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("gift"),!0);this.init(b);app.controller.TimeController.getInstance().addListener(this)}},{listN:null,listS:null,testGift:null,active:null,list:null,tabSelect:null,selItem:null,depose:function(){this.list=this.listN=this.listS=this.testGift=this.tabSelect=this.selItem=this.active=null;this.getGiftBtn[app.Event.ONCLICK]=null;app.controller.TimeController.getInstance().removeListener(this);
app.view.base.TabContentView.prototype.depose.call(this)},step:function(){if(1==this.tabSelect&&this.giftTipDiv&&0<this.listN.id)if(null!=this.listN.time)0>=this.listN.time.getTime()?(this.listN.time=null,this.listN.status=2,this.dispatchEvent({type:app.view.system.GiftView.GIFT_TIMEOUT}),this.giftTipDiv.innerHTML="\u606d\u559c\u60a8\u83b7\u5f97\u4ee5\u4e0a\u5956\u52b1",this.getGiftBtn.disabled=!1):(this.giftTipDiv.innerHTML='<label class="fc6">'+this.listN.time+"</label>\u540e\u53ef\u4ee5\u83b7\u5f97\u4ee5\u4e0a\u5956\u52b1",
this.getGiftBtn.disabled=!0);else{if(this.giftTipDiv)this.giftTipDiv.innerHTML="\u606d\u559c\u60a8\u83b7\u5f97\u4ee5\u4e0a\u5956\u52b1"}else if(3==this.tabSelect)0>=this.active.time.getTime()?(this.active.actRun=!1,this.getActBtn.disabled=!0,this.actTime.innerHTML='<label class="fc9">\u6d3b\u52a8\u5df2\u7ecf\u7ed3\u675f\uff01</label>'):864E5<this.active.time.getTime()?(this.actTime.innerHTML='\u5269\u4f59\u65f6\u95f4\uff1a<label class="fc6">'+Math.ceil(this.active.time.getTime()/864E5)+"\u5929</label>",
app.trace(this.active.time)):this.actTime.innerHTML='\u5269\u4f59\u65f6\u95f4\uff1a<label class="fc6">'+this.active.time+"</label>"},init:function(){this.getGiftBtn=$("getGiftBtn");this.giftInfoDiv=$("giftInfoDiv");this.giftTipDiv=$("giftTipDiv");this.giftTitle=$("giftTitle");this.closebtn=$("giftClose");this.listDiv=$("gift_list");this.itemGiftDiv=$("itemGiftDiv");this.keyGiftDiv=$("keyGiftDiv");this.ActGiftDiv=$("actGiftDiv");this.giftKeyInput=$("giftKeyInput");this.getKegGiftBtn=$("getKegGiftBtn");
this.keyGiftInputDiv=$("keyGiftInputDiv");this.keyGiftTipDiv=$("keyGiftTipDiv");this.actNameDiv=$("actNameDiv");this.actScoreDiv=$("actScoreDiv");this.actTimesDiv=$("actTimesDiv");this.getActBtn=$("getActBtn");this.actTime=$("actTime");this.getGiftBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.getKegGiftBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.getActBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.closebtn[app.Event.ONCLICK]=
ClassUtils.delegate(this,function(){this.dispatchEvent({type:app.view.system.GiftView.CLOSE})})},setData:function(b,c,e,f){this.listS=b;this.listN=c;this.testGift=e;this.active=f;if(null!=this.list)this.showInfo();else{this.list=[];if(0<this.listS.id)b={name:"\u5f00\u670d\u793c\u5305"},b.status=this.listS.status,b.type=0,this.list.push(b);if(0<this.listN.id)b={name:"\u65b0\u624b\u793c\u5305"},b.status=this.listN.status,b.type=1,this.list.push(b);0==this.testGift&&(b={name:"\u5c01\u6d4b\u793c\u5305",
status:0,type:2},this.list.push(b));if(null!=this.active)b={name:"\u8282\u65e5\u6d3b\u52a8"},b.status=this.active.status,b.type=3,this.list.push(b);sortOn(this.list,"status",1);this.layout();this.getInfo({target:this.selItem})}},getInfo:function(b){if(!b||!isNaN(b.target.idx)){if(this.selItem)this.selItem.className="rwCHo_Out";this.tabSelect=b.target.idx;if(b)this.selItem=b.target,this.selItem.className="rwCHo_Over";this.showInfo()}},showInfo:function(){if(2==this.tabSelect)this.itemGiftDiv.style.display=
"none",this.ActGiftDiv.style.display="none",this.keyGiftDiv.style.display="block",0==this.testGift?(this.keyGiftInputDiv.style.visibility="visible",this.keyGiftTipDiv.innerHTML="\u8bf7\u8f93\u5165\u793c\u54c1\u7801\uff1a"):(this.keyGiftInputDiv.style.display="none",this.keyGiftTipDiv.innerHTML="\u793c\u5305\u5df2\u7ecf\u9886\u53d6\uff01",this.keyGiftTipDiv.style.width="300px",this.keyGiftTipDiv.style.marginTop="50px");else if(3==this.tabSelect)this.itemGiftDiv.style.display="none",this.ActGiftDiv.style.display=
"block",this.keyGiftDiv.style.display="none",this.showActive();else{this.itemGiftDiv.style.display="block";this.ActGiftDiv.style.display="none";this.keyGiftDiv.style.display="none";var b=0==this.tabSelect?this.listS:this.listN;this.giftInfoDiv.innerHTML="";if(0<b.id){for(var c=b.reward.length,e=(308-60*c)/(c+1),f=0;f<c;f++){var g;g=document.createElement("div");con='<div class="jtkj_01"  style="margin-left:'+e+'px"><img style="margin-top:6px;" src="'+b.reward[f].img+'" width="47" height="47"/><p align="center" class="'+
b.reward[f].itemClass+'">'+b.reward[f].name+'</p><p align="center">x'+b.reward[f].value+"</div>";g.style.textAlign="center";g.style["float"]="left";g.innerHTML=con;this.giftInfoDiv.appendChild(g)}0==this.tabSelect?this.giftTipDiv.innerHTML="\u5f00\u670d\u7b2c"+b.time+"\u5929\u53ef\u9886\u53d6\u4ee5\u4e0a\u5956\u52b1\uff01":this.step();this.getGiftBtn.style.visibility="visible";this.giftTitle.style.visibility="visible";this.getGiftBtn.disabled=2==b.status?!1:!0}else this.giftTipDiv.innerHTML="\u5956\u52b1\u5df2\u7ecf\u9886\u5b8c\uff01",
this.getGiftBtn.style.visibility="hidden",this.giftTitle.style.visibility="hidden";for(f=0;f<this.listDiv.childNodes.length;f++)if(this.listDiv.childNodes[f].idx==this.tabSelect){this.listDiv.childNodes[f].childNodes[1].className=2==b.status?"gift_ico_on":"gift_ico_out";break}}},showActive:function(){this.actNameDiv.innerHTML=this.active.name;this.actScoreDiv.innerHTML=this.active.score;this.actTimesDiv.innerHTML=this.active.rewardTimes;this.getActBtn.disabled=0<this.active.rewardTimes&&this.active.actRun?
!1:!0;for(var b=0;b<this.listDiv.childNodes.length;b++)if(this.listDiv.childNodes[b].idx==this.tabSelect){this.listDiv.childNodes[b].childNodes[1].className=2==this.active.status?"gift_ico_on":"gift_ico_out";break}},handleEvent:function(b){b.currentTarget==this.getActBtn?0<this.active.rewardTimes&&this.active.actRun&&this.dispatchEvent({type:app.view.system.GiftView.GETACT}):b.currentTarget==this.getKegGiftBtn?this.dispatchEvent({type:app.view.system.GiftView.GETBYKEY,data:this.giftKeyInput.value}):
0==this.tabSelect&&2==this.listS.status?this.dispatchEvent({type:app.view.system.GiftView.GET,data:this.tabSelect}):1==this.tabSelect&&(2==this.listN.status||!this.listN.time)&&this.dispatchEvent({type:app.view.system.GiftView.GET,data:this.tabSelect})},layout:function(){var b,c;this.listDiv.innerHTML="";b=this.list.length;c=34*(b+1);for(var e=0;e<b;e++){var f=document.createElement("div");f.idx=this.list[e].type;f.style.width="107px";f.style.lineHeight=f.style.height="31px";f[app.Event.ONCLICK]=
ClassUtils.delegate(this,this.getInfo,this.list[e].type);f.style.textAlign="center";f.style.marginTop="3px";f.innerHTML=this.list[e].name+"<div class="+(2==this.list[e].status?"gift_ico_on":"gift_ico_out")+"></div>";f.className="rwCHo_Out";if(this.selItem){if(2!=this.list[0].status&&2==this.list[e].status)this.selItem=f}else this.selItem=f;this.listDiv.appendChild(f)}var g=this;this.dragSize=c;b=[107,190,107,c];if(this.listScroller)this.listScroller.depose(),this.listScroller=null;this.listScroller=
new app.view.base.ScrollView(function(b,c){g.listDiv.style["-webkit-transform"]="translateY("+-c+"px)"},b[0],b[1],b[2],b[3],this.listDiv)}},{CLOSE:"giftView_close",GETBYKEY:"giftView_getbykey",GIFT_TIMEOUT:"giftView_timeOut",GETACT:"giftView_GETACT",GET:"giftView_get"});puremvc.define({name:"app.view.system.ShowGiftView",parent:app.view.base.BaseUIForm},{reward:null,setData:function(b){this.list=b;this.init();this.showInfo()},init:function(){$("showGift_close")[app.Event.ONCLICK]=ClassUtils.delegate(this,this.sendEvent,app.view.system.ShowGiftView.CLOSE)},showInfo:function(){for(var b=$("giftListDiv"),c=b.innerHTML="",e=this.list.length,f=360/e,g=0;g<e;g++){var h=document.createElement("div");h.style.width=f+"px";h.style["float"]="left";c='<img src="'+this.list[g].img+
'" width="40" height="40" /><p align="center" class="'+this.list[g].itemClass+'">'+this.list[g].name+"x"+this.list[g].value+"</p>";h.style.textAlign="center";h.innerHTML=c;b.appendChild(h)}},sendEvent:function(b,c,e){this.dispatchEvent({type:c,data:e})}},{CLOSE:"showGift_close"});puremvc.define({name:"app.view.battle.JoinGroupWarView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("joinGroupWar"),!0);this.selectDiv=document.createElement("div");this.selectDiv.style.position="absolute";this.selectDiv.className="checkBox_02";this.selectDiv.id="selectDiv";this.init()}},{groupInfo:null,groupList:null,state:0,selL:0,currentL:null,currentT:null,init:function(){this.groupWarAfunBtn=$("groupWarAfunBtn");this.groupWarBfunBtn=
$("groupWarBfunBtn");this.closebtn=$("JoinGroup_close");this.groupWarAfunBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.groupWarBfunBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.closebtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent);this.groupInfoDiv=$("groupwar_info");this.grouplistDiv=$("groupwar_list");this.moveBarImg=$("groupWar_bar");this.achievement_score=$("achievement_score")},setGroupList:function(b,c){if(null!=this.teamCon){this.groupList=
b;this.showList();var e=1==c?0:this.selL;e>this.groupList.length-1&&(e=this.groupList.length-1);0<this.groupList.length&&this.showSelList(e)}},setGroupInfo:function(b,c){this.groupInfo=b;this.teamCon=c;this.showGroupInfo()},showUI:function(b){this.state=b;if(0==this.state)this.groupWarAfunBtn.style.visibility="visible",this.groupWarAfunBtn.value="\u52a0\u5165\u961f\u4f0d",this.groupWarBfunBtn.value="\u6210\u7acb\u961f\u4f0d";else if(1==this.state)this.groupWarAfunBtn.style.visibility="hidden",this.groupWarBfunBtn.value=
"\u9000\u51fa\u961f\u4f0d";else if(2==this.state)this.groupWarAfunBtn.style.visibility="visible",this.groupWarAfunBtn.value="\u961f\u5458\u7ba1\u7406",this.groupWarBfunBtn.value="\u89e3\u6563\u961f\u4f0d"},showList:function(){var b=0;if(this.listScroll)b=this.listScroll.scroller.getValues().top;var c,e;this.grouplistDiv.innerHTML="";c=this.groupList.length;this.moveBarImg.style.visibility="hidden";if(0>=c)this.grouplistDiv.innerHTML='<div style="margin-top:50px;margin-left: 10px;text-align: center;">\u6ca1\u6709\u53ef\u52a0\u5165\u7684\u961f\u4f0d!<br>\u60a8\u53ef\u4ee5\u9009\u62e9\u201c\u6210\u7acb\u961f\u4f0d\u201d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u961f\u4f0d\u3002</div>',
this.currentL=null;else{e=50*c;for(var f=0;f<c;f++){var g=this.groupList[f],h=document.createElement("div");h.idx=f;h.className="repeatDiv";h[app.Event.ONCLICK]=ClassUtils.delegate(this,this.listSelect,0);h.innerHTML=this.newList(g,f);this.grouplistDiv.appendChild(h)}var j=this;this.dragSize=e;c=[304,150];this.grouplistDiv.style.width=c[0];this.grouplistDiv.style.height=this.dragSize;this.moveBarImg.style.visibility=162<this.dragSize?"visible":"hidden";this.listScroll&&this.listScroll.depose();this.listScroll=
null;this.listScroll=new app.view.base.ScrollView(function(b,c){j.grouplistDiv.style["-webkit-transform"]="translateY("+-c+"px)";150<j.dragSize&&(j.moveBarImg.style["-webkit-transform"]="translateY("+136*(c/(j.dragSize-150))+"px)")},c[0],c[1],c[0],this.dragSize,this.grouplistDiv);b=Math.min(b,this.listScroll.scroller.getScrollMax().top);this.listScroll.scroller.__publish(0,b,1)}},newList:function(b,c){var e,f="";(e=b.tName)&&0<e.length&&(f=this.teamCon[b.team-1]+":"+e.substr(0,4)+(4<e.length?"...":
""));e='<div class="jtDiv"><div class="jtDiv_01"><div class="p_01">'+b.owner;e=e+'</div><div class="p_02"><span>'+b.tNum;e=e+"</span>/<span>"+b.tMax;e=e+'</span></div><div class="p_03">'+(0<this.state&&0==c?"<label class='fc9'>\u5df2\u52a0\u5165<label>":"\u5f85\u52a0\u5165");e=e+'</div></div><div class="jtDiv_02"><div class="p_04">\u7b49\u7ea7\u9650\u5236&nbsp;<span>'+b.level;return e+'</span></div><div class="p_05">\u7ec4\u961f\u9650\u5236'+f+"<span>"+('</span></div></div></div><div id="sel'+c+'" class="jtXuan_out"></div>')},
showGroupInfo:function(){for(var b=this.groupInfoDiv.getElementsByTagName("span"),c=this.groupInfo,c=[c.name,c.conf.level,c.conf.feat,"4~8",'<label class=" '+app.getStyle(c.quality)+'">'+c.reward+"</label>",c.rewardGet],e=0;e<c.length;e++)b[e].innerHTML=c[e]},listSelect:function(b,c){if(!b||!isNaN(b.currentTarget.idx)){var e;e=b.currentTarget?!b?0:b.currentTarget.idx:!b?0:b.touchs[0].currentTarget.idx;0==c?this.showSelList(e):this.showSelTeamr(e)}},showSelList:function(b){if($("sel"+this.selL))$("sel"+
this.selL).className="jtXuan_out";this.selL=b;this.currentL=this.groupList[this.selL];$("sel"+this.selL).className="jtXuan_on"},handleEvent:function(b){var c;if(b.currentTarget==this.groupWarAfunBtn)if(0==this.state){if(!this.currentL||!this.currentL.id)return;c=app.view.battle.JoinGroupWarView.JOINGROUP}else{if(2==this.state)c=app.view.battle.JoinGroupWarView.REMOVETEAM}else if(b.currentTarget==this.groupWarBfunBtn)if(0==this.state)c=app.view.battle.JoinGroupWarView.CREATGROUP;else if(1==this.state)c=
app.view.battle.JoinGroupWarView.EXITGROUP;else{if(2==this.state)c=app.view.battle.JoinGroupWarView.REMOVEGROUP}else if(b.currentTarget==this.closebtn){this.close();return}this.dispatchEvent({type:c,data:{group:this.currentL,team:this.currentT}})},close:function(){this.groupWarAfunBtn[app.Event.ONCLICK]=null;this.groupWarBfunBtn=this.groupWarAfunBtn=this.groupWarBfunBtn[app.Event.ONCLICK]=null;this.listScroller&&this.listScroller.depose();this.listScroller=null;this.dispatchEvent({type:app.view.battle.JoinGroupWarView.CLOSE,
target:this})}},{CLOSE:"close",JOINGROUP:"joingroup",CREATGROUP:"creatgroup",REMOVETEAM:"removeTeam",REMOVEGROUP:"removeGroup",EXITGROUP:"exitgroup"});puremvc.define({name:"app.view.battle.CreatGroupOptionsView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0)}},{levelCon:null,teamCon:null,numCon:null,options:null,setData:function(b,c,e){this.levelCon=b;this.teamCon=c;this.numCon=e;this.options={};this.options.level=0;this.options.team=0;this.options.num=0;this.init();this.layout();this.setLevel(null,0);this.setTeam(null,0);this.setNum()},init:function(){this.groupWar_OK=$("groupWar_OK");this.creatGroupOption_close=
$("creatGroupOption_close");this.creatGroupAddBtn=$("creatGroupAddBtn");this.creatGroupLessBtn=$("creatGroupLessBtn");this.creatLevel_div=$("creatLevel_div");this.creatTeam_div=$("creatTeam_div");this.creatNum_div=$("creatNum_div");this.selectLevelDiv=$("selectLevelDiv");this.selectTeamDiv=$("selectTeamDiv");this.groupWar_OK[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent,app.view.battle.CreatGroupOptionsView.OK);this.creatGroupOption_close[app.Event.ONCLICK]=ClassUtils.delegate(this,
this.handleEvent,app.view.battle.CreatGroupOptionsView.CANCLE);this.creatGroupAddBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.addNum,1);this.creatGroupLessBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.addNum,0)},layout:function(){this.creatLevel_div.innerHTML="";var b;for(b=0;b<this.levelCon.length;b++){var c=document.createElement("div");c.className="jtxxBtn";c.innerHTML=this.levelCon[b];c[app.Event.ONCLICK]=ClassUtils.delegate(this,this.setLevel,b);this.creatLevel_div.appendChild(c)}this.creatTeam_div.innerHTML=
"";for(b=0;b<this.teamCon.length;b++)c=document.createElement("div"),c.className="jtxxBtn",c.innerHTML=this.teamCon[b],c[app.Event.ONCLICK]=ClassUtils.delegate(this,this.setTeam,b),this.creatTeam_div.appendChild(c)},setLevel:function(b,c){if(null!=c){var e=this.creatLevel_div.getElementsByTagName("div")[c];this.selectLevelDiv.style.top=e.offsetTop+2+"px";this.selectLevelDiv.style.left=e.offsetLeft+50+"px";this.options.level=c}},setTeam:function(b,c){if(null!=c){var e=this.creatTeam_div.getElementsByTagName("div")[c];
this.selectTeamDiv.style.top=e.offsetTop+2+"px";this.selectTeamDiv.style.left=e.offsetLeft+50+"px";this.options.team=c}},setNum:function(){this.creatNum_div.innerHTML=this.numCon[this.options.num];this.creatGroupAddBtn.disabled=this.options.num<this.numCon.length-1?!1:"disabled";this.creatGroupLessBtn.disabled=0<this.options.num?!1:"disabled"},addNum:function(b,c){if(null!=this.options.num){0==c?this.options.num--:this.options.num++;if(0>this.options.num)this.options.num=0;if(this.options.num>this.numCon.length-
1)this.options.num=this.numCon.length-1;this.setNum()}},handleEvent:function(b,c){this.dispatchEvent({type:c,options:this.options})}},{OK:"CreatGroupOptionsView_Ok",CANCLE:"CreatGroupOptionsView_cancle"});puremvc.define({name:"app.view.battle.CreatGroupTeamView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b,!0)}},{list:null,setData:function(b){this.list=b;this.init();this.layout();if(null==this.options)this.options=0;if(this.options>this.list.length-1)this.options=this.list.length-1;this.setTeam(null,this.options)},init:function(){this.groupWar_OK=$("groupWarTeam_OK");this.creatGroupTeam_close=$("creatGroupTeam_close");this.creatTimer_div=$("creatTimer_div");
this.selectTeamDiv=$("selectTeamerDiv");this.groupWar_OK[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent,app.view.battle.CreatGroupTeamView.OK);this.creatGroupTeam_close[app.Event.ONCLICK]=ClassUtils.delegate(this,this.handleEvent,app.view.battle.CreatGroupTeamView.CANCLE)},layout:function(){this.creatTimer_div.innerHTML="";var b;for(b=0;b<this.list.length;b++){var c=document.createElement("div");c.className="jtxxBtn";c.innerHTML=this.list[b].name;c[app.Event.ONCLICK]=ClassUtils.delegate(this,
this.setTeam,b);this.creatTimer_div.appendChild(c)}},setTeam:function(b,c){if(null!=c){var e=this.creatTimer_div.getElementsByTagName("div")[c];this.selectTeamDiv.style.top=e.offsetTop+2+"px";this.selectTeamDiv.style.left=e.offsetLeft+50+"px";this.options=c}},handleEvent:function(b,c){this.dispatchEvent({type:c,options:this.list[this.options]})}},{OK:"CreatGroupTeamView_Ok",CANCLE:"CreatGroupTeamView_cancle"});puremvc.define({name:"app.view.smallGame.Enemy",constructor:function(b,c){this.container=new Container;this.enemyConf=b;this.hp=this.enemyConf.hp;this.bitmapAnimation=new app.view.smallGame.EnemyBitmapAnimation(b,c);this.container.addChild(this.bitmapAnimation);this.bitmapAnimation.climb();this.hpShape=new Shape;this.hpShape.graphics.beginFill("#F00").drawRect(10,0,25,3).beginFill("#FFF");this.container.addChild(this.hpShape);var e=Math.floor(100*Math.random()),f,g;if(0<=e&&25>e)this.container.x=
50,this.container.y=245,f=73,g=62,this.topY=60;else if(25<=e&&50>e)this.container.x=130,this.container.y=245,f=145,g=56,this.topY=35;else if(50<=e&&75>e)this.container.x=270,this.container.y=245,f=285,this.topY=g=55;else if(75<=e&&100>=e)this.container.x=345,this.container.y=245,f=360,g=55,this.topY=50;e=Math.atan2(g-this.container.y,f-this.container.x);this.xSpeed=this.enemyConf.speed*Math.cos(e);this.ySpeed=this.enemyConf.speed*Math.sin(e)}},{container:null,enemyConf:null,bitmapAnimation:null,hpShape:null,
hp:null,xSpeed:null,ySpeed:null,topY:null,beAttack:function(){0<this.hp&&(this.hp--,this.hpShape.graphics.clear(),this.hpShape.graphics.beginFill("#F00").drawRect(10,0,25*(this.hp/this.enemyConf.hp),3).beginFill("#FFF"))}},{});puremvc.define({name:"app.view.smallGame.EnemyBitmapAnimation",parent:BitmapAnimation,constructor:function(b,c){this.data={images:[c.getContent("enemy_"+b.id)],animations:{climb:[0,1,"climb",5],dead:[2,4,"",5]},frames:{height:95,regX:0,count:5,regY:0,width:48}};BitmapAnimation.call(this,new SpriteSheet(this.data))}},{animationEnd:null,onAnimationEnd:function(b,c){"dead"==c&&(this.gameScene.removeChild(this.enemy.container),this.enemyList.splice(this.enemyList.indexOf(this.enemy),1))},climb:function(){this.gotoAndPlay("climb")},
dead:function(b,c,e){this.gotoAndPlay("dead");this.gameScene=c;this.enemyList=e;this.enemy=b},standUp:function(){this.gotoAndStop(0)}},{});puremvc.define({name:"app.view.smallGame.HitBitmapAnimation",parent:BitmapAnimation,constructor:function(b,c,e){this.data={images:[c.getContent("hit")],animations:{all:[0,2]},frames:{height:32,regX:0,count:3,regY:0,width:44}};BitmapAnimation.call(this,new SpriteSheet(this.data));this.x=b.container.x;this.y=b.container.y;this.gameScene=e;this.gotoAndPlay(0)}},{onAnimationEnd:function(b){b.stop();b.animationEnd&&b.animationEnd();b.animationEnd=null;this.gameScene.removeChild(this)}},{});puremvc.define({name:"app.view.system.ChallengeView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("challenge"),!0);this.init()}},{scene:[452,217],listScroller:null,init:function(){var b=this;$("challengeClose")[app.Event.ONCLICK]=function(){null!=b.listScroller&&b.listScroller.depose();b.dispatchEvent({type:app.view.system.ChallengeView.CLOSE})};this.listDiv=$("challengeListDiv");this.pageHtml=$("challengePage")},showLayout:function(){this.listDiv.innerHTML=
"";var b,c,e,f,g;f=document.createDocumentFragment();b=this.list.length;for(g=0;g<b;g++)c=this.getPos(g),f.appendChild(this.createNew(g,this.list[g],ClassUtils.delegate(this,this.handler,this.list[g]),c[0],c[1]));for(g=4*this.pCount;b<g;)c=this.getPos(b),f.appendChild(this.createNew(b+1,null,null,c[0],c[1])),b++;this.listDiv.appendChild(f);e=this;this.dragSize=this.scene[0]*this.pCount;this.listDiv.style.width=this.dragSize+"px";this.listDiv.style.height=this.scene[1]+"px";null!=this.listScroller&&
this.listScroller.depose();this.listScroller=null;this.listScroller=new app.view.base.ScrollView(function(b){e.showPage();e.listDiv.style["-webkit-transform"]="translateX("+-b+"px)"},this.scene[0],this.scene[1],this.dragSize,this.scene[1],this.listDiv,{scrollingY:!1,paging:!0,bouncing:!0})},getPos:function(b){return[this.scene[0]*Math.floor(b/4)+90*(b%4)+20,0==(b+1)%2?120:20]},createNew:function(b,c,e,f,g){e=document.createElement("div");e.style.position="absolute";e.className="challengeBg";if(c){var h=
this;e[app.Event.ONMOUSE_DOWN]=function(b){var e=0;b.target[app.Event.ONMOVE]=function(){e=1};b.target[app.Event.ONMOUSE_UP]=function(){0==e&&h.handler(c)}};str='<div class="challengeHero" style="background:url('+("images/heros/hero_"+c.conf.picId+".gif")+') top center no-repeat;">'+c.conf.name.split("\uff08",2)[0]+"</div>";str+='<div class="clallengeInfo"><p>\u6218\u529f:'+c.conf.feat+"</p><p>\u6b21\u6570:"+c.count+"/"+c.conf.attackNum+'</p><p>\u6389\u843d:<label class=" '+app.getStyle(c.quality)+
'">'+c.reward+"</label></p><p>\u673a\u7387:"+c.getProbability()+"</p>";this.nowJoin==b?(str+=' <p class="fc9">\u7b49\u5f85\u4e2d...</p></div>',str+='<img src="images/ui/in4.png" style="position: absolute; top:-10px; left:0">'):str+="</div>";e.innerHTML=str}else e.innerHTML='<div class="challengeNoBg01"></div><div class="challengeNoBg02"></div>';e.style.width="160px";e.style.height="92px";e.style.left=f+"px";e.style.top=g+"px";return e},handler:function(b){b.attack?this.dispatchEvent({type:app.view.system.ChallengeView.SELECT_MAP,
target:this,data:b}):this.dispatchEvent({type:app.view.system.ChallengeView.SHOWMSG,data:"\u8be5\u519b\u56e2\u4eca\u5929\u7684\u653b\u6253\u6b21\u6570\u5df2\u6ee1!"})},showPage:function(){if(null!=this.listScroller){var b=Math.ceil(this.listScroller.scroller.getValues().left/(this.scene[0]-2));1>b&&(b=1);if(b>this.pCount)b=this.pCount;var c;if(0!=this.p)c=this.pageHtml.childNodes[this.p-1],c.style.background="url(images/ui/dotbg.png)";this.p=b;c=this.pageHtml.childNodes[b-1];c.style.background="url(images/ui/dot.png)"}},
gotoPage:function(b){b<=this.pCount&&(this.listScroller.scroller.__publish((b-1)*this.scene[0],0),this.showPage())},setData:function(b,c){this.list=b;this.nowJoin=c;this.pCount=Math.ceil(this.list.length/4);if(0>=this.pCount)this.pCount=1;var e=document.createDocumentFragment();for(i=0;i<this.pCount;i++){var f=document.createElement("li");f.style.background="url(images/ui/dotbg.png)";f.style.width="15px";f.style.height="15px";e.appendChild(f)}this.pageHtml.innerHTML=null;this.pageHtml.appendChild(e);
this.showLayout();if(null==this.p)this.p=null!=this.nowJoin?Math.floor(this.nowJoin/4)+1:this.pCount;if(this.p>this.pCount)this.p=this.pCount;this.gotoPage(this.p)}},{CLOSE:"ChallengeView_close",SHOWMSG:"ChallengeView_SHOWMSG",SELECT_MAP:"ChallengeView_select_map"});puremvc.define({name:"app.view.system.PayView",parent:app.view.base.BaseUIForm,constructor:function(b){app.view.base.BaseUIForm.call(this,b.getContent("payInfo"),!0);this.init()}},{paid:null,paylevel:null,nextPay:null,nextPayNum:null,setData:function(b){this.paid=b.paid;this.paylevel=b.paylevel;this.nextPay=b.nextPay;this.nextPayNum=b.nextPayNum;this.showInfo()},init:function(){$("pay_close")[app.Event.ONCLICK]=ClassUtils.delegate(this,this.sendEvent,app.view.system.PayView.CLOSE);$("goPay")[app.Event.ONCLICK]=
ClassUtils.delegate(this,this.sendEvent,app.view.system.PayView.PAY)},showInfo:function(){var b=$("nextTip");$("pay_paid").innerHTML='<label class="fc1">'+this.paid+"\u91d1\u5e01</label>\uff1b";var c=0==this.paylevel?"\u666e\u901a\u4f1a\u5458":"\u4f1a\u5458"+this.paylevel+"\u7ea7";$("pay_nowlevel").innerHTML='<label class="fc9">'+c+"</label>";for(var c=(this.paylevel+"").split(""),e="",f=0;f<c.length;f++)isNaN(c[f])||(e+='<img src="images/ui/font_'+c[f]+'.png"  width="25" height="31">');$("pay_levelImg").innerHTML=
e;if(this.nextPay&&0<this.nextPay.length){b.innerHTML='<p>\u60a8\u518d\u5145\u503c<label class="fc1">'+(this.nextPayNum-this.paid)+'\u91d1\u5e01</label>\u5347\u7ea7\u4e3a<label class="fc9">\u4f1a\u5458'+(this.paylevel+1)+"\u7ea7</label>\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u6d88\u8d39\u9879\u76ee\uff1a</p>";for(f=0;f<this.nextPay.length;f++)b.innerHTML+="<p>"+(f+1)+"\uff0e"+this.nextPay[f]+"</p>"}else b.innerHTML="<p>\u60a8\u5df2\u7ecf\u8fbe\u5230\u4f1a\u5458\u6700\u9ad8\u7b49\u7ea7\uff0c\u4ee5\u540e\u6bcf\u6b21\u5145\u503c\u90fd\u5c06\u8fd4\u8fd8\u60a8\u5145\u503c\u91d1\u989d\u768410%\u7684\u91d1\u5e01\u3002</p>"},
sendEvent:function(b,c){this.dispatchEvent({type:c})}},{PAY:"PayView_pay",CLOSE:"PayView_close"});puremvc.define({name:"app.view.system.HeroFrameView",parent:app.view.base.TabContentView,constructor:function(b){app.view.base.TabContentView.call(this,b.getContent("tabContent"));this.init(b)}},{init:function(b){this.append("\u6b66\u5c06",b.getContent("dg_heros"));this.append("\u88c5\u5907",b.getContent("equip"));this.append("\u9635\u578b",b.getContent("dg_formation"));this.append("\u80cc\u5305",b.getContent("reinforce"))},setData:function(b,c,e,f,g){this.herosData=b;this.formation=c;this.bag=e;
this.strongTimer=f;this.formationHero=g;this.title.innerHTML="\u6b66\u5c06"},tabChange:function(b){app.view.base.TabContentView.prototype.tabChange.call(this,b);if(null!=this.herosData)switch(b){case 0:if(null==this.herosList)this.canvas=this.view.querySelector("#transferCanvas"),this.herosList=new app.view.building.DrillGroundHeros(this.herosData,ClassUtils.delegate(this,this.sendEvent),this.canvas);this.herosList.hideTabBottom();break;case 1:if(null==this.equipView)this.equipView=new app.view.building.EquipView(ClassUtils.delegate(this,
this.sendEvent));this.equipView.setBagData(this.bag);this.equipView.setHeroListData(this.herosData.onJobList,this.formationHero);this.equipView.heroListLayout();this.equipView.hideTabBottom();break;case 2:if(null==this.herosFormation)this.herosFormation=new app.view.building.DrillGroundFormation(ClassUtils.delegate(this,this.sendEvent));this.herosFormation.setData(this.herosData,this.formation);this.herosFormation.hideTabBottom();break;case 3:if(null==this.itemUpgradeView)this.itemUpgradeView=new app.view.system.ItemUpgradeView(ClassUtils.delegate(this,
this.sendEvent));this.itemUpgradeView.setData(this.bag,this.strongTimer);this.itemUpgradeView.showTabBottom()}},updateInfo:function(){null!=this.herosList&&this.herosList.showHeroInfo()},heroListUpdate:function(){null!=this.herosList&&this.herosList.layout();null!=this.herosFormation&&this.herosFormation.refreshHeros()},formationChange:function(){null!=this.herosFormation&&this.herosFormation.refresh()},refreshEquipFormation:function(b){this.formationHero=b;null!=this.equipView&&this.equipView.refreshFormation(b)},
showUserInfo:function(b){var c=this.bottom.getElementsByTagName("span");c[0].innerHTML="\u91d1\u5e01\uff1a"+b.goldCoin;c[0].className="fc1";c[1].innerHTML="\u94f6\u5e01\uff1a"+b.silverCoin+"/"+b.maxSilverCoin},sendEvent:function(b){this.dispatchEvent(b)},refreshStrongInfo:function(b){this.itemUpgradeView&&this.itemUpgradeView.refreshStrongInfo(b)},updateNowView:function(b){this.itemUpgradeView&&this.itemUpgradeView.updateNowView(b)},updateBag:function(){this.itemUpgradeView&&this.itemUpgradeView.setData(this.bag,
this.strongTimer)},setBagData:function(b){this.equipView&&this.equipView.setBagData(b)},equipFresh:function(){this.equipView&&this.equipView.heroListLayout()},depose:function(b){void 0==b&&(b=!1);if(null!=this.herosFormation&&!1==b&&!0==this.herosFormation.isFChange){var c=this,b=this.herosFormation.fData.formation[this.herosFormation.fIndex];app.view.Alert.getInstance().show("["+b.conf.name+"] \u4e2d\u7684\u6b66\u5c06\u6709\u8c03\u6574\uff0c\u662f\u5426\u9700\u8981\u4fdd\u5b58\uff1f",["\u786e\u5b9a",
"\u53d6\u6d88"],function(b){0==b?c.herosFormation.saveFormation():c.herosFormation.isFChange=!1;c.depose(!0)})}else this.dispatchEvent({type:app.view.system.HeroFrameView.CLOSE,target:this}),null!=this.herosList&&null!=this.herosList.scrollView&&this.herosList.scrollView.depose(),null!=this.herosFormation&&null!=this.herosFormation.scrollView&&this.herosFormation.scrollView.depose(),null!=this.herosFormation&&null!=this.herosFormation.formationView&&this.herosFormation.formationView.depose(),null!=
this.itemUpgradeView&&this.itemUpgradeView.depose(),null!=this.equipView&&this.equipView.depose(),this.bag=this.hallBuildVo=this.herosFormation=this.herosList=null,app.view.base.TabContentView.prototype.depose.call(this)},drawDevelopAnimation:function(){this.stage=new Stage(this.canvas);this.obj=app.GameData.GameResource.getContent("uieff_10_data");this.obj.images=[app.GameData.GameResource.getContent("uieff_10")];this.movie=new BitmapAnimation(new SpriteSheet(this.obj));this.movie.scaleX=this.stage.canvas.width/
this.obj.frames.width;this.movie.scaleY=this.stage.canvas.height/this.obj.frames.height;this.movie.gotoAndPlay(0);this.stage.addChild(this.movie);var b=this;this.canvas.parentNode[app.Event.ONCLICK]=function(){b.transfer()};Ticker.addListener(this.stage);Ticker.setFPS(16)},stopDevelopAnimation:function(){this.stage&&(Ticker.removeListener(this.stage),this.stage.clear())}},{CLOSE:"HeroFrameView_close"});puremvc.define({name:"app.view.system.ItemUpgradeView",constructor:function(b){app.controller.TimeController.getInstance().addListener(this);this.callFunc=b;this.selectDiv=document.createElement("div");this.selectDiv.style["background-image"]="url(images/ui/xuan_02.png)";this.selectDiv.style.position="absolute";this.selectDiv.style.width="47px";this.selectDiv.style.height="47px";this.selectDiv.id="selectDiv";this.init()}},{isUseGold:!1,bagData:null,lastSelect:null,selectEquip:null,ImgCon:null,dragSize:null,
strongTimer:null,prevS:0,scrollV:null,depose:function(){this.scrollV&&this.scrollV.depose();this.scrollV=null;app.controller.TimeController.getInstance().removeListener(this)},step:function(){null!=this.selectEquip&&-1!=this.selectEquip.canObtain?0>=this.selectEquip.canObtain.getTime()?(this.selectEquip=null,this.callFunc({type:app.view.system.ItemUpgradeView.ITEM_TIMEOUT})):this.itemGetTime.innerHTML='\u5269\u4f59\u65f6\u95f4\uff1a<label class="fc6">'+this.selectEquip.canObtain+"</label>":this.itemGetTime.innerHTML=
"";null!=this.strongTimer&&0<this.strongTimer.time.getTime()?(this.upGradeSpeedBtn.style.visibility="visible",this.upGradeTime.innerHTML='\u51b7\u5374\u65f6\u95f4\uff1a<label class="'+(this.strongTimer.full?"fc6":"fc4")+'">'+this.strongTimer.time.toString()+"</label>",this.upGradeSpeedBtn.disabled=0>=this.strongTimer.time.getTime()):(this.upGradeTime.innerHTML="",this.upGradeSpeedBtn.style.visibility="hidden")},init:function(){$("tab_bottom").style.display="block";this.upGradeTime=$("upGradeTime");
this.upGradeSpeedBtn=$("upgrateSpeed_btn");this.moveImg=$("p_reinforcelist");this.strengthenBtn=$("strengthenBtn");this.bagSizeDiv=$("bagSize");this.degraObtainBtn=$("degraObtainBtn");this.itemForces=$("itemForces3");this.container=$("container3");this.itemAtt=$("itemAtt3");this.itemGetTime=$("itemGetTime");this.useGoldBtn=$("useGoldBtn");this.degraObtainBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.workHandler,app.view.system.ItemUpgradeView.DEGRA_OBTAIN);this.upGradeSpeedBtn[app.Event.ONCLICK]=
ClassUtils.delegate(this,this.workHandler,app.view.system.ItemUpgradeView.CLEAR_STRONGTIMER);this.strengthenBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.upgradeItem,app.view.system.ItemUpgradeView.UPGRADE_EQUIP);$("sellBtn")[app.Event.ONCLICK]=ClassUtils.delegate(this,this.workHandler,app.view.system.ItemUpgradeView.SELL_EQUIP);$("useGoldBtn")[app.Event.ONCLICK]=ClassUtils.delegate(this,this.useGoldHandler)},setData:function(b,c){this.prevS=this.scrollV?this.scrollV.scroller.getValues().top:
0;this.refreshStrongInfo(b);this.bagData=b.storageAllList;this.bagPrice=b.bagPrice;this.bagSize=b.totalBagNum;this.bagEmpty=b.bagEmpty;this.strongTimer=c;if(null==this.lastSelect)this.lastSelect=0;if(this.lastSelect>this.bagData.length-1)this.lastSelect=this.bagData.length-1;this.layout(this.bagData,4,3,47,47,5,15);this.prevS=Math.min(this.prevS,this.scrollV.scroller.getScrollMax().top);this.scrollV.scroller.__publish(0,this.prevS,1);this.showPageInfo(this.lastSelect);this.showBagSize();this.step()},
buyBagSize:function(b,c){this.callFunc({type:c})},workHandler:function(b,c){(this.selectEquip||b.currentTarget==this.appointSpeedBtn)&&this.callFunc({type:c,target:this,data:this.selectEquip})},upgradeItem:function(b,c){this.selectEquip&&this.callFunc({type:c,target:this,data:{sel:this.selectEquip,force:this.isUseGold?1:0,gold:100-this.rate}})},showTabBottom:function(){$("tab_bottom").style.display="block"},itemSelect:function(b){if(!b||!isNaN(b.currentTarget.idx))this.lastSelect=b.currentTarget?
!b?0:b.currentTarget.idx:!b?0:b.touchs[0].currentTarget.idx,this.showPageInfo(this.lastSelect)},showPageInfo:function(b){void 0==b&&(b=0);this.lastSelect=b;var b=this.bagData,c,e;c=this.itemAtt.getElementsByTagName("span");if(this.selectEquip=b[this.lastSelect]){this.container.childNodes[this.lastSelect].appendChild(this.selectDiv);var f=b[this.lastSelect];e=['<label class="'+app.getStyle(f.getquality())+'">'+f.getItemName()+"</label>",f.level+"\u7ea7","\u6b66\u5c06"+f.getuseLevel()+"\u7ea7",f.getattrName()+
"+",f.getAtt(),f.upMoney,f.getTroop(),f.strike,f.fightBack,f.mitigate];this.itemForces.style.visibility=7==f.gettypeId()?"hidden":"visible";for(b=0;b<e.length;b++)c[b].innerHTML=e[b];this.degraObtainBtn.disabled=-1==f.canObtain&&1==f.level?"disabled":!1;this.strengthenBtn.disabled=-1!=f.canObtain?"disabled":!1;-1==f.canObtain?(this.degraObtainBtn.value="\u4e00\u952e\u964d\u7ea7",this.itemGetTime.style.display="none",this.useGoldBtn.style.display="block",this.strengthenBtn.disabled=!1):(this.degraObtainBtn.value=
"\u9886 \u53d6",this.itemGetTime.style.display="block",this.useGoldBtn.style.display="none",this.strengthenBtn.disabled="disabled");this.step()}else for(b=0;b<c.length;b++)c[b].innerHTML=""},showBagSize:function(){this.bagSizeDiv.innerHTML=this.bagSize-this.bagEmpty+"/"+this.bagSize},layout:function(b,c,e,f,g,h,j){var k;this.ImgCon=this.container;this.ImgCon.innerHTML="";this.dragSize=0;k=b.length;var l=app.GameData.imageSrc;Math.ceil(k/(c*e));for(var m,o=0;o<k;o++){m=this.getPos(o+1,c,e,f,g,h,j);
var q=b[o].heroName;this.createNew(o,l+"items/i_"+b[o].conId+".jpg",f,g,ClassUtils.delegate(this,this.itemSelect),m[0],m[1],q,45)}l=this.ImgCon.childNodes;for(o=0;o<b.length;o++)m=document.createElement("div"),m.id="itemLogo"+o,m.className=-1!=b[o].canObtain?"item_get_on":"item_nologo",l[o].appendChild(m);l=app.GameData.imageSrc;for(b=this.bagEmpty;0<b;)m=this.getPos(k+1,c,e,f,g,h,j),this.createNew(k+1,l+"ui/iconBg_01.png",f,g,null,m[0],m[1],"",0),b--,k++;k++;m=this.getPos(k,c,e,f,g,h,j);this.createNew(k,
l+"ui/iconBg_03.png",f,g,ClassUtils.delegate(this,this.buyBagSize,app.view.system.ItemUpgradeView.ADD_BAGSIZE),m[0],m[1],'\u589e\u52a0</br>\u80cc\u5305\u4f4d</br><label class="fc1">'+this.bagPrice+"</label>",0);var p=this.ImgCon,r=this.dragSize,u=this.moveImg,c=[203,165,203,this.dragSize];this.scrollV&&this.scrollV.depose();this.scrollV=null;this.ImgCon.style.width="203px";this.ImgCon.style.height=this.dragSize+"px";this.moveImg.style.visibility=0<this.dragSize?"visible":"hidden";this.scrollV=new app.view.base.ScrollView(function(b,
c){165<r&&(u.style["-webkit-transform"]="translateY("+129*(c/(r-165))+"px)");p.style["-webkit-transform"]="translateY("+-c+"px)"},c[0],c[1],c[2],c[3],this.ImgCon)},createNew:function(b,c,e,f,g,h,j,k,l){var m=document.createElement("div");m.style.position="absolute";m.idx=b;m.style.width=e+"px";m.style.height=f+"px";m.style["background-image"]="url("+c+")";m[app.Event.ONCLICK]=g;m.style.textAlign="center";m.innerHTML='<div style="top:'+l+'px;width:47px;position:absolute;text-align:center;color:white;text-shadow: 1px 1px 1px #000;">'+
k+"</div>";m.style.left=h+"px";m.style.top=j+"px";this.ImgCon.appendChild(m)},getPos:function(b,c,e,f,g,h,j){e=Math.ceil(b/c);this.dragSize=e*(g+j);return[(b-(e-1)*c-1)*(f+h),(e-1)*(g+j)]},useGoldHandler:function(){(this.isUseGold=!this.isUseGold)?(this.useGoldBtn.style["background-position"]="0 -18px",$("useGoldNum").style.visibility="visible"):(this.useGoldBtn.style["background-position"]="0 0",$("useGoldNum").style.visibility="hidden")},updateNowView:function(){this.showPageInfo(this.lastSelect)},
updateBagData:function(b,c,e){this.prevS=this.scrollV0.scroller.getValues().left;this.bagData=b.storageAllList;this.bagPrice=b.bagPrice;this.bagSize=b.totalBagNum;this.bagEmpty=b.bagEmpty;this.strongTimer=e;this.step();if(this.lastSelect>this.bagData.length-1)this.lastSelect=this.bagData.length-1;this.layout(this.bagData,4,3,47,47,5,15,1);this.showPageInfo(this.lastSelect);this.prevS=Math.min(this.prevS,this.scrollV0.scroller.getScrollMax().left);this.scrollV0.scroller.__publish(this.prevS,0,1)},
refreshStrongInfo:function(b){this.rate=b.strongRate;this.up=b.strongTrend;$("useGoldNum").innerHTML=" \u82b1\u8d39\u91d1\u5e01"+(100-this.rate);$("strongTrend").innerHTML=0<this.up?'<label class="fc9">'+this.rate+"%(\u4e0a\u5347\u4e2d)</label>":'<label class="fc4">'+this.rate+"%(\u4e0b\u964d\u4e2d)</label>"}},{UPGRADE_EQUIP:"upgradeEquip",DEGRADE_EQUIP:"degradeEquip",BUY_EQUIP:"buyEquip",LOCK_EQUIP:"lockEquip",PUT_EQUIP:"PUTEquip",DEGRA_OBTAIN:"degraObtain",SELL_EQUIP:"sellEquip",SHOW_APPOINTACC:"show_appointAcc",
CLEAR_STRONGTIMER:"clear_strongTimer",CLEAR_APPOINTTIMER:"clear_appointTimer",ITEM_TIMEOUT:"item_timeout",CLOSE:"close_storeView"});puremvc.define({name:"app.view.building.AchievementSingleView",parent:app.view.base.BaseUIForm},{achievementInfo:null,copyList:null,copyDiv:null,getDiv:null,selI:null,selItem:null,init:function(){this.closebtn=$("achievementS_close");this.closebtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.sendEvent,app.view.building.AchievementSingleView.CLOSE);this.copyDiv=$("achievementS_copyList");this.scoreDiv=$("achievementS_nowScore");this.AchInfo_Num=$("achievementS_Num");this.AchInfo_Level=$("achievementS_Level");
this.process=$("achievementS_process");this.moveBarImg=$("achievementS_bar")},layout:function(){var b,c,e=this;this.copyDiv.innerHTML="";this.achievementInfo=this.data.AchDetail;b=this.achievementInfo.length;c=34*b;for(var f=0;f<b;f++)this.copyDiv.appendChild(this.createNew(f,this.achievementInfo[f],138,31,3));this.dragSize=c;b=[138,157,138,c];this.moveBarImg.style.visibility=c>b[1]?"visible":"hidden";this.scroller&&this.scroller.depose();this.scroller=null;this.scroller=new app.view.base.ScrollView(function(b,
c){e.copyDiv.style["-webkit-transform"]="translateY("+-c+"px)";157<e.dragSize&&(e.moveBarImg.style["-webkit-transform"]="translateY("+139*(c/(e.dragSize-157))+"px)")},b[0],b[1],b[2],b[3],this.copyDiv)},createNew:function(b,c,e,f,g){b=document.createElement("div");b.style.width=e+"px";b.style.lineHeight=b.style.height=f+"px";b.style.textAlign="left";b.style.marginTop=g+"px";b.innerHTML='<div style="width:33px; padding-left:5px;float:left;text-align:center">'+c.score+'\u5206</div><div style="width:90px; padding-left:10px;float:left;">'+
c.reward.name+"x"+c.reward.value+"</div>";if(1==c.status)b.className="rwCHo_canNot",b[app.Event.ONMOUSE_DOWN]=null;else if(2==c.status){b.className="rwCHo_notGet";var h=this;b[app.Event.ONMOUSE_DOWN]=function(b){var e=0;b.target[app.Event.ONMOVE]=function(){e=1};b.target[app.Event.ONMOUSE_UP]=function(){0==e&&h.getEvent(app.view.building.AchievementSingleView.GET,c.id)}}}else b.className="rwCHo_get",b[app.Event.ONMOUSE_DOWN]=null,b.innerHTML+='<div class="jl2_ico_on"></div>';return b},setData:function(b){this.data=
b;this.init();this.scoreDiv.innerHTML="\u76ee\u524d\u79ef\u5206\uff1a"+b.score;this.layout();this.showInfo()},showInfo:function(){this.AchInfo_Num.innerHTML="";this.AchInfo_Level.innerHTML="";this.process.innerHTML=this.data.process+"%";var b,c;b=this.data.AchInfoNum.length;for(var e=0;e<b;e++){c=this.data.AchInfoNum[e];newDiv=document.createElement("div");newDiv.style.background="url(images/heros/hero_"+c.picId+".gif) center top no-repeat";newDiv.className="zsImg";var f='<p style=" margin-bottom:23px;color:white">5\u5206</p>',
f=f+('<p style="text-align:center;color:white;text-shadow: 1px 1px 1px #000;">'+c.name+"</p>"),f=f+('<p style="text-align:center;color:white">\u51fb\u8d25'+c.schedule+"/"+c.targetValue+"</p>");newDiv.innerHTML=f;this.AchInfo_Num.appendChild(newDiv)}b=this.data.AchInfoLevel.length;for(e=0;e<b;e++)c=this.data.AchInfoLevel[e],newDiv=document.createElement("div"),newDiv.className=2==c.status?"tz_on":"tz_out",f='<span class="tz_01">'+c.name+'</span><span class="tz_02 fc10">'+c.level+"</span>",newDiv.innerHTML=
f,this.AchInfo_Level.appendChild(newDiv)},getEvent:function(b,c){this.dispatchEvent({type:b,target:this,data:{mapId:this.data.mapId,param:c}})},sendEvent:function(b,c,e){this.dispatchEvent({type:c,target:this,data:{mapId:this.data.mapId,param:e}})}},{CLOSE:"AchievementSingleView_close",GET:"AchievementSingleView_get"});puremvc.define({name:"app.view.building.StoreFrameView",parent:app.view.base.TabContentView,constructor:function(b,c,e){app.view.base.TabContentView.call(this,b.getContent("tabContent"));this.init(b,c,e)}},{init:function(b,c,e){this.append("\u5175\u5668\u94fa",b.getContent("shop"));c&&this.append("\u7cae\u98df\u4e70\u5356",b.getContent("market"));e&&this.append("\u59d4\u6d3e",b.getContent("appoint"))},setData:function(b,c,e,f,g,h){this.buildLv=b;this.shop=c;this.appoint=e;this.market=g;this.userInfo=
h;this.aTimer=f;this.title.innerHTML="\u5e02\u573a("+b+"\u7ea7)"},tabChange:function(b){app.view.base.TabContentView.prototype.tabChange.call(this,b);if(null!=this.shop)switch(b){case 0:if(null==this.shopView)this.shopView=new app.view.building.ShopView(ClassUtils.delegate(this,this.sendEvent)),this.shopView.setData(this.shop);break;case 1:if(null==this.marketView)this.marketView=new app.view.building.MarketContentView(ClassUtils.delegate(this,this.sendEvent));this.marketView.setData(this.market,
this.userInfo);break;case 2:if(null==this.appointView)this.appointView=new app.view.building.AppointView(ClassUtils.delegate(this,this.sendEvent));this.appointView.setData(this.appoint,this.aTimer);this.appointView.updateBagData()}},showUserInfo:function(b){this.userInfo=b;var c=this.bottom.getElementsByTagName("span");c[0].innerHTML="\u91d1\u5e01\uff1a"+b.goldCoin;c[0].className="fc1";c[1].innerHTML="\u94f6\u5e01\uff1a"+b.silverCoin+"/"+b.maxSilverCoin},sendEvent:function(b){this.dispatchEvent(b)},
updateAppointData:function(b){this.appoint=b;null!=this.appointView&&this.appointView.setData(this.appoint,this.aTimer)},updateBagData:function(b){null!=this.appointView&&this.appointView.updateBagData(b)},refreshMarket:function(){null!=this.marketView&&this.marketView.setData(this.market,this.userInfo)},depose:function(){this.sendEvent({type:app.view.building.StoreFrameView.CLOSE});null!=this.appointView&&this.appointView.depose();this.appointView=null;app.view.base.TabContentView.prototype.depose.call(this)}},
{CLOSE:"DrillGroundView_close"});puremvc.define({name:"app.view.building.ShopView",constructor:function(b){this.callFunc=b;this.selectDiv=document.createElement("div");this.selectDiv.style["background-image"]="url(images/ui/xuan_02.png)";this.selectDiv.style.position="absolute";this.selectDiv.style.width="47px";this.selectDiv.style.height="47px";this.selectDiv.id="selectDiv";this.init()}},{shopData:null,userData:null,selectEquip:null,ImgCon:null,dragSize:null,scrollV:null,depose:function(){this.scrollV&&this.scrollV.depose();this.scrollV=
null},init:function(){this.pageNext1=$("pageNext1");this.pagePrev1=$("pagePrev1");this.container=$("container1");this.pageDiv=$("pageDiv1");this.itemAtt=$("itemAtt1");this.itemForces=$("itemForces1");this.buyBtn=$("buyBtn");this.pagePrev1[app.Event.ONCLICK]=ClassUtils.delegate(this,this.gotoPage,0);this.pageNext1[app.Event.ONCLICK]=ClassUtils.delegate(this,this.gotoPage,1);this.buyBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.workHandler,app.view.building.ShopView.BUY_EQUIP)},gotoPage:function(b,
c){var e=this.scrollV.scroller.getValues().left;0==c?1<this.currentPage&&this.scrollV.scroller.__publish(e-275,0,1):this.currentPage<this.pageNum&&this.scrollV.scroller.__publish(e+275,0,1);this.showPage()},showPage:function(){if(null!=this.scrollV){this.currentPage=Math.ceil(this.scrollV.scroller.getValues().left/273);if(this.currentPage>this.pageNum)this.currentPage=this.pageNum;if(0>=this.currentPage)this.currentPage=1;if(0>=this.pageNum)this.pageNum=1;if(this.pageDiv)this.pageDiv.innerHTML=this.currentPage+
"/"+this.pageNum}},setData:function(b){this.shopData=b;this.layout(this.shopData,1,3,47,47,8,5);this.showPageInfo(0);this.showPage()},workHandler:function(b,c){this.selectEquip&&this.callFunc({type:c,target:this,data:this.selectEquip})},itemSelect:function(b){if(!b||!isNaN(b.currentTarget.idx))this.lastSelect=b.currentTarget?!b?0:b.currentTarget.idx:!b?0:b.touchs[0].currentTarget.idx,this.showPageInfo(this.lastSelect)},showPageInfo:function(b){void 0==b&&(b=0);this.lastSelect=b;n=this.shopData;var c,
e;c=this.itemAtt.getElementsByTagName("span");if(this.selectEquip=b=n[this.lastSelect]){this.container.childNodes[this.lastSelect].appendChild(this.selectDiv);e=['<label class="'+app.getStyle(b.getquality())+'">'+b.getItemName()+"</label>1\u7ea7","\u6b66\u5c06"+b.getuseLevel()+"\u7ea7",b.getattrName()+"+",b.getAtt(),b.getBuyTypeName(),b.price,b.getTroop(),b.strike,b.fightBack,b.mitigate,b.getBuyNumString()];this.itemForces.style.visibility=7==b.gettypeId()?"hidden":"visible";for(b=0;b<c.length;b++)c[b].innerHTML=
e[b]}else for(b=0;b<c.length;b++)c[b].innerHTML=""},layout:function(b,c,e,f,g,h,j){var k;this.ImgCon=this.container;this.ImgCon.innerHTML="";this.dragSize=0;this.pageNum=Math.ceil(b.length/14);k=b.length;var l=app.GameData.imageSrc;Math.ceil(k/(c*e));for(var m,o=0;o<k;o++)m=this.getPos(o+1,c,e,f,g,h,j),this.createNew(o,l+"items/i_"+b[o].conId+".jpg",f,g,ClassUtils.delegate(this,this.itemSelect),m[0],m[1],"",0);for(b=14*(Math.floor(k/14)+1);k<b;)m=this.getPos(k+1,c,e,f,g,h,j),this.createNew(k+1,l+
"ui/iconBg_02.png",f,g,null,m[0],m[1],""),k++;var q=this.ImgCon,p=this;this.scrollV&&this.scrollV.depose();this.scrollV=null;this.ImgCon.style.width=this.dragSize+"px";this.ImgCon.style.height="100px";c=[275,152,this.dragSize,100];this.scrollV=new app.view.base.ScrollView(function(b){q.style["-webkit-transform"]="translateX("+-b+"px)";p.showPage()},c[0],c[1],c[2],c[3],this.ImgCon,{scrollingY:!1,paging:!0,bouncing:!0})},createNew:function(b,c,e,f,g,h,j,k,l){var m=document.createElement("div");m.style.position=
"absolute";m.idx=b;m.style.width=e+"px";m.style.height=f+"px";m.style["background-image"]="url("+c+")";m[app.Event.ONCLICK]=g;m.style.textAlign="center";m.innerHTML='<div style="top:'+l+'px;width:47px;height:47px;position:absolute;text-align:center;color:white;text-shadow: 1px 1px 1px #000;">'+k+"</div>";m.style.left=h+"px";m.style.top=j+"px";this.ImgCon.appendChild(m)},getPos:function(b,c,e,f,g,h,j){var k=Math.ceil(b/c),l=b-(k-1)*c,k=Math.ceil(k/e),b=Math.ceil((b-(k-1)*c*e)/c);this.dragSize=1<b?
k*(f+h)*c:((k-1)*c+l)*(f+h);return[((k-1)*c+l-1)*(f+h),(b-1)*(g+j)]}},{BUY_EQUIP:"buyEquip"});puremvc.define({name:"app.view.building.AppointView",constructor:function(b){app.controller.TimeController.getInstance().addListener(this);this.callFunc=b;this.selectDiv=document.createElement("div");this.selectDiv.style["background-image"]="url(images/ui/xuan_02.png)";this.selectDiv.style.position="absolute";this.selectDiv.style.width="47px";this.selectDiv.style.height="47px";this.selectDiv.id="selectDiv";this.init();this.appointPerCon=["\u5546\u4eba","\u5de8\u8d3e","\u5bcc\u7fc1","\u5bcc\u7532"];
this.appointPerType=["\u6218\u7b56","\u5fa1\u7b56","\u6218\u9a6c\u4e0e\u4e66\u7c4d","\u5934\u76d4\u4e0e\u76fe\u724c"]}},{appointData1:null,appointData2:null,appointItem:null,selectAppoint:null,ImgCon:null,appointPt:null,appointTimer:null,appointPerCon:null,appointPerType:null,appointPrev:0,depose:function(){app.controller.TimeController.getInstance().removeListener(this)},step:function(){null!=this.appointTimer.time&&0<this.appointTimer.time.getTime()?(this.appointSpeedBtn.style.visibility="visible",
this.appointTime.innerHTML='\u51b7\u5374\u65f6\u95f4\uff1a<label class="'+(this.appointTimer.full?"fc6":"fc4")+'">'+this.appointTimer.time.toString()+"</label>",this.appointSpeedBtn.disabled=0>=this.appointTimer.time.getTime()):(this.appointTime.innerHTML="",this.appointSpeedBtn.style.visibility="hidden")},init:function(){this.appointTime=$("appointTime");this.appoinPerson1=$("appoinPerson1");this.appoinPerson2=$("appoinPerson2");this.appointSpeedBtn=$("appointSpeed_btn");this.itemAtt=$("itemAtt2");
this.itemAtt3Image=$("itemAtt3Image");this.itemForces=$("itemForces2");this.appointInfo=$("appointInfo");this.appointAccBtn=$("appointAccBtn");this.appointBtn=$("appointBtn");this.appointSell=$("appointSell");this.appointSpeedBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.workHandler,app.view.building.AppointView.CLEAR_APPOINTTIMER);this.appointAccBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.showAppointAcc);this.appointBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.sendAppoint);
this.appointSell[app.Event.ONCLICK]=ClassUtils.delegate(this,this.workHandler,app.view.building.AppointView.SELL_EQUIP)},setData:function(b,c){this.appointData1=b.weapon;this.appointData2=b.armor;this.appointTimer=c;this.showAppoint();this.showPageInfo()},workHandler:function(b,c){(this.appointItem||b.currentTarget==this.appointSpeedBtn)&&this.callFunc({type:c,target:this,data:this.appointItem})},showAppoint:function(){var b=this.appoinPerson1.children,c=this.appoinPerson2.children,e,f,g=app.GameData.imageSrc;
if(null==this.appointTimer||0>=this.appointTimer.length)this.appointAccBtn.disabled=!0,this.appointBtn.disabled=!0,this.appointSell.disabled=!0;else{this.appointAccBtn.disabled=!1;this.appointBtn.disabled=!1;this.appointSell.disabled=!1;for(e=0;e<b.length;e++)this.appointData1[e]&&!isNaN(this.appointData1[e].id)?(b[e].style["background-image"]="url("+g+"ren/w_"+(this.appointData1[e].id+1)+".gif)",b[e].idx=this.appointData1[e].id,b[e][app.Event.ONCLICK]=ClassUtils.delegate(this,this.appointSelect,
this.appointData1[e]),f=this.appointData1[e].id):(b[e].style["background-image"]="url("+g+"ui/iconBg_04.gif)",b[e].idx=null,b[e][app.Event.ONCLICK]=null);for(e=0;e<c.length;e++)this.appointData2[e]&&!isNaN(this.appointData2[e].id)?(c[e].style["background-image"]="url("+g+"ren/w_"+(this.appointData2[e].id+5)+".gif)",c[e].idx=this.appointData2[e].id,c[e][app.Event.ONCLICK]=ClassUtils.delegate(this,this.appointSelect,this.appointData2[e]),1==this.appointPrev&&(f=this.appointData2[e].id)):(c[e].style["background-image"]=
"url("+g+"ui/iconBg_04.gif)",c[e].idx=null,c[e][app.Event.ONCLICK]=null);1==this.appointPrev?this.showAppointPer(c[f],this.appointData2[f]):this.showAppointPer(b[f],this.appointData1[f])}},appointSelect:function(b,c){if(!b||!isNaN(b.currentTarget.idx))this.selectAppoint=!b?this.appointData1[0]:c,this.showAppointPer(b.currentTarget,c)},showAppointPer:function(b,c){this.selectAppoint=c;this.appointPrev=this.selectAppoint.type;var e=this.selectAppoint.id,f=this.selectAppoint.type;this.appointPt=f;b.appendChild(this.selectDiv);
var g=this.appointInfo.getElementsByTagName("span");g[0].innerHTML=this.appointPerType[f]+this.appointPerCon[e];g[1].innerHTML="\u80fd\u591f\u83b7\u5f97"+this.appointPerType[f+2];g[2].innerHTML="\u82b1\u8d39\u94f6\u5e01:"+this.selectAppoint.money},sendAppoint:function(){this.selectAppoint&&this.callFunc({type:app.view.building.AppointView.APPOINT,target:this,data:this.selectAppoint})},showPageInfo:function(){var b,c,e=app.GameData.imageSrc;b=this.itemAtt.getElementsByTagName("span");if(this.appointItem){var f=
this.appointItem;c=['<label class="'+app.getStyle(f.getquality())+'">'+f.getItemName()+"</label>1\u7ea7","\u6b66\u5c06"+f.getuseLevel()+"\u7ea7",f.getattrName()+"+",f.getAtt(),f.getTroop(),f.strike,f.fightBack,f.mitigate,f.getSellPrice()];this.itemAtt3Image.style["background-image"]="url("+e+"items/i_"+f.conId+".jpg)";this.itemForces.style.visibility=7==f.gettypeId()?"hidden":"visible";for(f=0;f<c.length;f++)b[f].innerHTML=c[f]}else{for(f=0;f<b.length;f++)b[f].innerHTML="";this.itemAtt3Image.style["background-image"]=
"url("+e+"ui/iconBg_02.png)"}},updateBagData:function(b){this.appointItem=b;this.showPageInfo()},showAppointAcc:function(){this.callFunc({type:app.view.building.AppointView.SHOW_APPOINTACC,target:this})}},{SELL_EQUIP:"sellEquip",APPOINT:"appoint",SHOW_APPOINTACC:"show_appointAcc",CLEAR_APPOINTTIMER:"clear_appointTimer"});puremvc.define({name:"app.view.building.HubuFrameView",parent:app.view.base.TabContentView,constructor:function(b,c){app.view.base.TabContentView.call(this,b.getContent("tabContent"));this.init(b,c)}},{init:function(b,c){this.append("\u5f81\u6536",b.getContent("levy"));c&&this.append("\u751f\u4ea7",b.getContent("workShop"))},setData:function(b,c,e,f,g,h){this.buildLv=b;this.levyData=c;this.workShop=e;this.userInfo=h;this.lTimer=f;this.wTimer=g;this.title.innerHTML="\u6237\u90e8("+b+"\u7ea7)"},tabChange:function(b){app.view.base.TabContentView.prototype.tabChange.call(this,
b);if(null!=this.levyData)switch(b){case 0:if(null==this.levyView)this.levyView=new app.view.building.LevyView(ClassUtils.delegate(this,this.sendEvent));this.updateLevyData();break;case 1:if(null==this.workShopView)this.workShopView=new app.view.building.WorkShopView(ClassUtils.delegate(this,this.sendEvent));this.workShopView.setData(this.workShop,this.wTimer)}},showUserInfo:function(b){this.userInfo=b;var c=this.bottom.getElementsByTagName("span");c[0].innerHTML="\u91d1\u5e01\uff1a"+b.goldCoin;c[0].className=
"fc1";c[1].innerHTML="\u94f6\u5e01\uff1a"+b.silverCoin+"/"+b.maxSilverCoin},sendEvent:function(b){this.dispatchEvent(b)},updateLevyData:function(){this.levyView&&(this.levyView.setLevyData(this.levyData,this.userInfo),this.levyView.setLevyTime(this.lTimer))},updateGoodInfo:function(b){this.workShopView&&this.workShopView.updateGoodInfo(b)},depose:function(){this.sendEvent({type:app.view.building.HubuFrameView.CLOSE});null!=this.levyView&&this.levyView.depose();this.levyView=null;app.view.base.TabContentView.prototype.depose.call(this)}},
{CLOSE:"HubuFrameView_close"});puremvc.define({name:"app.view.building.LevyView",constructor:function(b){this.callFunc=b;this.init();app.controller.TimeController.getInstance().addListener(this)}},{userData:null,levyData:null,levyIndicate:null,init:function(){this.timeLine=$("time_line");this.timeInfo=$("time_info");this.speedBtn=$("speedup_btn");this.levyBtn=$("levy_btn");this.forcedBtn=$("impress_btn");this.levyinfo=$("levyinfo");this.homeinfo_ul=$("homeinfo_ul");this.content_evt=$("content_evt");this.no_evt=$("no_evt");this.speedBtn[app.Event.ONCLICK]=
ClassUtils.delegate(this,this.speedUpHandler);this.levyBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.levyHandler);this.forcedBtn[app.Event.ONCLICK]=ClassUtils.delegate(this,this.forcedHandler)},setLevyData:function(b,c){this.levyData=b;this.userData=c;var e=this.levyinfo,f=e.getElementsByTagName("span");f[0].innerHTML=b.gainSilverCoin;f[2].innerHTML=b.forcedGoldCoin;e=this.homeinfo_ul;f=e.getElementsByTagName("span");f[0].innerHTML=b.popularFeeling;f[1].innerHTML=b.people;f[2].innerHTML=b.development;
f[3].innerHTML=b.account;f[4].innerHTML=b.tax;f[5].innerHTML=b.coinage;if(0<b.incident){var g=app.data.DataBase.getInstance().getLevyEvent(b.incident);if(null!=g)e=this.content_evt,f=e.getElementsByTagName("div"),f[1].innerHTML=g.content,f=f[2].getElementsByTagName("span"),f[0].innerHTML=g.choose1,f[1].innerHTML=g.choose2,e.style.display="block",this.no_evt.style.display="none",f[0][app.Event.ONCLICK]=ClassUtils.delegate(this,this.chooseHandler,0),f[1][app.Event.ONCLICK]=ClassUtils.delegate(this,
this.chooseHandler,1)}},chooseHandler:function(b,c){this.content_evt.style.display="none";this.no_evt.style.display="block";this.callFunc({type:app.view.building.LevyView.CHOOSE,target:this,data:c})},speedUpHandler:function(b){b.target.disabled||0<this.levyIndicate.time.getTime()&&this.callFunc({type:app.view.building.LevyView.CLEAR_FREEZE,target:this,data:this.levyIndicate})},levyHandler:function(b){b.target.disabled||this.callFunc({type:app.view.building.LevyView.LEVY,data:this.levyIndicate,target:this})},
forcedHandler:function(b){b.target.disabled||this.callFunc({type:app.view.building.LevyView.FORCED_LEVY,target:this})},setLevyTime:function(b){this.levyIndicate=b;this.levyinfo.getElementsByTagName("span")[1].innerHTML=b.num+"/"+b.maxNum;this.step()},step:function(){var b=!1;if(null!=this.levyIndicate){this.timeInfo.innerHTML=this.levyIndicate.time.toString();b=0>=this.levyIndicate.time.getTime();if(this.speedBtn)this.speedBtn.disabled=b;if(this.levyBtn)this.levyBtn.disabled=!(0<this.levyIndicate.num);
if(b){if(""==this.timeLine.style.visibility||"visible"==this.timeLine.style.visibility)this.timeLine.style.visibility="hidden"}else"hidden"==this.timeLine.style.visibility&&(this.timeLine.style.visibility="visible")}},depose:function(){this.speedBtn[app.Event.ONCLICK]=null;this.levyBtn[app.Event.ONCLICK]=null;this.forcedBtn=this.levyBtn=this.speedBtn=this.forcedBtn[app.Event.ONCLICK]=null;app.controller.TimeController.getInstance().removeListener(this)}},{CHOOSE:"choose",LEVY:"levy",FORCED_LEVY:"forcedLevy",
CLEAR_FREEZE:"clearFreeze"});puremvc.define({name:"app.view.system.BattleLoseGuideView",parent:app.view.base.BaseUIForm,constructor:function(b,c){app.view.base.BaseUIForm.call(this,b,!0);this.status=c;this.init()}},{init:function(){this.html_container=$("container");this.html_handleBtn=$("handleBtn");this.html_guide_close=$("guide_close");this.html_guide_close.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_handleBtn.addEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.handle));this.layout()},
layout:function(){0==this.status?(this.html_handleBtn.innerHTML="\u5f3a\u5316\u88c5\u5907",this.html_container.style.background="url(images/ui/zhiyin0.jpg) no-repeat"):1==this.status?(this.html_handleBtn.innerHTML="\u5347\u7ea7\u79d1\u6280",this.html_container.style.background="url(images/ui/zhiyin1.jpg) no-repeat"):(this.html_handleBtn.innerHTML="\u66f4\u6362\u9635\u5f62",this.html_container.style.background="url(images/ui/zhiyin2.jpg) no-repeat")},handle:function(){this.dispatchEvent({type:app.view.system.BattleLoseGuideView.HANDLE,
target:this,data:this.status})},close:function(){this.dispatchEvent({type:app.view.system.BattleLoseGuideView.CLOSE,target:this})},depose:function(){this.html_guide_close.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.close));this.html_handleBtn.removeEventListener(app.Event.CLICK,ClassUtils.delegate(this,this.handle));app.view.base.BaseUIForm.prototype.depose.call(this)}},{CLOSE:"BattleLoseGuide_close",HANDLE:"BattleLoseGuide_handle"});